[
    {"url": "https://api.github.com/repos/rails/rails/issues/48981", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48981/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48981/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48981/events", "html_url": "https://github.com/rails/rails/issues/48981", "id": 1857886744, "node_id": "I_kwDNIULObr0aGA", "number": 48981, "title": "g", "user": {"login": "gallegosdamian505", "id": 135607805, "node_id": "U_kgDOCBU1_Q", "avatar_url": "https://avatars.githubusercontent.com/u/135607805?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gallegosdamian505", "html_url": "https://github.com/gallegosdamian505", "followers_url": "https://api.github.com/users/gallegosdamian505/followers", "following_url": "https://api.github.com/users/gallegosdamian505/following{/other_user}", "gists_url": "https://api.github.com/users/gallegosdamian505/gists{/gist_id}", "starred_url": "https://api.github.com/users/gallegosdamian505/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gallegosdamian505/subscriptions", "organizations_url": "https://api.github.com/users/gallegosdamian505/orgs", "repos_url": "https://api.github.com/users/gallegosdamian505/repos", "events_url": "https://api.github.com/users/gallegosdamian505/events{/privacy}", "received_events_url": "https://api.github.com/users/gallegosdamian505/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-19T22:15:25Z", "updated_at": "2023-08-19T22:17:07Z", "closed_at": "2023-08-19T22:17:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "`###` Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# Your reproduction script goes here\r\n```\r\n\r\n### Expected behavior\r\n<!-- Tell us what should happen -->\r\n\r\n### Actual behavior\r\n<!-- Tell us what happens instead -->\r\n\r\n### System configuration\r\n**Rails version**:\r\n\r\n**Ruby version**:\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48981/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48981/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48980", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48980/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48980/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48980/events", "html_url": "https://github.com/rails/rails/pull/48980", "id": 1857675128, "node_id": "PR_kwDNIULOWEy_Vg", "number": 48980, "title": "Wordsmitthing and replaced all NBSP's with a single space for Assets Pipeline guide", "user": {"login": "vipulnsward", "id": 567626, "node_id": "MDQ6VXNlcjU2NzYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/567626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vipulnsward", "html_url": "https://github.com/vipulnsward", "followers_url": "https://api.github.com/users/vipulnsward/followers", "following_url": "https://api.github.com/users/vipulnsward/following{/other_user}", "gists_url": "https://api.github.com/users/vipulnsward/gists{/gist_id}", "starred_url": "https://api.github.com/users/vipulnsward/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vipulnsward/subscriptions", "organizations_url": "https://api.github.com/users/vipulnsward/orgs", "repos_url": "https://api.github.com/users/vipulnsward/repos", "events_url": "https://api.github.com/users/vipulnsward/events{/privacy}", "received_events_url": "https://api.github.com/users/vipulnsward/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-19T11:05:52Z", "updated_at": "2023-08-19T16:18:10Z", "closed_at": "2023-08-19T16:18:07Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48980", "html_url": "https://github.com/rails/rails/pull/48980", "diff_url": "https://github.com/rails/rails/pull/48980.diff", "patch_url": "https://github.com/rails/rails/pull/48980.patch", "merged_at": "2023-08-19T16:18:07Z"}, "body": null, "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48980/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48980/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48979", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48979/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48979/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48979/events", "html_url": "https://github.com/rails/rails/issues/48979", "id": 1857647382, "node_id": "I_kwDNIULObrlzFg", "number": 48979, "title": "Rails 7.0.7 regression collection caching JSON", "user": {"login": "javinto", "id": 363831, "node_id": "MDQ6VXNlcjM2MzgzMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/363831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/javinto", "html_url": "https://github.com/javinto", "followers_url": "https://api.github.com/users/javinto/followers", "following_url": "https://api.github.com/users/javinto/following{/other_user}", "gists_url": "https://api.github.com/users/javinto/gists{/gist_id}", "starred_url": "https://api.github.com/users/javinto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/javinto/subscriptions", "organizations_url": "https://api.github.com/users/javinto/orgs", "repos_url": "https://api.github.com/users/javinto/repos", "events_url": "https://api.github.com/users/javinto/events{/privacy}", "received_events_url": "https://api.github.com/users/javinto/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-19T09:15:53Z", "updated_at": "2023-08-19T09:30:03Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\nWithin index.json.jbuilder I have\r\n\r\n```ruby\r\njson.array! records, partial: 'view1', as: :model, cached: Proc.new{|record| [record, params.key?(:marker), record.geo_coordinates==geo_point] }\r\n```\r\n\r\n### Expected behavior\r\nRails 7.0.6 gives me JSON output\r\n\r\n### Actual behavior\r\nRails 7.0.7 gives me \r\n\r\n```\r\nNoMethodError: undefined method `to_str' for {\"longitude\"=>3.88933, \"latitude\"=>51.50608, ...}:Hash (NoMethodError)\r\n\r\n            if fragment = rendered_partial.body&.to_str\r\n                                               ^^^^^^^^\r\nDid you mean?  to_set\r\n               to_s\r\n\r\n```\r\n### System configuration\r\n**Rails version**: 7.0.7\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48979/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48979/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48978", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48978/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48978/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48978/events", "html_url": "https://github.com/rails/rails/pull/48978", "id": 1857550890, "node_id": "PR_kwDNIULOWEsqQg", "number": 48978, "title": "Alias scope merge fix", "user": {"login": "paulreece", "id": 96156234, "node_id": "U_kgDOBbs6Sg", "avatar_url": "https://avatars.githubusercontent.com/u/96156234?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paulreece", "html_url": "https://github.com/paulreece", "followers_url": "https://api.github.com/users/paulreece/followers", "following_url": "https://api.github.com/users/paulreece/following{/other_user}", "gists_url": "https://api.github.com/users/paulreece/gists{/gist_id}", "starred_url": "https://api.github.com/users/paulreece/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paulreece/subscriptions", "organizations_url": "https://api.github.com/users/paulreece/orgs", "repos_url": "https://api.github.com/users/paulreece/repos", "events_url": "https://api.github.com/users/paulreece/events{/privacy}", "received_events_url": "https://api.github.com/users/paulreece/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}, {"id": 123812746, "node_id": "MDU6TGFiZWwxMjM4MTI3NDY=", "url": "https://api.github.com/repos/rails/rails/labels/activejob", "name": "activejob", "color": "5319e7", "default": false, "description": null}, {"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-19T04:19:11Z", "updated_at": "2023-08-19T21:54:13Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48978", "html_url": "https://github.com/rails/rails/pull/48978", "diff_url": "https://github.com/rails/rails/pull/48978.diff", "patch_url": "https://github.com/rails/rails/pull/48978.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThis branch allows a user to set \"self.table_alias\" in the model to custom set a table alias.  It then accounts for the SQL needed for this in the AST.  \r\n\r\n### Detail\r\n\r\nSince Arel ends up combining two different Queries in this specific use case, it seemed to make the most sense to reuse the Alias in the WHERE condition.  I think for most use cases we still want to use the `association` if the `reflection.options` hash includes `:class_name`.  This fix ensures the continued use of that behavior.\r\n\r\n### Additional information\r\n\r\nWIP. Open to suggestions.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [ X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48978/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48978/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48977", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48977/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48977/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48977/events", "html_url": "https://github.com/rails/rails/pull/48977", "id": 1857495760, "node_id": "PR_kwDNIULOWEpndw", "number": 48977, "title": "Fix `webdrivers` on `7-0-stable` branch for issue #48973.", "user": {"login": "ruyrocha", "id": 108208, "node_id": "MDQ6VXNlcjEwODIwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/108208?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ruyrocha", "html_url": "https://github.com/ruyrocha", "followers_url": "https://api.github.com/users/ruyrocha/followers", "following_url": "https://api.github.com/users/ruyrocha/following{/other_user}", "gists_url": "https://api.github.com/users/ruyrocha/gists{/gist_id}", "starred_url": "https://api.github.com/users/ruyrocha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ruyrocha/subscriptions", "organizations_url": "https://api.github.com/users/ruyrocha/orgs", "repos_url": "https://api.github.com/users/ruyrocha/repos", "events_url": "https://api.github.com/users/ruyrocha/events{/privacy}", "received_events_url": "https://api.github.com/users/ruyrocha/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-19T02:37:47Z", "updated_at": "2023-08-19T03:11:33Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48977", "html_url": "https://github.com/rails/rails/pull/48977", "diff_url": "https://github.com/rails/rails/pull/48977.diff", "patch_url": "https://github.com/rails/rails/pull/48977.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because #48973 \r\n\r\n### Detail\r\n\r\nThis Pull Request changes the requirement for `webdrivers` gem.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [ ] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48977/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48977/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48976", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48976/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48976/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48976/events", "html_url": "https://github.com/rails/rails/issues/48976", "id": 1857192729, "node_id": "I_kwDNIULObrKDGQ", "number": 48976, "title": "Unexpected `schema.rb` change when using `db:migrate:redo` or `db:migrate` after a `db:reset`", "user": {"login": "manuelvanrijn", "id": 331876, "node_id": "MDQ6VXNlcjMzMTg3Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/331876?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manuelvanrijn", "html_url": "https://github.com/manuelvanrijn", "followers_url": "https://api.github.com/users/manuelvanrijn/followers", "following_url": "https://api.github.com/users/manuelvanrijn/following{/other_user}", "gists_url": "https://api.github.com/users/manuelvanrijn/gists{/gist_id}", "starred_url": "https://api.github.com/users/manuelvanrijn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manuelvanrijn/subscriptions", "organizations_url": "https://api.github.com/users/manuelvanrijn/orgs", "repos_url": "https://api.github.com/users/manuelvanrijn/repos", "events_url": "https://api.github.com/users/manuelvanrijn/events{/privacy}", "received_events_url": "https://api.github.com/users/manuelvanrijn/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-18T19:28:06Z", "updated_at": "2023-08-18T19:34:51Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```console\r\n# Clone/setup the example project\r\ngit clone https://github.com/manuelvanrijn/rails-issue-reset-migrate-vs-reset-migrate-redo.git\r\ncd rails-issue-reset-migrate-vs-reset-migrate-redo\r\nbin/setup\r\n\r\n# db:reset db:migrate scenario\r\nbin/rails db:reset db:migrate\r\n# At this point the schema.rb file is changed \ud83e\udd14\r\n\r\n# Reset the schema\r\ngit checkout db/schema.rb\r\n\r\n# db:reset db:migrate:redo scenario\r\nbin/rails db:reset db:migrate:redo STEP=1\r\n# Schema file did not change \ud83d\ude44\r\n```\r\n\r\n### Expected behavior\r\nWhen performing a `db:reset` with a `db:migrate:redo` or `db:migrate`, I wouldn't expect the schema.rb file to change. In my case, I'm running the `db:migrate:redo` in a CI task to see if the schema doesn't change, but in this case it does.\r\nIt has to have something to do with the `where` in the `add_index` but I was unable to figure out why the SchemaDumper would give a different outcome.\r\n\r\n### Actual behavior\r\nChanges the `schema.rb` file to a bit of different syntax, but as far as I can tell is still a valid one.\r\n```diff\r\n-    t.index [\"name\"], name: \"index_blogs_on_name\", unique: true, where: \"(((state)::text <> ALL ((ARRAY['finished'::character varying, 'expired'::character varying])::text[])) AND (created_at > '2018-09-01 00:00:00'::timestamp without time zone))\"\r\n+    t.index [\"name\"], name: \"index_blogs_on_name\", unique: true, where: \"(((state)::text <> ALL (ARRAY[('finished'::character varying)::text, ('expired'::character varying)::text])) AND (created_at > '2018-09-01 00:00:00'::timestamp without time zone))\"\r\n```\r\n\r\nSetting the `config.active_record.schema_format = :sql` give's the same outcome\r\n\r\n### System configuration\r\n**Rails version**: github#main\r\n\r\n**Ruby version**: 3.2.2\r\n ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48976/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48976/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48975", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48975/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48975/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48975/events", "html_url": "https://github.com/rails/rails/issues/48975", "id": 1857100531, "node_id": "I_kwDNIULObrEa8w", "number": 48975, "title": "rails-ujs ignores submission value of form-associated custom elements", "user": {"login": "khuston", "id": 4020899, "node_id": "MDQ6VXNlcjQwMjA4OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/4020899?v=4", "gravatar_id": "", "url": "https://api.github.com/users/khuston", "html_url": "https://github.com/khuston", "followers_url": "https://api.github.com/users/khuston/followers", "following_url": "https://api.github.com/users/khuston/following{/other_user}", "gists_url": "https://api.github.com/users/khuston/gists{/gist_id}", "starred_url": "https://api.github.com/users/khuston/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/khuston/subscriptions", "organizations_url": "https://api.github.com/users/khuston/orgs", "repos_url": "https://api.github.com/users/khuston/repos", "events_url": "https://api.github.com/users/khuston/events{/privacy}", "received_events_url": "https://api.github.com/users/khuston/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-18T18:08:52Z", "updated_at": "2023-08-18T18:08:52Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Preface\r\n\r\nBest practice when designing a form-associated custom element would be to have interface parity with `HTMLInputElement`, especially the value attribute's behavior (e.g. only null when disabled, otherwise null is converted to empty string). I am submitting this issue in part to document a potential pitfall of form-associated custom elements that don't follow this best practice and suggest that rails-ujs could use `FormData` and `URLSearchParams` to avoid the pitfall altogether.\r\n\r\n### Steps to reproduce\r\nInclude a [form-associated custom element](https://html.spec.whatwg.org/multipage/custom-elements.html#form-associated-custom-element) that deviates from `HTMLInputElement` behavior by not having a value attribute at all or having a `.value` property that returns null. (The form-associated custom element sets its [submission value](https://html.spec.whatwg.org/multipage/custom-elements.html#face-submission-value) through the [ElementInternals API](https://developer.mozilla.org/en-US/docs/Web/API/ElementInternals/setFormValue)).\r\n\r\nUse `remote: true` and `multipart: false` (default multipart value) when creating the form.\r\n\r\nFire a submit event on the form to trigger rails-ujs ajax.\r\n\r\nObserve that rails-ujs serializes the parameters into `x-www-form-urlencode` without regard to the submission value.\r\n\r\n```html.erb\r\n<script>\r\n    class MyControl extends HTMLElement {\r\n\r\n        static formAssociated = true;\r\n\r\n        constructor() {\r\n            super();\r\n            this.internals_ = this.attachInternals();\r\n            this.value_ = null;\r\n        }\r\n\r\n        // HTMLInputElement has a \"value\" property. We do too,\r\n        // but sometimes ours is null despite being enabled.\r\n        get value() { return this.value_; }\r\n        set value(v) { this.value_ = v; }\r\n\r\n        // More properties which aren't required by the standard but recommended.\r\n        get form() { return this.internals_.form; }\r\n        get name() { return this.getAttribute('name'); }\r\n    }\r\n    customElements.define('null-value', NullValueControl);\r\n</script>\r\n\r\n<%= form_with url: \"/things\", method: :get, remote: true do |form| %>\r\n  <null-value name=\"some_value\"></null-value>\r\n  <%= form.submit %>\r\n<% end %>\r\n\r\n```\r\n\r\n### Expected behavior\r\n\r\nThe serialized parameters should match those given by `FormData`, which constructs the entry list following the [standard procedure](https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#constructing-form-data-set) that supports form-associated custom elements. The parameters can then be URL encoded, e.g.\r\n\r\n```js\r\nconst formData = new FormData(form)\r\nconst params = new URLSearchParams(formData)\r\n// params is populated with parameters based on the submission value of form-associated custom elements\r\n// in the above code example, the submission value of the field is null, so it doesn't appear in params at all\r\n```\r\n\r\nNote: `multipart: true` on the form already results in `FormData` being correctly used to serialize as `multipart/form-data`\r\n\r\n### Actual behavior\r\nrails-ujs serializes parameters into `x-www-form-urlencode` by scanning for value attributes on form controls. A form-associated custom element may not have a value attribute or may return the property as null.\r\n\r\nExample 1: If the form-associated custom element has no value attribute, it is missed altogether, even if a submission value is contributed to the form.\r\n\r\nExample 2: If the form-associated custom element has a `.value` property that is null, it is serialized to the literal string 'null'.\r\n\r\nhttps://github.com/rails/rails/blob/main/actionview/app/assets/javascripts/rails-ujs.esm.js#L283\r\n\r\n### System configuration\r\n**Rails version**: 7.0.7\r\n\r\n**Ruby version**: 3.1.2", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48975/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48975/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48974", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48974/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48974/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48974/events", "html_url": "https://github.com/rails/rails/pull/48974", "id": 1857084305, "node_id": "PR_kwDNIULOWETIyQ", "number": 48974, "title": "Fix 6.1 change_table setting datetime precision", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-18T17:54:28Z", "updated_at": "2023-08-18T17:54:32Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48974", "html_url": "https://github.com/rails/rails/pull/48974", "diff_url": "https://github.com/rails/rails/pull/48974.diff", "patch_url": "https://github.com/rails/rails/pull/48974.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nWhile working on #48969, I found that some of the Compatibility test cases were not working correctly. The tests removed in this commit were never running the `change_table` migration and so were not actually testing that `change_table` works correctly. The issue is that the two migrations created in these tests both have `nil` versions, and so the Migrator only runs the first one.\r\n\r\n### Detail\r\n\r\nThis commit refactors the tests so that its easier to test the behavior of each Migration class version (and I think the rest of the tests should be updated to use this strategy as well). Additionally, since the tests are fixed it exposed that `t.change` in a `change_table` is not behaving as expected so that is fixed as well.\r\n\r\n### Additional information\r\n\r\nThis should be backported to `7-0-stable`. Because of the change to the migrator signature it will likely not apply cleanly, I'm happy to make a PR to `7-0-stable` if that would make it easier.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48974/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48974/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48973", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48973/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48973/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48973/events", "html_url": "https://github.com/rails/rails/issues/48973", "id": 1857065077, "node_id": "I_kwDNIULObrCQdQ", "number": 48973, "title": "Webdrivers::VersionError: Unable to find latest point release version for 115.0.5790", "user": {"login": "jasonfb", "id": 59002, "node_id": "MDQ6VXNlcjU5MDAy", "avatar_url": "https://avatars.githubusercontent.com/u/59002?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jasonfb", "html_url": "https://github.com/jasonfb", "followers_url": "https://api.github.com/users/jasonfb/followers", "following_url": "https://api.github.com/users/jasonfb/following{/other_user}", "gists_url": "https://api.github.com/users/jasonfb/gists{/gist_id}", "starred_url": "https://api.github.com/users/jasonfb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jasonfb/subscriptions", "organizations_url": "https://api.github.com/users/jasonfb/orgs", "repos_url": "https://api.github.com/users/jasonfb/repos", "events_url": "https://api.github.com/users/jasonfb/events{/privacy}", "received_events_url": "https://api.github.com/users/jasonfb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 126910270, "node_id": "MDU6TGFiZWwxMjY5MTAyNzA=", "url": "https://api.github.com/repos/rails/rails/labels/With%20reproduction%20steps", "name": "With reproduction steps", "color": "009800", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-18T17:38:49Z", "updated_at": "2023-08-19T16:29:13Z", "closed_at": "2023-08-19T16:27:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\n\u2022 Create a brand new rails app\r\n\u2022 Create a basic home page + capybara home page test (feature or system spec)\r\n\u2022 run the test, you will get an error:\r\n```\r\nWebdrivers::VersionError: Unable to find latest point release version for 115.0.5790\r\n```\r\n\r\n\r\nto quickly make a repo app, copy & paste the following code blocks into your terminal:\r\n```\r\necho \"please give your new Importmap Rails app a TitleCase name:\" && read APP_NAME && rails new $APP_NAME --database=postgresql && cd $APP_NAME && git add . && git commit -m \"initial commit with $(rails -v), Ruby $(more ./.ruby-version)\" && printf \"Ruby version is in \\`.ruby-version\\`.\\n\\n# Setup\\n\\n\\`bin/setup\\`\\n\\n# Start Rails\\n\\n\\`bin/rails s\\`\\n\\n# Run Specs\\n\\nrun with \\`bin/rake\\`\" > README.md  && sed -i '' -e 's/ruby-//g' .ruby-version && RUBY_STRING=\"ruby \\\"$(more ./.ruby-version)\\\"\" && sed -i '' -e \"s/$RUBY_STRING/ruby File.read('.ruby-version').strip/g\" Gemfile  && git add . && git commit -m \"fixes .ruby-version file and set Gemfile to use .ruby-version file\" && ./bin/setup && git add . && git commit -m \"adds schema file\"\r\n```\r\n\r\n```\r\nbundle add rspec-rails rspec-wait factory_bot_rails ffaker vcr simplecov dotenv-rails webmock --group \"development, test\" && bundle add simplecov-rcov launchy --group \"test\" &&\r\nrails generate rspec:install &&\r\ngit add . && git commit -m \"adds rspec, factory bot, ffaker, vcr, simplecov, and launchy\" && printf \"\\n.env\\n.env.local\\n.env.*.local\\n\\ncoverage/\" >> .gitignore && printf \"\" >> .env.local && git add . && git commit -m \"adds .env, etc and coverage/ to .gitignore file\" && sed -i '' -e 's/RSpec.configure do |config|/RSpec.configure do |config|\\n  config.include FactoryBot::Syntax::Methods\\n/g' spec/rails_helper.rb && sed -i '' -e \"s/RSpec.configure do |config|/require 'simplecov'\\nrequire 'simplecov-rcov'\\nclass SimpleCov::Formatter::MergedFormatter\\n  def format(result)\\n    SimpleCov::Formatter::HTMLFormatter.new.format(result)\\n    SimpleCov::Formatter::RcovFormatter.new.format(result)\\n  end\\nend\\nSimpleCov.formatter = SimpleCov::Formatter::MergedFormatter\\nSimpleCov.start 'rails' do\\n  add_filter \\\"\\/vendor\\\"\\nend\\n\\nVCR.configure do |config|\\n  config.cassette_library_dir = \\\"spec\\/fixtures\\/vcr_cassettes\\\"\\n  config.hook_into :webmock\\n  config.ignore_request do |request|\\n    [\\\"127.0.0.1\\\", \\\"chromedriver.storage.googleapis.com\\\"].include? URI(request.uri).host\\n  end\\nend\\n\\n\\nRSpec.configure do |config|/g\" spec/rails_helper.rb  &&  git add . && git commit -m \"adding factorybot and simplecov to Rspec config\" && sed -i '' -e 's/< Rails::Application/< Rails::Application\\n\tconfig.generators do |generate|\\n      generate.helper false\\n\\n      generate.assets false\\n      generate.helper false\\n      generate.stylesheets false\\n      generate.test_framework :rspec,\\n                              request_specs: false,\\n                              view_specs: false,\\n                              controller_specs: false,\\n                              helper_specs: false,\\n                              routing_specs: false,\\n                              fixture: false,\\n                              fixture_replacement: \"factory_bot\"\\n    end\\n/g' config/application.rb && git add . && git commit -m \"disables extraneous generators\"\r\n```\r\nadd rspec (but I think it will happen in minitest too)\r\n```\r\nmkdir spec/features  && printf \"require 'rails_helper'\\n\\ndescribe 'homepage' do\\n  it 'can load' do\\n    visit '/'\\n    expect(page).to have_content('Hello World')\\n  end\\nend\" >>  spec/features/homepage_spec.rb && printf \"Capybara.register_driver :selenium do |app|\\n  options = Selenium::WebDriver::Chrome::Options.new(\\n    # It's the headlese arg that make Chrome headless\\n    # + you also need the disable-gpu arg due to a bug\\n    args: ['headless', 'disable-gpu window-size=1366,1200'],\\n    )\\n\\n  Capybara::Selenium::Driver.new(\\n    app,\\n    browser: :chrome,\\n    options: options\\n  )\\nend\\n\\nCapybara.default_driver = :selenium\" >> spec/rails_helper.rb && git add . && git commit -m \"basic capybara example\"\r\n```\r\n```\r\nrails generate controller Welcome &&\r\nsed -i '' -e 's/class WelcomeController < ApplicationController/class WelcomeController < ApplicationController\\n  def index\\n\\n  end/g' app/controllers/welcome_controller.rb &&\r\nprintf \"Hello World\" > app/views/welcome/index.html.erb &&\r\nsed -i '' -e  's/# root \"articles#index\"//g' config/routes.rb &&\r\nsed -i '' -e  's/Rails.application.routes.draw do/Rails.application.routes.draw do\\n  root to: \"welcome#index\"/g' config/routes.rb && git add . && git commit -m \"generates Welcome controller\"\r\n```\r\n\r\n\r\n\r\n\r\nThe best fix is to remove the `webdrivers` gem completely, as it is no longer needed if you are using `selenium-webdriver` v 4.10.0 or above\r\n\r\nsee this discussion:\r\nhttps://github.com/titusfortner/webdrivers/issues/247#issuecomment-1684191351\r\n\r\n(Note if you are using an older version of webdrivers and cannot upgrade `selenium-webdriver`, you can fix to the older webdriver using ` Webdrivers::Chromedriver.required_version = '114.0.5735.90'`)\r\n\r\nEither way, it seems like with `webdrivers` gem no longer being necessary for *newly created Rails apps*, this gem can simply be removed from `rails new` so as to not re-create the problem for new Rails apps and people in a learning/education environment. \r\n\r\n### Expected behavior\r\n`rails new` works out of the box\r\n\r\n### Actual behavior\r\n`rails new` creates a Gemfile where the bug will show up the first time you create a JS-driven capybara spec.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48973/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48973/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48972", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48972/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48972/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48972/events", "html_url": "https://github.com/rails/rails/pull/48972", "id": 1857032357, "node_id": "PR_kwDNIULOWEQTQQ", "number": 48972, "title": "Ensure target is an attribute for `alias_attribute`", "user": {"login": "ipc103", "id": 6826778, "node_id": "MDQ6VXNlcjY4MjY3Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/6826778?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ipc103", "html_url": "https://github.com/ipc103", "followers_url": "https://api.github.com/users/ipc103/followers", "following_url": "https://api.github.com/users/ipc103/following{/other_user}", "gists_url": "https://api.github.com/users/ipc103/gists{/gist_id}", "starred_url": "https://api.github.com/users/ipc103/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ipc103/subscriptions", "organizations_url": "https://api.github.com/users/ipc103/orgs", "repos_url": "https://api.github.com/users/ipc103/repos", "events_url": "https://api.github.com/users/ipc103/events{/privacy}", "received_events_url": "https://api.github.com/users/ipc103/received_events", "type": "User", "site_admin": true}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-18T17:09:56Z", "updated_at": "2023-08-18T18:46:38Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48972", "html_url": "https://github.com/rails/rails/pull/48972", "diff_url": "https://github.com/rails/rails/pull/48972.diff", "patch_url": "https://github.com/rails/rails/pull/48972.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nWe ran into a few cases at GitHub where we were using `alias_attribute` incorrectly to target non-attribute methods. Previously, this \"worked\", because `alias_attribute` just forwarded the method call, but this is no longer the case.\r\n\r\nIn most cases, this raised a deprecation warning, although the message was a bit unclear. The original deprecation warning was intended to look for manually defined alias methods that won't be forwarded in the future. \r\n\r\nIf the target happens to be a generated attribute method, no deprecation is raised. For example, assuming a model has a `title` attribute, `alias_attribute :saved_title, :title_in_database` was using the new behavior, because we only raise the deprecation if the target method is not an attribute method. \r\n\r\n### Detail\r\n\r\nThis Pull Request adds a check to `alias_attribute_method_definition` to ensure that you actually are targeting an attribute, and raises a deprecation warning if not. In the future, I think we should raise if you try to use `alias_attribute` with a non-attribute method. \r\n\r\nNote that the following code will still behave correctly, because `has_attribute?` will forward the aliases to the far target automatically.\r\n\r\n```ruby\r\nclass Topic\r\n  alias_attribute :heading, :title\r\n  alias_attribute :subject, :heading\r\nend\r\n```\r\n\r\nThis correctly issues a deprecation warning for generated attribute methods, and also makes the warning for any non-attribute methods more clear.\r\n\r\n### Additional information\r\nWe originally tried to make this warning even more specific in #48929, but the logic got kind of complicated. Issuing one warning for this case felt like a good compromise.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48972/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48972/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48971", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48971/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48971/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48971/events", "html_url": "https://github.com/rails/rails/pull/48971", "id": 1856962729, "node_id": "PR_kwDNIULOWEMjOg", "number": 48971, "title": "Add method for accessing only query constraints", "user": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-18T16:08:15Z", "updated_at": "2023-08-18T17:24:53Z", "closed_at": "2023-08-18T17:24:51Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48971", "html_url": "https://github.com/rails/rails/pull/48971", "diff_url": "https://github.com/rails/rails/pull/48971.diff", "patch_url": "https://github.com/rails/rails/pull/48971.patch", "merged_at": "2023-08-18T17:24:51Z"}, "body": "I'm working on an enhancement to query constraints that will require me to know when we have query constraints but not a composite key. Currently if you have a composite key it will be included in the query constraints list. There's not a way to differentiate between the two which means that we're forced into setting the query constraints on the associations for the primary key.\r\n\r\nThis change adds a `has_query_constraints?` method so we can check the class for query constraints. The options still work as well but we can be sure we're always picking up the query constraints when they're present.\r\n\r\ncc/ @nvasilevski ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48971/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48971/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48970", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48970/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48970/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48970/events", "html_url": "https://github.com/rails/rails/pull/48970", "id": 1855730056, "node_id": "PR_kwDNIULOWDJoZw", "number": 48970, "title": "Fix list item numbering on API docs main page [ci-skip]", "user": {"login": "jonathanhefner", "id": 771968, "node_id": "MDQ6VXNlcjc3MTk2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/771968?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonathanhefner", "html_url": "https://github.com/jonathanhefner", "followers_url": "https://api.github.com/users/jonathanhefner/followers", "following_url": "https://api.github.com/users/jonathanhefner/following{/other_user}", "gists_url": "https://api.github.com/users/jonathanhefner/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonathanhefner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonathanhefner/subscriptions", "organizations_url": "https://api.github.com/users/jonathanhefner/orgs", "repos_url": "https://api.github.com/users/jonathanhefner/repos", "events_url": "https://api.github.com/users/jonathanhefner/events{/privacy}", "received_events_url": "https://api.github.com/users/jonathanhefner/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-17T21:23:34Z", "updated_at": "2023-08-17T21:26:54Z", "closed_at": "2023-08-17T21:26:54Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48970", "html_url": "https://github.com/rails/rails/pull/48970", "diff_url": "https://github.com/rails/rails/pull/48970.diff", "patch_url": "https://github.com/rails/rails/pull/48970.patch", "merged_at": "2023-08-17T21:26:54Z"}, "body": "Follow-up to #47178.\r\n\r\nRDoc's Markdown parser requires multi-line list items to use a hanging indent of at least four spaces.  Otherwise, trailing lines will be rendered as an independent paragraph, and the next list item will start a new list.\r\n\r\n| Before | After |\r\n| --- | --- |\r\n| ![before](https://github.com/rails/rails/assets/771968/d0c2b486-7a8c-492f-bfad-8982dbc18af4) | ![after](https://github.com/rails/rails/assets/771968/7e0efc66-11c9-4677-8d9a-d49011e1057f) |\r\n\r\n(The unordered list being rendered as an ordered list is actually a CSS issue, not a Markdown issue, and will be fixed in an upcoming version of SDoc.)\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48970/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48970/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48969", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48969/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48969/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48969/events", "html_url": "https://github.com/rails/rails/pull/48969", "id": 1855555446, "node_id": "PR_kwDNIULOWDANng", "number": 48969, "title": "Fix 6.1 change_column setting datetime precision", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-17T19:08:27Z", "updated_at": "2023-08-17T23:30:49Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48969", "html_url": "https://github.com/rails/rails/pull/48969", "diff_url": "https://github.com/rails/rails/pull/48969.diff", "patch_url": "https://github.com/rails/rails/pull/48969.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nFix #48965 \r\n\r\nThis is already the case for add_column and create_table, but change_column was missed\r\n\r\n### Additional Information\r\n\r\nThis needs to be backported to 7.0, but the test change won't backport cleanly because the Migrator signature in the test changed. I'll make a PR for 7-0-stable as well if that would be easier\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48969/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48969/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48968", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48968/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48968/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48968/events", "html_url": "https://github.com/rails/rails/issues/48968", "id": 1855533364, "node_id": "I_kwDNIULObpkxNA", "number": 48968, "title": "ActiveRecord - Dependent destroy relies on cached ActiveRecord::Relation", "user": {"login": "sergioisidoro", "id": 5014629, "node_id": "MDQ6VXNlcjUwMTQ2Mjk=", "avatar_url": "https://avatars.githubusercontent.com/u/5014629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sergioisidoro", "html_url": "https://github.com/sergioisidoro", "followers_url": "https://api.github.com/users/sergioisidoro/followers", "following_url": "https://api.github.com/users/sergioisidoro/following{/other_user}", "gists_url": "https://api.github.com/users/sergioisidoro/gists{/gist_id}", "starred_url": "https://api.github.com/users/sergioisidoro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sergioisidoro/subscriptions", "organizations_url": "https://api.github.com/users/sergioisidoro/orgs", "repos_url": "https://api.github.com/users/sergioisidoro/repos", "events_url": "https://api.github.com/users/sergioisidoro/events{/privacy}", "received_events_url": "https://api.github.com/users/sergioisidoro/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-17T18:50:35Z", "updated_at": "2023-08-17T18:50:35Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n\r\nclass ThingsTodo < ApplicationRecord\r\n   belongs_to :task # without FK constraint\r\n\r\nclass Task < ApplicationRecord\r\n   has_many :things_todo, dependent: :destroy\r\n\r\n   after_create :init_things_todo\r\n   \r\n   def init_things_todo\r\n       # call service that creates things to do\r\n       InitializeTodo.call(self)\r\n\r\n@todo = Todo.create()\r\n@todo.id  # 123\r\n@todo.things_todo.count  # Zero, Expected\r\nThingsTodo.count # Not Zero, Expected\r\n\r\n@todo.destroy!\r\nThingsTodo.count # Not Zero, NOT expected?\r\nThingsTodo.first.id # 123\r\n\r\nThingsTodo.destroy_all\r\n\r\n@todo = Todo.create()\r\n@todo.reload\r\n@todo.destroy!\r\nThingsTodo.count # Zero \r\n\r\n```\r\n### Expected behavior\r\nAlthough I do not expect the just created object to contain the initialised related objects - created by the `after_save` callback, I was expecting the the `dependent: :destroy` to make a query to delete the related records, instead of using the cached ActiveRecord::Relation. \r\n\r\n### Actual behavior\r\nDependent destroy calls destroy on the cached ActiveRecord::Relation (which is empty). This might be by design as a way to avoid one extra query, but it took me a while to realise because in this case there was no foreign key constraint. I was also getting a fk_constraint error on another case, and didn't realise why I was getting it until I found this.\r\n\r\nAlso note that this makes the behaviour of destroy and destroy async different, as destroy async will make a separate query with `find_by`.\r\n\r\n### Going forward \r\nA) make dependent destroy make a query, with a performance penalty.\r\nB) Expand on the warning in the documentations - https://guides.rubyonrails.org/association_basics.html#options-for-belongs-to-dependent - to include this caveat. \r\n\r\n### System configuration\r\n**Rails version**: 7.0.4\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48968/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48968/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48967", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48967/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48967/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48967/events", "html_url": "https://github.com/rails/rails/pull/48967", "id": 1854835138, "node_id": "PR_kwDNIULOWCYonQ", "number": 48967, "title": "Add test coverage for RedisCacheStore with Redis::Distributed / ConnectionPool", "user": {"login": "jdelStrother", "id": 2377, "node_id": "MDQ6VXNlcjIzNzc=", "avatar_url": "https://avatars.githubusercontent.com/u/2377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdelStrother", "html_url": "https://github.com/jdelStrother", "followers_url": "https://api.github.com/users/jdelStrother/followers", "following_url": "https://api.github.com/users/jdelStrother/following{/other_user}", "gists_url": "https://api.github.com/users/jdelStrother/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdelStrother/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdelStrother/subscriptions", "organizations_url": "https://api.github.com/users/jdelStrother/orgs", "repos_url": "https://api.github.com/users/jdelStrother/repos", "events_url": "https://api.github.com/users/jdelStrother/events{/privacy}", "received_events_url": "https://api.github.com/users/jdelStrother/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-17T11:42:14Z", "updated_at": "2023-08-17T12:05:19Z", "closed_at": "2023-08-17T12:05:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48967", "html_url": "https://github.com/rails/rails/pull/48967", "diff_url": "https://github.com/rails/rails/pull/48967.diff", "patch_url": "https://github.com/rails/rails/pull/48967.patch", "merged_at": "2023-08-17T12:05:13Z"}, "body": "\r\n### Motivation / Background\r\n\r\nThe [Rails guides](https://guides.rubyonrails.org/caching_with_rails.html#activesupport-cache-rediscachestore) suggest using connection pooling & multiple cache-urls in production, but there's very little test coverage for that situation.\r\n\r\n### Detail\r\n\r\nThis 'forward-ports' some tests which were added against 7-0-stable here: #48952\r\n\r\nAlso fixes a bug in `supports_expire_nx?` when using distributed-redis.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n\r\n\r\ncc @byroot ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48967/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48967/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48966", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48966/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48966/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48966/events", "html_url": "https://github.com/rails/rails/pull/48966", "id": 1854754878, "node_id": "PR_kwDNIULOWCUNhg", "number": 48966, "title": "Do not codespell yarn.lock", "user": {"login": "byroot", "id": 44640, "node_id": "MDQ6VXNlcjQ0NjQw", "avatar_url": "https://avatars.githubusercontent.com/u/44640?v=4", "gravatar_id": "", "url": "https://api.github.com/users/byroot", "html_url": "https://github.com/byroot", "followers_url": "https://api.github.com/users/byroot/followers", "following_url": "https://api.github.com/users/byroot/following{/other_user}", "gists_url": "https://api.github.com/users/byroot/gists{/gist_id}", "starred_url": "https://api.github.com/users/byroot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/byroot/subscriptions", "organizations_url": "https://api.github.com/users/byroot/orgs", "repos_url": "https://api.github.com/users/byroot/repos", "events_url": "https://api.github.com/users/byroot/events{/privacy}", "received_events_url": "https://api.github.com/users/byroot/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-17T10:48:59Z", "updated_at": "2023-08-17T10:49:53Z", "closed_at": "2023-08-17T10:49:53Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48966", "html_url": "https://github.com/rails/rails/pull/48966", "diff_url": "https://github.com/rails/rails/pull/48966.diff", "patch_url": "https://github.com/rails/rails/pull/48966.patch", "merged_at": "2023-08-17T10:49:53Z"}, "body": "Should fix CI:\r\n\r\n```\r\n./yarn.lock:1503: NaX ==> max, nad\r\n```", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48966/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48966/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48965", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48965/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48965/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48965/events", "html_url": "https://github.com/rails/rails/issues/48965", "id": 1854697972, "node_id": "I_kwDNIULOboxx9A", "number": 48965, "title": "Upgrading to Rails 7.0 changes precision when changing column type to datetime", "user": {"login": "willnet", "id": 82371, "node_id": "MDQ6VXNlcjgyMzcx", "avatar_url": "https://avatars.githubusercontent.com/u/82371?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willnet", "html_url": "https://github.com/willnet", "followers_url": "https://api.github.com/users/willnet/followers", "following_url": "https://api.github.com/users/willnet/following{/other_user}", "gists_url": "https://api.github.com/users/willnet/gists{/gist_id}", "starred_url": "https://api.github.com/users/willnet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willnet/subscriptions", "organizations_url": "https://api.github.com/users/willnet/orgs", "repos_url": "https://api.github.com/users/willnet/repos", "events_url": "https://api.github.com/users/willnet/events{/privacy}", "received_events_url": "https://api.github.com/users/willnet/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}, {"id": 126910270, "node_id": "MDU6TGFiZWwxMjY5MTAyNzA=", "url": "https://api.github.com/repos/rails/rails/labels/With%20reproduction%20steps", "name": "With reproduction steps", "color": "009800", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-17T10:11:05Z", "updated_at": "2023-08-17T23:36:08Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In Rails 6.1 and below, precision is nil when using `change_column` to set the column type to datetime without explicit option. In Rails 7.0, precision is 6 even if the migration version is specified as `ActiveRecord::Migration[6.1]`. This will result in different schemas when running `rails db:migrate` in Rails 6.1 and Rails 7.0.\r\n\r\n\r\nhttps://github.com/rails/rails/pull/42297 changed the default datetime precision to 6. In Rails7.0, `ActiveRecord::Migration[6.1]` or lower version includes the following support to maintain the original behavior.\r\n- https://github.com/rails/rails/blob/2fa54931cf3fee16cc1e7f1fad851078910f83e5/activerecord/lib/active_record/migration/compatibility.rb#L204 \r\n- https://github.com/rails/rails/blob/2fa54931cf3fee16cc1e7f1fad851078910f83e5/activerecord/lib/active_record/migration/compatibility.rb#L174 \r\n\r\nbut there seems to be no support for `change_column`\r\n\r\n### Steps to reproduce\r\n\r\nUsing PostgreSQL because I can't reproduce with sqlite3\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activerecord\", \"~> 7.0.0\"\r\n  gem \"pg\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# docker run --rm -e POSTGRES_PASSWORD=postgres -p 9999:5432 postgres\r\nActiveRecord::Base.establish_connection(\"postgres://postgres:postgres@localhost:9999/postgres\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema[6.1].define do\r\n  create_table :posts, force: true do |t|\r\n    t.date :published_at\r\n  end\r\nend\r\n\r\nclass ChangePublishedAt < ActiveRecord::Migration[6.1]\r\n  def change\r\n    change_column :posts, :published_at, :datetime\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_precision_when_change_column_to_datetime\r\n    ChangePublishedAt.migrate(:up)\r\n    Post.reset_column_information\r\n    published_at_column = Post.columns.find { |c| c.name == \"published_at\" }\r\n    assert_nil published_at_column.precision # fail. Expected 6 to be nil.\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\n\r\nthe test pass\r\n\r\n<!-- Tell us what should happen -->\r\n\r\n### Actual behavior\r\n\r\nthe test fails.\r\n<!-- Tell us what happens instead -->\r\n\r\n### System configuration\r\n**Rails version**:\r\n7.0.7\r\n**Ruby version**:\r\n3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48965/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48965/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48964", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48964/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48964/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48964/events", "html_url": "https://github.com/rails/rails/pull/48964", "id": 1854481656, "node_id": "PR_kwDNIULOWCFNzw", "number": 48964, "title": "Fix method name to `check_all_pending!`", "user": {"login": "sinsoku", "id": 248174, "node_id": "MDQ6VXNlcjI0ODE3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/248174?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinsoku", "html_url": "https://github.com/sinsoku", "followers_url": "https://api.github.com/users/sinsoku/followers", "following_url": "https://api.github.com/users/sinsoku/following{/other_user}", "gists_url": "https://api.github.com/users/sinsoku/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinsoku/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinsoku/subscriptions", "organizations_url": "https://api.github.com/users/sinsoku/orgs", "repos_url": "https://api.github.com/users/sinsoku/repos", "events_url": "https://api.github.com/users/sinsoku/events{/privacy}", "received_events_url": "https://api.github.com/users/sinsoku/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-17T08:03:25Z", "updated_at": "2023-08-18T00:08:52Z", "closed_at": "2023-08-17T14:04:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48964", "html_url": "https://github.com/rails/rails/pull/48964", "diff_url": "https://github.com/rails/rails/pull/48964.diff", "patch_url": "https://github.com/rails/rails/pull/48964.patch", "merged_at": "2023-08-17T14:04:41Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nBecause `check_pending_migrations!` mentioned in the warning message does not exist.\r\n\r\n### Detail\r\n\r\nThe method added in 03379d1f59 is `check_all_pending!`, not `check_pending_migrations!`.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [-] Tests are added or updated if you fix a bug or add a feature.\r\n* [-] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48964/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48964/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48963", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48963/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48963/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48963/events", "html_url": "https://github.com/rails/rails/pull/48963", "id": 1854314577, "node_id": "PR_kwDNIULOWB8G7w", "number": 48963, "title": "Test `rails new` docker workflow on a rubies matrix", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-17T06:08:46Z", "updated_at": "2023-08-17T07:21:20Z", "closed_at": "2023-08-17T07:21:17Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48963", "html_url": "https://github.com/rails/rails/pull/48963", "diff_url": "https://github.com/rails/rails/pull/48963.diff", "patch_url": "https://github.com/rails/rails/pull/48963.patch", "merged_at": null}, "body": "TODO: write this\r\n\r\nI was pushing to a branch on `upstream` but that fills discord with notifications everytime I try to run a build, so I just opened a PR instead \ud83d\ude48 ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48963/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48963/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48962", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48962/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48962/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48962/events", "html_url": "https://github.com/rails/rails/pull/48962", "id": 1854266493, "node_id": "PR_kwDNIULOWB5ihA", "number": 48962, "title": "Revert \"Bundler should use platform :windows instead of :mingw, etc.\"", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-08-17T05:16:03Z", "updated_at": "2023-08-17T07:19:26Z", "closed_at": "2023-08-17T07:19:23Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48962", "html_url": "https://github.com/rails/rails/pull/48962", "diff_url": "https://github.com/rails/rails/pull/48962.diff", "patch_url": "https://github.com/rails/rails/pull/48962.patch", "merged_at": null}, "body": "Reverts rails/rails#46009\r\n\r\nThis change breaks building Rails source on Ruby 3.0.\r\n\r\nIn #48951, we found that `gem install rails` and `rails new` must work on the currently supported Ruby versions default available rubygems&bundler.\r\n\r\nThe reason this feature passed CI was because we always update to the latest rubygems and bundler in our build images, including Ruby 2.7 and up.\r\n\r\nThrough experimenting on rails/buildkite-config#65, I realized that the two are mutually exclusive, and there are things in the test suite that we may want to make exceptions for in order to keep builds green -- if that means a developer who wants to contribute to rails/rails also has to update to the latest version.\r\n\r\nAll of that said, this feature breaks that guarantee that we will support the default available rubygems and bundler for each version of Ruby we support.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48962/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48962/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48961", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48961/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48961/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48961/events", "html_url": "https://github.com/rails/rails/pull/48961", "id": 1854160814, "node_id": "PR_kwDNIULOWBz7Ig", "number": 48961, "title": "Add Rack::Lint to ActionCable::Server health tests", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-17T02:57:51Z", "updated_at": "2023-08-17T23:59:38Z", "closed_at": "2023-08-17T23:51:41Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48961", "html_url": "https://github.com/rails/rails/pull/48961", "diff_url": "https://github.com/rails/rails/pull/48961.diff", "patch_url": "https://github.com/rails/rails/pull/48961.patch", "merged_at": "2023-08-17T23:51:41Z"}, "body": "### Motivation / Background\r\n\r\nRef #48874\r\n\r\nThis adds additional coverage to ActionCable::Server to validate that its output follow the Rack SPEC.\r\n\r\n### Detail\r\n\r\nIn addition to using Rack::CONTENT_TYPE for the Content-Type header, there was another change required: the Content-Type header cannot be specified when the Response status is 204, so the default health check status was updated to 200\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48961/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48961/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48960", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48960/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48960/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48960/events", "html_url": "https://github.com/rails/rails/issues/48960", "id": 1854091490, "node_id": "I_kwDNIULOboMw4g", "number": 48960, "title": "ActiveModel Validations - DEPRECATION WARNING Time#to_s to Time#to_fs actioncable", "user": {"login": "magni-", "id": 1640976, "node_id": "MDQ6VXNlcjE2NDA5NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1640976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/magni-", "html_url": "https://github.com/magni-", "followers_url": "https://api.github.com/users/magni-/followers", "following_url": "https://api.github.com/users/magni-/following{/other_user}", "gists_url": "https://api.github.com/users/magni-/gists{/gist_id}", "starred_url": "https://api.github.com/users/magni-/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/magni-/subscriptions", "organizations_url": "https://api.github.com/users/magni-/orgs", "repos_url": "https://api.github.com/users/magni-/repos", "events_url": "https://api.github.com/users/magni-/events{/privacy}", "received_events_url": "https://api.github.com/users/magni-/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 126910270, "node_id": "MDU6TGFiZWwxMjY5MTAyNzA=", "url": "https://api.github.com/repos/rails/rails/labels/With%20reproduction%20steps", "name": "With reproduction steps", "color": "009800", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-17T01:18:18Z", "updated_at": "2023-08-17T06:06:13Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\nThe error message for comparison validations involving dates and times triggers a deprecation message (related to #48555)\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activemodel\", \"7.0.7\"\r\nend\r\n\r\nrequire \"active_model\"\r\nrequire \"active_support/core_ext/time/conversions\"\r\nrequire \"active_support/core_ext/time/deprecated_conversions\"\r\nrequire \"minitest/autorun\"\r\n\r\nTime::DATE_FORMATS[:default] = \"%F %T\"\r\n\r\nclass Reproduction\r\n  include ActiveModel::API\r\n\r\n  attr_accessor :first, :second\r\n\r\n  validates_comparison_of :first, less_than: :second\r\nend\r\n\r\nclass ReproductionTest < Minitest::Test\r\n  def test_error_message_does_not_trigger_deprecation_warning\r\n    invalid = Reproduction.new(first: Time.at(2), second: Time.at(1))\r\n    assert invalid.valid? == false\r\n\r\n    assert_output(nil, \"\") { invalid.errors.full_messages.to_sentence }\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\nNo deprecation warning should be raised.\r\n\r\n### Actual behavior\r\nA deprecation warning is raised.\r\n\r\n### System configuration\r\n**Rails version**: 7.0.7\r\n**Ruby version**: 3.2.2\r\n\r\n6.1 defaults are loaded (so `disable_to_s_conversion` is `false`) and `Time::DATE_FORMATS[:default]` is set.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48960/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48960/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48959", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48959/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48959/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48959/events", "html_url": "https://github.com/rails/rails/pull/48959", "id": 1853958916, "node_id": "PR_kwDNIULOWBpcXA", "number": 48959, "title": "Remove uneeded requires of core_ext/string/filters", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 123812746, "node_id": "MDU6TGFiZWwxMjM4MTI3NDY=", "url": "https://api.github.com/repos/rails/rails/labels/activejob", "name": "activejob", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-16T21:59:14Z", "updated_at": "2023-08-18T23:03:44Z", "closed_at": "2023-08-18T23:03:44Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48959", "html_url": "https://github.com/rails/rails/pull/48959", "diff_url": "https://github.com/rails/rails/pull/48959.diff", "patch_url": "https://github.com/rails/rails/pull/48959.patch", "merged_at": "2023-08-18T23:03:44Z"}, "body": "`actionpack/lib/action_dispatch/routing.rb`\r\n- added: 013745151be062aa4d0fc1f2a008a7303fdb6e04\r\n- removed: 93034ad7fea7e00562103a7cd0acfab19bbfadf9\r\n\r\n`activejob/lib/active_job/log_subscriber.rb`\r\n- added: b314ab555e0d85e6efb41be94fb5f3a157bb12fe\r\n- removed: 5ab2034730feacfc2caee418f8c0b55191d27427\r\n\r\n`activemodel/lib/active_model/errors.rb`\r\n- added: cf7fac7e29bb2816412c949fdaed3d61a923eb23\r\n- removed: 9de6457ab0767ebab7f2c8bc583420fda072e2bd\r\n\r\n`activerecord/lib/active_record/core.rb`\r\n- added: b3bfa361c503e107aff4dee5edf79bd7fd3d3725\r\n- removed: e1066f450d1a99c9a0b4d786b202e2ca82a4c3b3\r\n\r\n`activesupport/lib/active_support/core_ext/module/introspection.rb`\r\n- added: 358ac36edf1695fcbec0aa21f126a3d8b83d4b5a\r\n- removed: 167b4153cac0069a21e0bb9689cb16f34f6abbaa\r\n\r\n`activesupport/lib/active_support/duration.rb`\r\n- added: 75924c4517c8f87712d3f59c11f10152ed57b9d8\r\n- removed: a91ea1d51048342d13fc73f9b09ce4cfd086bb34\r\n\r\n`railties/lib/rails/commands/server/server_command.rb`\r\n- added: f2173648938b418d120f5a68d8f3862d8ae9dace\r\n- removed: 553b86fc751c751db504bcbe2d033eb2bb5b6a0b\r\n\r\n`railties/lib/rails/command/base.rb`\r\n- added: 6813edc7d926965e5644cd8befaf229a35b9d8ca\r\n- removed: b617a561d865a65cfc140caa0e3c4af4350bfcef\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48959/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48959/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48958", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48958/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48958/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48958/events", "html_url": "https://github.com/rails/rails/pull/48958", "id": 1853916297, "node_id": "PR_kwDNIULOWBnHFQ", "number": 48958, "title": "Update job testing guidelines", "user": {"login": "Mangara", "id": 5864726, "node_id": "MDQ6VXNlcjU4NjQ3MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/5864726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mangara", "html_url": "https://github.com/Mangara", "followers_url": "https://api.github.com/users/Mangara/followers", "following_url": "https://api.github.com/users/Mangara/following{/other_user}", "gists_url": "https://api.github.com/users/Mangara/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mangara/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mangara/subscriptions", "organizations_url": "https://api.github.com/users/Mangara/orgs", "repos_url": "https://api.github.com/users/Mangara/repos", "events_url": "https://api.github.com/users/Mangara/events{/privacy}", "received_events_url": "https://api.github.com/users/Mangara/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-16T21:15:31Z", "updated_at": "2023-08-18T00:10:14Z", "closed_at": "2023-08-18T00:10:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48958", "html_url": "https://github.com/rails/rails/pull/48958", "diff_url": "https://github.com/rails/rails/pull/48958.diff", "patch_url": "https://github.com/rails/rails/pull/48958.patch", "merged_at": "2023-08-18T00:10:14Z"}, "body": "### Motivation / Background\r\n\r\nThe current example test for jobs using `perform_now` to run the job inline. This is problematic for jobs that have retries configured, as any exception that is retried will be silently rescued. Ideally, the test will still fail because the job did not perform the work it was supposed to, but it makes finding the root cause a lot harder.\r\n\r\nTesting with `perform_enqueued_jobs` and `perform_later` gets around this problem, as the retries are also performed immediately and, assuming that the exception happens consistently, it will bubble up after exhausting its retries.\r\n\r\nTherefore, this PR updates the basic test guidance to suggest `perform_enqueued_jobs` and `perform_later` over `perform_now`.\r\n\r\nBoth described behaviours make it harder to test that a job raises a specific exception, so this requires special handling, which I added a paragraph on. I can pull that out to a separate PR if desired.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48958/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48958/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48957", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48957/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48957/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48957/events", "html_url": "https://github.com/rails/rails/pull/48957", "id": 1853867624, "node_id": "PR_kwDNIULOWBkdoA", "number": 48957, "title": "Fix #48326", "user": {"login": "cmaruz", "id": 1709692, "node_id": "MDQ6VXNlcjE3MDk2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/1709692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cmaruz", "html_url": "https://github.com/cmaruz", "followers_url": "https://api.github.com/users/cmaruz/followers", "following_url": "https://api.github.com/users/cmaruz/following{/other_user}", "gists_url": "https://api.github.com/users/cmaruz/gists{/gist_id}", "starred_url": "https://api.github.com/users/cmaruz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cmaruz/subscriptions", "organizations_url": "https://api.github.com/users/cmaruz/orgs", "repos_url": "https://api.github.com/users/cmaruz/repos", "events_url": "https://api.github.com/users/cmaruz/events{/privacy}", "received_events_url": "https://api.github.com/users/cmaruz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-16T20:32:55Z", "updated_at": "2023-08-16T20:32:58Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48957", "html_url": "https://github.com/rails/rails/pull/48957", "diff_url": "https://github.com/rails/rails/pull/48957.diff", "patch_url": "https://github.com/rails/rails/pull/48957.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nFixes #48326\r\n\r\nThis Pull Request has been created to fix an issue where syntax errors generated inside an eval method cause an Internal Server Error due to a TypeError.\r\n\r\n### Detail\r\n\r\nIn order to display the extraced source of a syntax error, we try to locate the node id for the backtrace location. The call to RubyVM::AbstractSyntaxTree.node_id_for_backtrace_location is expecting a Thread::Backtrace::Location object, but we are passing a SourceMapLocation instead.\r\n\r\nOnce this is fixed, another issue then appears. The first location of the backtrace for an eval error does not include the filename of where eval is called, so we can't extract the source. This means that the development view fails to show the extracted source because it is hard-coded to show the source extracted for the first location.\r\n\r\nThis commit does two things:\r\n1) it addresses the issue by making sure that we are always passing a Thread::Backtrace::Location instead\r\n2) it allows the development view to show the extracted source fragment by ensuring the first location of the backtrace for a syntax error coming from eval includes the name of the file where eval is called\r\n\r\n\r\n### Additional information\r\n\r\nI have tried to keep the changes consistent with the approach introduced in https://github.com/rails/rails/pull/46171.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48957/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48957/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48956", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48956/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48956/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48956/events", "html_url": "https://github.com/rails/rails/pull/48956", "id": 1853836002, "node_id": "PR_kwDNIULOWBivNw", "number": 48956, "title": "Add test coverage for ShowExceptions failsafe", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-16T20:05:54Z", "updated_at": "2023-08-18T23:08:41Z", "closed_at": "2023-08-18T23:08:41Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48956", "html_url": "https://github.com/rails/rails/pull/48956", "diff_url": "https://github.com/rails/rails/pull/48956.diff", "patch_url": "https://github.com/rails/rails/pull/48956.patch", "merged_at": "2023-08-18T23:08:41Z"}, "body": "### Motivation / Background\r\n\r\nRef #48874 \r\n\r\nThis adds additional test coverage to ShowExceptions, since one of the possible responses it creates was not previously tested.\r\n\r\n### Detail\r\n\r\nBecause of the previous [addition][1] of Rack::Lint, this also demonstrates that the Content-Type header needed to be fixed.\r\n\r\n[1]: https://github.com/rails/rails/commit/339dda4a82356d173b62dab144870790618e40c6\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48956/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48956/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48955", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48955/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48955/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48955/events", "html_url": "https://github.com/rails/rails/pull/48955", "id": 1853800397, "node_id": "PR_kwDNIULOWBgy4w", "number": 48955, "title": "Fix served_url printed when using Puma & Rack 3", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-16T19:35:40Z", "updated_at": "2023-08-18T16:53:57Z", "closed_at": "2023-08-18T00:26:03Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48955", "html_url": "https://github.com/rails/rails/pull/48955", "diff_url": "https://github.com/rails/rails/pull/48955.diff", "patch_url": "https://github.com/rails/rails/pull/48955.patch", "merged_at": "2023-08-18T00:26:03Z"}, "body": "### Motivation / Background\r\n\r\nThis `#use_puma?` check was [introduced][1] because Rails could potentially display the wrong server URL in development if another host or port is configured in `config/puma.rb`.\r\n\r\nHowever, in Rack 3 the the name of the server class changed from `Rack::Handler::Puma` to `Rackup::Handler::Puma`, which means that the served_url is being logged again.\r\n\r\n### Detail\r\n\r\nThis commit fixes the check to accept either version of the class. Additionally, puma was updated in Gemfile.lock because Puma 6.0.x prints a deprecation warning about Rack::Handler that's fixed in 6.1.0.\r\n\r\n[1]: https://github.com/rails/rails/commit/29648ff60e66c674b3cc49151df15dc100ffb4f4\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48955/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48955/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48954", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48954/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48954/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48954/events", "html_url": "https://github.com/rails/rails/pull/48954", "id": 1853574387, "node_id": "PR_kwDNIULOWBUg8A", "number": 48954, "title": "Updating Time.to_s to Time.to_fs", "user": {"login": "kemaldemirgil", "id": 75903418, "node_id": "MDQ6VXNlcjc1OTAzNDE4", "avatar_url": "https://avatars.githubusercontent.com/u/75903418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kemaldemirgil", "html_url": "https://github.com/kemaldemirgil", "followers_url": "https://api.github.com/users/kemaldemirgil/followers", "following_url": "https://api.github.com/users/kemaldemirgil/following{/other_user}", "gists_url": "https://api.github.com/users/kemaldemirgil/gists{/gist_id}", "starred_url": "https://api.github.com/users/kemaldemirgil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kemaldemirgil/subscriptions", "organizations_url": "https://api.github.com/users/kemaldemirgil/orgs", "repos_url": "https://api.github.com/users/kemaldemirgil/repos", "events_url": "https://api.github.com/users/kemaldemirgil/events{/privacy}", "received_events_url": "https://api.github.com/users/kemaldemirgil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-16T16:34:29Z", "updated_at": "2023-08-16T16:34:33Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48954", "html_url": "https://github.com/rails/rails/pull/48954", "diff_url": "https://github.com/rails/rails/pull/48954.diff", "patch_url": "https://github.com/rails/rails/pull/48954.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because I was working on some system specs for my project and noticed the deprecation warning in my console. I thought that this would be a great opportunity to contribute and create my first pull request to Rails! Even though it's a simple maintenance fix, it's very exciting to update the rails repository no matter the size of the change.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the `action_cable/connection/base.rb#started_request_message` and `action_cable/connection/base.rb#finished_request_message` methods to use `Time.to_fs` instead of `Time.to_s` as the deprecation warning suggests as well. This was causing the deprecation warning message in my system spec.\r\n\r\n### Additional information\r\nShould be a simple maintenance fix, nothing should be broken :)\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48954/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48954/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48953", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48953/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48953/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48953/events", "html_url": "https://github.com/rails/rails/issues/48953", "id": 1853541618, "node_id": "I_kwDNIULObnrM8g", "number": 48953, "title": "Action Cable - DEPRECATION WARNING Time#to_s to Time#to_fs", "user": {"login": "kemaldemirgil", "id": 75903418, "node_id": "MDQ6VXNlcjc1OTAzNDE4", "avatar_url": "https://avatars.githubusercontent.com/u/75903418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kemaldemirgil", "html_url": "https://github.com/kemaldemirgil", "followers_url": "https://api.github.com/users/kemaldemirgil/followers", "following_url": "https://api.github.com/users/kemaldemirgil/following{/other_user}", "gists_url": "https://api.github.com/users/kemaldemirgil/gists{/gist_id}", "starred_url": "https://api.github.com/users/kemaldemirgil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kemaldemirgil/subscriptions", "organizations_url": "https://api.github.com/users/kemaldemirgil/orgs", "repos_url": "https://api.github.com/users/kemaldemirgil/repos", "events_url": "https://api.github.com/users/kemaldemirgil/events{/privacy}", "received_events_url": "https://api.github.com/users/kemaldemirgil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}, {"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-16T16:10:49Z", "updated_at": "2023-08-16T19:16:06Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nWhen executing a system spec that involves an action through the cable, the following deprecation warning will be logged:\r\n\r\n```\r\nDEPRECATION WARNING: Using a :default format for Time#to_s is deprecated. Please use Time#to_fs instead. (called from finished_request_message at .../local/share/gem/ruby/3.2.0/gems/actioncable-7.0.7/lib/action_cable/connection/base.rb:248)\r\n```\r\n\r\nEven though this system spec is designed for my app, a similar one could be created easily.\r\n```ruby\r\nrequire 'spec_helper'\r\n\r\ndescribe 'Test Spec', type: :system, js: true do\r\n  before do\r\n    visit login_path\r\n\r\n    fill_in 'login', with: 'test@gmail.com'\r\n    fill_in 'password', with: '123_password'\r\n\r\n    click_button 'Log In'\r\n  end\r\n\r\n  it 'logs a deprecation message' do\r\n    expect(page).not_to have_selector('.test')\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\nThe logs shouldn't contain a deprecation warning message.\r\n\r\n### Actual behavior\r\nIt will log the following deprecation message:\r\n\r\n```\r\nDEPRECATION WARNING: Using a :default format for Time#to_s is deprecated. Please use Time#to_fs instead. (called from finished_request_message at .../.local/share/gem/ruby/3.2.0/gems/actioncable-7.0.7/lib/action_cable/connection/base.rb:248)\r\n  logs a deprecation message\r\n\r\nTop 1 slowest examples (5.25 seconds, 99.9% of total time):\r\n  Test Spec logs a deprecation message\r\n    5.25 seconds ./spec/system/test_spec.rb:16\r\n\r\nFinished in 5.25 seconds (files took 3.53 seconds to load)\r\n1 example, 0 failures\r\n```\r\n\r\n### System configuration\r\n**Rails version**:\r\nRails 7.0.7\r\n\r\n**Ruby version**:\r\nruby 3.2.2 (2023-07-23 revision 0b3ed6043c) [x86_64-linux]", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48953/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48953/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48952", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48952/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48952/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48952/events", "html_url": "https://github.com/rails/rails/pull/48952", "id": 1853233244, "node_id": "PR_kwDNIULOWBB8MQ", "number": 48952, "title": "Fix CacheStore#write_multi with Redis::Distributed+ConnectionPool", "user": {"login": "jdelStrother", "id": 2377, "node_id": "MDQ6VXNlcjIzNzc=", "avatar_url": "https://avatars.githubusercontent.com/u/2377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdelStrother", "html_url": "https://github.com/jdelStrother", "followers_url": "https://api.github.com/users/jdelStrother/followers", "following_url": "https://api.github.com/users/jdelStrother/following{/other_user}", "gists_url": "https://api.github.com/users/jdelStrother/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdelStrother/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdelStrother/subscriptions", "organizations_url": "https://api.github.com/users/jdelStrother/orgs", "repos_url": "https://api.github.com/users/jdelStrother/repos", "events_url": "https://api.github.com/users/jdelStrother/events{/privacy}", "received_events_url": "https://api.github.com/users/jdelStrother/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-08-16T13:19:53Z", "updated_at": "2023-08-17T12:04:36Z", "closed_at": "2023-08-17T12:04:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48952", "html_url": "https://github.com/rails/rails/pull/48952", "diff_url": "https://github.com/rails/rails/pull/48952.diff", "patch_url": "https://github.com/rails/rails/pull/48952.patch", "merged_at": "2023-08-17T12:04:35Z"}, "body": "### Motivation / Background\r\n\r\nWhen RedisCacheStore uses a connection pool, `RedisCacheStore#mset_capable?` would always return true due to the class-check here: https://github.com/rails/rails/blame/a844773245e96de8a47d24df76747cdc9e4aa01f/activesupport/lib/active_support/cache/redis_cache_store.rb#L315\r\n\r\nIn Rails 7.0.7, collection caching [started using write_multi](https://github.com/rails/rails/pull/48645). If you're using Redis::Distributed with a connection pool, it'll then raise `MAPPED_MSET cannot be used in Redis::Distributed because the keys involved need to be on the same server or because we cannot guarantee that the operation will be atomic.`.\r\n\r\n\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the class-check to handle connection pools, so that mget/mset_capable are set appropriately based on the underling class.\r\nI've also added another subclass of RedisCacheStoreCommonBehaviorTest, this one using distributed-redis + a connection pool, to try & get some more coverage there.\r\n\r\n( ~I also wanted to point out that I've [disabled a test there](https://github.com/rails/rails/pull/48952/commits/afa6a6ba3bd68a32bdb4b9a506a5819a15437ae4#diff-6cbd9119d9ff9196372e53699cb973838036a376995cf32e4c0c5d6584520d6aR277) because `delete_multi` returns the incorrect number of deletions when using Redis::Distributed.~  Can no longer reproduce the failure, think I must have been confused)\r\n\r\n### Additional information\r\n\r\nI'd originally looked at [fixing this upstream in redis-rb](https://github.com/redis/redis-rb/pull/1215) to add mset support to Redis::Distributed, and then started looking at replacing RedisCacheStore's use of Redis::Distributed with a new wrapper-class that could handle the sharding itself. I think this fix might be a better option in the short-term though, as a small fix to 7-0-stable.\r\n\r\nI don't believe the same fix is needed on main because that no-longer uses mset_capable (https://github.com/rails/rails/commit/f9fce850da754daca5274f402b7b6dc77c7489b9). It might be worth adding the extra test coverage from the new RedisCacheStoreWithDistributedRedisTest though - any preferences how that's done?\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48952/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48952/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48951", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48951/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48951/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48951/events", "html_url": "https://github.com/rails/rails/pull/48951", "id": 1852875529, "node_id": "PR_kwDNIULOWAuccA", "number": 48951, "title": "Bump bundler requirement to >= 2.2.0", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-08-16T09:39:54Z", "updated_at": "2023-08-17T07:17:05Z", "closed_at": "2023-08-17T07:17:02Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48951", "html_url": "https://github.com/rails/rails/pull/48951", "diff_url": "https://github.com/rails/rails/pull/48951.diff", "patch_url": "https://github.com/rails/rails/pull/48951.patch", "merged_at": null}, "body": "My main motivation was to remove `git_source` from the `bug_report_templates`, which is possible by rubygems/rubygems@c2e81f8ff6\r\n\r\nIn general, I'm curious what is preventing us from upgrading `bundler` and probably the `required_rubygems_version` should be increased at some point?\r\n\r\nSeems like `git_source` was removed from the generated `Gemfile` (but not templates) in #48396.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48951/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48951/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48950", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48950/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48950/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48950/events", "html_url": "https://github.com/rails/rails/pull/48950", "id": 1852669815, "node_id": "PR_kwDNIULOWAjSoQ", "number": 48950, "title": "Add support for Playwright as a driver for system tests", "user": {"login": "yuki24", "id": 386234, "node_id": "MDQ6VXNlcjM4NjIzNA==", "avatar_url": "https://avatars.githubusercontent.com/u/386234?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuki24", "html_url": "https://github.com/yuki24", "followers_url": "https://api.github.com/users/yuki24/followers", "following_url": "https://api.github.com/users/yuki24/following{/other_user}", "gists_url": "https://api.github.com/users/yuki24/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuki24/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuki24/subscriptions", "organizations_url": "https://api.github.com/users/yuki24/orgs", "repos_url": "https://api.github.com/users/yuki24/repos", "events_url": "https://api.github.com/users/yuki24/events{/privacy}", "received_events_url": "https://api.github.com/users/yuki24/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-08-16T07:28:00Z", "updated_at": "2023-08-16T12:21:25Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48950", "html_url": "https://github.com/rails/rails/pull/48950", "diff_url": "https://github.com/rails/rails/pull/48950.diff", "patch_url": "https://github.com/rails/rails/pull/48950.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\n[Playwright](https://playwright.dev/) is getting popularity as a new browser automation tool. There is a community-maintained Ruby client ([client](https://github.com/YusukeIwaki/playwright-ruby-client) and [capybara driver](https://github.com/YusukeIwaki/capybara-playwright-driver)) as well. I have been using it for a while now and it works great, and it would be great if we could add support for it to Rails.\r\n\r\n### Detail\r\n\r\nThis PR adds support for the Playwright driver to Rails.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48950/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48950/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48949", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48949/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48949/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48949/events", "html_url": "https://github.com/rails/rails/pull/48949", "id": 1852566804, "node_id": "PR_kwDNIULOWAdv_w", "number": 48949, "title": "Do not suggest adding non-existent gems to Gemfile", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-16T06:01:02Z", "updated_at": "2023-08-17T03:14:15Z", "closed_at": "2023-08-17T03:13:52Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48949", "html_url": "https://github.com/rails/rails/pull/48949", "diff_url": "https://github.com/rails/rails/pull/48949.diff", "patch_url": "https://github.com/rails/rails/pull/48949.patch", "merged_at": "2023-08-17T03:13:52Z"}, "body": "### Motivation / Background\r\n\r\nWhile these are valid Rack Handler names, their handler name is not the same as their gem name.\r\n\r\n| handler | gem        |\r\n| ------- | ---------- |\r\n| fastcgi | fcgi       |\r\n| lsws    | ruby-lsapi |\r\n\r\n### Detail\r\n\r\nDo not suggest adding non-existant gems to Gemfile\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48949/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48949/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48948", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48948/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48948/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48948/events", "html_url": "https://github.com/rails/rails/issues/48948", "id": 1852487371, "node_id": "I_kwDNIULObmq2yw", "number": 48948, "title": "Unnamed Yet", "user": {"login": "Gadrawingz", "id": 50759844, "node_id": "MDQ6VXNlcjUwNzU5ODQ0", "avatar_url": "https://avatars.githubusercontent.com/u/50759844?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Gadrawingz", "html_url": "https://github.com/Gadrawingz", "followers_url": "https://api.github.com/users/Gadrawingz/followers", "following_url": "https://api.github.com/users/Gadrawingz/following{/other_user}", "gists_url": "https://api.github.com/users/Gadrawingz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Gadrawingz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Gadrawingz/subscriptions", "organizations_url": "https://api.github.com/users/Gadrawingz/orgs", "repos_url": "https://api.github.com/users/Gadrawingz/repos", "events_url": "https://api.github.com/users/Gadrawingz/events{/privacy}", "received_events_url": "https://api.github.com/users/Gadrawingz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-16T04:27:55Z", "updated_at": "2023-08-16T04:30:02Z", "closed_at": "2023-08-16T04:28:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```rubyk\r\n# Still writing them!\r\n```\r\n\r\n### Expected behavior\r\n> Not connecting\r\n\r\n### Actual behavior\r\n> Not wanted!\r\n\r\n### System configuration\r\n> Not memorized yet\r\n\r\n**1**:\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48948/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48948/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48947", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48947/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48947/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48947/events", "html_url": "https://github.com/rails/rails/pull/48947", "id": 1852062716, "node_id": "PR_kwDNIULOWACX1w", "number": 48947, "title": "Use IN sql instead of OR sql for query constraints", "user": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-15T20:14:46Z", "updated_at": "2023-08-18T14:21:05Z", "closed_at": "2023-08-17T19:34:31Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48947", "html_url": "https://github.com/rails/rails/pull/48947", "diff_url": "https://github.com/rails/rails/pull/48947.diff", "patch_url": "https://github.com/rails/rails/pull/48947.patch", "merged_at": "2023-08-17T19:34:31Z"}, "body": "We originally implemented this project to use OR queries instead of IN because it seemed like there was no way to do that without a row constructor. While working on implementing this feature in our vitess gem I noticed that we can actually get the queries we wanted, and the new code is more performant than generating an OR.\r\n\r\nSQL Before:\r\n\r\n```sql\r\nSELECT \"sharded_comments\".*\r\nFROM \"sharded_comments\"\r\nWHERE (\"sharded_comments\".\"blog_id\" = 969142904\r\nAND (\"sharded_comments\".\"blog_post_id\" = 357271355\r\nOR \"sharded_comments\".\"blog_post_id\" = 756811794)\r\nOR \"sharded_comments\".\"blog_id\" = 308674288\r\nAND \"sharded_comments\".\"blog_post_id\" = 1055755181)\r\n```\r\n\r\nSQL After:\r\n\r\n```sql\r\nSELECT \"sharded_comments\".*\r\nFROM \"sharded_comments\"\r\nWHERE \"sharded_comments\".\"blog_id\"\r\nIN (969142904, 308674288)\r\nAND \"sharded_comments\".\"blog_post_id\"\r\nIN (357271355, 756811794, 1055755181)\r\n```\r\n\r\nUsing one of the tests that utilizes this code path, I benchmarked the queries. The new implementation is faster:\r\n\r\nBefore:\r\n\r\n```\r\nWarming up --------------------------------------\r\n             queries   147.000  i/100ms\r\nCalculating -------------------------------------\r\n             queries      1.486k (\u00b1 3.2%) i/s -      7.497k in   5.050742s\r\n```\r\n\r\nAfter:\r\n\r\n```\r\nWarming up --------------------------------------\r\n             queries   179.000  i/100ms\r\nCalculating -------------------------------------\r\n             queries      1.747k (\u00b1 4.5%) i/s -      8.771k in   5.031424s\r\n```\r\n\r\nWe can probably improve this more but I think this query is more in line with what we want and expect while also being more performant (without having to build a new row constructor in arel).", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48947/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48947/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48946", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48946/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48946/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48946/events", "html_url": "https://github.com/rails/rails/issues/48946", "id": 1852020901, "node_id": "I_kwDNIULObmOYpQ", "number": 48946, "title": "Regression in Postgres aggregate function data type inference/casting in Rails >= 7.0.5", "user": {"login": "midnightmonster", "id": 57948, "node_id": "MDQ6VXNlcjU3OTQ4", "avatar_url": "https://avatars.githubusercontent.com/u/57948?v=4", "gravatar_id": "", "url": "https://api.github.com/users/midnightmonster", "html_url": "https://github.com/midnightmonster", "followers_url": "https://api.github.com/users/midnightmonster/followers", "following_url": "https://api.github.com/users/midnightmonster/following{/other_user}", "gists_url": "https://api.github.com/users/midnightmonster/gists{/gist_id}", "starred_url": "https://api.github.com/users/midnightmonster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/midnightmonster/subscriptions", "organizations_url": "https://api.github.com/users/midnightmonster/orgs", "repos_url": "https://api.github.com/users/midnightmonster/repos", "events_url": "https://api.github.com/users/midnightmonster/events{/privacy}", "received_events_url": "https://api.github.com/users/midnightmonster/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 126910270, "node_id": "MDU6TGFiZWwxMjY5MTAyNzA=", "url": "https://api.github.com/repos/rails/rails/labels/With%20reproduction%20steps", "name": "With reproduction steps", "color": "009800", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-15T19:41:45Z", "updated_at": "2023-08-16T18:22:11Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n```sql\r\n-- Create Postgres database, required to reproduce\r\nCREATE DATABASE type_inference_test;\r\n```\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # gem \"rails\", github: \"rails/rails\", tag: \"v7.0.4.3\" # OK\r\n  # gem \"rails\", github: \"rails/rails\", tag: \"v7.0.5\"   # Fail\r\n  # gem \"rails\", github: \"rails/rails\", tag: \"v7.0.7\"   # Fail\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"    # Fail\r\n  gem \"pg\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# The issue appears appears with Postgres, not with SQLite. I have not tested other adapters.\r\n# ActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\n# N.b., in sqlite3 .pluck(\"sum(decimal_column)\").first returns a Float instead of a BigDecimal. Though that arguably is a bug, AFAICT it is _not_ a regression.\r\nActiveRecord::Base.establish_connection(adapter: \"postgresql\", database: \"type_inference_test\", encoding: \"unicode\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :line_items, force: true do |t|\r\n    t.integer :unit_count\r\n    t.decimal :subtotal\r\n  end\r\nend\r\n\r\nclass LineItem < ActiveRecord::Base\r\nend\r\n\r\nclass TypeInferenceBug < Minitest::Test\r\n  def setup\r\n    LineItem.create! unit_count: 5, subtotal: 47.98\r\n    LineItem.create! unit_count: 1, subtotal: 13.13\r\n  end\r\n\r\n  # This works correctly\r\n  def test_single_column\r\n    assert_kind_of Integer, LineItem.sum(:unit_count)\r\n    assert_kind_of Integer, LineItem.pluck(\"sum(unit_count)\").first\r\n    assert_kind_of BigDecimal, LineItem.sum(:subtotal)\r\n    assert_kind_of BigDecimal, LineItem.pluck(\"sum(subtotal)\").first\r\n  end\r\n\r\n  # All these fail starting in 7.0.5. ActiveRecord seems to apply the type of the last item to all numeric(?) columns.\r\n  def test_two_column_decimal_last\r\n    # Fails in 7.0.5-7.0.7, ok in 7.0.4.3\r\n    assert_kind_of Integer, LineItem.pluck(\"sum(unit_count)\", \"sum(subtotal)\").first.first\r\n  end\r\n\r\n  def test_two_column_integer_last\r\n    # Fails in 7.0.5-7.0.7, ok in 7.0.4.3\r\n    assert_kind_of BigDecimal, LineItem.pluck(\"sum(subtotal)\", \"sum(unit_count)\").first.first\r\n  end\r\n\r\n  def test_same_problem_with_another_aggregate_function\r\n    # Fails in 7.0.5-7.0.7, ok in 7.0.4.3\r\n    assert_kind_of BigDecimal, LineItem.pluck(\"max(subtotal)\", \"max(unit_count)\").first.first\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\nType of values returned from `pluck(\"aggregate_function(column)\",...)` depends on database's data type and does not change if additional values are also plucked. Up through Rails 7.0.4.3, this worked as expected.\r\n\r\n### Actual behavior\r\nWhen plucking sums (or other aggregate functions) of more than one numeric column, `pluck` coerces all numeric(?) values to the type of the last column, at least when using the postgresql adapter. In our use, this results in integers inconveniently cast to BigDecimals and (more perniciously) decimal values representing dollars and cents being truncated to integers\u2014and the data type of existing columns of a `pluck` call changing based on order or from adding an additional column.\r\n\r\n### System configuration\r\n**Rails version**: 7.0.7\r\n\r\n**Ruby version**: 3.1.1p18\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48946/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48946/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48945", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48945/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48945/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48945/events", "html_url": "https://github.com/rails/rails/issues/48945", "id": 1851736618, "node_id": "I_kwDNIULObl9CKg", "number": 48945, "title": "Broken table alias referencing in Rails 7.0.7", "user": {"login": "kaoru", "id": 89070, "node_id": "MDQ6VXNlcjg5MDcw", "avatar_url": "https://avatars.githubusercontent.com/u/89070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kaoru", "html_url": "https://github.com/kaoru", "followers_url": "https://api.github.com/users/kaoru/followers", "following_url": "https://api.github.com/users/kaoru/following{/other_user}", "gists_url": "https://api.github.com/users/kaoru/gists{/gist_id}", "starred_url": "https://api.github.com/users/kaoru/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kaoru/subscriptions", "organizations_url": "https://api.github.com/users/kaoru/orgs", "repos_url": "https://api.github.com/users/kaoru/repos", "events_url": "https://api.github.com/users/kaoru/events{/privacy}", "received_events_url": "https://api.github.com/users/kaoru/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 126910270, "node_id": "MDU6TGFiZWwxMjY5MTAyNzA=", "url": "https://api.github.com/repos/rails/rails/labels/With%20reproduction%20steps", "name": "With reproduction steps", "color": "009800", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-15T16:11:26Z", "updated_at": "2023-08-17T16:33:18Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\nWe're using a combination of \"where missing\" and \"or + scope\" to find goals without a state, either because they have no state record or because they have a state record with a NULL state column on it.\r\n\r\nThe behaviour has changed in Rails 7.0.7 to throw an ActiveRecord::StatementInvalid error, because on 7.0.6 the left joined table was not given an alias but on 7.0.7 it is given an alias and that alias is then not consistently used in the where clauses produced.\r\n\r\nNote this looks a lot like https://github.com/rails/rails/issues/48334 but that bug is fixed on 7.0.6 and 7.0.7.\r\n\r\n```ruby\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # gem 'rails', '~> 7.0', '= 7.0.6'\r\n  gem 'rails', '~> 7.0', '= 7.0.7'\r\n  # gem 'rails', github: 'rails/rails'\r\n  gem 'sqlite3'\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\n#ActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :goals, force: true do |t|\r\n  end\r\n\r\n  create_table :goal_states, force: true do |t|\r\n    t.integer :goal_id\r\n    t.string :state\r\n  end\r\nend\r\n\r\nclass Goal < ActiveRecord::Base\r\n  has_one :state, class_name: 'GoalState', dependent: :destroy\r\n\r\n  scope :no_state, -> { where.missing(:state).or(left_joins(:state).merge(GoalState.not_set)) }\r\nend\r\n\r\nclass GoalState < ActiveRecord::Base\r\n  belongs_to :goal\r\n\r\n  scope :set, -> { where.not(state: nil) }\r\n  scope :not_set, -> { where(state: nil) }\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def setup\r\n    @g1 = Goal.create\r\n\r\n    @g2 = Goal.create\r\n    @g2.create_state(state: nil)\r\n\r\n    @g3 = Goal.create\r\n    @g3.create_state(state: 'cool')\r\n  end\r\n\r\n  # This works on Rails 7.0.6 and gives an ActiveRecord::StatementInvalid on\r\n  # Rails 7.0.7 because the table alias behaviour has changed.\r\n  def test_no_state\r\n    puts\r\n    puts Goal.no_state.to_sql\r\n    puts\r\n\r\n    assert_equal 2, Goal.no_state.count\r\n    assert_equal Goal.no_state, [@g1, @g2]\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\n\r\nOn Rails 7.0.6 the SQL produced is:\r\n\r\n```sql\r\nSELECT \"goals\".* FROM \"goals\" LEFT OUTER JOIN \"goal_states\" ON \"goal_states\".\"goal_id\" = \"goals\".\"id\" WHERE (\"goal_states\".\"id\" IS NULL OR \"goal_states\".\"state\" IS NULL)\r\n```\r\n\r\n### Actual behavior\r\n\r\nOn Rails 7.0.7 (and on the main branch of `rails/rails`) the SQL produced is:\r\n\r\n```sql\r\nSELECT \"goals\".* FROM \"goals\" LEFT OUTER JOIN \"goal_states\" \"state\" ON \"state\".\"goal_id\" = \"goals\".\"id\" WHERE (\"state\".\"id\" IS NULL OR \"goal_states\".\"state\" IS NULL)\r\n```\r\n\r\nWhich throws an error:\r\n\r\n```\r\nActiveRecord::StatementInvalid: SQLite3::SQLException: no such column: goal_states.state\r\n```\r\n\r\nBecause the missing gives the left join an alias of \"state\" but the check produced by the \"OR\" uses the table name \"goal_states\".\r\n\r\nI've fixed this in our codebase by changing the code to `scope :no_status, -> { left_joins(:status).merge(Goals::Status.not_set) }` because technically with a left join the missing check is redundant anyway! But I thought I'd report the bug in case it's affecting other people with harder-to-fix query cases.\r\n\r\n### System configuration\r\n\r\n**Rails version**: 7.0.7\r\n\r\n**Ruby version**: 3.2.2", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48945/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48945/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48944", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48944/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48944/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48944/events", "html_url": "https://github.com/rails/rails/issues/48944", "id": 1851693426, "node_id": "I_kwDNIULObl6Zcg", "number": 48944, "title": "Order of `id` column in `select` changes loaded record ID", "user": {"login": "conzett", "id": 142183, "node_id": "MDQ6VXNlcjE0MjE4Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/142183?v=4", "gravatar_id": "", "url": "https://api.github.com/users/conzett", "html_url": "https://github.com/conzett", "followers_url": "https://api.github.com/users/conzett/followers", "following_url": "https://api.github.com/users/conzett/following{/other_user}", "gists_url": "https://api.github.com/users/conzett/gists{/gist_id}", "starred_url": "https://api.github.com/users/conzett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/conzett/subscriptions", "organizations_url": "https://api.github.com/users/conzett/orgs", "repos_url": "https://api.github.com/users/conzett/repos", "events_url": "https://api.github.com/users/conzett/events{/privacy}", "received_events_url": "https://api.github.com/users/conzett/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-15T15:44:05Z", "updated_at": "2023-08-15T15:44:05Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\nrequire \"bundler/inline\"                                                         \r\n                                                                                 \r\ngemfile(true) do                                                                 \r\n  source \"https://rubygems.org\"                                                  \r\n                                                                                 \r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }                \r\n                                                                                 \r\n  # Activate the gem you are reporting the issue against.                        \r\n  gem \"activerecord\", \"~> 7.0.0\"                                                 \r\n  gem \"sqlite3\"                                                                  \r\nend                                                                              \r\n                                                                                 \r\nrequire \"active_record\"                                                          \r\nrequire \"minitest/autorun\"                                                       \r\nrequire \"logger\"                                                                 \r\n                                                                                 \r\n# This connection will do for database-independent bug reports.                  \r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)                                   \r\n                                                                                 \r\nActiveRecord::Schema.define do                                                   \r\n  create_table :posts, force: true do |t|                                        \r\n  end                                                                            \r\n                                                                                 \r\n  create_table :comments, force: true do |t|                                     \r\n    t.integer :post_id                                                           \r\n  end                                                                            \r\nend                                                                              \r\n                                                                                 \r\nclass Post < ActiveRecord::Base                                                  \r\n  has_many :comments                                                             \r\nend                                                                              \r\n                                                                                 \r\nclass Comment < ActiveRecord::Base                                               \r\n  belongs_to :post                                                               \r\nend                                                                              \r\n                                                                                 \r\nclass BugTest < Minitest::Test                                                   \r\n  def test_select_order_with_join                                                \r\n    10.times { |i| Post.create! id: i + 1 }                                      \r\n                                                                                 \r\n    Post.first.comments << Comment.create!                                       \r\n                                                                                 \r\n    join_last = Post.left_joins(:comments).select \"posts.*, comments.id\"         \r\n    join_first = Post.left_joins(:comments).select \"comments.id, posts.*\"        \r\n                                                                                 \r\n    assert_equal (1..10).to_a, join_last.map(&:id)                               \r\n    assert_equal join_last.map(&:id), join_first.map(&:id)                       \r\n  end                                                                            \r\nend                                                                              \r\n```\r\n\r\n### Expected behavior\r\n- Post records should have correct `id` and not the ID of the join record(s)\r\n- Order of what is being selected should not matter?\r\n\r\n### Actual behavior\r\nThe ID if the join record appears to be assigned to the main record\r\n\r\n### System configuration\r\n**Rails version**: 7.0.0\r\n\r\n**Ruby version**: 3.2.2\r\n\r\nAlso tested with Rails 6 and Ruby 2.7\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48944/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48944/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48943", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48943/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48943/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48943/events", "html_url": "https://github.com/rails/rails/issues/48943", "id": 1851247869, "node_id": "I_kwDNIULOblfM_Q", "number": 48943, "title": "Would be nice to drop DB with FORCE argument", "user": {"login": "loqimean", "id": 49816584, "node_id": "MDQ6VXNlcjQ5ODE2NTg0", "avatar_url": "https://avatars.githubusercontent.com/u/49816584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/loqimean", "html_url": "https://github.com/loqimean", "followers_url": "https://api.github.com/users/loqimean/followers", "following_url": "https://api.github.com/users/loqimean/following{/other_user}", "gists_url": "https://api.github.com/users/loqimean/gists{/gist_id}", "starred_url": "https://api.github.com/users/loqimean/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/loqimean/subscriptions", "organizations_url": "https://api.github.com/users/loqimean/orgs", "repos_url": "https://api.github.com/users/loqimean/repos", "events_url": "https://api.github.com/users/loqimean/events{/privacy}", "received_events_url": "https://api.github.com/users/loqimean/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-15T10:54:07Z", "updated_at": "2023-08-15T17:52:10Z", "closed_at": "2023-08-15T17:52:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nThere is no step to reproduce, because database can be accessed automatically and because of doesn't closed connection I can't drop my DB. So, would be fine to have ability to drop DB with `FORCE` option, that DB provides. The problem described in this stackowerflow issue:\r\nhttps://stackoverflow.com/questions/17449420/postgresql-unable-to-drop-database-because-of-some-auto-connections-to-db\r\n\r\n### Expected behavior\r\n`rails db:drop! # success`\r\n\r\n### Actual behavior\r\n`rails db:drop # error, because database is accessed by other user`\r\n\r\n### System configuration\r\n**Rails version**:\r\n\r\n**Ruby version**:\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48943/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48943/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48942", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48942/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48942/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48942/events", "html_url": "https://github.com/rails/rails/issues/48942", "id": 1851210298, "node_id": "I_kwDNIULOblc6Og", "number": 48942, "title": "Why we cannot pass the other options to `joins`?", "user": {"login": "loqimean", "id": 49816584, "node_id": "MDQ6VXNlcjQ5ODE2NTg0", "avatar_url": "https://avatars.githubusercontent.com/u/49816584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/loqimean", "html_url": "https://github.com/loqimean", "followers_url": "https://api.github.com/users/loqimean/followers", "following_url": "https://api.github.com/users/loqimean/following{/other_user}", "gists_url": "https://api.github.com/users/loqimean/gists{/gist_id}", "starred_url": "https://api.github.com/users/loqimean/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/loqimean/subscriptions", "organizations_url": "https://api.github.com/users/loqimean/orgs", "repos_url": "https://api.github.com/users/loqimean/repos", "events_url": "https://api.github.com/users/loqimean/events{/privacy}", "received_events_url": "https://api.github.com/users/loqimean/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-15T10:17:29Z", "updated_at": "2023-08-15T17:48:08Z", "closed_at": "2023-08-15T17:48:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nWhen we have STI for example with relation and would like to pass an extra options to joins, like type checking, for example:\r\n```ruby\r\nclass Group < ApplicationRecord\r\n  belongs_to :groupable, polymorphic: true\r\nend\r\n\r\nclass OtherGroup < Group\r\n  GROUP_MESSAGES = [:book_requested, :some_other].freeze\r\n\r\n  validates :group_message, inclusion: { in: GROUP_MESSAGES }\r\nend\r\n\r\n\r\nclass Book < ApplicationRecord\r\n  has_many :groups, as: :groupable, class_name: \"OtherGroup\"\r\nend\r\n\r\n\r\n# So, let's reproduce:\r\n# I'd like to do it like this:\r\nBook.joins(groups: { group_message: \"book_requested\" }).where(groups: { some: :another })\r\n\r\n# BUT I should do this..:\r\nBook.joins(\r\n  <<~SQL\r\n    INNER JOIN \"groups\"\r\n      ON \"groups\".\"groupable_type\" = \"Book\" AND\r\n      \"groups\".\"groupable_id\" = \"books\".\"id\" AND\r\n      \"groups\".\"group_message\" = \"book_requested\"\r\n  SQL\r\n).where(groups: { some: :another })\r\n```\r\n\r\n### Expected behavior\r\nBook.joins(groups: { group_message: \"book_requested\" }).where(groups: { some: :another })\r\n\r\n### Actual behavior\r\nBook.joins(\r\n  <<~SQL\r\n    INNER JOIN \"groups\"\r\n      ON \"groups\".\"groupable_type\" = \"Book\" AND\r\n      \"groups\".\"groupable_id\" = \"books\".\"id\" AND\r\n      \"groups\".\"group_message\" = \"book_requested\"\r\n  SQL\r\n).where(groups: { some: :another })\r\n\r\n### System configuration\r\n**Rails version**: 7.x.x\r\n\r\n**Ruby version**: 3.x.x\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48942/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48942/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48941", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48941/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48941/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48941/events", "html_url": "https://github.com/rails/rails/pull/48941", "id": 1851022632, "node_id": "PR_kwDNIULOV_K75g", "number": 48941, "title": "Fix host display when X_FORWARDED_HOST authorized", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-15T07:34:14Z", "updated_at": "2023-08-15T07:35:44Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48941", "html_url": "https://github.com/rails/rails/pull/48941", "diff_url": "https://github.com/rails/rails/pull/48941.diff", "patch_url": "https://github.com/rails/rails/pull/48941.patch", "merged_at": null}, "body": "\r\n\r\n\r\n### Motivation / Background\r\n\r\nPreviously, when a Request had a non-authorized HTTP_HOST but an authorized HTTP_X_FORWARDED_HOST, the HTTP_X_FORWARDED_HOST value would be displayed as the one being blocked. However, this could be confusing for users since that value would already be added to `config.hosts`.\r\n\r\n### Detail\r\n\r\nThis commit addresses the issue by tweaking how the blocked host is displayed. Instead of always displaying Request#host (which will return X_FORWARDED_HOST when present whether or not that's the host being blocked), each host being blocked will be displayed on its own.\r\n\r\n### Additional information\r\n\r\nFixes #40230\r\nSupercedes #46158\r\n\r\ncc @Eusebius1920 I added you as a coauthor for your work on the previous PR\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48941/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48941/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48940", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48940/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48940/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48940/events", "html_url": "https://github.com/rails/rails/pull/48940", "id": 1850339168, "node_id": "PR_kwDNIULOV-l43w", "number": 48940, "title": "Ignore all environment files in the gitignore template", "user": {"login": "cover", "id": 76693, "node_id": "MDQ6VXNlcjc2Njkz", "avatar_url": "https://avatars.githubusercontent.com/u/76693?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cover", "html_url": "https://github.com/cover", "followers_url": "https://api.github.com/users/cover/followers", "following_url": "https://api.github.com/users/cover/following{/other_user}", "gists_url": "https://api.github.com/users/cover/gists{/gist_id}", "starred_url": "https://api.github.com/users/cover/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cover/subscriptions", "organizations_url": "https://api.github.com/users/cover/orgs", "repos_url": "https://api.github.com/users/cover/repos", "events_url": "https://api.github.com/users/cover/events{/privacy}", "received_events_url": "https://api.github.com/users/cover/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-08-14T18:39:58Z", "updated_at": "2023-08-19T10:31:45Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48940", "html_url": "https://github.com/rails/rails/pull/48940", "diff_url": "https://github.com/rails/rails/pull/48940.diff", "patch_url": "https://github.com/rails/rails/pull/48940.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nI've been playing a bit with MRSK on a new Rails 7.1alpha project (using `main`) and something that is both mentioned in the video and the [Readme](https://github.com/mrsked/mrsk#using-a-generated-env-file) is the ability to set a `.env.erb` template and then run `mrsk envify` to generate the final `.env`.\r\n\r\nGiven that MRSK might become more popular to deploy Rails applications, it feels like a good default to automatically remove any `.env` from the Git repository that are not templates or examples.\r\n\r\n### Detail\r\n\r\nThis adds a few new lines to the `.gitignore` template to ignore all env files that are not ending by `.erb` or `.example`\r\n\r\n### Additional information\r\n\r\nThis is similar to what the `.dockerignore` is [currently doing](https://github.com/rails/rails/blob/main/railties/lib/rails/generators/rails/app/templates/dockerignore.tt#L13), with the exception of allowing template files and any specialized env files (eg. `.env.staging.erb` / `.env.staging.example`)\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48940/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48940/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48939", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48939/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48939/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48939/events", "html_url": "https://github.com/rails/rails/issues/48939", "id": 1850332701, "node_id": "I_kwDNIULObknWHQ", "number": 48939, "title": "HABTM Silently ignores :dependent option", "user": {"login": "nhorton", "id": 204146, "node_id": "MDQ6VXNlcjIwNDE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/204146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nhorton", "html_url": "https://github.com/nhorton", "followers_url": "https://api.github.com/users/nhorton/followers", "following_url": "https://api.github.com/users/nhorton/following{/other_user}", "gists_url": "https://api.github.com/users/nhorton/gists{/gist_id}", "starred_url": "https://api.github.com/users/nhorton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nhorton/subscriptions", "organizations_url": "https://api.github.com/users/nhorton/orgs", "repos_url": "https://api.github.com/users/nhorton/repos", "events_url": "https://api.github.com/users/nhorton/events{/privacy}", "received_events_url": "https://api.github.com/users/nhorton/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-14T18:35:22Z", "updated_at": "2023-08-15T15:25:16Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n  end\r\n\r\n  create_table :categories, force: true do |t|\r\n  end\r\n\r\n  create_join_table :posts, :categories\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  has_and_belongs_to_many :categories\r\nend\r\n\r\nclass Category < ActiveRecord::Base\r\n  has_and_belongs_to_many :posts, dependent: :destroy\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_association_stuff\r\n    post = Post.create!\r\n    category = Category.create!\r\n    post.categories << category\r\n    assert post.persisted?\r\n    assert category.posts.include?(post)\r\n\r\n    # Now the bug\r\n    category.destroy!\r\n    refute Post.find_by_id(post.id) # Post should be gone\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\nHABTM should either destroy the associated resource when it is destroyed, or the declaration should error when you try to set the `:dependent` option should trigger an error\r\n\r\n### Actual behavior\r\nIt silently accepts the `:dependent` option then ignores it\r\n\r\n### System configuration\r\n**Rails version**: 7.0.7\r\n\r\n**Ruby version**: 3.1.4\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48939/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48939/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48938", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48938/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48938/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48938/events", "html_url": "https://github.com/rails/rails/issues/48938", "id": 1849803234, "node_id": "I_kwDNIULObkHB4g", "number": 48938, "title": "Rails cache broken with Redis::Distributed in 7.0.7", "user": {"login": "jdelStrother", "id": 2377, "node_id": "MDQ6VXNlcjIzNzc=", "avatar_url": "https://avatars.githubusercontent.com/u/2377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdelStrother", "html_url": "https://github.com/jdelStrother", "followers_url": "https://api.github.com/users/jdelStrother/followers", "following_url": "https://api.github.com/users/jdelStrother/following{/other_user}", "gists_url": "https://api.github.com/users/jdelStrother/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdelStrother/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdelStrother/subscriptions", "organizations_url": "https://api.github.com/users/jdelStrother/orgs", "repos_url": "https://api.github.com/users/jdelStrother/repos", "events_url": "https://api.github.com/users/jdelStrother/events{/privacy}", "received_events_url": "https://api.github.com/users/jdelStrother/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-14T13:42:16Z", "updated_at": "2023-08-14T13:59:38Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "https://github.com/rails/rails/pull/48645 adds support for write_multi in collection caches, but this now breaks when using Redis::Distributed as a backend. eg:\r\n\r\n```ruby\r\n      config.cache_store = :redis_cache_store, {\r\n        url: [url1, url2],\r\n        ...\r\n      }\r\n}\r\n```\r\n\r\nI'm seeing `MAPPED_MSET cannot be used in Redis::Distributed because the keys involved need to be on the same server or because we cannot guarantee that the operation will be atomic.`\r\n\r\n```\r\nredis (5.0.7) lib/redis/distributed.rb in mapped_mset at line 306\r\nactivesupport (7.0.7) lib/active_support/cache/redis_cache_store.rb in block (2 levels) in write_multi_entries at line 419\r\nconnection_pool (2.4.1) lib/connection_pool.rb in block (2 levels) in with at line 110\r\nconnection_pool (2.4.1) lib/connection_pool.rb in handle_interrupt at line 109\r\nconnection_pool (2.4.1) lib/connection_pool.rb in block in with at line 109\r\nconnection_pool (2.4.1) lib/connection_pool.rb in handle_interrupt at line 106\r\nconnection_pool (2.4.1) lib/connection_pool.rb in with at line 106\r\nactivesupport (7.0.7) lib/active_support/cache/redis_cache_store.rb in block in write_multi_entries at line 418\r\nactivesupport (7.0.7) lib/active_support/cache/redis_cache_store.rb in failsafe at line 466\r\nactivesupport (7.0.7) lib/active_support/cache/redis_cache_store.rb in write_multi_entries at line 416\r\nactivesupport (7.0.7) lib/active_support/cache.rb in block in write_multi at line 415\r\nactivesupport (7.0.7) lib/active_support/cache.rb in block in instrument at line 783\r\nactivesupport (7.0.7) lib/active_support/notifications.rb in block in instrument at line 206\r\nactivesupport (7.0.7) lib/active_support/notifications/instrumenter.rb in instrument at line 24\r\nactivesupport (7.0.7) lib/active_support/notifications.rb in instrument at line 206\r\nactivesupport (7.0.7) lib/active_support/cache.rb in instrument at line 783\r\nactivesupport (7.0.7) lib/active_support/cache.rb in write_multi at line 410\r\nactionview (7.0.7) lib/action_view/renderer/partial_renderer/collection_caching.rb in fetch_or_cache_partial at line 106\r\nactionview (7.0.7) lib/action_view/renderer/partial_renderer/collection_caching.rb in cache_collection_render at line 43\r\nactionview (7.0.7) lib/action_view/renderer/collection_renderer.rb in block in render_collection at line 161\r\nactivesupport (7.0.7) lib/active_support/notifications.rb in block in instrument at line 206\r\nactivesupport (7.0.7) lib/active_support/notifications/instrumenter.rb in instrument at line 24\r\nactivesupport (7.0.7) lib/active_support/notifications.rb in instrument at line 206\r\nactionview (7.0.7) lib/action_view/renderer/collection_renderer.rb in render_collection at line 147\r\nactionview (7.0.7) lib/action_view/renderer/collection_renderer.rb in render_collection_with_partial at line 119\r\nactionview (7.0.7) lib/action_view/renderer/renderer.rb in render_partial_to_object at line 72\r\nactionview (7.0.7) lib/action_view/renderer/renderer.rb in render_to_object at line 27\r\nactionview (7.0.7) lib/action_view/renderer/renderer.rb in render at line 22\r\nactionview (7.0.7) lib/action_view/helpers/rendering_helper.rb in block in render at line 37\r\nactionview (7.0.7) lib/action_view/base.rb in in_rendering_context at line 270\r\nactionview (7.0.7) lib/action_view/helpers/rendering_helper.rb in render at line 33\r\n```\r\n\r\n@byroot perhaps this could be fixed in Redis::Distributed with something like this (pseudocode) ?\r\n\r\n```ruby\r\n    def mapped_mset(hash, atomic: true)\r\n      raise CannotDistribute, :mapped_mset if atomic\r\n      \r\n       hash.group_by { node_for(_1) }.each { |node, keyvalues|\r\n            node.mapped_mset(keyvalues)\r\n       }\r\n    end\r\n```\r\n\r\nwant me to take a stab at fixing it?", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48938/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48938/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48937", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48937/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48937/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48937/events", "html_url": "https://github.com/rails/rails/pull/48937", "id": 1849385223, "node_id": "PR_kwDNIULOV9yWzQ", "number": 48937, "title": "Handle non-string partial body in ActionView::CollectionCaching (7.0 backport)", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-14T09:27:04Z", "updated_at": "2023-08-14T09:52:58Z", "closed_at": "2023-08-14T09:52:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48937", "html_url": "https://github.com/rails/rails/pull/48937", "diff_url": "https://github.com/rails/rails/pull/48937.diff", "patch_url": "https://github.com/rails/rails/pull/48937.patch", "merged_at": "2023-08-14T09:52:57Z"}, "body": "Followup: https://github.com/rails/rails/pull/48645\r\n\r\nSome template engines such as `jbuilder` use these Action View primitives with types other than strings, which breaks a bunch of assumptions.\r\n\r\nI wish I could add a test for this, but this is deep in private methods I don't see a way to cover this.\r\n\r\nFYI @edariedl", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48937/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48937/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48936", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48936/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48936/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48936/events", "html_url": "https://github.com/rails/rails/pull/48936", "id": 1849378284, "node_id": "PR_kwDNIULOV9x9pw", "number": 48936, "title": "Handle non-string partial body in ActionView::CollectionCaching", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-14T09:23:16Z", "updated_at": "2023-08-14T09:52:49Z", "closed_at": "2023-08-14T09:52:49Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48936", "html_url": "https://github.com/rails/rails/pull/48936", "diff_url": "https://github.com/rails/rails/pull/48936.diff", "patch_url": "https://github.com/rails/rails/pull/48936.patch", "merged_at": "2023-08-14T09:52:49Z"}, "body": "Followup: https://github.com/rails/rails/pull/48645\r\n\r\nSome template engines such as `jbuilder` use these Action View primitives with types other than strings, which breaks a bunch of assumptions.\r\n\r\nI wish I could add a test for this, but this is deep in private methods I don't see a way to cover this.\r\n\r\nFYI @edariedl \r\n\r\nI'll also work on a backport for 7-0-stable.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48936/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48936/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48935", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48935/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48935/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48935/events", "html_url": "https://github.com/rails/rails/pull/48935", "id": 1849199290, "node_id": "PR_kwDNIULOV9oFVQ", "number": 48935, "title": "Add note on GitHub Codespaces to Getting Started guide [skip ci]", "user": {"login": "yasulab", "id": 155807, "node_id": "MDQ6VXNlcjE1NTgwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/155807?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yasulab", "html_url": "https://github.com/yasulab", "followers_url": "https://api.github.com/users/yasulab/followers", "following_url": "https://api.github.com/users/yasulab/following{/other_user}", "gists_url": "https://api.github.com/users/yasulab/gists{/gist_id}", "starred_url": "https://api.github.com/users/yasulab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yasulab/subscriptions", "organizations_url": "https://api.github.com/users/yasulab/orgs", "repos_url": "https://api.github.com/users/yasulab/repos", "events_url": "https://api.github.com/users/yasulab/events{/privacy}", "received_events_url": "https://api.github.com/users/yasulab/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-08-14T07:44:18Z", "updated_at": "2023-08-15T10:46:47Z", "closed_at": "2023-08-15T08:46:16Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48935", "html_url": "https://github.com/rails/rails/pull/48935", "diff_url": "https://github.com/rails/rails/pull/48935.diff", "patch_url": "https://github.com/rails/rails/pull/48935.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThis PR adds a note for new Rails developers to get started quickly by [GitHub Codespaces](https://github.com/features/codespaces). They can start [creating the blog application](https://guides.rubyonrails.org/getting_started.html#creating-a-new-rails-project) by clicking a Rails template from [Codespaces templates](https://github.com/codespaces/templates) provided by GitHub.\r\n\r\n- [:octocat: github/codespaces-rails](https://github.com/github/codespaces-rails)\r\n\r\n\r\n### Detail\r\n\r\nThe note added by this PR is generated like this:\r\n\r\n<img width=\"548\" alt=\"image\" src=\"https://github.com/rails/rails/assets/155807/77a449bf-3f3f-4b9b-a57b-959909c34a4f\">\r\n\r\nYou can check how it works by following steps:\r\n\r\n1. Go to https://github.com/codespaces/templates\r\n2. Click `Use this template` in Ruby on Rails\r\n3. Wait until GitHub Codespaces gets ready.\r\n\r\n\r\n### Additional information\r\n\r\nThe official Rails template sets `4` to CPUs, which means new Rails developers can use Codespaces 30 hours free / month. The 30 hours would be enough to finish the [Getting Started guide](https://guides.rubyonrails.org/getting_started.html).\r\n\r\n- https://github.com/features/codespaces\r\n- https://github.com/github/codespaces-rails/blob/b999f8549281fc85d1d3715eb8c2998038adea83/.devcontainer/devcontainer.json#L4\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48935/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48935/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48934", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48934/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48934/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48934/events", "html_url": "https://github.com/rails/rails/issues/48934", "id": 1848941870, "node_id": "I_kwDNIULObjSdLg", "number": 48934, "title": "assert_broadcasts fails when testing broadcast_append_to", "user": {"login": "intradayreview", "id": 121980070, "node_id": "U_kgDOB0VEpg", "avatar_url": "https://avatars.githubusercontent.com/u/121980070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/intradayreview", "html_url": "https://github.com/intradayreview", "followers_url": "https://api.github.com/users/intradayreview/followers", "following_url": "https://api.github.com/users/intradayreview/following{/other_user}", "gists_url": "https://api.github.com/users/intradayreview/gists{/gist_id}", "starred_url": "https://api.github.com/users/intradayreview/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/intradayreview/subscriptions", "organizations_url": "https://api.github.com/users/intradayreview/orgs", "repos_url": "https://api.github.com/users/intradayreview/repos", "events_url": "https://api.github.com/users/intradayreview/events{/privacy}", "received_events_url": "https://api.github.com/users/intradayreview/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-14T03:47:52Z", "updated_at": "2023-08-14T04:27:34Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n\r\nMake sure you have turbo-rails gem installed then try and test using assert_broadcasts and it will fail.\r\n\r\n```ruby\r\n\r\nclass Comment < ApplicationRecord\r\n  belongs_to :user\r\n  belongs_to :commentable, polymorphic: true\r\n\r\n  after_create_commit do\r\n    broadcast_append_to(commentable, target: ApplicationController.helpers.dom_id(commentable, :comments),\r\n                                     partial: \"comments/comment\", locals: { comment: self })\r\n  end\r\nend\r\n\r\nclass CommentCallbackTest < CommentTest\r\n  include ActionCable::TestHelper\r\n\r\n  setup do\r\n    Current.user = users(:roger)\r\n    @commentable = screenshots(:roger_review)\r\n  end\r\n\r\n  test 'should broadcast comment after create' do\r\n    assert_broadcasts @commentable, 1 do\r\n      Comment.create!(commentable: @commentable, content: 'Test content')\r\n    end\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\nExpected test to pass.\r\n\r\nBut the stream name is not converted using `stream.to_gid_param ` so the stream is never found and the test fails https://github.com/rails/rails/blob/157920aead96865e3135f496c09ace607d5620dc/actioncable/lib/action_cable/test_helper.rb#L45\r\n\r\nWriting the test like this passes but does not match the docs.\r\n\r\n```ruby\r\n  test 'should broadcast comment after create' do\r\n    assert_broadcasts @commentable.to_gid_param, 1 do\r\n      Comment.create!(commentable: @commentable, content: 'Test content')\r\n    end\r\n  end\r\n```\r\n\r\n### Actual behavior\r\n`\r\nFailure:\r\nCommentCallbackTest#test_should_broadcast_comment_after_create [/Users/lmackay/Desktop/intradayreview/test/models/comment_test.rb:43]:\r\n1 broadcasts to #<Screenshot:0x00000001166ecde8> expected, but 0 were sent.\r\nExpected: 1\r\n  Actual: 0\r\n`\r\n\r\n### System configuration\r\n\r\n**Rails version**: 7.0.2.3\r\n**Ruby version**: ruby 3.0.5p211\r\n**Turbo rails version**: 1.0.1\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48934/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48934/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48933", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48933/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48933/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48933/events", "html_url": "https://github.com/rails/rails/pull/48933", "id": 1848400629, "node_id": "PR_kwDNIULOV899oQ", "number": 48933, "title": "Prevent autoloading fixtures in gem paths.", "user": {"login": "JoeDupuis", "id": 1518299, "node_id": "MDQ6VXNlcjE1MTgyOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1518299?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JoeDupuis", "html_url": "https://github.com/JoeDupuis", "followers_url": "https://api.github.com/users/JoeDupuis/followers", "following_url": "https://api.github.com/users/JoeDupuis/following{/other_user}", "gists_url": "https://api.github.com/users/JoeDupuis/gists{/gist_id}", "starred_url": "https://api.github.com/users/JoeDupuis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JoeDupuis/subscriptions", "organizations_url": "https://api.github.com/users/JoeDupuis/orgs", "repos_url": "https://api.github.com/users/JoeDupuis/repos", "events_url": "https://api.github.com/users/JoeDupuis/events{/privacy}", "received_events_url": "https://api.github.com/users/JoeDupuis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-13T04:24:10Z", "updated_at": "2023-08-13T19:52:28Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48933", "html_url": "https://github.com/rails/rails/pull/48933", "diff_url": "https://github.com/rails/rails/pull/48933.diff", "patch_url": "https://github.com/rails/rails/pull/48933.patch", "merged_at": null}, "body": "#48287 introduced auto loading fixtures in engines. All engines present in the root folder of the rails app would have their fixtures auto loaded. This caused tests to fail when gems were vendorized, because fixtures from the internal rails test suite would be loaded.\r\n\r\n#48323 Added a check to exclude the vendor folder.\r\n\r\nThis PR extends the check introduced in #48323 to prevent loading fixtures from gem paths instead of just the vendor folder.\r\n\r\nSome tools like devenv install gems in the root of the app, but outside of the vendor folder (`.devenv/state`).\r\n\r\nThis change prevents automatically loading fixtures from gems instead of the vendor folder.\r\n\r\n### Motivation / Background\r\n\r\nI run rails using devenv and after updating rails, my test suite started to complain about fixtures from rails internal tests.\r\nThe current check doesn't fix the issue for all situations. This new check *should*.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48933/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48933/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48932", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48932/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48932/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48932/events", "html_url": "https://github.com/rails/rails/pull/48932", "id": 1848369470, "node_id": "PR_kwDNIULOV88TUA", "number": 48932, "title": "This branch allows a user to set self.table_alias in the model", "user": {"login": "paulreece", "id": 96156234, "node_id": "U_kgDOBbs6Sg", "avatar_url": "https://avatars.githubusercontent.com/u/96156234?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paulreece", "html_url": "https://github.com/paulreece", "followers_url": "https://api.github.com/users/paulreece/followers", "following_url": "https://api.github.com/users/paulreece/following{/other_user}", "gists_url": "https://api.github.com/users/paulreece/gists{/gist_id}", "starred_url": "https://api.github.com/users/paulreece/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paulreece/subscriptions", "organizations_url": "https://api.github.com/users/paulreece/orgs", "repos_url": "https://api.github.com/users/paulreece/repos", "events_url": "https://api.github.com/users/paulreece/events{/privacy}", "received_events_url": "https://api.github.com/users/paulreece/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-13T02:50:09Z", "updated_at": "2023-08-17T16:15:13Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48932", "html_url": "https://github.com/rails/rails/pull/48932", "diff_url": "https://github.com/rails/rails/pull/48932.diff", "patch_url": "https://github.com/rails/rails/pull/48932.patch", "merged_at": null}, "body": "This branch allows a user to set `self.table_alias` in the model to custom set a table alias.  It then accounts for the SQL needed for this in the AST.  It addresses #48775.\r\n\r\n### Motivation / Background\r\n\r\nThis was motivated by the behavior shown in [48775](https://github.com/rails/rails/issues/48775) and by a suggestion to implement it by @rafaelfranca.  \r\n\r\n### Detail\r\n\r\nThis Pull Request allows a user to set a SQL `table_alias` in the model by using `self.table_alias = \"alias\"`.  Once this is done it gets added to the `Alias` node in the AST.  In order to account for this in the SQL created by the AST I have the `Insert` statement using the original table name instead of the `table_alias` when a `table_alias` is present so that the SQL INSERT will function.  \r\n\r\nWith the `Update` and `Delete` methods I changed the default behavior of `visit_Arel_Table` to use ` AS ` when a `table_alias` is present, `table AS t` vs `table t`.  One last adjustment was necessary in the `Delete` method.  In order for MySQL to use the alias in the delete method I needed to add the `table_alias` after `DELETE `.  So the code checks for MySQL and if the Node is using a `table_alias` it will then insert the alias  after `DELETE `, `DELETE t FROM table AS t` vs `DELETE FROM table AS t`.  \r\n\r\nWith these adjustments in place one can now successfully use a `table_alias` set from the model with the Public API.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48932/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48932/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48931", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48931/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48931/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48931/events", "html_url": "https://github.com/rails/rails/issues/48931", "id": 1847372572, "node_id": "I_kwDNIULObhyrHA", "number": 48931, "title": "`undefine_attribute_methods` now clears alias attribute methods", "user": {"login": "nvasilevski", "id": 5512772, "node_id": "MDQ6VXNlcjU1MTI3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/5512772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nvasilevski", "html_url": "https://github.com/nvasilevski", "followers_url": "https://api.github.com/users/nvasilevski/followers", "following_url": "https://api.github.com/users/nvasilevski/following{/other_user}", "gists_url": "https://api.github.com/users/nvasilevski/gists{/gist_id}", "starred_url": "https://api.github.com/users/nvasilevski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nvasilevski/subscriptions", "organizations_url": "https://api.github.com/users/nvasilevski/orgs", "repos_url": "https://api.github.com/users/nvasilevski/repos", "events_url": "https://api.github.com/users/nvasilevski/events{/privacy}", "received_events_url": "https://api.github.com/users/nvasilevski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-11T20:16:07Z", "updated_at": "2023-08-14T14:11:22Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In https://github.com/rails/rails/pull/48533 we made a deliberate decision to use `generated_attribute_methods` module\r\nhttps://github.com/rails/rails/blob/008db52a0694d36ae47be7a8ab79bf838d79079d/activemodel/lib/active_model/attribute_methods.rb#L376\r\nto define both attribute and alias attribute methods. \r\n\r\nThis lead to the `undefine_attribute_methods` method now cleaning up alias attribute methods along with attribute methods. \r\nWe may want to reconsider this decision since this behavior may be found confusing since there is no clear guidance on how to explicitly re-generate alias method attributes after clearing them. \r\n\r\nAlso it may lead to some libraries being broken since those libraries won't be aware of the new behavior. \r\n\r\nFor example `frozen_record` undefines attributes under certain circumstances and frozen records may end up not having alias attributes since the library doesn't bring the alias attribute methods back. \r\n\r\nhttps://github.com/byroot/frozen_record/blob/1c809bcdc603759728ec0923c4ba5a23f1466101/lib/frozen_record/compact.rb#L11\r\n\r\n\r\nIf we think this behavior is intended we should at least change documentation of the `undefine_attribute_methods`. Otherwise we may want to use a different module specifically for alias attribute methods or even define methods directly on the model class as it was being done in Active Model prior our change.\r\n\r\ncc: @byroot ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48931/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48931/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48930", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48930/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48930/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48930/events", "html_url": "https://github.com/rails/rails/pull/48930", "id": 1847156211, "node_id": "PR_kwDNIULOV76Q9g", "number": 48930, "title": "Use `alias_attribute` to provide `id_value` alias for `id` attribute", "user": {"login": "adrianna-chang-shopify", "id": 22918438, "node_id": "MDQ6VXNlcjIyOTE4NDM4", "avatar_url": "https://avatars.githubusercontent.com/u/22918438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adrianna-chang-shopify", "html_url": "https://github.com/adrianna-chang-shopify", "followers_url": "https://api.github.com/users/adrianna-chang-shopify/followers", "following_url": "https://api.github.com/users/adrianna-chang-shopify/following{/other_user}", "gists_url": "https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}", "starred_url": "https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adrianna-chang-shopify/subscriptions", "organizations_url": "https://api.github.com/users/adrianna-chang-shopify/orgs", "repos_url": "https://api.github.com/users/adrianna-chang-shopify/repos", "events_url": "https://api.github.com/users/adrianna-chang-shopify/events{/privacy}", "received_events_url": "https://api.github.com/users/adrianna-chang-shopify/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2023-08-11T17:03:28Z", "updated_at": "2023-08-18T13:18:43Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48930", "html_url": "https://github.com/rails/rails/pull/48930", "diff_url": "https://github.com/rails/rails/pull/48930.diff", "patch_url": "https://github.com/rails/rails/pull/48930.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nExtends on https://github.com/rails/rails/pull/48533.\r\n\r\nThis allows access to the raw `id` column value on records for which an id column exists but is not the primary key. This is common amongst models with composite primary keys.\r\n\r\n### Detail\r\n\r\nUse `alias_attribute` to provide a `uid` alias for the `id` attribute. That was one of the primary use cases described in the above pull request; as such, we've decided to provide it out of the box in Rails.\r\n\r\n### Additional information\r\n\r\nIs there a better way to provide documentation for `#uid` than via a comment inserted above the `alias_attribute` call?\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n\r\ncc @nvasilevski @rafaelfranca \r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48930/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48930/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48929", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48929/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48929/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48929/events", "html_url": "https://github.com/rails/rails/pull/48929", "id": 1847140470, "node_id": "PR_kwDNIULOV75Zwg", "number": 48929, "title": "Refine the alias_attribute warning message to be more specific", "user": {"login": "ipc103", "id": 6826778, "node_id": "MDQ6VXNlcjY4MjY3Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/6826778?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ipc103", "html_url": "https://github.com/ipc103", "followers_url": "https://api.github.com/users/ipc103/followers", "following_url": "https://api.github.com/users/ipc103/following{/other_user}", "gists_url": "https://api.github.com/users/ipc103/gists{/gist_id}", "starred_url": "https://api.github.com/users/ipc103/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ipc103/subscriptions", "organizations_url": "https://api.github.com/users/ipc103/orgs", "repos_url": "https://api.github.com/users/ipc103/repos", "events_url": "https://api.github.com/users/ipc103/events{/privacy}", "received_events_url": "https://api.github.com/users/ipc103/received_events", "type": "User", "site_admin": true}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-08-11T16:50:27Z", "updated_at": "2023-08-18T17:11:19Z", "closed_at": "2023-08-18T17:11:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48929", "html_url": "https://github.com/rails/rails/pull/48929", "diff_url": "https://github.com/rails/rails/pull/48929.diff", "patch_url": "https://github.com/rails/rails/pull/48929.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nWe want to be clear that alias_attribute is not meant to be used for non-attributes, and provide a clear deprecation warning if it's used for associations or otherwise non-attribute methods. This adds specific deprecation warnings for overriding an attribute method that won't forward in the future, aliasing an association (a common anti-pattern), and aliasing a non-attribute method.\r\n\r\nIn addition, we add tests for some of these common cases to ensure that we get the expected deprecation warning.\r\n\r\n- If the user has manually defined an attribute method, we need to warn them that we won't forward to that method call in the future.\r\n- If the user is using `alias_attribute` to alias an association (a common anti-pattern), we need to warn them of that specifically. \r\n- Finally, we can warn if `alias_attribute` is being used with a non-attribute target. \r\n\r\n### Detail\r\n\r\nWe add a check to walk up the alias chain to ensure that the target hasn't been redefined by the user. If the targets are all attribute methods and the class has the attribute, we can use `define_proxy_call`. Otherwise, we determine a deprecation warning to issue. \r\n\r\n### Additional information\r\n\r\nOpened separately from https://github.com/rails/rails/pull/48913 to try to keep the changes easier to reason about, but let me know if there are any conflicts I may have missed. \r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48929/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48929/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48928", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48928/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48928/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48928/events", "html_url": "https://github.com/rails/rails/pull/48928", "id": 1846902673, "node_id": "PR_kwDNIULOV7sUnA", "number": 48928, "title": "Reference correct method from 'deliver_now' example code", "user": {"login": "jozr", "id": 8154741, "node_id": "MDQ6VXNlcjgxNTQ3NDE=", "avatar_url": "https://avatars.githubusercontent.com/u/8154741?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jozr", "html_url": "https://github.com/jozr", "followers_url": "https://api.github.com/users/jozr/followers", "following_url": "https://api.github.com/users/jozr/following{/other_user}", "gists_url": "https://api.github.com/users/jozr/gists{/gist_id}", "starred_url": "https://api.github.com/users/jozr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jozr/subscriptions", "organizations_url": "https://api.github.com/users/jozr/orgs", "repos_url": "https://api.github.com/users/jozr/repos", "events_url": "https://api.github.com/users/jozr/events{/privacy}", "received_events_url": "https://api.github.com/users/jozr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-11T14:13:26Z", "updated_at": "2023-08-11T15:53:19Z", "closed_at": "2023-08-11T15:53:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48928", "html_url": "https://github.com/rails/rails/pull/48928", "diff_url": "https://github.com/rails/rails/pull/48928.diff", "patch_url": "https://github.com/rails/rails/pull/48928.patch", "merged_at": "2023-08-11T15:53:15Z"}, "body": "### Detail\r\n\r\nThis PR updates an incorrect reference to a method in example code for `deliver_now` explanation.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48928/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48928/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48927", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48927/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48927/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48927/events", "html_url": "https://github.com/rails/rails/pull/48927", "id": 1845857519, "node_id": "PR_kwDNIULOV6zjvw", "number": 48927, "title": "This removes the writer method for table_alias from Arel::Table.", "user": {"login": "paulreece", "id": 96156234, "node_id": "U_kgDOBbs6Sg", "avatar_url": "https://avatars.githubusercontent.com/u/96156234?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paulreece", "html_url": "https://github.com/paulreece", "followers_url": "https://api.github.com/users/paulreece/followers", "following_url": "https://api.github.com/users/paulreece/following{/other_user}", "gists_url": "https://api.github.com/users/paulreece/gists{/gist_id}", "starred_url": "https://api.github.com/users/paulreece/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paulreece/subscriptions", "organizations_url": "https://api.github.com/users/paulreece/orgs", "repos_url": "https://api.github.com/users/paulreece/repos", "events_url": "https://api.github.com/users/paulreece/events{/privacy}", "received_events_url": "https://api.github.com/users/paulreece/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-10T20:33:51Z", "updated_at": "2023-08-11T19:34:18Z", "closed_at": "2023-08-11T19:34:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48927", "html_url": "https://github.com/rails/rails/pull/48927", "diff_url": "https://github.com/rails/rails/pull/48927.diff", "patch_url": "https://github.com/rails/rails/pull/48927.patch", "merged_at": "2023-08-11T19:34:18Z"}, "body": "This removes the writer method for table_alias from `Arel::Table`.  Since arel_table is a private API of the framework, no one should be modifying it. It addresses #48775\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [ X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ X] Tests are added or updated if you fix a bug or add a feature.\r\n* [ X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48927/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48927/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48926", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48926/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48926/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48926/events", "html_url": "https://github.com/rails/rails/pull/48926", "id": 1845728703, "node_id": "PR_kwDNIULOV6shXw", "number": 48926, "title": "feat: Add semester range and boundaries to ActiveSupport", "user": {"login": "hfvmarques", "id": 84946401, "node_id": "MDQ6VXNlcjg0OTQ2NDAx", "avatar_url": "https://avatars.githubusercontent.com/u/84946401?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hfvmarques", "html_url": "https://github.com/hfvmarques", "followers_url": "https://api.github.com/users/hfvmarques/followers", "following_url": "https://api.github.com/users/hfvmarques/following{/other_user}", "gists_url": "https://api.github.com/users/hfvmarques/gists{/gist_id}", "starred_url": "https://api.github.com/users/hfvmarques/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hfvmarques/subscriptions", "organizations_url": "https://api.github.com/users/hfvmarques/orgs", "repos_url": "https://api.github.com/users/hfvmarques/repos", "events_url": "https://api.github.com/users/hfvmarques/events{/privacy}", "received_events_url": "https://api.github.com/users/hfvmarques/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-10T18:59:36Z", "updated_at": "2023-08-15T14:30:11Z", "closed_at": "2023-08-10T19:36:12Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48926", "html_url": "https://github.com/rails/rails/pull/48926", "diff_url": "https://github.com/rails/rails/pull/48926.diff", "patch_url": "https://github.com/rails/rails/pull/48926.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\nIt has been a while that I miss an `all_semester` method for queries, mostly for scripting uses, so I decided to do it myself, as a thanks for all that Rails have been for me.\r\n\r\nAdded to that, I think both moments `.end_of_semester` and `.beginning_of_semester` can be helpful.\r\n\r\n### Detail\r\n\r\nThis Pull Request adds three methods to `DateAndTime::Calculations`, which are:\r\n-  `.all_semester` that brings a range from the beginning of the semester to the end of the semester of the year that is being used;\r\n- `.beginning_of_semester` that brings the moment of the beginning of the semester, depending on which you are using can be 01/01 at 00:00:00 or 07/01 00:00:00;\r\n- `.end_of_semester` that brings the moment of the end of the semester, depending on which you are using can be 06/30 at 23:59:59 or 12/31 at 23:59:59.\r\n\r\n### Additional information\r\n\r\nI will add the documentation as soon as this looks good.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48926/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48926/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48925", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48925/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48925/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48925/events", "html_url": "https://github.com/rails/rails/issues/48925", "id": 1845590235, "node_id": "I_kwDNIULObgF42w", "number": 48925, "title": "Make \"class_name\" option for polymorphic `has_many` relation to STI required", "user": {"login": "loqimean", "id": 49816584, "node_id": "MDQ6VXNlcjQ5ODE2NTg0", "avatar_url": "https://avatars.githubusercontent.com/u/49816584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/loqimean", "html_url": "https://github.com/loqimean", "followers_url": "https://api.github.com/users/loqimean/followers", "following_url": "https://api.github.com/users/loqimean/following{/other_user}", "gists_url": "https://api.github.com/users/loqimean/gists{/gist_id}", "starred_url": "https://api.github.com/users/loqimean/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/loqimean/subscriptions", "organizations_url": "https://api.github.com/users/loqimean/orgs", "repos_url": "https://api.github.com/users/loqimean/repos", "events_url": "https://api.github.com/users/loqimean/events{/privacy}", "received_events_url": "https://api.github.com/users/loqimean/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-10T17:20:59Z", "updated_at": "2023-08-11T08:24:52Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nModels:\r\n```ruby\r\nclass Product < ApplicationRecord\r\n  has_many :requests, as: :requestable, dependent: :destroy\r\nend\r\n\r\n# STI tables\r\nclass Request < ApplicationRecord\r\n  belongs_to :requestable, polymorphic: true\r\n\r\n  validate :request_type, presence: true\r\nend\r\n\r\nclass ProductRequest < Request\r\n  belongs_to :user\r\nend\r\n```\r\nThen running in your console:\r\n```ruby\r\nProduct.joins(requests: :user).where(requests: { user: { role: \"admin\" } })\r\n```\r\nRaises you an error:\r\n```ruby\r\n/Users/some/.rvm/gems/ruby-3.1.1/gems/activerecord-7.0.4/lib/active_record/table_metadata.rb:22:in `has_column?': undefined method `key?' for nil:NilClass (NoMethodError)\r\n```\r\n\r\n### Expected behavior\r\nTo raise a detailed error, like \"provide a `class_name` option to use joins on STI table with polymorphic, or make required option `class_name` for polymorphic relation with STI\", like:\r\n```ruby\r\nclass Product < ApplicationRecord\r\n  has_many :requests, as: :requestable, class_name: \"ProductRequest\", dependent: :destroy\r\nend\r\n\r\n# STI tables\r\nclass Request < ApplicationRecord\r\n  belongs_to :requestable, polymorphic: true\r\n\r\n  validate :request_type, presence: true\r\nend\r\n\r\nclass ProductRequest < Request\r\n  belongs_to :user\r\nend\r\n```\r\n\r\n### Actual behavior\r\nUnknown error \ud83d\ude42 \r\n```ruby\r\n/Users/some/.rvm/gems/ruby-3.1.1/gems/activerecord-7.0.4/lib/active_record/table_metadata.rb:22:in `has_column?': undefined method `key?' for nil:NilClass (NoMethodError)\r\n```\r\n\r\n### System configuration\r\n**Rails version**: 7.0.4\r\n\r\n**Ruby version**: 3.1.1\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48925/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48925/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48924", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48924/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48924/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48924/events", "html_url": "https://github.com/rails/rails/pull/48924", "id": 1845572148, "node_id": "PR_kwDNIULOV6j91g", "number": 48924, "title": "Fix code blocks using + instead of <tt> [ci skip]", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2023-08-10T17:07:49Z", "updated_at": "2023-08-11T04:10:40Z", "closed_at": "2023-08-10T23:04:20Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48924", "html_url": "https://github.com/rails/rails/pull/48924", "diff_url": "https://github.com/rails/rails/pull/48924.diff", "patch_url": "https://github.com/rails/rails/pull/48924.patch", "merged_at": "2023-08-10T23:04:20Z"}, "body": "Pluses cannot be used to create code blocks when the content includes a space.\r\n\r\nFound using a regular expression:\r\n\r\n```bash\r\n$ rg '#\\s[^+]*\\+[^+]*\\s[^+]*\\S\\+'\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48924/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48924/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48923", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48923/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48923/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48923/events", "html_url": "https://github.com/rails/rails/pull/48923", "id": 1845411391, "node_id": "PR_kwDNIULOV6bNkQ", "number": 48923, "title": "[Fix #48922] Honour encrypted attribute context in encrypted_attribute?", "user": {"login": "maximerety", "id": 58582, "node_id": "MDQ6VXNlcjU4NTgy", "avatar_url": "https://avatars.githubusercontent.com/u/58582?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maximerety", "html_url": "https://github.com/maximerety", "followers_url": "https://api.github.com/users/maximerety/followers", "following_url": "https://api.github.com/users/maximerety/following{/other_user}", "gists_url": "https://api.github.com/users/maximerety/gists{/gist_id}", "starred_url": "https://api.github.com/users/maximerety/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maximerety/subscriptions", "organizations_url": "https://api.github.com/users/maximerety/orgs", "repos_url": "https://api.github.com/users/maximerety/repos", "events_url": "https://api.github.com/users/maximerety/events{/privacy}", "received_events_url": "https://api.github.com/users/maximerety/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-10T15:21:02Z", "updated_at": "2023-08-10T15:23:12Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48923", "html_url": "https://github.com/rails/rails/pull/48923", "diff_url": "https://github.com/rails/rails/pull/48923.diff", "patch_url": "https://github.com/rails/rails/pull/48923.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\nThis Pull Request has been created to fix https://github.com/rails/rails/issues/48922.\r\n\r\n### Detail\r\n\r\nThe helper `encrypted_attribute?` currently delegates the check to the global default encryptor configured, cf\r\n\r\nhttps://github.com/rails/rails/blob/e6d59cdebbd0ddaf88029a7b9f03f5d642780e0a/activerecord/lib/active_record/encryption/encryptable_record.rb#L141-L144\r\n\r\nThis Pull Requests delegates the check to the EncryptedAttributeType instance defined for the attribute. This attribute type properly applies context properties defined initially with `encrypts`, such as a custom encryptor or message serializer.\r\n\r\nThis fixes an issue where the `encrypted_attribute?` helper would return erroneous results.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48923/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48923/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48922", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48922/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48922/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48922/events", "html_url": "https://github.com/rails/rails/issues/48922", "id": 1845388034, "node_id": "I_kwDNIULObf5jAg", "number": 48922, "title": "Helper `encrypted_attribute?` does not honour the context properties passed to `encrypts`", "user": {"login": "maximerety", "id": 58582, "node_id": "MDQ6VXNlcjU4NTgy", "avatar_url": "https://avatars.githubusercontent.com/u/58582?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maximerety", "html_url": "https://github.com/maximerety", "followers_url": "https://api.github.com/users/maximerety/followers", "following_url": "https://api.github.com/users/maximerety/following{/other_user}", "gists_url": "https://api.github.com/users/maximerety/gists{/gist_id}", "starred_url": "https://api.github.com/users/maximerety/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maximerety/subscriptions", "organizations_url": "https://api.github.com/users/maximerety/orgs", "repos_url": "https://api.github.com/users/maximerety/repos", "events_url": "https://api.github.com/users/maximerety/events{/privacy}", "received_events_url": "https://api.github.com/users/maximerety/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 5511275119, "node_id": "LA_kwDNIULPAAAAAUh_Ym8", "url": "https://api.github.com/repos/rails/rails/labels/encryption", "name": "encryption", "color": "8D3EA8", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-10T15:09:33Z", "updated_at": "2023-08-11T08:24:40Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\n1. Pass a custom encryptor (or other context properties) to the `encrypts` helper, e.g.\r\nhttps://github.com/rails/rails/blob/e6d59cdebbd0ddaf88029a7b9f03f5d642780e0a/activerecord/test/cases/encryption/encryption_schemes_test.rb#L198-L202\r\n1. Create a record and test a supposedly encrypted attribute with `encrypted_attribute?`:\r\n\r\n    ```ruby\r\n    author = EncryptedAuthor1.create name: \"1\"\r\n    assert author.encrypted_attribute? :name\r\n    ```\r\n\r\n### Expected behavior\r\n\r\nThe attribute is expected to be encrypted, i.e. `encrypted_attribute?` should return `true`.\r\n\r\n### Actual behavior\r\n\r\nThe attribute appears to be unencrypted, i.e. `encrypted_attribute?` returns `false`, despite the actual value being encrypted.\r\n\r\n### System configuration\r\n\r\n**Rails version**: 7.0.7 / main\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48922/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48922/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48921", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48921/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48921/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48921/events", "html_url": "https://github.com/rails/rails/pull/48921", "id": 1845260824, "node_id": "PR_kwDNIULOV6S7bg", "number": 48921, "title": "feat: Add ActiveModel::Model.filter_attributes", "user": {"login": "bf4", "id": 142914, "node_id": "MDQ6VXNlcjE0MjkxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/142914?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bf4", "html_url": "https://github.com/bf4", "followers_url": "https://api.github.com/users/bf4/followers", "following_url": "https://api.github.com/users/bf4/following{/other_user}", "gists_url": "https://api.github.com/users/bf4/gists{/gist_id}", "starred_url": "https://api.github.com/users/bf4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bf4/subscriptions", "organizations_url": "https://api.github.com/users/bf4/orgs", "repos_url": "https://api.github.com/users/bf4/repos", "events_url": "https://api.github.com/users/bf4/events{/privacy}", "received_events_url": "https://api.github.com/users/bf4/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-08-10T14:03:53Z", "updated_at": "2023-08-13T16:33:55Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48921", "html_url": "https://github.com/rails/rails/pull/48921", "diff_url": "https://github.com/rails/rails/pull/48921.diff", "patch_url": "https://github.com/rails/rails/pull/48921.patch", "merged_at": null}, "body": "If this looks good, I'll fill in the gaps in documentation and respond\nto feedback in a timely manner.\n\nIs a simpler version of what's in\nhttps://github.com/rails/rails/blob/7-0-stable/activerecord/lib/active_record/core.rb#L373-L396\n\nI'm using this in our application and thought I'd share back.\n\n### Motivation / Background\n\nWe using ActiveModel::Model to build plain-old-ruby\nobjects for things like API clients.  When I use\nthe Attributes API to define secrets like `attribute :api_key, :string`\nI don't want the `api_key` to show up anywhere.\n\nThis Pull Request has been created because ActiveModel::Model\nis missing the `filter_attributes` behavior present in\nActiveRecord::Core.\n\n### Detail\n\nThis Pull Request changes adds `filter_attributes` to ActiveModel::API\n\nI added it to ActiveModel::API so that it does not interfere with\nActiveRecord.\n\n\n### Additional information\n\nWe're using this in our app.\n\n### Checklist\n\nBefore submitting the PR make sure the following are checked:\n\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\n* [x] Tests are added or updated if you fix a bug or add a feature.\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48921/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48921/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48920", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48920/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48920/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48920/events", "html_url": "https://github.com/rails/rails/pull/48920", "id": 1845106228, "node_id": "PR_kwDNIULOV6Kc6g", "number": 48920, "title": "[docs] Update assert_enqueued_with documentation with keyword arguments example", "user": {"login": "fidalgo", "id": 22743, "node_id": "MDQ6VXNlcjIyNzQz", "avatar_url": "https://avatars.githubusercontent.com/u/22743?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fidalgo", "html_url": "https://github.com/fidalgo", "followers_url": "https://api.github.com/users/fidalgo/followers", "following_url": "https://api.github.com/users/fidalgo/following{/other_user}", "gists_url": "https://api.github.com/users/fidalgo/gists{/gist_id}", "starred_url": "https://api.github.com/users/fidalgo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fidalgo/subscriptions", "organizations_url": "https://api.github.com/users/fidalgo/orgs", "repos_url": "https://api.github.com/users/fidalgo/repos", "events_url": "https://api.github.com/users/fidalgo/events{/privacy}", "received_events_url": "https://api.github.com/users/fidalgo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123812746, "node_id": "MDU6TGFiZWwxMjM4MTI3NDY=", "url": "https://api.github.com/repos/rails/rails/labels/activejob", "name": "activejob", "color": "5319e7", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-10T12:38:36Z", "updated_at": "2023-08-11T07:55:37Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48920", "html_url": "https://github.com/rails/rails/pull/48920", "diff_url": "https://github.com/rails/rails/pull/48920.diff", "patch_url": "https://github.com/rails/rails/pull/48920.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because it's not intuitive how we should match the arguments passed to an ActiveJob job when using keyword arguments.\r\n\r\n### Detail\r\n\r\nThis commit adds an example to the `assert_enqueued_with` method documentation, demonstrating how to use it with keyword arguments. The example clarifies that keyword arguments should be specified as a hash inside an array, guiding developers to write tests for jobs that use keyword arguments.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48920/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48920/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48919", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48919/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48919/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48919/events", "html_url": "https://github.com/rails/rails/pull/48919", "id": 1845052846, "node_id": "PR_kwDNIULOV6Helg", "number": 48919, "title": "Refactor actions to make fewer status checks", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-10T12:10:24Z", "updated_at": "2023-08-10T23:05:09Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48919", "html_url": "https://github.com/rails/rails/pull/48919", "diff_url": "https://github.com/rails/rails/pull/48919.diff", "patch_url": "https://github.com/rails/rails/pull/48919.patch", "merged_at": null}, "body": "This flattens our workflow graph pretty much in half.\r\n\r\nBy compacting the lint jobs into a single job inside a single workflow, we maybe lose some readability -- but since the cost to maintain those files is already really low, they are rarely changed, versus the number of checks on each PR makes for a worse experience IMO.\r\n\r\nThis also means that all of those separate checks can be found on a single page (e.g. [here](https://github.com/zzak/rails/actions/runs/5820736204/job/15781737808?pr=20)), for better or worse.. navigating the actions UI across multiple workflows and jobs is already strenuous. There is an argument that if one of these steps fails, debugging it there may be difficult, but I've tried to order them in terms of priority of \"if this step fails it should fail first\". \r\n\r\nIf any of the `Lint` steps fails, figuring out which one and why may not be as straight-forward, that maybe the only downside here. There are plans to move this workflow entirely to Buildkite at some point, probably after a refactor (rails/buildkite-config#62, where they can go back to being separate \"jobs\" in that context and all of the important stuff is in a single place.\r\n\r\nSo this is more of an intermediary step to improve the PR page and hopefully make reviewing them and deciding which checks failed matters, more efficient.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48919/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48919/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48918", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48918/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48918/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48918/events", "html_url": "https://github.com/rails/rails/pull/48918", "id": 1844990926, "node_id": "PR_kwDNIULOV6EFBw", "number": 48918, "title": "Test pr", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-10T11:29:34Z", "updated_at": "2023-08-10T11:30:54Z", "closed_at": "2023-08-10T11:29:50Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48918", "html_url": "https://github.com/rails/rails/pull/48918", "diff_url": "https://github.com/rails/rails/pull/48918.diff", "patch_url": "https://github.com/rails/rails/pull/48918.patch", "merged_at": null}, "body": null, "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48918/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48918/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48917", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48917/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48917/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48917/events", "html_url": "https://github.com/rails/rails/pull/48917", "id": 1843995996, "node_id": "PR_kwDNIULOV5OETg", "number": 48917, "title": "Use `ActiveRecord.deprecator` for the alias attribute deprecation", "user": {"login": "nvasilevski", "id": 5512772, "node_id": "MDQ6VXNlcjU1MTI3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/5512772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nvasilevski", "html_url": "https://github.com/nvasilevski", "followers_url": "https://api.github.com/users/nvasilevski/followers", "following_url": "https://api.github.com/users/nvasilevski/following{/other_user}", "gists_url": "https://api.github.com/users/nvasilevski/gists{/gist_id}", "starred_url": "https://api.github.com/users/nvasilevski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nvasilevski/subscriptions", "organizations_url": "https://api.github.com/users/nvasilevski/orgs", "repos_url": "https://api.github.com/users/nvasilevski/repos", "events_url": "https://api.github.com/users/nvasilevski/events{/privacy}", "received_events_url": "https://api.github.com/users/nvasilevski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-09T20:52:46Z", "updated_at": "2023-08-09T21:32:14Z", "closed_at": "2023-08-09T21:32:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48917", "html_url": "https://github.com/rails/rails/pull/48917", "diff_url": "https://github.com/rails/rails/pull/48917.diff", "patch_url": "https://github.com/rails/rails/pull/48917.patch", "merged_at": "2023-08-09T21:32:12Z"}, "body": "We are using wrong deprecator to issue the alias attribute deprecation. The deprecation used to live in Active Model during the initial implementation but eventually got moved to Active Record and now Active Model is not affected by it so we need to use a correct deprecator ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48917/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48917/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48916", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48916/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48916/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48916/events", "html_url": "https://github.com/rails/rails/pull/48916", "id": 1843895890, "node_id": "PR_kwDNIULOV5IoMw", "number": 48916, "title": "Use Pathnames for comparisons in the engine rake tasks", "user": {"login": "vinistock", "id": 18742907, "node_id": "MDQ6VXNlcjE4NzQyOTA3", "avatar_url": "https://avatars.githubusercontent.com/u/18742907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vinistock", "html_url": "https://github.com/vinistock", "followers_url": "https://api.github.com/users/vinistock/followers", "following_url": "https://api.github.com/users/vinistock/following{/other_user}", "gists_url": "https://api.github.com/users/vinistock/gists{/gist_id}", "starred_url": "https://api.github.com/users/vinistock/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vinistock/subscriptions", "organizations_url": "https://api.github.com/users/vinistock/orgs", "repos_url": "https://api.github.com/users/vinistock/repos", "events_url": "https://api.github.com/users/vinistock/events{/privacy}", "received_events_url": "https://api.github.com/users/vinistock/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-09T19:41:50Z", "updated_at": "2023-08-10T14:58:05Z", "closed_at": "2023-08-10T14:54:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48916", "html_url": "https://github.com/rails/rails/pull/48916", "diff_url": "https://github.com/rails/rails/pull/48916.diff", "patch_url": "https://github.com/rails/rails/pull/48916.patch", "merged_at": "2023-08-10T14:54:07Z"}, "body": "### Motivation / Background\r\n\r\nWhen loading engine tasks for a railtie on Windows, I noticed we ended up doing endless recursion and throwing a stack error. The reason this happens is:\r\n1. When working on a railtie only (no engine), we try to find the `ENGINE_ROOT`\r\n2. That invokes `find_engine_path`, which is a recursive method that can only stop in two scenarios: if an engine is found (won't ever happen in the railtie case) or if we hit the root of the folder structure `/`\r\n\r\nThat works on Linux/Mac but will fail on Windows (and possibly other operating systems?) since `/` doesn't exist. In that case, we just never exit recursion and get the stack error.\r\n\r\n### Detail\r\n\r\nTo make sure we're always doing the right thing on different operating systems, I changed the implementation to rely on `Pathname`. This allows us to invoke `root?` to check if we reached the end of the folder structure.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48916/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48916/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48915", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48915/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48915/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48915/events", "html_url": "https://github.com/rails/rails/issues/48915", "id": 1843653413, "node_id": "I_kwDNIULObePrJQ", "number": 48915, "title": "Not obvious how to customize ActiveStorage routing, and undocumented in API docs and guide", "user": {"login": "technicalpickles", "id": 159, "node_id": "MDQ6VXNlcjE1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/159?v=4", "gravatar_id": "", "url": "https://api.github.com/users/technicalpickles", "html_url": "https://github.com/technicalpickles", "followers_url": "https://api.github.com/users/technicalpickles/followers", "following_url": "https://api.github.com/users/technicalpickles/following{/other_user}", "gists_url": "https://api.github.com/users/technicalpickles/gists{/gist_id}", "starred_url": "https://api.github.com/users/technicalpickles/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/technicalpickles/subscriptions", "organizations_url": "https://api.github.com/users/technicalpickles/orgs", "repos_url": "https://api.github.com/users/technicalpickles/repos", "events_url": "https://api.github.com/users/technicalpickles/events{/privacy}", "received_events_url": "https://api.github.com/users/technicalpickles/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-09T16:46:50Z", "updated_at": "2023-08-09T17:14:20Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "While setting up ActiveStorage in an existing app, we found ourselves needing to make sure that it's only available on a specific subdomain. We use this snippet in `config/routes.rb` when we are applying this to our application code:\r\n\r\n```ruby\r\ndefaults(subdomain: app_subdomain) do\r\n  # routes here\r\nend\r\n```\r\n\r\nThe [ActiveStorage Overview guide](https://guides.rubyonrails.org/active_storage_overview.html) doesn't mention it at all.\r\n\r\nI dug around active_storage, and found this:\r\n\r\nhttps://github.com/rails/rails/blob/8ec27a4529e37cff77abe54573bb8923d9fe8e9a/activestorage/config/routes.rb#L4\r\n\r\nhttps://github.com/rails/rails/blob/8ec27a4529e37cff77abe54573bb8923d9fe8e9a/activestorage/lib/active_storage.rb#L359\r\n\r\nWhen I found that it was using `scope`, I realized we could pass in a Hash with options instead of a string to use as a prefix:\r\n\r\n```ruby\r\n# config/initializers/active_storage.rb\r\nRails.application.config.active_storage.routes_prefix = {path: 'rails/active_storage', subdomain: app_subdomain}\r\n```\r\n\r\nSeeing it written out this way, `routes_prefix` doesn't seem as an accurate a name for what it allows.\r\n\r\nThis might be a few tasks actually:\r\n\r\n- document `routes_prefix` in rdoc\r\n- document `routes_prefix` on the guide\r\n- maybe rename `routes_prefix` w/ a deprecation?\r\n\r\n### Steps to reproduce\r\n\r\nn/a\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# Your reproduction script goes here\r\n```\r\n\r\n### Expected behavior\r\n<!-- Tell us what should happen -->\r\n\r\nShould be able to find out how to customize ActiveStorage routing on either API docs or ActiveStorage guide\r\n\r\n### Actual behavior\r\n\r\nHad to read the code to find out how to do this\r\n\r\n### System configuration\r\n**Rails version**: 7-0-stable (fabd0b5827a3af1f189d726fbc7669f9fbdeef5e)\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48915/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48915/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48914", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48914/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48914/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48914/events", "html_url": "https://github.com/rails/rails/pull/48914", "id": 1843614396, "node_id": "PR_kwDNIULOV45fyw", "number": 48914, "title": "reflect_on_all_associations to support multiple macros", "user": {"login": "keshavbiswa", "id": 27268721, "node_id": "MDQ6VXNlcjI3MjY4NzIx", "avatar_url": "https://avatars.githubusercontent.com/u/27268721?v=4", "gravatar_id": "", "url": "https://api.github.com/users/keshavbiswa", "html_url": "https://github.com/keshavbiswa", "followers_url": "https://api.github.com/users/keshavbiswa/followers", "following_url": "https://api.github.com/users/keshavbiswa/following{/other_user}", "gists_url": "https://api.github.com/users/keshavbiswa/gists{/gist_id}", "starred_url": "https://api.github.com/users/keshavbiswa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/keshavbiswa/subscriptions", "organizations_url": "https://api.github.com/users/keshavbiswa/orgs", "repos_url": "https://api.github.com/users/keshavbiswa/repos", "events_url": "https://api.github.com/users/keshavbiswa/events{/privacy}", "received_events_url": "https://api.github.com/users/keshavbiswa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-09T16:19:13Z", "updated_at": "2023-08-09T16:38:32Z", "closed_at": "2023-08-09T16:35:56Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48914", "html_url": "https://github.com/rails/rails/pull/48914", "diff_url": "https://github.com/rails/rails/pull/48914.diff", "patch_url": "https://github.com/rails/rails/pull/48914.patch", "merged_at": null}, "body": "### Motivation / Background\r\nI needed a way to get all the associations for a model, for that I was using `reflect_on_all_associations`. But `reflect_on_all_associations` only allows one macro to be passed. For example\r\n\r\n```ruby\r\nUser.reflect_on_all_associations(:has_many) # This works\r\nUser.reflect_on_all_associations(:has_many, :has_one) # This doesn't\r\n```\r\n### Detail\r\n\r\nAdded ability to add multiple macro in `reflect_on_all_associations` method in `Reflection.rb`.\r\n\r\nPreviously, `reflect_on_all_association` would only allow a single macro to be passed in.\r\nTo return multiple associations, we would need to use custom select logic.\r\n\r\nBefore:\r\n```ruby\r\nModel.reflect_on_all_associations(:has_many)\r\n# Returns an array of all has_many associations\r\n\r\n# To get array of more than one macro associations\r\nModel.reflect_on_all_associations.select do |reflection|\r\n  %i[has_many has_one].include?(reflection.macro)\r\nend\r\n```\r\n\r\nAfter:\r\n\r\n```ruby\r\nModel.reflect_on_all_associations(:has_many, :has_one)\r\n# Returns an array of all has_many and has_one associations\r\n```\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48914/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48914/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48913", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48913/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48913/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48913/events", "html_url": "https://github.com/rails/rails/pull/48913", "id": 1843597332, "node_id": "PR_kwDNIULOV44kVA", "number": 48913, "title": "Stop generating parent-defined alias methods in child classes", "user": {"login": "ipc103", "id": 6826778, "node_id": "MDQ6VXNlcjY4MjY3Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/6826778?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ipc103", "html_url": "https://github.com/ipc103", "followers_url": "https://api.github.com/users/ipc103/followers", "following_url": "https://api.github.com/users/ipc103/following{/other_user}", "gists_url": "https://api.github.com/users/ipc103/gists{/gist_id}", "starred_url": "https://api.github.com/users/ipc103/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ipc103/subscriptions", "organizations_url": "https://api.github.com/users/ipc103/orgs", "repos_url": "https://api.github.com/users/ipc103/repos", "events_url": "https://api.github.com/users/ipc103/events{/privacy}", "received_events_url": "https://api.github.com/users/ipc103/received_events", "type": "User", "site_admin": true}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-08-09T16:07:41Z", "updated_at": "2023-08-17T14:25:32Z", "closed_at": "2023-08-17T13:46:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48913", "html_url": "https://github.com/rails/rails/pull/48913", "diff_url": "https://github.com/rails/rails/pull/48913.diff", "patch_url": "https://github.com/rails/rails/pull/48913.patch", "merged_at": "2023-08-17T13:46:27Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nWe currently issue a deprecation warning when an attribute method is overwritten to let people know that they'll need to manually define the alias override as well. If the override is also defined on the parent class, then we shouldn't need to issue a deprecation warning. \r\n\r\nBefore, the following was raising a deprecation warning for because `subject_was` is not implemented directly on the child class.\r\n\r\n```ruby\r\nclass Topic < ActiveRecord::Base\r\n  alias_attribute :subject, :title\r\n  \r\n  def title_was\r\n    \"override_title\"\r\n  end\r\n  alias_method :subject_was, :title_was\r\nend\r\n\r\nclass SubTopic < Topic\r\nend\r\n```\r\n\r\nFollowing this change, the behavior works correctly without a deprecation warning.\r\n\r\n### Detail\r\n\r\nBecause we're using a class_attribute to track all of the attribute_aliases, each subclass was regenerating the parent class methods. When a child was generating methods for the parent, it was only looking to see if the manual override method was defined within. \r\n\r\nInstead, we can use a class instance variable to track the attributes aliased locally in that particular subclass. We then walk up the chain and re-define the attribute methods if they haven't been defined yet.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48913/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48913/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48912", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48912/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48912/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48912/events", "html_url": "https://github.com/rails/rails/pull/48912", "id": 1843364450, "node_id": "PR_kwDNIULOV4r5uQ", "number": 48912, "title": "Change `has_secure_token` default to `on: :initialize`", "user": {"login": "seanpdoyle", "id": 2575027, "node_id": "MDQ6VXNlcjI1NzUwMjc=", "avatar_url": "https://avatars.githubusercontent.com/u/2575027?v=4", "gravatar_id": "", "url": "https://api.github.com/users/seanpdoyle", "html_url": "https://github.com/seanpdoyle", "followers_url": "https://api.github.com/users/seanpdoyle/followers", "following_url": "https://api.github.com/users/seanpdoyle/following{/other_user}", "gists_url": "https://api.github.com/users/seanpdoyle/gists{/gist_id}", "starred_url": "https://api.github.com/users/seanpdoyle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/seanpdoyle/subscriptions", "organizations_url": "https://api.github.com/users/seanpdoyle/orgs", "repos_url": "https://api.github.com/users/seanpdoyle/repos", "events_url": "https://api.github.com/users/seanpdoyle/events{/privacy}", "received_events_url": "https://api.github.com/users/seanpdoyle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-09T14:23:11Z", "updated_at": "2023-08-11T15:43:46Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48912", "html_url": "https://github.com/rails/rails/pull/48912", "diff_url": "https://github.com/rails/rails/pull/48912.diff", "patch_url": "https://github.com/rails/rails/pull/48912.patch", "merged_at": null}, "body": "Follow-up to [#47420][]\r\n\r\n\r\n### Motivation / Background\r\n\r\nWith the changes made in [#47420][], `has_secure_token` declarations can be configured to execute in an `after_initialize` callback. This commit proposed a new Rails 7.1 default: generate all `has_secure_token` values when their corresponding models are initialized.\r\n\r\n### Detail\r\n\r\nTo preserve pre-7.1 behavior, applications can set `config.active_record.generate_secure_token_on = :create`.\r\n\r\nBy default, generate the value when the model is initialized:\r\n\r\n```ruby\r\nclass User < ApplicationRecord\r\n  has_secure_token\r\nend\r\n\r\nrecord = User.new\r\nrecord.token # => \"fwZcXX6SkJBJRogzMdciS7wf\"\r\n```\r\n\r\nWith `config.active_record.generate_secure_token_on = :create`, generate the\r\nvalue when the model is created:\r\n\r\n```ruby\r\n# config/application.rb\r\nconfig.active_record.generate_secure_token_on = :create\r\n\r\n# app/models/user.rb\r\nclass User < ApplicationRecord\r\n  has_secure_token on: :create\r\nend\r\n\r\nrecord = User.new\r\nrecord.token # => nil\r\nrecord.save!\r\nrecord.token # => \"fwZcXX6SkJBJRogzMdciS7wf\"\r\n```\r\n\r\n[#47420]: https://github.com/rails/rails/pull/47420\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48912/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48912/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48911", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48911/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48911/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48911/events", "html_url": "https://github.com/rails/rails/pull/48911", "id": 1843257763, "node_id": "PR_kwDNIULOV4mJew", "number": 48911, "title": "Ensure schema_cache_dump settings are propagated to SchemaReflection class", "user": {"login": "jhbabon", "id": 280452, "node_id": "MDQ6VXNlcjI4MDQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/280452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhbabon", "html_url": "https://github.com/jhbabon", "followers_url": "https://api.github.com/users/jhbabon/followers", "following_url": "https://api.github.com/users/jhbabon/following{/other_user}", "gists_url": "https://api.github.com/users/jhbabon/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhbabon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhbabon/subscriptions", "organizations_url": "https://api.github.com/users/jhbabon/orgs", "repos_url": "https://api.github.com/users/jhbabon/repos", "events_url": "https://api.github.com/users/jhbabon/events{/privacy}", "received_events_url": "https://api.github.com/users/jhbabon/received_events", "type": "User", "site_admin": true}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-09T13:35:40Z", "updated_at": "2023-08-10T14:58:11Z", "closed_at": "2023-08-10T14:57:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48911", "html_url": "https://github.com/rails/rails/pull/48911", "diff_url": "https://github.com/rails/rails/pull/48911.diff", "patch_url": "https://github.com/rails/rails/pull/48911.patch", "merged_at": "2023-08-10T14:57:57Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because after [the latest schema cache changes](https://github.com/rails/rails/pull/48716) at GitHub we started to see this warning in our development and test environments:\r\n\r\n```\r\nIgnoring db/schema/db.dump because it has expired. The current schema version is abc, but the one in the schema cache file is efg.\r\n```\r\n\r\nWe decided to set the configuration setting that controls this check:\r\n\r\n```ruby\r\nconfig.active_record.check_schema_cache_dump_version = false\r\n```\r\n\r\nBut we kept seeing the same warning. After some digging we found out that the configuration setting is used only at the ActiveRecord's Railtie level, but it is not propagated internally down to the `ActiveRecord::ConnectionAdapters::SchemaReflection` class, which is the one that does the schema cache dump loading and check.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes ActiveRecord's Railtie so it sets the configuration settings `check_schema_cache_dump_version` and `use_schema_cache_dump` in the `ActiveRecord::ConnectionAdapters::SchemaReflection` class directly. That way the behavior of setting the app configuration settings is preserved across all the app.\r\n\r\nI've added tests in the main `railties/test/application/configuration_test.rb` file since it's the only place I saw tests around configuration settings applied at the app level, but I'm not sure that's the right place. I'm happy to move them if someone has a better idea.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\nI think another approach could be to add these settings at the `ActiveRecord` module level, like `lazily_load_schema_cache`, and then change `SchemaReflection` so it uses them, but this seemed like a bigger change.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [ ] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48911/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48911/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48910", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48910/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48910/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48910/events", "html_url": "https://github.com/rails/rails/issues/48910", "id": 1842822459, "node_id": "I_kwDNIULObdc9Ow", "number": 48910, "title": "If multiple after_commits are defined with the same callback only the last one is evaluated", "user": {"login": "melefabrizio", "id": 9076837, "node_id": "MDQ6VXNlcjkwNzY4Mzc=", "avatar_url": "https://avatars.githubusercontent.com/u/9076837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/melefabrizio", "html_url": "https://github.com/melefabrizio", "followers_url": "https://api.github.com/users/melefabrizio/followers", "following_url": "https://api.github.com/users/melefabrizio/following{/other_user}", "gists_url": "https://api.github.com/users/melefabrizio/gists{/gist_id}", "starred_url": "https://api.github.com/users/melefabrizio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/melefabrizio/subscriptions", "organizations_url": "https://api.github.com/users/melefabrizio/orgs", "repos_url": "https://api.github.com/users/melefabrizio/repos", "events_url": "https://api.github.com/users/melefabrizio/events{/privacy}", "received_events_url": "https://api.github.com/users/melefabrizio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2023-08-09T09:17:02Z", "updated_at": "2023-08-10T10:24:17Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nWhen two after_commit hooks with the same callback are defined, i.e. on different conditions, only the last one is evaluated.\r\n```rb\r\nclass Post < ActiveRecord::Base\r\n  has_many :comments\r\n  after_commit :do_something, on: :create\r\n  after_commit :do_something, on: :update\r\n\r\n  def do_something\r\n    comments << Comment.new\r\n  end\r\nend\r\n```\r\nIn this case, a `Post.create!` action does not fire the `do_something` method. An update does.\r\n\r\n[Here is the standard test case](https://gist.github.com/melefabrizio/07f52d7c55bb7d1ae651bd35cb620785)\r\n\r\n### Expected behavior\r\nBoth hooks should be evaluated and executed.\r\n\r\n### Actual behavior\r\nOnly the last one is evaluated.\r\n\r\n### System configuration\r\n**Rails version**:  7.0.6\r\n\r\n**Ruby version**: 3.2.1\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48910/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48910/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48909", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48909/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48909/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48909/events", "html_url": "https://github.com/rails/rails/issues/48909", "id": 1842028900, "node_id": "I_kwDNIULObcshZA", "number": 48909, "title": "Google Storage Service Error when uploading attachments", "user": {"login": "matiassalles99", "id": 57004457, "node_id": "MDQ6VXNlcjU3MDA0NDU3", "avatar_url": "https://avatars.githubusercontent.com/u/57004457?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matiassalles99", "html_url": "https://github.com/matiassalles99", "followers_url": "https://api.github.com/users/matiassalles99/followers", "following_url": "https://api.github.com/users/matiassalles99/following{/other_user}", "gists_url": "https://api.github.com/users/matiassalles99/gists{/gist_id}", "starred_url": "https://api.github.com/users/matiassalles99/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matiassalles99/subscriptions", "organizations_url": "https://api.github.com/users/matiassalles99/orgs", "repos_url": "https://api.github.com/users/matiassalles99/repos", "events_url": "https://api.github.com/users/matiassalles99/events{/privacy}", "received_events_url": "https://api.github.com/users/matiassalles99/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-08T20:17:01Z", "updated_at": "2023-08-09T17:13:56Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "- We have been running into these kinds of errors lately when attaching multiple images to a model:\r\n`Google::Cloud::AlreadyExistsError conflict: The metadata for object \"....\" was edited during the operation. Please try again.`\r\n- After digging into both the google cloud gem and active storage I noticed that google cloud is the only one that implements the `update_metadata` method within the `class Service::GCSService` which makes me wonder why is that the case.\r\n- I saw that the `identify` method call in `ActiveStorage::Blob` within `upload(io, identify: true)` updates the metadata, and the analyze job also. Google Storage gem does some threads execution when calling the API which I don't fully understand, but I was wondering if there might be a race condition here, or get more info from people who have a deeper understanding of Active Storage with GCS\r\n\r\nThe code looks as simple as:\r\n``` ruby\r\n   class A\r\n      has_many :media\r\n   end\r\n\r\n   class Media\r\n      belongs_to :user\r\n      has_one_attached :image\r\n    end\r\n\r\n    # In the controller\r\n    attach_to = A.first\r\n\r\n    # We get an array of directly uploaded images\r\n    array_of_signed_ids = params[:images]\r\n    media = array_of_signed_ids.map { |image| attach_to.media.build(image: image) }\r\n    media.each { |m| m.save! }\r\n    \r\n    respond_to ... \r\n```\r\n\r\n### Expected behavior\r\n- Shouldn't raise Google::Cloud::AlreadyExistsError since we are just following the normal flow of attaching images to a model \r\n\r\n### Actual behavior\r\n- Intermittently raises Google::Cloud::AlreadyExistsError \r\n\r\n### System configuration\r\n**Rails version**:\r\n7.0.4\r\n\r\n**Ruby version**:\r\n3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48909/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48909/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48908", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48908/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48908/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48908/events", "html_url": "https://github.com/rails/rails/issues/48908", "id": 1841342515, "node_id": "I_kwDNIULObcCoMw", "number": 48908, "title": "ActiveRecord::RecordInvalid silently ignored during create! with associations and after_create callbacks", "user": {"login": "eric-christian", "id": 298704, "node_id": "MDQ6VXNlcjI5ODcwNA==", "avatar_url": "https://avatars.githubusercontent.com/u/298704?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eric-christian", "html_url": "https://github.com/eric-christian", "followers_url": "https://api.github.com/users/eric-christian/followers", "following_url": "https://api.github.com/users/eric-christian/following{/other_user}", "gists_url": "https://api.github.com/users/eric-christian/gists{/gist_id}", "starred_url": "https://api.github.com/users/eric-christian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eric-christian/subscriptions", "organizations_url": "https://api.github.com/users/eric-christian/orgs", "repos_url": "https://api.github.com/users/eric-christian/repos", "events_url": "https://api.github.com/users/eric-christian/events{/privacy}", "received_events_url": "https://api.github.com/users/eric-christian/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 126910270, "node_id": "MDU6TGFiZWwxMjY5MTAyNzA=", "url": "https://api.github.com/repos/rails/rails/labels/With%20reproduction%20steps", "name": "With reproduction steps", "color": "009800", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2023-08-08T13:38:43Z", "updated_at": "2023-08-10T13:45:13Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\r\n\r\nwe noticed some inconsistent data in our database and came to the conclusion that data created within an `after_create` hook is not always present.\r\nOur audit tool hooks itself into some of our models by using the `after_*` callbacks.\r\nAnd on a rare occasion, it produced an invalid record. Causing an `ActiveRecord::RecordInvalid` to be raised within the callback.\r\nIf that happens while the audited model is used solely, everything works as intended. A rollback is issued and no incomplete data is persisted. The exception is also re-raised, which is correct in my opinion, but not what the documentation claims: https://guides.rubyonrails.org/active_record_callbacks.html#halting-execution\r\n\r\nHowever, something different happens, if we try this with associated models. Both models are saved, no rollback happens, no exception bubbels up. Incomplete data is persisted because everything but the audit was commited. There is no indication that the callback failed at all. \ud83e\udd37\u200d\u2642\ufe0f \r\n\r\nI was unable to find any documentation explaining this behavior.\r\n\r\n### Steps to reproduce\r\n```ruby\r\n### Schema\r\n\r\nclass CreateTestAs < ActiveRecord::Migration[7.0]\r\n  def change\r\n    create_table :test_as do |t|\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n\r\nclass CreateTestBs < ActiveRecord::Migration[7.0]\r\n  def change\r\n    create_table :test_bs do |t|\r\n      t.references :test_a\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n\r\n### Models\r\n\r\nclass TestA < ApplicationRecord\r\n  has_one :test_b\r\nend\r\n\r\nclass TestB < ApplicationRecord\r\n  after_create(-> { raise ActiveRecord::RecordInvalid }) # simulating the broken audit-tool behavior\r\nend\r\n```\r\n\r\n### Expected behavior\r\nThe expectation is that `TestA.create!(test_b: TestB.new)` issues a rollback and raises the same exception as `TestB.create!` does. No data should be persisted.\r\n\r\n### Actual behavior\r\nWhile `TestB.create!`, as expected, raises an `ActiveRecord::RecordInvalid` exception and issues a rollback. `TestA.create!(test_b: TestB.new)` does not. Instead, both instances of TestA and TestB are persisted. The exception is silently ignored!\r\n\r\n```bash\r\n[1] pry(main)> TestB.create!\r\n  TRANSACTION (0.5ms)  BEGIN\r\n  TestB Create (1.8ms)  INSERT INTO \"test_bs\" (\"test_a_id\", \"created_at\", \"updated_at\") VALUES ($1, $2, $3) RETURNING \"id\"  [[\"test_a_id\", nil], [\"created_at\", \"2023-08-08 12:29:45.686484\"], [\"updated_at\", \"2023-08-08 12:29:45.686484\"]]\r\n  TRANSACTION (0.6ms)  ROLLBACK\r\nActiveRecord::RecordInvalid: Record invalid\r\n\r\n[2] pry(main)> TestA.create!(test_b: TestB.new)\r\n  TRANSACTION (1.4ms)  BEGIN\r\n  TestA Create (7.6ms)  INSERT INTO \"test_as\" (\"created_at\", \"updated_at\") VALUES ($1, $2) RETURNING \"id\"  [[\"created_at\", \"2023-08-08 12:30:30.200175\"], [\"updated_at\", \"2023-08-08 12:30:30.200175\"]]\r\n  TestB Create (1.3ms)  INSERT INTO \"test_bs\" (\"test_a_id\", \"created_at\", \"updated_at\") VALUES ($1, $2, $3) RETURNING \"id\"  [[\"test_a_id\", 13], [\"created_at\", \"2023-08-08 12:30:30.208412\"], [\"updated_at\", \"2023-08-08 12:30:30.208412\"]]\r\n  TRANSACTION (7.7ms)  COMMIT\r\n```\r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48908/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48908/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48907", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48907/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48907/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48907/events", "html_url": "https://github.com/rails/rails/pull/48907", "id": 1841193442, "node_id": "PR_kwDNIULOV21lLw", "number": 48907, "title": "Add `drb`, `mutex_m` and `base64` that are bundled gem candidates for Ruby 3.4", "user": {"login": "yahonda", "id": 73684, "node_id": "MDQ6VXNlcjczNjg0", "avatar_url": "https://avatars.githubusercontent.com/u/73684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yahonda", "html_url": "https://github.com/yahonda", "followers_url": "https://api.github.com/users/yahonda/followers", "following_url": "https://api.github.com/users/yahonda/following{/other_user}", "gists_url": "https://api.github.com/users/yahonda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yahonda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yahonda/subscriptions", "organizations_url": "https://api.github.com/users/yahonda/orgs", "repos_url": "https://api.github.com/users/yahonda/repos", "events_url": "https://api.github.com/users/yahonda/events{/privacy}", "received_events_url": "https://api.github.com/users/yahonda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-08T12:15:00Z", "updated_at": "2023-08-08T23:30:44Z", "closed_at": "2023-08-08T23:30:44Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48907", "html_url": "https://github.com/rails/rails/pull/48907", "diff_url": "https://github.com/rails/rails/pull/48907.diff", "patch_url": "https://github.com/rails/rails/pull/48907.patch", "merged_at": "2023-08-08T23:30:44Z"}, "body": "### Motivation / Background\r\n\r\nThis commit adds `drb`, `mutex_m` and `base64` to `activesupport/activesupport.gemspec` because 3.3.0dev shows warnings if bundled gem candidates are required like `mutex_m will be not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.`\r\n\r\n### Detail\r\n\r\n#### Example\r\n```ruby\r\n$ ruby -v ; ruby generic_main.rb\r\nruby 3.3.0dev (2023-08-07T23:09:02Z master 0e5da05a32) [x86_64-linux]\r\nFetching https://github.com/rails/rails.git\r\nResolving dependencies...\r\nFetching gem metadata from https://rubygems.org/.......\r\n/home/yahonda/.rbenv/versions/trunk/lib/ruby/gems/3.3.0+0/bundler/gems/rails-2942958827f1/activesupport/lib/active_support/notifications/fanout.rb:3: warning: mutex_m will be not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.\r\n/home/yahonda/.rbenv/versions/trunk/lib/ruby/gems/3.3.0+0/bundler/gems/rails-2942958827f1/activesupport/lib/active_support/message_encryptor.rb:4: warning: base64 will be not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.\r\ngeneric_main.rb:16: warning: drb will be not part of the default gems since Ruby 3.4.0. Add it to your inline Gemfile.\r\n$\r\n```\r\n\r\n#### generic_main.rb\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\nend\r\n\r\nrequire \"active_support\"\r\nrequire \"minitest/autorun\"\r\n# These gems will be bundled gems in Ruby 3.4\r\nrequire \"drb\"\r\nrequire \"base64\"\r\nrequire \"mutex_m\"\r\n```\r\n\r\nThese gems are chosen as follows.\r\n#### Bundled gems candidates for Ruby 3.4\r\n\r\n```ruby\r\n$ ruby -v ; ruby -e 'pp Gem::BUNDLED_GEMS::SINCE.select { |k,v| v == \"3.4.0\" }'\r\nruby 3.3.0dev (2023-08-07T23:09:02Z master 0e5da05a32) [x86_64-linux]\r\n{\"abbrev\"=>\"3.4.0\",\r\n \"observer\"=>\"3.4.0\",\r\n \"getoptlong\"=>\"3.4.0\",\r\n \"resolv-replace\"=>\"3.4.0\",\r\n \"rinda\"=>\"3.4.0\",\r\n \"nkf\"=>\"3.4.0\",\r\n \"syslog\"=>\"3.4.0\",\r\n \"drb\"=>\"3.4.0\",\r\n \"mutex_m\"=>\"3.4.0\",\r\n \"csv\"=>\"3.4.0\",\r\n \"base64\"=>\"3.4.0\"}\r\n$\r\n```\r\n\r\n#### `drb`, `mutex_m` and `base64` are required by Rails\r\n\r\n- \"drb\"\r\n```ruby\r\n$ git grep 'require \"drb\"'\r\nactivesupport/lib/active_support/testing/parallelization.rb:require \"drb\"\r\nactivesupport/lib/active_support/testing/parallelization/server.rb:require \"drb\"\r\n```\r\n\r\n- \"mutex_m\"\r\n\r\n```ruby\r\n$ git grep 'require \"mutex_m\"'\r\nactionpack/lib/action_controller/metal/params_wrapper.rb:    require \"mutex_m\"\r\nactiverecord/lib/active_record/attribute_methods.rb:require \"mutex_m\"\r\nactiverecord/lib/active_record/relation/delegation.rb:require \"mutex_m\"\r\nactivesupport/lib/active_support/notifications/fanout.rb:require \"mutex_m\"\r\n```\r\n\r\n- \"base64\" usage\r\n\r\n```ruby\r\n$ git grep 'require \"base64\"'\r\nactioncable/Rakefile:require \"base64\"\r\nactionmailer/lib/action_mailer/inline_preview_interceptor.rb:require \"base64\"\r\nactionpack/lib/action_controller/metal/http_authentication.rb:require \"base64\"\r\nactionview/Rakefile:require \"base64\"\r\nactiverecord/lib/active_record/encryption/message_serializer.rb:require \"base64\"\r\nactiverecord/lib/active_record/fixture_set/render_context.rb:require \"base64\"\r\nactiverecord/test/cases/encryption/message_serializer_test.rb:require \"base64\"\r\nactivesupport/lib/active_support/message_encryptor.rb:require \"base64\"\r\nactivesupport/lib/active_support/message_verifier.rb:require \"base64\"\r\nactivesupport/lib/active_support/xml_mini.rb:require \"base64\"\r\nrailties/test/application/mailer_previews_test.rb:require \"base64\"\r\n```\r\n\r\n#### Dependency between Rails related modules\r\n\r\n- \"drb\" is only required by Active Support\r\n\r\n- \"mutex_m\" is required by Action Pack, Active Record and Active Support Action Pack and Active Record depend on Active Support. Therefore, adding dependency to Active Support is fine.\r\n\r\nhttps://github.com/rails/rails/blob/2942958827f1934dfcba284d074e6d61104d3e7c/actionpack/actionpack.gemspec#L36 https://github.com/rails/rails/blob/2942958827f1934dfcba284d074e6d61104d3e7c/activerecord/activerecord.gemspec#L38\r\n\r\n- \"base64\" is required by Action Cable, Action Mailer, Action Pack, Action View, Active Record, Active Support and Raillties. Action Cable, Action Mailer, Action Pack, Action View and Active Record and Railties depend on Active Support. Therefore, adding dependency to Active Support is fine.\r\n\r\nhttps://github.com/rails/rails/blob/2942958827f1934dfcba284d074e6d61104d3e7c/actioncable/actioncable.gemspec#L35 https://github.com/rails/rails/blob/2942958827f1934dfcba284d074e6d61104d3e7c/actionmailer/actionmailer.gemspec#L36 https://github.com/rails/rails/blob/2942958827f1934dfcba284d074e6d61104d3e7c/actionpack/actionpack.gemspec#L36 https://github.com/rails/rails/blob/2942958827f1934dfcba284d074e6d61104d3e7c/actionview/actionview.gemspec#L36 https://github.com/rails/rails/blob/2942958827f1934dfcba284d074e6d61104d3e7c/actionpack/actionpack.gemspec#L36 https://github.com/rails/rails/blob/2942958827f1934dfcba284d074e6d61104d3e7c/railties/railties.gemspec#L40\r\n\r\n### Additional information\r\n\r\nRefer to:\r\nhttps://bugs.ruby-lang.org/issues/19776\r\nhttps://github.com/ruby/ruby/pull/8126\r\nhttps://github.com/rubygems/rubygems/pull/6840\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48907/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48907/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48906", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48906/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48906/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48906/events", "html_url": "https://github.com/rails/rails/issues/48906", "id": 1840527774, "node_id": "I_kwDNIULObbQ5ng", "number": 48906, "title": "Postgres / activerecord: Invalid SQL generated for array-of-array columns", "user": {"login": "DanielHeath", "id": 47430, "node_id": "MDQ6VXNlcjQ3NDMw", "avatar_url": "https://avatars.githubusercontent.com/u/47430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DanielHeath", "html_url": "https://github.com/DanielHeath", "followers_url": "https://api.github.com/users/DanielHeath/followers", "following_url": "https://api.github.com/users/DanielHeath/following{/other_user}", "gists_url": "https://api.github.com/users/DanielHeath/gists{/gist_id}", "starred_url": "https://api.github.com/users/DanielHeath/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DanielHeath/subscriptions", "organizations_url": "https://api.github.com/users/DanielHeath/orgs", "repos_url": "https://api.github.com/users/DanielHeath/repos", "events_url": "https://api.github.com/users/DanielHeath/events{/privacy}", "received_events_url": "https://api.github.com/users/DanielHeath/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-08T04:09:31Z", "updated_at": "2023-08-08T06:43:35Z", "closed_at": "2023-08-08T06:43:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Reproduction script\r\n```ruby\r\n\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"pg\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"postgresql\", database: \"bug\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n  end\r\n  connection.execute 'alter table posts add column nested int[][];'\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_format\r\n    Post.create!(nested: [[1], []])\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\nInsert a record containing an array of arrays\r\n\r\n### Actual behavior\r\n\r\n```\r\nActiveRecord::StatementInvalid: PG::InvalidTextRepresentation: ERROR:  malformed array literal: \"{{1},{}}\"\r\nDETAIL:  Unexpected \"}\" character.\r\nCONTEXT:  unnamed portal parameter $1 = '...'\r\n```\r\n\r\n### System configuration\r\n\r\n**Rails version**: rails-2942958827f1\r\n\r\n**Ruby version**: ruby 3.2.2 (2023-03-30 revision e51014f9c0) [x86_64-linux]\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48906/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48906/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48905", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48905/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48905/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48905/events", "html_url": "https://github.com/rails/rails/pull/48905", "id": 1840404503, "node_id": "PR_kwDNIULOV2LFCw", "number": 48905, "title": "Use Arel table alias with insert, update, and delete statements. Fixes #48775 ", "user": {"login": "paulreece", "id": 96156234, "node_id": "U_kgDOBbs6Sg", "avatar_url": "https://avatars.githubusercontent.com/u/96156234?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paulreece", "html_url": "https://github.com/paulreece", "followers_url": "https://api.github.com/users/paulreece/followers", "following_url": "https://api.github.com/users/paulreece/following{/other_user}", "gists_url": "https://api.github.com/users/paulreece/gists{/gist_id}", "starred_url": "https://api.github.com/users/paulreece/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paulreece/subscriptions", "organizations_url": "https://api.github.com/users/paulreece/orgs", "repos_url": "https://api.github.com/users/paulreece/repos", "events_url": "https://api.github.com/users/paulreece/events{/privacy}", "received_events_url": "https://api.github.com/users/paulreece/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-08-08T01:07:03Z", "updated_at": "2023-08-14T23:02:12Z", "closed_at": "2023-08-13T02:35:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48905", "html_url": "https://github.com/rails/rails/pull/48905", "diff_url": "https://github.com/rails/rails/pull/48905.diff", "patch_url": "https://github.com/rails/rails/pull/48905.patch", "merged_at": null}, "body": "This removes the writer method for table_alias from `Arel::Table`.  Since arel_table is a private API of the framework, no one should be modifying it. It addresses #48775\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [ X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ X] Tests are added or updated if you fix a bug or add a feature.\r\n* [ X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48905/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48905/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48904", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48904/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48904/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48904/events", "html_url": "https://github.com/rails/rails/pull/48904", "id": 1839944084, "node_id": "PR_kwDNIULOV1x7DA", "number": 48904, "title": "Use sdoc main branch for edge API docs", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-07T17:42:19Z", "updated_at": "2023-08-09T19:35:08Z", "closed_at": "2023-08-09T19:35:08Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48904", "html_url": "https://github.com/rails/rails/pull/48904", "diff_url": "https://github.com/rails/rails/pull/48904.diff", "patch_url": "https://github.com/rails/rails/pull/48904.patch", "merged_at": "2023-08-09T19:35:08Z"}, "body": "### Motivation / Background\r\n\r\nThere are a lot of changes on the sdoc main branch, but there are still some open issues for a new 3.0 release.\r\nTo find any bugs we can use the main branch for the edge API docs.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48904/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48904/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48903", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48903/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48903/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48903/events", "html_url": "https://github.com/rails/rails/pull/48903", "id": 1839767139, "node_id": "PR_kwDNIULOV1oYuw", "number": 48903, "title": "Add validation to LengthValidator to prevent typo", "user": {"login": "RobertChang0722", "id": 74767965, "node_id": "MDQ6VXNlcjc0NzY3OTY1", "avatar_url": "https://avatars.githubusercontent.com/u/74767965?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RobertChang0722", "html_url": "https://github.com/RobertChang0722", "followers_url": "https://api.github.com/users/RobertChang0722/followers", "following_url": "https://api.github.com/users/RobertChang0722/following{/other_user}", "gists_url": "https://api.github.com/users/RobertChang0722/gists{/gist_id}", "starred_url": "https://api.github.com/users/RobertChang0722/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RobertChang0722/subscriptions", "organizations_url": "https://api.github.com/users/RobertChang0722/orgs", "repos_url": "https://api.github.com/users/RobertChang0722/repos", "events_url": "https://api.github.com/users/RobertChang0722/events{/privacy}", "received_events_url": "https://api.github.com/users/RobertChang0722/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-07T15:51:18Z", "updated_at": "2023-08-07T16:00:43Z", "closed_at": "2023-08-07T16:00:43Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48903", "html_url": "https://github.com/rails/rails/pull/48903", "diff_url": "https://github.com/rails/rails/pull/48903.diff", "patch_url": "https://github.com/rails/rails/pull/48903.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThe current situation, when the user set `minium` & `maximum` together, the validator would ignores the typo.\r\n\r\n```ruby\r\nclass Post < ActiveRecord::Base\r\n  validates :title, length: { minium: 10, maximum: 20 }\r\nend\r\n\r\npost = Post.new(title: \"Invalid\")\r\nputs post.valid? # true\r\n```\r\n\r\nJust add a typo checker to make it would not happened again.\r\n\r\n```ruby\r\nclass Post < ActiveRecord::Base\r\n  validates :title, length: { minium: 10, maximum: 20 }\r\nend\r\n\r\nraise ArgumentError...\r\n```\r\n\r\n### Detail\r\n\r\n1. Add `TYPO_OPTIONS`\r\n2. Make sure no options in there, if yes, raise errror\r\n\r\n### Additional information\r\n\r\nhttps://discuss.rubyonrails.org/t/proposal-add-min-and-max-alias-to-lengthvalidator/82771\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48903/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48903/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48902", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48902/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48902/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48902/events", "html_url": "https://github.com/rails/rails/issues/48902", "id": 1839022759, "node_id": "I_kwDNIULObZ1Cpw", "number": 48902, "title": "Show image in view but show record in mysql ", "user": {"login": "phamthanhlam", "id": 25340581, "node_id": "MDQ6VXNlcjI1MzQwNTgx", "avatar_url": "https://avatars.githubusercontent.com/u/25340581?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phamthanhlam", "html_url": "https://github.com/phamthanhlam", "followers_url": "https://api.github.com/users/phamthanhlam/followers", "following_url": "https://api.github.com/users/phamthanhlam/following{/other_user}", "gists_url": "https://api.github.com/users/phamthanhlam/gists{/gist_id}", "starred_url": "https://api.github.com/users/phamthanhlam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phamthanhlam/subscriptions", "organizations_url": "https://api.github.com/users/phamthanhlam/orgs", "repos_url": "https://api.github.com/users/phamthanhlam/repos", "events_url": "https://api.github.com/users/phamthanhlam/events{/privacy}", "received_events_url": "https://api.github.com/users/phamthanhlam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-08-07T09:10:51Z", "updated_at": "2023-08-10T02:07:39Z", "closed_at": "2023-08-07T14:18:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "I tried but the result still shows the record information stored in the database\r\n![post image](https://github.com/rails/rails/assets/25340581/39a919ee-c1a3-4573-94f5-0a54d4393c3a)\r\nCode show image in view\r\n![Image show record](https://github.com/rails/rails/assets/25340581/1909bb7a-3b73-4397-942d-6db7412087de)\r\nI don't know what to adjust the config to not show the record in the database.\r\nHope for a help\r\n\r\n\r\n### System configuration\r\n**Rails version**:7.0.6\r\n\r\n**Ruby version**: 3.1.2p20\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48902/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48902/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48901", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48901/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48901/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48901/events", "html_url": "https://github.com/rails/rails/issues/48901", "id": 1838627436, "node_id": "I_kwDNIULObZc6bA", "number": 48901, "title": "Show image attached to database archive in mysql \"ActiveStorage::Attachment id: 1, name: \"images\", record_type: \"Post\", record_id: 1, blob_id: 1, created_at: \"2023-08-04 08:19:18.112865000 +0000\"\"", "user": {"login": "phamthanhlam", "id": 25340581, "node_id": "MDQ6VXNlcjI1MzQwNTgx", "avatar_url": "https://avatars.githubusercontent.com/u/25340581?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phamthanhlam", "html_url": "https://github.com/phamthanhlam", "followers_url": "https://api.github.com/users/phamthanhlam/followers", "following_url": "https://api.github.com/users/phamthanhlam/following{/other_user}", "gists_url": "https://api.github.com/users/phamthanhlam/gists{/gist_id}", "starred_url": "https://api.github.com/users/phamthanhlam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phamthanhlam/subscriptions", "organizations_url": "https://api.github.com/users/phamthanhlam/orgs", "repos_url": "https://api.github.com/users/phamthanhlam/repos", "events_url": "https://api.github.com/users/phamthanhlam/events{/privacy}", "received_events_url": "https://api.github.com/users/phamthanhlam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-07T03:55:17Z", "updated_at": "2023-08-07T10:06:42Z", "closed_at": "2023-08-07T08:31:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "After saving the image using mysql save operation storage, when displaying the image by command, all the information stored in the database is included even though the information is not displayed in the databse. The result is as in the following image\r\n`<strong>Images:</strong>`\r\n    `<%= post.images.each do |image| %>`\r\n   ` <div><%= link_to image.filename %></div>`\r\n` <% end %>`\r\nThe result of html view is out\r\n[1 image.PNG](http://localhost:3000/posts)\r\n[1378083.png](http://localhost:3000/posts)\r\n**[#<ActiveStorage::Attachment id: 1, name: \"images\", record_type: \"Post\", record_id: 1, blob_id: 1, created_at: \"2023-08-04 08:19:18.112865000 +0000\">, #<ActiveStorage::Attachment id: 2, name: \"images\", record_type: \"Post\", record_id: 1, blob_id: 2, created_at: \"2023-08-04 08:19:18.116852000 +0000\">]**\r\nI don't know how to turn off this bold. Hope everybody help please. Thank you very much!\r\n\r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: ruby 3.1.2p20\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48901/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48901/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48900", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48900/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48900/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48900/events", "html_url": "https://github.com/rails/rails/issues/48900", "id": 1838309647, "node_id": "I_kwDNIULObZJhDw", "number": 48900, "title": "Rails 7.0.6 cannot update credentials from files", "user": {"login": "m2wasabi", "id": 3489286, "node_id": "MDQ6VXNlcjM0ODkyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/3489286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m2wasabi", "html_url": "https://github.com/m2wasabi", "followers_url": "https://api.github.com/users/m2wasabi/followers", "following_url": "https://api.github.com/users/m2wasabi/following{/other_user}", "gists_url": "https://api.github.com/users/m2wasabi/gists{/gist_id}", "starred_url": "https://api.github.com/users/m2wasabi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m2wasabi/subscriptions", "organizations_url": "https://api.github.com/users/m2wasabi/orgs", "repos_url": "https://api.github.com/users/m2wasabi/repos", "events_url": "https://api.github.com/users/m2wasabi/events{/privacy}", "received_events_url": "https://api.github.com/users/m2wasabi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-08-06T18:59:55Z", "updated_at": "2023-08-08T19:03:09Z", "closed_at": "2023-08-08T19:03:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n\r\n```shell\r\nEDITOR=\"cat .config_development.yml >\" bundle exec rails credentials:edit -e development\r\n```\r\n\r\n### Expected behavior\r\n<!-- Tell us what should happen -->\r\n\r\n`.config_development.yml` is encrypted into `config/credentials/development.yml.enc`\r\n\r\nThis works successful up to Rails 7.0.5.1 .\r\n\r\n### Actual behavior\r\n<!-- Tell us what happens instead -->\r\n\r\nEncrypt task finish with error.\r\n\r\n> cat: '>': No such file or directory\r\n\r\nDecrypted content is deferent from input file.\r\n\r\n```shell\r\nbundle exec rails credentials:edit -e development\r\n```\r\n\r\n```yaml\r\n# aws:\r\n#   access_key_id: 123\r\n#   secret_access_key: 345\r\n```\r\n\r\n### System configuration\r\n**Rails version**:\r\n7.0.6\r\n\r\n**Ruby version**:\r\n3.0.4", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48900/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48900/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48899", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48899/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48899/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48899/events", "html_url": "https://github.com/rails/rails/pull/48899", "id": 1838295181, "node_id": "PR_kwDNIULOV0ZEKQ", "number": 48899, "title": "Document and test `nil` cache coder", "user": {"login": "jonathanhefner", "id": 771968, "node_id": "MDQ6VXNlcjc3MTk2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/771968?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonathanhefner", "html_url": "https://github.com/jonathanhefner", "followers_url": "https://api.github.com/users/jonathanhefner/followers", "following_url": "https://api.github.com/users/jonathanhefner/following{/other_user}", "gists_url": "https://api.github.com/users/jonathanhefner/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonathanhefner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonathanhefner/subscriptions", "organizations_url": "https://api.github.com/users/jonathanhefner/orgs", "repos_url": "https://api.github.com/users/jonathanhefner/repos", "events_url": "https://api.github.com/users/jonathanhefner/events{/privacy}", "received_events_url": "https://api.github.com/users/jonathanhefner/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-06T18:09:20Z", "updated_at": "2023-08-06T18:22:52Z", "closed_at": "2023-08-06T18:22:51Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48899", "html_url": "https://github.com/rails/rails/pull/48899", "diff_url": "https://github.com/rails/rails/pull/48899.diff", "patch_url": "https://github.com/rails/rails/pull/48899.patch", "merged_at": "2023-08-06T18:22:51Z"}, "body": "Since Rails 6.1 (via c4845aa7791839fcdf723dc77e3df258e7274496), it has been possible to specify `coder: nil` to allow the store to handle cache entries directly.\r\n\r\nThis commit adds documentation and regression tests for the behavior.\r\n\r\n---\r\n\r\nPer https://github.com/rails/rails/pull/48451#discussion_r1282090075.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48899/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48899/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48898", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48898/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48898/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48898/events", "html_url": "https://github.com/rails/rails/pull/48898", "id": 1838062128, "node_id": "PR_kwDNIULOV0OSZQ", "number": 48898, "title": "[skip ci] Testing by line range documentation added in guide", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-06T05:51:52Z", "updated_at": "2023-08-16T13:23:09Z", "closed_at": "2023-08-15T23:33:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48898", "html_url": "https://github.com/rails/rails/pull/48898", "diff_url": "https://github.com/rails/rails/pull/48898.diff", "patch_url": "https://github.com/rails/rails/pull/48898.patch", "merged_at": "2023-08-15T23:33:50Z"}, "body": "### Motivation / Background\r\n\r\n#48807 Added the ability to filter the tests within a range.\r\n\r\n### Detail\r\n\r\nThis PR added the documentation for filter tests within range in the rails testing guide.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48898/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48898/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48897", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48897/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48897/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48897/events", "html_url": "https://github.com/rails/rails/pull/48897", "id": 1838055562, "node_id": "PR_kwDNIULOV0N_iQ", "number": 48897, "title": "Removes Webpacker from the guides index page", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-06T05:19:17Z", "updated_at": "2023-08-09T03:04:24Z", "closed_at": "2023-08-08T19:03:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48897", "html_url": "https://github.com/rails/rails/pull/48897", "diff_url": "https://github.com/rails/rails/pull/48897.diff", "patch_url": "https://github.com/rails/rails/pull/48897.patch", "merged_at": "2023-08-08T19:03:52Z"}, "body": "### Motivation / Background\r\n\r\nWebpacker is now deprecated and not used in Rails7 applications. So we don't really need to reference `webpacker` in the guides index page.\r\n\r\n### Detail\r\n\r\nThis PR removed the Webpacker reference from the guides index page.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48897/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48897/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48896", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48896/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48896/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48896/events", "html_url": "https://github.com/rails/rails/pull/48896", "id": 1838028993, "node_id": "PR_kwDNIULOV0MuBw", "number": 48896, "title": "Strip empty AWS keys from options in S3 initialization", "user": {"login": "Jay0921", "id": 12777550, "node_id": "MDQ6VXNlcjEyNzc3NTUw", "avatar_url": "https://avatars.githubusercontent.com/u/12777550?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jay0921", "html_url": "https://github.com/Jay0921", "followers_url": "https://api.github.com/users/Jay0921/followers", "following_url": "https://api.github.com/users/Jay0921/following{/other_user}", "gists_url": "https://api.github.com/users/Jay0921/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jay0921/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jay0921/subscriptions", "organizations_url": "https://api.github.com/users/Jay0921/orgs", "repos_url": "https://api.github.com/users/Jay0921/repos", "events_url": "https://api.github.com/users/Jay0921/events{/privacy}", "received_events_url": "https://api.github.com/users/Jay0921/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-06T03:36:37Z", "updated_at": "2023-08-08T01:55:22Z", "closed_at": "2023-08-08T01:55:22Z", "author_association": "NONE", "active_lock_reason": null, "draft": true, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48896", "html_url": "https://github.com/rails/rails/pull/48896", "diff_url": "https://github.com/rails/rails/pull/48896.diff", "patch_url": "https://github.com/rails/rails/pull/48896.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because [REPLACE ME]\r\n\r\n### Detail\r\n\r\nThis Pull Request changes [REPLACE ME]\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48896/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48896/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48895", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48895/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48895/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48895/events", "html_url": "https://github.com/rails/rails/pull/48895", "id": 1837893345, "node_id": "PR_kwDNIULOV0Gj7g", "number": 48895, "title": "Added String#extract_numbers for extracting numbers from string", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-05T18:40:23Z", "updated_at": "2023-08-07T14:54:36Z", "closed_at": "2023-08-07T14:10:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48895", "html_url": "https://github.com/rails/rails/pull/48895", "diff_url": "https://github.com/rails/rails/pull/48895.diff", "patch_url": "https://github.com/rails/rails/pull/48895.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThis Pull Request aims to add a new method, extract_numbers, to the String class in Rails. The extract_numbers method allows users to extract numeric values from a given string.\r\n\r\n### Detail\r\n\r\nThe extract_numbers method has been added to the String class, allowing users to extract numeric values from a given string. Here's an example of how it works:\r\n\r\n```ruby\r\ntext = \"The temperature outside is -10.5\u00b0C and it will rise to 25.7\u00b0C in the afternoon.\"\r\nnumbers = text.extract_numbers\r\n\r\nputs numbers\r\n# Output: [-10.5, 25.7]\r\n```\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48895/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48895/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48894", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48894/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48894/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48894/events", "html_url": "https://github.com/rails/rails/pull/48894", "id": 1837784446, "node_id": "PR_kwDNIULOV0BfcA", "number": 48894, "title": "Active Storage Guides: change `fixture_file_upload` to `file_fixture_upload` [ci-skip]", "user": {"login": "seanpdoyle", "id": 2575027, "node_id": "MDQ6VXNlcjI1NzUwMjc=", "avatar_url": "https://avatars.githubusercontent.com/u/2575027?v=4", "gravatar_id": "", "url": "https://api.github.com/users/seanpdoyle", "html_url": "https://github.com/seanpdoyle", "followers_url": "https://api.github.com/users/seanpdoyle/followers", "following_url": "https://api.github.com/users/seanpdoyle/following{/other_user}", "gists_url": "https://api.github.com/users/seanpdoyle/gists{/gist_id}", "starred_url": "https://api.github.com/users/seanpdoyle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/seanpdoyle/subscriptions", "organizations_url": "https://api.github.com/users/seanpdoyle/orgs", "repos_url": "https://api.github.com/users/seanpdoyle/repos", "events_url": "https://api.github.com/users/seanpdoyle/events{/privacy}", "received_events_url": "https://api.github.com/users/seanpdoyle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-05T14:21:30Z", "updated_at": "2023-08-07T13:22:30Z", "closed_at": "2023-08-06T18:15:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48894", "html_url": "https://github.com/rails/rails/pull/48894", "diff_url": "https://github.com/rails/rails/pull/48894.diff", "patch_url": "https://github.com/rails/rails/pull/48894.patch", "merged_at": "2023-08-06T18:15:22Z"}, "body": "Follow-up to [#48857][]\r\n\r\n\r\n### Detail\r\n\r\nMention the recently introduced `file_fixture_upload` alias in the Active Storage Overview guides to reinforce the symmetry with the `file_fixture` test helper method.\r\n\r\n[#48857]: https://github.com/rails/rails/pull/48857\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48894/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48894/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48893", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48893/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48893/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48893/events", "html_url": "https://github.com/rails/rails/pull/48893", "id": 1837760676, "node_id": "PR_kwDNIULOV0AZrw", "number": 48893, "title": "Use relative path for screenshot metadata", "user": {"login": "matteeyah", "id": 1218868, "node_id": "MDQ6VXNlcjEyMTg4Njg=", "avatar_url": "https://avatars.githubusercontent.com/u/1218868?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matteeyah", "html_url": "https://github.com/matteeyah", "followers_url": "https://api.github.com/users/matteeyah/followers", "following_url": "https://api.github.com/users/matteeyah/following{/other_user}", "gists_url": "https://api.github.com/users/matteeyah/gists{/gist_id}", "starred_url": "https://api.github.com/users/matteeyah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matteeyah/subscriptions", "organizations_url": "https://api.github.com/users/matteeyah/orgs", "repos_url": "https://api.github.com/users/matteeyah/repos", "events_url": "https://api.github.com/users/matteeyah/events{/privacy}", "received_events_url": "https://api.github.com/users/matteeyah/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-05T13:23:49Z", "updated_at": "2023-08-07T14:19:47Z", "closed_at": "2023-08-07T14:19:46Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48893", "html_url": "https://github.com/rails/rails/pull/48893", "diff_url": "https://github.com/rails/rails/pull/48893.diff", "patch_url": "https://github.com/rails/rails/pull/48893.patch", "merged_at": "2023-08-07T14:19:46Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nIn https://github.com/rails/rails/pull/48863 I added the screenshot path to the test metadata. This PR replaces that with a relative path because most CI systems that use this information require a relative path. It was an oversight from my end in my original PR.\r\n\r\n### Detail\r\n\r\nThis Pull Request replaces the absolute path used in the test metadata with a relative path.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48893/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48893/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48892", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48892/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48892/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48892/events", "html_url": "https://github.com/rails/rails/pull/48892", "id": 1837692578, "node_id": "PR_kwDNIULOVz9CCg", "number": 48892, "title": "Draft | Investigate implicit recall usage in url helpers", "user": {"login": "joshuay03", "id": 54629302, "node_id": "MDQ6VXNlcjU0NjI5MzAy", "avatar_url": "https://avatars.githubusercontent.com/u/54629302?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshuay03", "html_url": "https://github.com/joshuay03", "followers_url": "https://api.github.com/users/joshuay03/followers", "following_url": "https://api.github.com/users/joshuay03/following{/other_user}", "gists_url": "https://api.github.com/users/joshuay03/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshuay03/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshuay03/subscriptions", "organizations_url": "https://api.github.com/users/joshuay03/orgs", "repos_url": "https://api.github.com/users/joshuay03/repos", "events_url": "https://api.github.com/users/joshuay03/events{/privacy}", "received_events_url": "https://api.github.com/users/joshuay03/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-05T10:42:54Z", "updated_at": "2023-08-16T10:37:00Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48892", "html_url": "https://github.com/rails/rails/pull/48892", "diff_url": "https://github.com/rails/rails/pull/48892.diff", "patch_url": "https://github.com/rails/rails/pull/48892.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created to investigate https://github.com/rails/rails/issues/15097.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes [REPLACE ME]\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\nI noticed that options are also extracted from the recall here:\r\nhttps://github.com/rails/rails/blob/d73daaca479ac50ef2983d3f0af3ae16af738cf0/actionpack/lib/action_dispatch/routing/route_set.rb#L738-L747\r\n\r\nBut the `id` is never extracted (in the case of my test) since the `controller` doesn't get extracted in the first place as `segment_keys.include?(key)` returns `false` here:\r\nhttps://github.com/rails/rails/blob/d73daaca479ac50ef2983d3f0af3ae16af738cf0/actionpack/lib/action_dispatch/routing/route_set.rb#L712\r\n\r\nI'm unsure of the usecase for using the recall like this, just thought I'd point it out since it's relevant.\r\n\r\n**Edit:** I'm guessing this is utilised in mailers going off of the documentation added here: https://github.com/rails/rails/pull/20631?\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48892/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48892/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48891", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48891/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48891/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48891/events", "html_url": "https://github.com/rails/rails/pull/48891", "id": 1837531404, "node_id": "PR_kwDNIULOVz0zJA", "number": 48891, "title": "Change the devcontainer configuration to use docker compose instead of collocated services", "user": {"login": "rafaelfranca", "id": 47848, "node_id": "MDQ6VXNlcjQ3ODQ4", "avatar_url": "https://avatars.githubusercontent.com/u/47848?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rafaelfranca", "html_url": "https://github.com/rafaelfranca", "followers_url": "https://api.github.com/users/rafaelfranca/followers", "following_url": "https://api.github.com/users/rafaelfranca/following{/other_user}", "gists_url": "https://api.github.com/users/rafaelfranca/gists{/gist_id}", "starred_url": "https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rafaelfranca/subscriptions", "organizations_url": "https://api.github.com/users/rafaelfranca/orgs", "repos_url": "https://api.github.com/users/rafaelfranca/repos", "events_url": "https://api.github.com/users/rafaelfranca/events{/privacy}", "received_events_url": "https://api.github.com/users/rafaelfranca/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-05T02:36:16Z", "updated_at": "2023-08-08T15:40:45Z", "closed_at": "2023-08-08T15:40:44Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48891", "html_url": "https://github.com/rails/rails/pull/48891", "diff_url": "https://github.com/rails/rails/pull/48891.diff", "patch_url": "https://github.com/rails/rails/pull/48891.patch", "merged_at": "2023-08-08T15:40:44Z"}, "body": "This will not only match most of the CI configuration but will provide better experience for users of those containers.\r\n\r\nBefore after the first time the container was created, if it was restarted you needed to run the boot.sh script manually to start those services. Now, docker compose will make sure the services are running and there is no need to run. `boot.sh` again.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48891/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48891/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48890", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48890/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48890/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48890/events", "html_url": "https://github.com/rails/rails/pull/48890", "id": 1837267348, "node_id": "PR_kwDNIULOVzmpQQ", "number": 48890, "title": "Support min & max for length validation", "user": {"login": "RobertChang0722", "id": 74767965, "node_id": "MDQ6VXNlcjc0NzY3OTY1", "avatar_url": "https://avatars.githubusercontent.com/u/74767965?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RobertChang0722", "html_url": "https://github.com/RobertChang0722", "followers_url": "https://api.github.com/users/RobertChang0722/followers", "following_url": "https://api.github.com/users/RobertChang0722/following{/other_user}", "gists_url": "https://api.github.com/users/RobertChang0722/gists{/gist_id}", "starred_url": "https://api.github.com/users/RobertChang0722/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RobertChang0722/subscriptions", "organizations_url": "https://api.github.com/users/RobertChang0722/orgs", "repos_url": "https://api.github.com/users/RobertChang0722/repos", "events_url": "https://api.github.com/users/RobertChang0722/events{/privacy}", "received_events_url": "https://api.github.com/users/RobertChang0722/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-08-04T19:55:28Z", "updated_at": "2023-08-07T16:08:45Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48890", "html_url": "https://github.com/rails/rails/pull/48890", "diff_url": "https://github.com/rails/rails/pull/48890.diff", "patch_url": "https://github.com/rails/rails/pull/48890.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nProvides a simple way for users to set length\r\n\r\nThis reduces the need for users to make typos like minium and avoid validation.\r\n\r\n```ruby\r\nclass Post < ActiveRecord::Base\r\n  validates :title, length: { minium: 10, maximum: 20 }\r\nend\r\n\r\npost = Post.new(title: \"Invalid\")\r\nputs post.valid? # true\r\n```\r\n\r\nso If user can use `min` & `max` then it can prevent the wrong situation happened.\r\n\r\n```ruby\r\nclass Post < ActiveRecord::Base\r\n  validates :title, length: { min: 10, max: 20 }\r\nend\r\n\r\npost = Post.new(title: \"Invalid\")\r\nputs post.valid? # false\r\n```\r\n\r\nhttps://discuss.rubyonrails.org/t/proposal-add-min-and-max-alias-to-lengthvalidator/82771\r\n\r\n### Detail\r\n\r\n1. add the `min` & `max` to the `CHECKS` and `MESSAGE` like alias the `minimum` and `maximum`\r\n2. add test to make sure everything works good\r\n\r\n### Additional information\r\n\r\nOther way likes to validate the typo like `minium`.\r\n\r\nAdd possible keys into the `RESERVED_OPTIONS`\r\n\r\nand like:\r\n\r\n```ruby\r\nunless options.keys.all? { |k| RESERVED_OPTIONS.include?(k) }\r\n  raise ArgumentError ...\r\nend\r\n\r\nkeys = CEHCKS.keys & options.keys\r\n```\r\n\r\nI try the code above, that's not a good idea, because add possible keys into `RESERVED_OPTIONS` would break the rules now.\r\n\r\nlike `:message` would be excepted below, so error message would be breaked\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48890/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48890/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48889", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48889/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48889/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48889/events", "html_url": "https://github.com/rails/rails/pull/48889", "id": 1837241700, "node_id": "PR_kwDNIULOVzlPfg", "number": 48889, "title": "Add length validation for minium typo, raise error to notify user", "user": {"login": "RobertChang0722", "id": 74767965, "node_id": "MDQ6VXNlcjc0NzY3OTY1", "avatar_url": "https://avatars.githubusercontent.com/u/74767965?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RobertChang0722", "html_url": "https://github.com/RobertChang0722", "followers_url": "https://api.github.com/users/RobertChang0722/followers", "following_url": "https://api.github.com/users/RobertChang0722/following{/other_user}", "gists_url": "https://api.github.com/users/RobertChang0722/gists{/gist_id}", "starred_url": "https://api.github.com/users/RobertChang0722/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RobertChang0722/subscriptions", "organizations_url": "https://api.github.com/users/RobertChang0722/orgs", "repos_url": "https://api.github.com/users/RobertChang0722/repos", "events_url": "https://api.github.com/users/RobertChang0722/events{/privacy}", "received_events_url": "https://api.github.com/users/RobertChang0722/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-04T19:30:53Z", "updated_at": "2023-08-04T19:40:04Z", "closed_at": "2023-08-04T19:40:04Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48889", "html_url": "https://github.com/rails/rails/pull/48889", "diff_url": "https://github.com/rails/rails/pull/48889.diff", "patch_url": "https://github.com/rails/rails/pull/48889.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\n```ruby\r\nclass Post < ActiveRecord::Base\r\n  validates :title, length: { minium: 10, maximum: 20 }\r\nend\r\n\r\npost = Post.new(title: \"a\")\r\nputs post.valid? # true\r\n```\r\nThe above code will pass validation because we don't have an equivalent for typos when `minium & maximum` present both.\r\n\r\nThe PR is more of a workaround at the moment, but I think the `CHECKS.keys & options.keys` code needs to be fixed.\r\n\r\nso that `keys.empty?` works correctly.\r\n\r\nhttps://discuss.rubyonrails.org/t/proposal-add-min-and-max-alias-to-lengthvalidator/82771\r\n\r\n### Detail\r\n\r\n1. Add a comparison to check if there are `minium` in there\r\n2. Add test to make sure it works and would not break other test\r\n\r\n### Additional information\r\n\r\nPerhaps we can also include the keys that will be used in RESERVED_OPTIONS, so that we don't need to use such a workaround, and the code will be more elegant.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48889/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48889/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48888", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48888/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48888/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48888/events", "html_url": "https://github.com/rails/rails/pull/48888", "id": 1837137134, "node_id": "PR_kwDNIULOVzfleQ", "number": 48888, "title": "Action Mailer Preview empty states", "user": {"login": "seanpdoyle", "id": 2575027, "node_id": "MDQ6VXNlcjI1NzUwMjc=", "avatar_url": "https://avatars.githubusercontent.com/u/2575027?v=4", "gravatar_id": "", "url": "https://api.github.com/users/seanpdoyle", "html_url": "https://github.com/seanpdoyle", "followers_url": "https://api.github.com/users/seanpdoyle/followers", "following_url": "https://api.github.com/users/seanpdoyle/following{/other_user}", "gists_url": "https://api.github.com/users/seanpdoyle/gists{/gist_id}", "starred_url": "https://api.github.com/users/seanpdoyle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/seanpdoyle/subscriptions", "organizations_url": "https://api.github.com/users/seanpdoyle/orgs", "repos_url": "https://api.github.com/users/seanpdoyle/repos", "events_url": "https://api.github.com/users/seanpdoyle/events{/privacy}", "received_events_url": "https://api.github.com/users/seanpdoyle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-04T17:52:40Z", "updated_at": "2023-08-04T21:23:10Z", "closed_at": "2023-08-04T21:18:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48888", "html_url": "https://github.com/rails/rails/pull/48888", "diff_url": "https://github.com/rails/rails/pull/48888.diff", "patch_url": "https://github.com/rails/rails/pull/48888.patch", "merged_at": "2023-08-04T21:18:57Z"}, "body": "\r\n\r\n### Motivation / Background\r\n\r\nWhen an application defines mailers without any corresponding previews, requests to `GET /rails/mailers` return a page with a blank `<body>` element.\r\n\r\nThis entirely empty page can be confusing, since it's difficult to distinguish the \"success\" state with an empty list and a \"failure\" state with swallowed errors.\r\n\r\nSimilarly, when an `ActionMailer::Preview` subclass is defined, but doesn't declare any actions, the response contains a mostly empty page.\r\n\r\n### Detail\r\n\r\n\r\n\r\nThis commit renders empty-state messaging for both scenarios, and links to the [Action Mailer Basics][] guides.\r\n\r\nTo effectively cover that behavior, this commit also expands the Mailer Preview test coverage to utilize [rails-dom-testing][] assertions.\r\n\r\n[Action Mailer Basics]: https://guides.rubyonrails.org/action_mailer_basics.html#previewing-emails\r\n[rails-dom-testing]: http://github.com/rails/rails-dom-testing\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48888/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48888/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48887", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48887/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48887/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48887/events", "html_url": "https://github.com/rails/rails/pull/48887", "id": 1837085075, "node_id": "PR_kwDNIULOVzcyzA", "number": 48887, "title": "Fix NoMethodError when request Content-Type is blank.", "user": {"login": "bryantraywick", "id": 42215, "node_id": "MDQ6VXNlcjQyMjE1", "avatar_url": "https://avatars.githubusercontent.com/u/42215?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bryantraywick", "html_url": "https://github.com/bryantraywick", "followers_url": "https://api.github.com/users/bryantraywick/followers", "following_url": "https://api.github.com/users/bryantraywick/following{/other_user}", "gists_url": "https://api.github.com/users/bryantraywick/gists{/gist_id}", "starred_url": "https://api.github.com/users/bryantraywick/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bryantraywick/subscriptions", "organizations_url": "https://api.github.com/users/bryantraywick/orgs", "repos_url": "https://api.github.com/users/bryantraywick/repos", "events_url": "https://api.github.com/users/bryantraywick/events{/privacy}", "received_events_url": "https://api.github.com/users/bryantraywick/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-04T17:03:48Z", "updated_at": "2023-08-04T17:26:01Z", "closed_at": "2023-08-04T17:26:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48887", "html_url": "https://github.com/rails/rails/pull/48887", "diff_url": "https://github.com/rails/rails/pull/48887.diff", "patch_url": "https://github.com/rails/rails/pull/48887.patch", "merged_at": "2023-08-04T17:26:01Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because since [this change](https://github.com/rails/rails/commit/1071a39020564e1f7ebfb618e3e855b52450e015) we started receiving a `NoMethodError` \"undefined method \\`rstrip' for nil:NilClass\" from [line 166](https://github.com/rails/rails/blob/1071a39020564e1f7ebfb618e3e855b52450e015/actionpack/lib/action_dispatch/http/mime_type.rb#L166) of `actionpack/lib/action_dispatch/http/mime_type.rb` when a client makes a request with a blank `Content-Type` header. I believe this client is not adhering to the spec, but prior to the commit they would raise an `ActionDispatch::Http::MimeNegotiation::InvalidType` error and receive a \"406 Not Acceptable\" response instead of a \"500 Server Error\" response.\r\n\r\nThe `NoMethodError`s also clog our error tracking system, whereas we are able to ignore the more specific invalid mime type errors.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the mime type lookup to use the safe nagivation operator on the call to `rstrip` to handle the case when a client makes a request with a blank `Content-Type` header.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\nThe following code snippet contains a working recreation of the issue with the current `main` branch.\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"rack\", \"~> 2.0\"\r\nend\r\n\r\nrequire \"action_controller/railtie\"\r\n\r\nclass TestApp < Rails::Application\r\n  config.root = __dir__\r\n  config.hosts << \"example.org\"\r\n  config.secret_key_base = \"secret_key_base\"\r\n\r\n  config.logger = Logger.new($stdout)\r\n  Rails.logger  = config.logger\r\n\r\n  routes.draw do\r\n    get \"/\" => \"test#index\"\r\n  end\r\nend\r\n\r\nclass TestController < ActionController::Base\r\n  include Rails.application.routes.url_helpers\r\n\r\n  def index\r\n    render plain: \"Home\"\r\n  end\r\nend\r\n\r\nrequire \"minitest/autorun\"\r\nrequire \"rack/test\"\r\n\r\nclass BugTest < Minitest::Test\r\n  include Rack::Test::Methods\r\n\r\n  def test_returns_success\r\n    get \"/\", {}, 'CONTENT_TYPE' => ''\r\n\r\n    assert last_response.server_error?\r\n    assert (last_response.status == 500)\r\n  end\r\n\r\n  private\r\n    def app\r\n      Rails.application\r\n    end\r\nend\r\n```\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48887/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48887/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48886", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48886/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48886/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48886/events", "html_url": "https://github.com/rails/rails/pull/48886", "id": 1836975249, "node_id": "PR_kwDNIULOVzW1Ew", "number": 48886, "title": "Fix `ActiveRecord::QueryMethods#in_order_of` to work with nils", "user": {"login": "fatkodima", "id": 5657035, "node_id": "MDQ6VXNlcjU2NTcwMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/5657035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fatkodima", "html_url": "https://github.com/fatkodima", "followers_url": "https://api.github.com/users/fatkodima/followers", "following_url": "https://api.github.com/users/fatkodima/following{/other_user}", "gists_url": "https://api.github.com/users/fatkodima/gists{/gist_id}", "starred_url": "https://api.github.com/users/fatkodima/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fatkodima/subscriptions", "organizations_url": "https://api.github.com/users/fatkodima/orgs", "repos_url": "https://api.github.com/users/fatkodima/repos", "events_url": "https://api.github.com/users/fatkodima/events{/privacy}", "received_events_url": "https://api.github.com/users/fatkodima/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-04T15:42:16Z", "updated_at": "2023-08-04T21:02:42Z", "closed_at": "2023-08-04T20:41:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48886", "html_url": "https://github.com/rails/rails/pull/48886", "diff_url": "https://github.com/rails/rails/pull/48886.diff", "patch_url": "https://github.com/rails/rails/pull/48886.patch", "merged_at": "2023-08-04T20:41:48Z"}, "body": "This a backport of https://github.com/rails/rails/pull/45670 into `7-0-stable` (including a few follow-up PRs which were made after, https://github.com/rails/rails/pull/46031, https://github.com/rails/rails/pull/46471 and https://github.com/rails/rails/commit/18f8c6ac9ba).", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48886/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48886/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48885", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48885/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48885/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48885/events", "html_url": "https://github.com/rails/rails/pull/48885", "id": 1836498633, "node_id": "PR_kwDNIULOVy8rpQ", "number": 48885, "title": "I18n record not destroyed", "user": {"login": "enmy", "id": 7958278, "node_id": "MDQ6VXNlcjc5NTgyNzg=", "avatar_url": "https://avatars.githubusercontent.com/u/7958278?v=4", "gravatar_id": "", "url": "https://api.github.com/users/enmy", "html_url": "https://github.com/enmy", "followers_url": "https://api.github.com/users/enmy/followers", "following_url": "https://api.github.com/users/enmy/following{/other_user}", "gists_url": "https://api.github.com/users/enmy/gists{/gist_id}", "starred_url": "https://api.github.com/users/enmy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/enmy/subscriptions", "organizations_url": "https://api.github.com/users/enmy/orgs", "repos_url": "https://api.github.com/users/enmy/repos", "events_url": "https://api.github.com/users/enmy/events{/privacy}", "received_events_url": "https://api.github.com/users/enmy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-04T10:39:19Z", "updated_at": "2023-08-10T20:41:06Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48885", "html_url": "https://github.com/rails/rails/pull/48885", "diff_url": "https://github.com/rails/rails/pull/48885.diff", "patch_url": "https://github.com/rails/rails/pull/48885.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because you couldn't change the `ActiveRecord::Persistence` exception message, meaning the message was `\"Failed to destroy #{model} with #{key}\"` even if it wasn't an english language app.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the `ActiveRecord::Persistence` exception message to allow i18n on it.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [ ] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48885/reactions", "total_count": 5, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 2, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48885/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48884", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48884/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48884/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48884/events", "html_url": "https://github.com/rails/rails/issues/48884", "id": 1836447313, "node_id": "I_kwDNIULObXX2UQ", "number": 48884, "title": "7.0.6 changed the i18n behavior of validation messages for `base` in autosave associations", "user": {"login": "wata727", "id": 9624059, "node_id": "MDQ6VXNlcjk2MjQwNTk=", "avatar_url": "https://avatars.githubusercontent.com/u/9624059?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wata727", "html_url": "https://github.com/wata727", "followers_url": "https://api.github.com/users/wata727/followers", "following_url": "https://api.github.com/users/wata727/following{/other_user}", "gists_url": "https://api.github.com/users/wata727/gists{/gist_id}", "starred_url": "https://api.github.com/users/wata727/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wata727/subscriptions", "organizations_url": "https://api.github.com/users/wata727/orgs", "repos_url": "https://api.github.com/users/wata727/repos", "events_url": "https://api.github.com/users/wata727/events{/privacy}", "received_events_url": "https://api.github.com/users/wata727/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2023-08-04T10:02:33Z", "updated_at": "2023-08-07T07:10:06Z", "closed_at": "2023-08-04T19:57:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "From v7.0.6, the behavior regarding i18n of autosave associations validation errors added to `base` has been changed. This change was introduced in https://github.com/rails/rails/pull/48413 (I know this has been reverted in https://github.com/rails/rails/pull/48871, but the behavior hasn't changed).\r\n\r\nThis broke our use case of adding to the `base`, which is configured as `\"\"`. This may have been intentional, but I've decided to open this issue in order to share our use case.\r\n\r\n### Background\r\n\r\n- Add validation errors to `base` that are not related to a column (e.g. depending on multiple columns).\r\n- An entity is stored in multiple models (imagine the [Delegated Types example](https://api.rubyonrails.org/v7.0.6/classes/ActiveRecord/DelegatedType.html)).\r\n- Add validation errors to the delegated association.\r\n\r\n### Steps to reproduce\r\n\r\nBelow is a simplified example of our use case. This works fine in v7.0.5.\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activerecord\", '7.0.5'\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\n\r\nI18n.backend.store_translations(\r\n  :en,\r\n  activerecord: {\r\n    attributes: {\r\n      comment: {\r\n        entity: \"Comment\"\r\n      },\r\n      entity: {\r\n        base: \"\",\r\n      }\r\n    }\r\n  }\r\n)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :comments, force: true do |t|\r\n  end\r\n\r\n  create_table :entities, force: true do |t|\r\n    t.integer :comment_id\r\n  end\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\n  has_one :entity, autosave: true\r\n\r\n  validates :entity, presence: true\r\nend\r\n\r\nclass Entity < ActiveRecord::Base\r\n  validate ->() { errors.add(:base, \"This operation is not allowed\") }\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_without_entity\r\n    comment = Comment.new\r\n\r\n    assert_predicate(comment, :invalid?)\r\n    assert_equal([\"Comment can't be blank\"], comment.errors.full_messages.map(&:strip))\r\n  end\r\n\r\n  def test_with_entity\r\n    comment = Comment.new\r\n    comment.build_entity\r\n\r\n    assert_predicate(comment, :invalid?)\r\n    assert_equal([\"This operation is not allowed\"], comment.errors.full_messages.map(&:strip))\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\n<!-- Tell us what should happen -->\r\n\r\nAll tests pass in v7.0.6.\r\n\r\n```\r\n# Running:\r\n\r\n..\r\n\r\nFinished in 0.007893s, 253.3891 runs/s, 506.7782 assertions/s.\r\n\r\n2 runs, 4 assertions, 0 failures, 0 errors, 0 skips\r\n```\r\n\r\nOr that there is a way to change the locale data to support this case.\r\n\r\n### Actual behavior\r\n<!-- Tell us what happens instead -->\r\n\r\nFirst, if I simply update to v7.0.6, the tests fail:\r\n\r\n```diff\r\n@@ -8,7 +8,7 @@ gemfile(true) do\r\n   git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n \r\n   # Activate the gem you are reporting the issue against.\r\n-  gem \"activerecord\", \"7.0.5\"\r\n+  gem \"activerecord\", \"7.0.6\"\r\n   gem \"sqlite3\"\r\n end\r\n```\r\n\r\n```\r\n# Running:\r\n\r\n.F\r\n\r\nFinished in 0.122810s, 16.2853 runs/s, 32.5706 assertions/s.\r\n\r\n  1) Failure:\r\nBugTest#test_with_entity [test.rb:68]:\r\n--- expected\r\n+++ actual\r\n@@ -1 +1 @@\r\n-[\"This operation is not allowed\"]\r\n+[\"Comment This operation is not allowed\"]\r\n\r\n\r\n2 runs, 4 assertions, 1 failures, 0 errors, 0 skips\r\n```\r\n\r\nThe other test fails when changed the locale data as below:\r\n\r\n```diff\r\n@@ -24,10 +24,9 @@ I18n.backend.store_translations(\r\n   activerecord: {\r\n     attributes: {\r\n       comment: {\r\n-        entity: \"Comment\"\r\n+        entity: \"\"\r\n       },\r\n       entity: {\r\n-        base: \"\",\r\n       }\r\n     }\r\n   }\r\n```\r\n\r\n```\r\n# Running:\r\n\r\n.F\r\n\r\nFinished in 0.007706s, 259.5380 runs/s, 519.0761 assertions/s.\r\n\r\n  1) Failure:\r\nBugTest#test_without_entity [test.rb:59]:\r\nExpected: [\"Comment can't be blank\"]\r\n  Actual: [\"can't be blank\"]\r\n\r\n2 runs, 4 assertions, 1 failures, 0 errors, 0 skips\r\n```\r\n\r\nOnly `base` is treated specially in https://github.com/rails/rails/pull/48413, so it works if changed to `_base`.\r\n\r\n```diff\r\n@@ -27,7 +27,7 @@ I18n.backend.store_translations(\r\n         entity: \"Comment\"\r\n       },\r\n       entity: {\r\n-        base: \"\"\r\n+        _base: \"\"\r\n       }\r\n     }\r\n   }\r\n@@ -49,7 +49,7 @@ class Comment < ActiveRecord::Base\r\n end\r\n \r\n class Entity < ActiveRecord::Base\r\n-  validate ->() { errors.add(:base, \"This operation is not allowed\") }\r\n+  validate ->() { errors.add(:_base, \"This operation is not allowed\") }\r\n end\r\n \r\n class BugTest < Minitest::Test\r\n```\r\n\r\n```\r\n# Running:\r\n\r\n..\r\n\r\nFinished in 0.006907s, 289.5613 runs/s, 579.1226 assertions/s.\r\n\r\n2 runs, 4 assertions, 0 failures, 0 errors, 0 skips\r\n```\r\n\r\nBut is this the right approach? Isn't it an issue that only `base` behaves differently in autosave than otherwise?\r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.1.4\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48884/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48884/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48883", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48883/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48883/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48883/events", "html_url": "https://github.com/rails/rails/pull/48883", "id": 1836432723, "node_id": "PR_kwDNIULOVy5KXQ", "number": 48883, "title": "Remove overflow:hidden from welcome logo", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-04T09:52:44Z", "updated_at": "2023-08-04T20:13:10Z", "closed_at": "2023-08-04T20:13:10Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48883", "html_url": "https://github.com/rails/rails/pull/48883", "diff_url": "https://github.com/rails/rails/pull/48883.diff", "patch_url": "https://github.com/rails/rails/pull/48883.patch", "merged_at": "2023-08-04T20:13:09Z"}, "body": "This was originally added in #47781:\r\n\r\n> ...rails logo hover on welcome page is being triggered on square instead of round image.\r\n\r\nHowever, on Safari the border is being cut-off.\r\n\r\nI'm not sure there is another workaround, but I am willing to accept a larger (square) clickable area to have a consistent drop shadow.\r\n\r\nBefore\r\n\r\n<img width=\"303\" alt=\"Screenshot 2023-08-04 at 18 47 43\" src=\"https://github.com/rails/rails/assets/277819/aa05ff53-5781-4a45-8dc5-a037125e8be1\">\r\n\r\nAfter\r\n\r\n<img width=\"303\" alt=\"Screenshot 2023-08-04 at 18 47 48\" src=\"https://github.com/rails/rails/assets/277819/de4413bd-dc08-49f0-9dab-826be4a2b9bd\">\r\n\r\n\r\n/cc @brenda-daroz ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48883/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48883/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48882", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48882/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48882/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48882/events", "html_url": "https://github.com/rails/rails/issues/48882", "id": 1836419724, "node_id": "I_kwDNIULObXWKjA", "number": 48882, "title": "Rails hangs on Turbo::StreamsChannel is streaming from", "user": {"login": "cvandermeer", "id": 5426992, "node_id": "MDQ6VXNlcjU0MjY5OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5426992?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cvandermeer", "html_url": "https://github.com/cvandermeer", "followers_url": "https://api.github.com/users/cvandermeer/followers", "following_url": "https://api.github.com/users/cvandermeer/following{/other_user}", "gists_url": "https://api.github.com/users/cvandermeer/gists{/gist_id}", "starred_url": "https://api.github.com/users/cvandermeer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cvandermeer/subscriptions", "organizations_url": "https://api.github.com/users/cvandermeer/orgs", "repos_url": "https://api.github.com/users/cvandermeer/repos", "events_url": "https://api.github.com/users/cvandermeer/events{/privacy}", "received_events_url": "https://api.github.com/users/cvandermeer/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-04T09:44:12Z", "updated_at": "2023-08-07T09:22:11Z", "closed_at": "2023-08-07T09:22:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nCreate a new rails app, and build turbo_stream_from logic.\r\n\r\nMy rails 7 application is using turbo streams broadcast. But after running for a while it will start hanging/not loading anymore.\r\n\r\nThese are the last 3 lines from my application log\r\n```\r\nI, [2023-07-20T15:48:46.854914 #4211]  INFO -- : [047924b6-20d4-4aca-90bb-cca4efcf99e0] Started GET \"/cable\" [WebSocket] for 93.117.245.115 at 2023-07-20 15:48:46 +0200\r\nI, [2023-07-20T15:48:46.854984 #4211]  INFO -- : [047924b6-20d4-4aca-90bb-cca4efcf99e0] Successfully upgraded to WebSocket (REQUEST_METHOD: GET, HTTP_CONNECTION: upgrade, HTTP_UPGRADE: websocket)\r\nI, [2023-07-20T15:48:46.953230 #4211]  INFO -- : Turbo::StreamsChannel is streaming from assign_employees_7\r\n```\r\nThe pages are no longer loading and it stays on this line. New requests are not being received anymore.\r\n\r\nMy code is as follows:\r\n\r\nIn the controller after update\r\n```\r\nTurbo::StreamsChannel.broadcast_update_to(\"assign_employees_#{company.id}\", target: \"assign_employees_#{company.id}\", partial: 'activities/assign_employees', locals: { activities: activities, calendars: company.calendars, shifts: shifts, company: company, group_id: session[:group_id] })\r\n```\r\nIn my view\r\n```\r\n<%= turbo_stream_from \"assign_employees_#{current_company.id}\" %>\r\n<%= render 'assign_employees', activities: @activities, calendar: @calendars, shifts: @shifts, company: current_company, group_id: session[:group_id] %>\r\n```\r\n\r\nI am really clueless as to what is going on. Server performance seems fine. I also get this when running the application locally for a while.\r\n\r\n### Expected behavior\r\nit should not hang the entire application\r\n\r\n### Actual behavior\r\n<!-- Tell us what happens instead -->\r\n\r\n### System configuration\r\n**Rails version**:\r\n```\r\ngem 'rails', '~> 7.0.6'\r\ngem 'mysql2', '~> 0.5.4'\r\ngem 'puma', '~> 6.3.0'\r\n```\r\n\r\n**Ruby version**:\r\n2.7.8\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48882/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48882/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48881", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48881/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48881/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48881/events", "html_url": "https://github.com/rails/rails/pull/48881", "id": 1836198234, "node_id": "PR_kwDNIULOVyssHw", "number": 48881, "title": "Fix typo in ActiveRecord Query guide", "user": {"login": "jackclarkeparker", "id": 57271551, "node_id": "MDQ6VXNlcjU3MjcxNTUx", "avatar_url": "https://avatars.githubusercontent.com/u/57271551?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackclarkeparker", "html_url": "https://github.com/jackclarkeparker", "followers_url": "https://api.github.com/users/jackclarkeparker/followers", "following_url": "https://api.github.com/users/jackclarkeparker/following{/other_user}", "gists_url": "https://api.github.com/users/jackclarkeparker/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackclarkeparker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackclarkeparker/subscriptions", "organizations_url": "https://api.github.com/users/jackclarkeparker/orgs", "repos_url": "https://api.github.com/users/jackclarkeparker/repos", "events_url": "https://api.github.com/users/jackclarkeparker/events{/privacy}", "received_events_url": "https://api.github.com/users/jackclarkeparker/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-04T07:12:18Z", "updated_at": "2023-08-04T08:46:14Z", "closed_at": "2023-08-04T08:46:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48881", "html_url": "https://github.com/rails/rails/pull/48881", "diff_url": "https://github.com/rails/rails/pull/48881.diff", "patch_url": "https://github.com/rails/rails/pull/48881.patch", "merged_at": "2023-08-04T08:46:14Z"}, "body": "The SQL generated by this query (at 13.1.3.2 of the ActiveRecord Query guide):\r\n\r\n```ruby\r\nAuthor.joins(books: [{ reviews: { customer: :orders } }, :supplier] )\r\n```\r\n\r\nIs stated to generate SQL whose select list is comprised of `*`; it should be `authors.*`", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48881/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48881/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48880", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48880/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48880/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48880/events", "html_url": "https://github.com/rails/rails/pull/48880", "id": 1836040458, "node_id": "PR_kwDNIULOVykieQ", "number": 48880, "title": "Added missing test for Arel factory methods", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-04T04:22:04Z", "updated_at": "2023-08-05T01:41:16Z", "closed_at": "2023-08-04T20:03:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48880", "html_url": "https://github.com/rails/rails/pull/48880", "diff_url": "https://github.com/rails/rails/pull/48880.diff", "patch_url": "https://github.com/rails/rails/pull/48880.patch", "merged_at": "2023-08-04T20:03:05Z"}, "body": "### Detail\r\n\r\nThis Pull Request added the missing test for a couple of methods in Arel::FactoryMethods\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48880/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48880/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48879", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48879/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48879/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48879/events", "html_url": "https://github.com/rails/rails/pull/48879", "id": 1835844788, "node_id": "PR_kwDNIULOVyaTUA", "number": 48879, "title": "Get rid of trilogy errors merge", "user": {"login": "jhawthorn", "id": 131752, "node_id": "MDQ6VXNlcjEzMTc1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/131752?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhawthorn", "html_url": "https://github.com/jhawthorn", "followers_url": "https://api.github.com/users/jhawthorn/followers", "following_url": "https://api.github.com/users/jhawthorn/following{/other_user}", "gists_url": "https://api.github.com/users/jhawthorn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhawthorn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhawthorn/subscriptions", "organizations_url": "https://api.github.com/users/jhawthorn/orgs", "repos_url": "https://api.github.com/users/jhawthorn/repos", "events_url": "https://api.github.com/users/jhawthorn/events{/privacy}", "received_events_url": "https://api.github.com/users/jhawthorn/received_events", "type": "User", "site_admin": true}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-03T23:17:31Z", "updated_at": "2023-08-04T06:17:25Z", "closed_at": "2023-08-04T06:17:19Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48879", "html_url": "https://github.com/rails/rails/pull/48879", "diff_url": "https://github.com/rails/rails/pull/48879.diff", "patch_url": "https://github.com/rails/rails/pull/48879.patch", "merged_at": "2023-08-04T06:17:19Z"}, "body": "Testing merge commit of https://github.com/rails/rails/pull/48109", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48879/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48879/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48878", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48878/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48878/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48878/events", "html_url": "https://github.com/rails/rails/issues/48878", "id": 1835744145, "node_id": "I_kwDNIULObWs7kQ", "number": 48878, "title": "ActionController::PermissionsPolicy does not define \"Permissions-Policy\" but \"Feature-Policy\"", "user": {"login": "mikevoets", "id": 4422159, "node_id": "MDQ6VXNlcjQ0MjIxNTk=", "avatar_url": "https://avatars.githubusercontent.com/u/4422159?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikevoets", "html_url": "https://github.com/mikevoets", "followers_url": "https://api.github.com/users/mikevoets/followers", "following_url": "https://api.github.com/users/mikevoets/following{/other_user}", "gists_url": "https://api.github.com/users/mikevoets/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikevoets/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikevoets/subscriptions", "organizations_url": "https://api.github.com/users/mikevoets/orgs", "repos_url": "https://api.github.com/users/mikevoets/repos", "events_url": "https://api.github.com/users/mikevoets/events{/privacy}", "received_events_url": "https://api.github.com/users/mikevoets/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-03T21:14:55Z", "updated_at": "2023-08-03T21:20:00Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# config/initializers/permissions_policy.rb\r\n\r\nRails.application.config.permissions_policy do |f|\r\n  f.camera      :none\r\n  f.gyroscope   :none\r\n  f.microphone  :none\r\n  f.usb         :none\r\n  f.fullscreen  :self\r\n  f.payment     :self\r\nend\r\n```\r\n\r\n### Expected behavior\r\nThis adds the following to the response headers:\r\n\r\nPermissions-Policy: camera=(), gyroscope=(), microphone=(), usb=(), fullscreen=(self), payment=(self)\r\n\r\n### Actual behavior\r\nThis adds the following to the response headers:\r\n\r\nFeature-Policy: camera 'none'; gyroscope 'none'; microphone 'none'; usb 'none'; fullscreen 'self'; payment 'self'\r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.0.6p216\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48878/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48878/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48877", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48877/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48877/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48877/events", "html_url": "https://github.com/rails/rails/pull/48877", "id": 1835130291, "node_id": "PR_kwDNIULOVx0qvQ", "number": 48877, "title": "[skip ci] Added missing parathesis in guide", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-03T14:01:59Z", "updated_at": "2023-08-03T14:05:09Z", "closed_at": "2023-08-03T14:03:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48877", "html_url": "https://github.com/rails/rails/pull/48877", "diff_url": "https://github.com/rails/rails/pull/48877.diff", "patch_url": "https://github.com/rails/rails/pull/48877.patch", "merged_at": "2023-08-03T14:03:57Z"}, "body": "### Detail\r\n\r\nAdded a missing parathesis inside a javascript code in the guide.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48877/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48877/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48876", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48876/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48876/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48876/events", "html_url": "https://github.com/rails/rails/pull/48876", "id": 1834208849, "node_id": "PR_kwDNIULOVxCTEQ", "number": 48876, "title": "Use already loaded relation when batching if possible", "user": {"login": "HParker", "id": 4482399, "node_id": "MDQ6VXNlcjQ0ODIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/4482399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HParker", "html_url": "https://github.com/HParker", "followers_url": "https://api.github.com/users/HParker/followers", "following_url": "https://api.github.com/users/HParker/following{/other_user}", "gists_url": "https://api.github.com/users/HParker/gists{/gist_id}", "starred_url": "https://api.github.com/users/HParker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HParker/subscriptions", "organizations_url": "https://api.github.com/users/HParker/orgs", "repos_url": "https://api.github.com/users/HParker/repos", "events_url": "https://api.github.com/users/HParker/events{/privacy}", "received_events_url": "https://api.github.com/users/HParker/received_events", "type": "User", "site_admin": true}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-03T03:29:39Z", "updated_at": "2023-08-03T14:36:29Z", "closed_at": "2023-08-03T07:57:56Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48876", "html_url": "https://github.com/rails/rails/pull/48876", "diff_url": "https://github.com/rails/rails/pull/48876.diff", "patch_url": "https://github.com/rails/rails/pull/48876.patch", "merged_at": "2023-08-03T07:57:56Z"}, "body": "If you have already loaded the relation when using in_batches, you would reload each batch from the database.  Since we already have the records available, we can avoid these queries and return the records as-if the query was run.\r\n\r\n### Motivation / Background\r\n\r\nThis Pull Request has been created because today `in_batches` can run queries which can be avoided.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes batches to avoid queries when possible.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48876/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48876/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48875", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48875/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48875/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48875/events", "html_url": "https://github.com/rails/rails/issues/48875", "id": 1833946178, "node_id": "I_kwDNIULObU_MQg", "number": 48875, "title": "AbstractController::DoubleRenderError:        Render and/or redirect were called multiple times in this action. Please note that you may only call render OR redirect, and at most once per action. Also note that neither redirect nor render terminate execution of the action, so if you want to exit an action after redirecting, you need to do something like \"redirect_to(...) and return\".", "user": {"login": "karantomar-aretove", "id": 78872115, "node_id": "MDQ6VXNlcjc4ODcyMTE1", "avatar_url": "https://avatars.githubusercontent.com/u/78872115?v=4", "gravatar_id": "", "url": "https://api.github.com/users/karantomar-aretove", "html_url": "https://github.com/karantomar-aretove", "followers_url": "https://api.github.com/users/karantomar-aretove/followers", "following_url": "https://api.github.com/users/karantomar-aretove/following{/other_user}", "gists_url": "https://api.github.com/users/karantomar-aretove/gists{/gist_id}", "starred_url": "https://api.github.com/users/karantomar-aretove/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/karantomar-aretove/subscriptions", "organizations_url": "https://api.github.com/users/karantomar-aretove/orgs", "repos_url": "https://api.github.com/users/karantomar-aretove/repos", "events_url": "https://api.github.com/users/karantomar-aretove/events{/privacy}", "received_events_url": "https://api.github.com/users/karantomar-aretove/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1071962662, "node_id": "MDU6TGFiZWwxMDcxOTYyNjYy", "url": "https://api.github.com/repos/rails/rails/labels/more-information-needed", "name": "more-information-needed", "color": "bfdadc", "default": false, "description": "When reporter needs to provide more information"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-08-02T21:45:12Z", "updated_at": "2023-08-19T22:14:27Z", "closed_at": "2023-08-16T22:42:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "I recently upgraded our application to Rails 6 and while running Rspec I am getting this below error\r\n\r\n`AbstractController::DoubleRenderError: Render and/or redirect were called multiple times in this action. Please note that you may only call render OR redirect, and at most once per action. Also, note that neither redirect nor render terminate execution of the action, so if you want to exit an action after redirecting, you need to do something like \"redirect_to(...) and return\".`\r\n\r\n```\r\n     # --- Caused by: ---\r\n     # Example::RecordNotFound:\r\n     #   Example::RecordNotFound\r\n     #   ./app/controllers/api/v1/dummy_controller.rb:75:in `find_test_by_email'\r\n```\r\n```\r\n      def find_test_by_email\r\n        @abc = Test.find_by_email(email)\r\n        fail Example::RecordNotFound unless @abc\r\n      end\r\n```\r\n      \r\nBelow is the def of that specific action and I can see there is only a single render used \r\n        \r\n     def rescue_example_action(type, status_code)\r\n        render json: {\r\n          errors: [\r\n            JSONAPI::Error.new(\r\n              title: I18n.t(type),\r\n              code: status_code,\r\n              status: :forbidden\r\n            )]\r\n        }, status: status_code || 422\r\n      end`", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48875/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48875/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48873", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48873/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48873/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48873/events", "html_url": "https://github.com/rails/rails/pull/48873", "id": 1833038138, "node_id": "PR_kwDNIULOVwCaoQ", "number": 48873, "title": "Adds Arel::FactoryMethods#cast(node, type)", "user": {"login": "drnic", "id": 108, "node_id": "MDQ6VXNlcjEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drnic", "html_url": "https://github.com/drnic", "followers_url": "https://api.github.com/users/drnic/followers", "following_url": "https://api.github.com/users/drnic/following{/other_user}", "gists_url": "https://api.github.com/users/drnic/gists{/gist_id}", "starred_url": "https://api.github.com/users/drnic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drnic/subscriptions", "organizations_url": "https://api.github.com/users/drnic/orgs", "repos_url": "https://api.github.com/users/drnic/repos", "events_url": "https://api.github.com/users/drnic/events{/privacy}", "received_events_url": "https://api.github.com/users/drnic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-08-02T11:55:49Z", "updated_at": "2023-08-09T00:01:23Z", "closed_at": "2023-08-04T01:52:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48873", "html_url": "https://github.com/rails/rails/pull/48873", "diff_url": "https://github.com/rails/rails/pull/48873.diff", "patch_url": "https://github.com/rails/rails/pull/48873.patch", "merged_at": "2023-08-04T01:52:01Z"}, "body": "For example:\r\n\r\n```\r\n  product_table = Product.arel_table\r\n  product_table.cast(product_table[:position], \"integer\")\r\n```\r\n\r\nProduces SQL:\r\n\r\n```\r\n  CAST(\"products\".\"position\" as integer)\r\n```\r\n\r\n### Motivation / Background\r\n\r\n`CAST(field as type)` is a widely supported SQL function. This PR adds native arel support for this named function with a `cast(field, type)` helper.\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48873/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48873/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48872", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48872/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48872/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48872/events", "html_url": "https://github.com/rails/rails/pull/48872", "id": 1832972304, "node_id": "PR_kwDNIULOVv-2CA", "number": 48872, "title": "Simplify the sanity check in ARTest.connect", "user": {"login": "aidanharan", "id": 1769416, "node_id": "MDQ6VXNlcjE3Njk0MTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1769416?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aidanharan", "html_url": "https://github.com/aidanharan", "followers_url": "https://api.github.com/users/aidanharan/followers", "following_url": "https://api.github.com/users/aidanharan/following{/other_user}", "gists_url": "https://api.github.com/users/aidanharan/gists{/gist_id}", "starred_url": "https://api.github.com/users/aidanharan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aidanharan/subscriptions", "organizations_url": "https://api.github.com/users/aidanharan/orgs", "repos_url": "https://api.github.com/users/aidanharan/repos", "events_url": "https://api.github.com/users/aidanharan/events{/privacy}", "received_events_url": "https://api.github.com/users/aidanharan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-08-02T11:12:21Z", "updated_at": "2023-08-03T12:27:35Z", "closed_at": "2023-08-03T12:02:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48872", "html_url": "https://github.com/rails/rails/pull/48872", "diff_url": "https://github.com/rails/rails/pull/48872.diff", "patch_url": "https://github.com/rails/rails/pull/48872.patch", "merged_at": "2023-08-03T12:02:02Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created to allow [Active Record SQL Server Adapter](https://github.com/rails-sqlserver/activerecord-sqlserver-adapter/) tests to run against the Rails `main` branch.\r\n\r\n### Detail\r\n\r\nIn PR [Fix trilogy builds](https://github.com/rails/rails/pull/48015), a check was included to prevent the tests running against the wrong adapter. The fix handled the special case of SQLite which uses different connection (`sqlite3_mem`) and adapter (`sqlite3`) names. \r\n\r\nThis Pull Request extends that check to also handle the SQL Server adapter. The adapter's name is `sqlserver` but the connection's name is `dblib`. I can't find an alternative method in the adapter's codebase of fixing this issue.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48872/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48872/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48871", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48871/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48871/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48871/events", "html_url": "https://github.com/rails/rails/pull/48871", "id": 1832955727, "node_id": "PR_kwDNIULOVv98UQ", "number": 48871, "title": "Fix AM::Error.full_message to remove \":base\"", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-02T11:00:45Z", "updated_at": "2023-08-02T22:09:38Z", "closed_at": "2023-08-02T20:31:11Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48871", "html_url": "https://github.com/rails/rails/pull/48871", "diff_url": "https://github.com/rails/rails/pull/48871.diff", "patch_url": "https://github.com/rails/rails/pull/48871.patch", "merged_at": "2023-08-02T20:31:11Z"}, "body": "This PR reverts the changes to autosave from #48413, and fixes #48408, without having to change which key errors are stored.\r\n\r\nThere is an equivalent PR for `7-0-stable` branch in #48870.\r\n\r\n/cc @fatkodima @rafaelfranca @Edouard-chin @kamil-gwozdz", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48871/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48871/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48870", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48870/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48870/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48870/events", "html_url": "https://github.com/rails/rails/pull/48870", "id": 1832933272, "node_id": "PR_kwDNIULOVv8tCQ", "number": 48870, "title": "[7-0-stable] Fix AM::Error.full_message to remove \":base\"", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-02T10:46:34Z", "updated_at": "2023-08-02T22:18:37Z", "closed_at": "2023-08-02T20:33:33Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48870", "html_url": "https://github.com/rails/rails/pull/48870", "diff_url": "https://github.com/rails/rails/pull/48870.diff", "patch_url": "https://github.com/rails/rails/pull/48870.patch", "merged_at": null}, "body": "This PR reverts the changes to autosave from #48413, and fixes #48408, without having to change which key errors are stored.\r\n\r\n\r\nThere is an equivalent PR for `main` branch in #48871", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48870/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48870/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48869", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48869/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48869/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48869/events", "html_url": "https://github.com/rails/rails/pull/48869", "id": 1832410763, "node_id": "PR_kwDNIULOVvgdwg", "number": 48869, "title": "Disable session in ActiveStorage blobs and representations proxy controllers", "user": {"login": "brunoprietog", "id": 46098928, "node_id": "MDQ6VXNlcjQ2MDk4OTI4", "avatar_url": "https://avatars.githubusercontent.com/u/46098928?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brunoprietog", "html_url": "https://github.com/brunoprietog", "followers_url": "https://api.github.com/users/brunoprietog/followers", "following_url": "https://api.github.com/users/brunoprietog/following{/other_user}", "gists_url": "https://api.github.com/users/brunoprietog/gists{/gist_id}", "starred_url": "https://api.github.com/users/brunoprietog/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brunoprietog/subscriptions", "organizations_url": "https://api.github.com/users/brunoprietog/orgs", "repos_url": "https://api.github.com/users/brunoprietog/repos", "events_url": "https://api.github.com/users/brunoprietog/events{/privacy}", "received_events_url": "https://api.github.com/users/brunoprietog/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-02T04:31:37Z", "updated_at": "2023-08-04T07:51:36Z", "closed_at": "2023-08-03T20:00:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48869", "html_url": "https://github.com/rails/rails/pull/48869", "diff_url": "https://github.com/rails/rails/pull/48869.diff", "patch_url": "https://github.com/rails/rails/pull/48869.patch", "merged_at": "2023-08-03T20:00:34Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nWhen configuring ActiveStorage with resolve_model_to_route in rails_storage_proxy, you would expect a CDN such as CloudFlare to cache the files. However, in the case of CloudFlare, by default, anything that has session cookies will not cache them. To work around this you can use custom rules or patch these ActiveStorage proxy controllers.\r\n\r\n### Detail\r\n\r\nSession now is disabled in `ActiveStorage::Blobs::ProxyController` and `ActiveStorage::Representations::ProxyController`, including the new concern `ActiveStorage::DisableSession` in both controllers that does the work.\r\n\r\nThis way it will not be necessary to create custom rules and works by default.\r\n\r\nThanks to @fleck for the idea in this [comment](https://github.com/rails/rails/pull/34477#issuecomment-660490231).\r\n\r\nFixes #44136\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\nI'm not sure if or how to test this, because there is no way to access the session in `ActionDispatch::IntegrationTest`.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48869/reactions", "total_count": 8, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 8, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48869/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48868", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48868/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48868/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48868/events", "html_url": "https://github.com/rails/rails/pull/48868", "id": 1832166934, "node_id": "PR_kwDNIULOVvTbzQ", "number": 48868, "title": "Fix `Cache::NullStore` with local caching for repeated reads", "user": {"login": "fatkodima", "id": 5657035, "node_id": "MDQ6VXNlcjU2NTcwMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/5657035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fatkodima", "html_url": "https://github.com/fatkodima", "followers_url": "https://api.github.com/users/fatkodima/followers", "following_url": "https://api.github.com/users/fatkodima/following{/other_user}", "gists_url": "https://api.github.com/users/fatkodima/gists{/gist_id}", "starred_url": "https://api.github.com/users/fatkodima/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fatkodima/subscriptions", "organizations_url": "https://api.github.com/users/fatkodima/orgs", "repos_url": "https://api.github.com/users/fatkodima/repos", "events_url": "https://api.github.com/users/fatkodima/events{/privacy}", "received_events_url": "https://api.github.com/users/fatkodima/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-08-01T23:26:58Z", "updated_at": "2023-08-02T07:08:33Z", "closed_at": "2023-08-01T23:34:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48868", "html_url": "https://github.com/rails/rails/pull/48868", "diff_url": "https://github.com/rails/rails/pull/48868.diff", "patch_url": "https://github.com/rails/rails/pull/48868.patch", "merged_at": "2023-08-01T23:34:42Z"}, "body": "This is a backport of https://github.com/rails/rails/pull/45728 into `7-0-stable`.\r\nFixes #48867.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48868/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48868/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48867", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48867/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48867/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48867/events", "html_url": "https://github.com/rails/rails/issues/48867", "id": 1832132932, "node_id": "I_kwDNIULObTQhRA", "number": 48867, "title": "Repeated calls to `read_multi` on `NullStore` cache causes a NoMethodError", "user": {"login": "JBKahn", "id": 2654653, "node_id": "MDQ6VXNlcjI2NTQ2NTM=", "avatar_url": "https://avatars.githubusercontent.com/u/2654653?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JBKahn", "html_url": "https://github.com/JBKahn", "followers_url": "https://api.github.com/users/JBKahn/followers", "following_url": "https://api.github.com/users/JBKahn/following{/other_user}", "gists_url": "https://api.github.com/users/JBKahn/gists{/gist_id}", "starred_url": "https://api.github.com/users/JBKahn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JBKahn/subscriptions", "organizations_url": "https://api.github.com/users/JBKahn/orgs", "repos_url": "https://api.github.com/users/JBKahn/repos", "events_url": "https://api.github.com/users/JBKahn/events{/privacy}", "received_events_url": "https://api.github.com/users/JBKahn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-08-01T22:47:27Z", "updated_at": "2023-08-01T23:34:58Z", "closed_at": "2023-08-01T23:34:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\nUsing a local cache block with the NullStore causes an exception. I dug a little deeper to discover that somehow the local cache has an explicitly stored `nil` for the missing value *after* the first call. And then when the second call is made, that is what causes it to break.\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activesupport\", \"~> 7.0.6\"\r\nend\r\n\r\nrequire \"active_support\"\r\nrequire \"active_support/core_ext/object/blank\"\r\nrequire \"minitest/autorun\"\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_two_calls_to_read_multi\r\n    cache = ActiveSupport::Cache::NullStore.new\r\n    cache.with_local_cache do \r\n      cache.write(\"1\", \"one\")\r\n      cache.write(\"2\", \"two\")\r\n      keys = [\"1\", \"2\", \"3\"]\r\n\r\n      assert(cache.read_multi(*keys) == { \"1\" => \"one\", \"2\" => \"two\" })\r\n      assert(cache.read_multi(*keys) == { \"1\" => \"one\", \"2\" => \"two\" })\r\n    end\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\nThe cache retrieves the values the second time\r\n\r\n### Actual behavior\r\n\r\n```\r\nBugTest#test_two_calls_to_read_multi:\r\nNoMethodError: undefined method `value' for nil:NilClass\r\n    .gem/ruby/3.2.2/gems/activesupport-7.0.6/lib/active_support/cache/strategy/local_cache.rb:127:in `block in read_multi_entries'\r\n    .gem/ruby/3.2.2/gems/activesupport-7.0.6/lib/active_support/cache/strategy/local_cache.rb:126:in `transform_values!'\r\n    .gem/ruby/3.2.2/gems/activesupport-7.0.6/lib/active_support/cache/strategy/local_cache.rb:126:in `read_multi_entries'\r\n    .gem/ruby/3.2.2/gems/activesupport-7.0.6/lib/active_support/cache.rb:400:in `block in read_multi'\r\n    .gem/ruby/3.2.2/gems/activesupport-7.0.6/lib/active_support/cache.rb:783:in `block in instrument'\r\n    .gem/ruby/3.2.2/gems/activesupport-7.0.6/lib/active_support/notifications.rb:208:in `instrument'\r\n    .gem/ruby/3.2.2/gems/activesupport-7.0.6/lib/active_support/cache.rb:783:in `instrument'\r\n    .gem/ruby/3.2.2/gems/activesupport-7.0.6/lib/active_support/cache.rb:399:in `read_multi'\r\n    bug_test.rb:27:in `block in test_two_calls_to_read_multi'\r\n    .gem/ruby/3.2.2/gems/activesupport-7.0.6/lib/active_support/cache/strategy/local_cache.rb:178:in `use_temporary_local_cache'\r\n    .gem/ruby/3.2.2/gems/activesupport-7.0.6/lib/active_support/cache/strategy/local_cache.rb:64:in `with_local_cache'\r\n    bug_test.rb:21:in `test_two_calls_to_read_multi'\r\n```\r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48867/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48867/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48866", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48866/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48866/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48866/events", "html_url": "https://github.com/rails/rails/issues/48866", "id": 1832022828, "node_id": "I_kwDNIULObTJzLA", "number": 48866, "title": "Direct Routes aren't reflected in list of available routes via `bin/rails routes`", "user": {"login": "dylanfisher", "id": 3743491, "node_id": "MDQ6VXNlcjM3NDM0OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/3743491?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dylanfisher", "html_url": "https://github.com/dylanfisher", "followers_url": "https://api.github.com/users/dylanfisher/followers", "following_url": "https://api.github.com/users/dylanfisher/following{/other_user}", "gists_url": "https://api.github.com/users/dylanfisher/gists{/gist_id}", "starred_url": "https://api.github.com/users/dylanfisher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dylanfisher/subscriptions", "organizations_url": "https://api.github.com/users/dylanfisher/orgs", "repos_url": "https://api.github.com/users/dylanfisher/repos", "events_url": "https://api.github.com/users/dylanfisher/events{/privacy}", "received_events_url": "https://api.github.com/users/dylanfisher/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-01T21:00:03Z", "updated_at": "2023-08-04T20:43:10Z", "closed_at": "2023-08-04T20:43:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "Adding [direct routes](https://guides.rubyonrails.org/routing.html#direct-routes) to your application don't seem to be reflected in the list of available routes. I'm not sure if this is intentional or not, but it seems counterintuitive in my first time using the `direct` route option.\r\n\r\n### Steps to reproduce\r\n\r\n```ruby\r\n# routes.rb\r\n\r\ndirect :homepage do\r\n  \"http://www.rubyonrails.org\"\r\nend\r\n```\r\n\r\n```\r\nbin/rails routes | grep homepage\r\n=> no results\r\n```\r\n\r\nThe direct route helpers do work in the app, but they aren't reflected in the list of routes.\r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48866/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48866/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48865", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48865/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48865/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48865/events", "html_url": "https://github.com/rails/rails/pull/48865", "id": 1831997609, "node_id": "PR_kwDNIULOVvKSIQ", "number": 48865, "title": "Don't check `defined?` on `@connection_specification_name`", "user": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-08-01T20:40:05Z", "updated_at": "2023-08-01T20:51:16Z", "closed_at": "2023-08-01T20:51:16Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48865", "html_url": "https://github.com/rails/rails/pull/48865", "diff_url": "https://github.com/rails/rails/pull/48865.diff", "patch_url": "https://github.com/rails/rails/pull/48865.patch", "merged_at": null}, "body": "I've removed these checks for a couple reasons:\r\n\r\n1) If an instance variable is undefined, it will return nil, so `@connection_specification_name.nil?` is equivalent to `!defined?(@connection_specification_name)`.\r\n2) It's possible to have a `nil` value for `name` and `@connection_specification_name`. Checking\r\n`defined(@connection_specification_name)` in `remove_connection` doesn't prevent us from trying to remove a `nil` pool. So either way we end up with `nil`. `remove_connection_pool` silently does nothing if there's no pool found.\r\n\r\nSo neither of the `defined?` checks do anything for us and can be removed.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48865/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48865/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48864", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48864/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48864/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48864/events", "html_url": "https://github.com/rails/rails/issues/48864", "id": 1831476600, "node_id": "I_kwDNIULObSodeA", "number": 48864, "title": "Unable to autoload constant Example, expected /lib/example.rb to define it (LoadError)", "user": {"login": "karantomar-aretove", "id": 78872115, "node_id": "MDQ6VXNlcjc4ODcyMTE1", "avatar_url": "https://avatars.githubusercontent.com/u/78872115?v=4", "gravatar_id": "", "url": "https://api.github.com/users/karantomar-aretove", "html_url": "https://github.com/karantomar-aretove", "followers_url": "https://api.github.com/users/karantomar-aretove/followers", "following_url": "https://api.github.com/users/karantomar-aretove/following{/other_user}", "gists_url": "https://api.github.com/users/karantomar-aretove/gists{/gist_id}", "starred_url": "https://api.github.com/users/karantomar-aretove/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/karantomar-aretove/subscriptions", "organizations_url": "https://api.github.com/users/karantomar-aretove/orgs", "repos_url": "https://api.github.com/users/karantomar-aretove/repos", "events_url": "https://api.github.com/users/karantomar-aretove/events{/privacy}", "received_events_url": "https://api.github.com/users/karantomar-aretove/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2023-08-01T15:01:36Z", "updated_at": "2023-08-01T20:35:58Z", "closed_at": "2023-08-01T20:35:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am getting this error though I have autoloaded the lib directory in the application.rb file and also wrapped the Example module in Rails.application.config.to_prepare do block. Can you please help @fxn\r\n\r\n    config.autoload_paths << Rails.root.join('lib')\r\n    config.eager_load_paths << Rails.root.join('lib')", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48864/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48864/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48863", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48863/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48863/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48863/events", "html_url": "https://github.com/rails/rails/pull/48863", "id": 1831297145, "node_id": "PR_kwDNIULOVukqDA", "number": 48863, "title": "Save screenshot path on system test failure", "user": {"login": "matteeyah", "id": 1218868, "node_id": "MDQ6VXNlcjEyMTg4Njg=", "avatar_url": "https://avatars.githubusercontent.com/u/1218868?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matteeyah", "html_url": "https://github.com/matteeyah", "followers_url": "https://api.github.com/users/matteeyah/followers", "following_url": "https://api.github.com/users/matteeyah/following{/other_user}", "gists_url": "https://api.github.com/users/matteeyah/gists{/gist_id}", "starred_url": "https://api.github.com/users/matteeyah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matteeyah/subscriptions", "organizations_url": "https://api.github.com/users/matteeyah/orgs", "repos_url": "https://api.github.com/users/matteeyah/repos", "events_url": "https://api.github.com/users/matteeyah/events{/privacy}", "received_events_url": "https://api.github.com/users/matteeyah/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-08-01T13:30:42Z", "updated_at": "2023-08-05T06:41:56Z", "closed_at": "2023-08-03T14:35:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48863", "html_url": "https://github.com/rails/rails/pull/48863", "diff_url": "https://github.com/rails/rails/pull/48863.diff", "patch_url": "https://github.com/rails/rails/pull/48863.patch", "merged_at": "2023-08-03T14:35:30Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nLots of CI tools support showing a failure screenshot somewhere in their UI (e.g. GitLab). I want to persist the screenshot path so these tools can pick up the screenshot and visually display it.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes `ActionDispatch::SystemTesting::TestHelpers::ScreenshotHelper` to save the screenshot path in the test metadata on failure.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\nBumping `minitest` to `5.19.0` is required because the metadata changes were added in then.\r\n\r\nhttps://github.com/minitest/minitest/blob/master/History.rdoc#5190--2023-07-26-\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48863/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48863/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48862", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48862/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48862/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48862/events", "html_url": "https://github.com/rails/rails/issues/48862", "id": 1830670755, "node_id": "I_kwDNIULObR3Row", "number": 48862, "title": "ActiveRecord::QueryMethods#select with Hash does not match syntax for #where", "user": {"login": "leejarvis", "id": 197567, "node_id": "MDQ6VXNlcjE5NzU2Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/197567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leejarvis", "html_url": "https://github.com/leejarvis", "followers_url": "https://api.github.com/users/leejarvis/followers", "following_url": "https://api.github.com/users/leejarvis/following{/other_user}", "gists_url": "https://api.github.com/users/leejarvis/gists{/gist_id}", "starred_url": "https://api.github.com/users/leejarvis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leejarvis/subscriptions", "organizations_url": "https://api.github.com/users/leejarvis/orgs", "repos_url": "https://api.github.com/users/leejarvis/repos", "events_url": "https://api.github.com/users/leejarvis/events{/privacy}", "received_events_url": "https://api.github.com/users/leejarvis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-08-01T07:50:12Z", "updated_at": "2023-08-10T12:03:41Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "https://github.com/rails/rails/pull/45612 recently added support for passing a Hash to `ActiveRecord::QueryMethods#select`, however it does not pick up table aliases in the same way that `#where` does. I think this behaviour is incorrect.\r\n\r\n### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"pg\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\nActiveRecord::Base.establish_connection(adapter: \"postgresql\", database: \"select_hash_test\")\r\n# ActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n    t.string :title\r\n  end\r\n\r\n  create_table :authors, force: true do |t|\r\n    t.string :name\r\n  end\r\n\r\n  create_table :post_authors, force: true do |t|\r\n    t.belongs_to :post\r\n    t.belongs_to :author\r\n  end\r\n\r\n  create_table :comments, force: true do |t|\r\n    t.belongs_to :post\r\n    t.belongs_to :author\r\n    t.string :text\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  has_many :post_authors\r\n  has_many :authors, through: :post_authors\r\n\r\n  has_many :comments\r\n  has_many :comment_authors, through: :comments, source: :author\r\nend\r\n\r\nclass PostAuthor < ActiveRecord::Base\r\n  belongs_to :post\r\n  belongs_to :author\r\nend\r\n\r\nclass Author < ActiveRecord::Base\r\n  has_many :post_authors\r\n  has_many :posts, through: :post_authors\r\n  has_many :comments\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\n  belongs_to :post\r\n  belongs_to :author\r\nend\r\n\r\n# test\r\n\r\nclass BugTest < Minitest::Test\r\n  def setup\r\n    Author.delete_all\r\n    Post.delete_all\r\n\r\n    author_1 = Author.create!(name: \"Author 1\")\r\n    author_2 = Author.create!(name: \"Author 2\")\r\n\r\n    post = author_1.posts.create!(title: \"Post 1\")\r\n    post.comments.create! text: \"Comment 1\", author: author_2\r\n    post.comments.create! text: \"Reply\", author: author_1\r\n\r\n    author_2.posts.create!(title: \"Post 2\")\r\n  end\r\n\r\n  # This test correctly picks up the `comment_authors` alias\r\n  #\r\n  # SELECT \"posts\".* FROM \"posts\"\r\n  # INNER JOIN \"post_authors\" ON \"post_authors\".\"post_id\" = \"posts\".\"id\"\r\n  # INNER JOIN \"authors\" ON \"authors\".\"id\" = \"post_authors\".\"author_id\"\r\n  # INNER JOIN \"comments\" ON \"comments\".\"post_id\" = \"posts\".\"id\"\r\n  # INNER JOIN \"authors\" \"comment_authors\" ON \"comment_authors\".\"id\" = \"comments\".\"author_id\"\r\n  # WHERE \"comment_authors\".\"name\" = 'Author 2'\r\n  def test_where_with_select_hash\r\n    posts = Post.joins(:authors, :comment_authors).where(comment_authors: { name: \"Author 2\" })\r\n\r\n    assert_equal 1, posts.count\r\n    assert_equal \"Post 1\", posts.take.title\r\n  end\r\n\r\n  # This test fails because the `comment_authors` alias is not picked up, instead\r\n  # We would need to know that Rails has generated a different alias: `comment_authors_posts`\r\n  #\r\n  # PG::UndefinedTable: ERROR:  missing FROM-clause entry for table \"comment_authors\"\r\n  def test_select_with_hash\r\n    posts = Post.joins(:authors, :comment_authors).select(comment_authors: { name: :commentor_name })\r\n\r\n    assert_equal [\"Author 1\", \"Author 2\"], posts.map(&:commentor_name).sort\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\n\r\n`ActiveRecord::QueryMethods#select` should be able to determine the alias for `comment_authors` like `where` does.\r\n\r\n### Actual behavior\r\n\r\n`ActiveRecord::QueryMethods#select` raises an error because the alias table does not match the one that Rails generates\r\n\r\n### System configuration\r\n**Rails version**: `main` from GitHub, currently https://github.com/rails/rails/commit/35a614c227620a62d7a2a242e375a43e7e2affc5\r\n\r\n**Ruby version**: ruby 3.1.2p20 (2022-04-12 revision 4491bb740a) [arm64-darwin21]\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48862/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48862/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48861", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48861/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48861/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48861/events", "html_url": "https://github.com/rails/rails/pull/48861", "id": 1830367151, "node_id": "PR_kwDNIULOVty9ZQ", "number": 48861, "title": "Fixes #47909 when using order or unscope", "user": {"login": "paulreece", "id": 96156234, "node_id": "U_kgDOBbs6Sg", "avatar_url": "https://avatars.githubusercontent.com/u/96156234?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paulreece", "html_url": "https://github.com/paulreece", "followers_url": "https://api.github.com/users/paulreece/followers", "following_url": "https://api.github.com/users/paulreece/following{/other_user}", "gists_url": "https://api.github.com/users/paulreece/gists{/gist_id}", "starred_url": "https://api.github.com/users/paulreece/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paulreece/subscriptions", "organizations_url": "https://api.github.com/users/paulreece/orgs", "repos_url": "https://api.github.com/users/paulreece/repos", "events_url": "https://api.github.com/users/paulreece/events{/privacy}", "received_events_url": "https://api.github.com/users/paulreece/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-08-01T02:51:35Z", "updated_at": "2023-08-04T13:57:15Z", "closed_at": "2023-08-03T15:26:37Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48861", "html_url": "https://github.com/rails/rails/pull/48861", "diff_url": "https://github.com/rails/rails/pull/48861.diff", "patch_url": "https://github.com/rails/rails/pull/48861.patch", "merged_at": "2023-08-03T15:26:37Z"}, "body": "This fix corrects the logic in both the associated and missing methods. If the reflection.options hash has a key/value pair for :class_name it will use the association. This fixes [48651](https://github.com/rails/rails/issues/48651) which was not returning the correct value when using an enum association and querying for a record that had one key of the enum but was missing another. This also fixes [44964](https://github.com/rails/rails/issues/44964) where ActiveRecord was not properly aliasing self-referencing relations. If the reflection.options doesn\u2019t contain the key/value pair then it will use the reflection.table_name. This fixes  [47909](https://github.com/rails/rails/issues/47909) in which a user was trying to find records that were either missing a relation or were missing a relation that was ordered or unscoped or were missing a relation that was using extends in the query which resulted in an ActiveRecord Exception. It also allows for using extends in any of these capacities.\r\n\r\n\r\n* [ X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48861/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48861/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48860", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48860/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48860/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48860/events", "html_url": "https://github.com/rails/rails/pull/48860", "id": 1829363359, "node_id": "PR_kwDNIULOVs8C3A", "number": 48860, "title": "Fixed few typos in tests and guide", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-31T14:47:55Z", "updated_at": "2023-08-02T02:36:21Z", "closed_at": "2023-08-01T19:23:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48860", "html_url": "https://github.com/rails/rails/pull/48860", "diff_url": "https://github.com/rails/rails/pull/48860.diff", "patch_url": "https://github.com/rails/rails/pull/48860.patch", "merged_at": "2023-08-01T19:23:50Z"}, "body": "### Detail\r\n\r\nThis PR contains the fix for a few typos in the test and guides.\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48860/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48860/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48859", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48859/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48859/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48859/events", "html_url": "https://github.com/rails/rails/pull/48859", "id": 1829242798, "node_id": "PR_kwDNIULOVs1cAA", "number": 48859, "title": "[skip ci] Removed the repetition text", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1180817762, "node_id": "MDU6TGFiZWwxMTgwODE3NzYy", "url": "https://api.github.com/repos/rails/rails/labels/actiontext", "name": "actiontext", "color": "3bc667", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-31T13:52:36Z", "updated_at": "2023-08-01T01:58:58Z", "closed_at": "2023-07-31T23:17:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48859", "html_url": "https://github.com/rails/rails/pull/48859", "diff_url": "https://github.com/rails/rails/pull/48859.diff", "patch_url": "https://github.com/rails/rails/pull/48859.patch", "merged_at": null}, "body": "### Detail\r\n\r\nRemoves the repetition of \"the\" in trix.js\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48859/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48859/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48858", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48858/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48858/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48858/events", "html_url": "https://github.com/rails/rails/issues/48858", "id": 1829173380, "node_id": "I_kwDNIULObQb4hA", "number": 48858, "title": "ActiveSupport JSON.encode in API mode spends most time in String.gsub!", "user": {"login": "fanktom", "id": 189038, "node_id": "MDQ6VXNlcjE4OTAzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/189038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fanktom", "html_url": "https://github.com/fanktom", "followers_url": "https://api.github.com/users/fanktom/followers", "following_url": "https://api.github.com/users/fanktom/following{/other_user}", "gists_url": "https://api.github.com/users/fanktom/gists{/gist_id}", "starred_url": "https://api.github.com/users/fanktom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fanktom/subscriptions", "organizations_url": "https://api.github.com/users/fanktom/orgs", "repos_url": "https://api.github.com/users/fanktom/repos", "events_url": "https://api.github.com/users/fanktom/events{/privacy}", "received_events_url": "https://api.github.com/users/fanktom/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2023-07-31T13:17:35Z", "updated_at": "2023-08-02T06:48:34Z", "closed_at": "2023-08-02T06:48:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\nIn our codebase, we have a `Datable` concern, which allows to store JSON serialized chunks of data via `serialize :data, JSON`. The concern also adds further checks, we should not be relevant here. The data to be stored can be quite big, such as 20 MB in occasions.\r\n\r\nAs the performance in production was slower as expected, we ran some benchmarks and compared two versions:\r\n\r\n**A**: Version that uses `ActiveSupport::JSON.encode`:\r\n```ruby\r\nmodule Automation::Datable\r\n  extend ActiveSupport::Concern\r\n\r\n  included do\r\n    serialize :data, JSON\r\n  end\r\n\r\n  # more stuff ...\r\nend\r\n```\r\n\r\n**B**: Version that uses only Ruby `JSON.dump`:\r\n```ruby\r\nmodule Automation::Datable\r\n  extend ActiveSupport::Concern\r\n\r\n  class PlainJSON\r\n    def self.load(string)\r\n      JSON.load(string)\r\n    end\r\n\r\n    def self.dump(value)\r\n      JSON.dump(value)\r\n    end\r\n  end\r\n\r\n  included do\r\n    serialize :data, PlainJSON\r\n  end\r\n\r\n  # more stuff ...\r\nend\r\n```\r\n\r\n### Expected behavior\r\nFrom the encoder source code:https://github.com/rails/rails/blob/b18b9df65eb7d4e5dfa9a6982a8709c0c94b0b97/activesupport/lib/active_support/json/encoding.rb#L21\r\nwe know that ActiveSupport is doing some extra work, e.g. converting Ruby objects into JSON dumpable structures and escaping some strings. So we expect it to be a bit slower, and the Ruby only version to be a bit faster.\r\n\r\n### Actual behavior\r\nWe created multiple test cases and measured them using pprof and then converted them into Flamegraphs with similar relationships of results: **A** was much slowet then **B**, and most time was spend string replacing the patterns as defined in \r\nhttps://github.com/rails/rails/blob/b18b9df65eb7d4e5dfa9a6982a8709c0c94b0b97/activesupport/lib/active_support/json/encoding.rb#L38-L65\r\n\r\n**A**: Our test took 1m20s:\r\n\r\n<img width=\"1139\" alt=\"Screenshot 2023-07-31 at 14 45 37\" src=\"https://github.com/rails/rails/assets/189038/1b67261d-0951-48cb-aaca-3f0dd3bd8930\">\r\n\r\nOver 30% of the time was spend in `String.gsub!`.\r\n\r\n**B**: Our test took 18s:\r\n\r\n![plain_json](https://github.com/rails/rails/assets/189038/18fc3374-017c-4239-bab1-10811fa1094b)\r\n\r\nWe can clearly see that most time is spent in escaping the special chars from the strings, which of course takes longer with bigger strings (we measured a roughly linear relationship between time and string size, before we ran out of memory).\r\n\r\n### Final question\r\nWe use Rails purely in API mode and would never render the encoded strings to HTML, but parse them through JavaScript on the frontend. Also, we have a dedicated serializer mechanism, which converts \"complex\" ruby objects to JSON dumpable structures (Arrays, Hashes, ...).\r\n\r\n- Do we understand it correctly, that the escaping is purely to ensure JSON strings can be rendered straight to HTML?\r\n- Is there any way to disable the ActiveSupport encoding HTML escape? Basically skipping the `EscapedString` class? We don't see one, except monkey patching ActiveSupport, if we want to skip the String escape everywhere.\r\n- Would it make sense to implement a \"faster\" JSON serialization in API mode by default? E.g. `config.active_support.encoding.api_mode = true` or enable it by default with `api_mode`\r\n\r\nWe would be happy to contribute and have this upstream.\r\n\r\nThanks a lot for your insights and help!\r\n\r\n### System configuration\r\n**Rails version**: 7.0.4.2\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48858/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48858/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48857", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48857/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48857/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48857/events", "html_url": "https://github.com/rails/rails/pull/48857", "id": 1829108222, "node_id": "PR_kwDNIULOVsuCpA", "number": 48857, "title": "Rename `fixture_file_upload` method to `file_fixture_upload`", "user": {"login": "seanpdoyle", "id": 2575027, "node_id": "MDQ6VXNlcjI1NzUwMjc=", "avatar_url": "https://avatars.githubusercontent.com/u/2575027?v=4", "gravatar_id": "", "url": "https://api.github.com/users/seanpdoyle", "html_url": "https://github.com/seanpdoyle", "followers_url": "https://api.github.com/users/seanpdoyle/followers", "following_url": "https://api.github.com/users/seanpdoyle/following{/other_user}", "gists_url": "https://api.github.com/users/seanpdoyle/gists{/gist_id}", "starred_url": "https://api.github.com/users/seanpdoyle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/seanpdoyle/subscriptions", "organizations_url": "https://api.github.com/users/seanpdoyle/orgs", "repos_url": "https://api.github.com/users/seanpdoyle/repos", "events_url": "https://api.github.com/users/seanpdoyle/events{/privacy}", "received_events_url": "https://api.github.com/users/seanpdoyle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-31T12:42:06Z", "updated_at": "2023-08-04T21:08:46Z", "closed_at": "2023-08-04T21:08:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48857", "html_url": "https://github.com/rails/rails/pull/48857", "diff_url": "https://github.com/rails/rails/pull/48857.diff", "patch_url": "https://github.com/rails/rails/pull/48857.patch", "merged_at": "2023-08-04T21:08:41Z"}, "body": "### Motivation / Background\r\n\r\nThe naming difference between the test harness' [file_fixture][] helper made available through Active Support (along with the `file_fixture_path` configuration value) and the integration test harness' [fixture_file_upload][] is a constant source of confusion and surprise.\r\n\r\n### Detail\r\n\r\nSince Active Support is more ubiquitous, this commit renames the `fixture_file_upload` method to `file_fixture_upload` to match the order of words in `file_fixture` and `file_fixture_path`.\r\n\r\nTo preserve backwards compatibility, declare a `fixture_file_upload` alias to be preserved into the future (or removed at a future point in time).\r\n\r\n[file_fixture]: https://edgeapi.rubyonrails.org/classes/ActiveSupport/Testing/FileFixtures.html#method-i-file_fixture\r\n[fixture_file_upload]: https://edgeapi.rubyonrails.org/classes/ActionDispatch/TestProcess/FixtureFile.html#method-i-fixture_file_upload\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48857/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48857/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48856", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48856/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48856/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48856/events", "html_url": "https://github.com/rails/rails/pull/48856", "id": 1829088465, "node_id": "PR_kwDNIULOVss9wA", "number": 48856, "title": "Draft | [Fix #44792] Fix chaining class method scopes leaking into querying methods", "user": {"login": "joshuay03", "id": 54629302, "node_id": "MDQ6VXNlcjU0NjI5MzAy", "avatar_url": "https://avatars.githubusercontent.com/u/54629302?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshuay03", "html_url": "https://github.com/joshuay03", "followers_url": "https://api.github.com/users/joshuay03/followers", "following_url": "https://api.github.com/users/joshuay03/following{/other_user}", "gists_url": "https://api.github.com/users/joshuay03/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshuay03/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshuay03/subscriptions", "organizations_url": "https://api.github.com/users/joshuay03/orgs", "repos_url": "https://api.github.com/users/joshuay03/repos", "events_url": "https://api.github.com/users/joshuay03/events{/privacy}", "received_events_url": "https://api.github.com/users/joshuay03/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-31T12:30:34Z", "updated_at": "2023-08-04T02:28:11Z", "closed_at": "2023-08-04T02:28:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48856", "html_url": "https://github.com/rails/rails/pull/48856", "diff_url": "https://github.com/rails/rails/pull/48856.diff", "patch_url": "https://github.com/rails/rails/pull/48856.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created to fix https://github.com/rails/rails/issues/44792.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes ...\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48856/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48856/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48855", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48855/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48855/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48855/events", "html_url": "https://github.com/rails/rails/pull/48855", "id": 1828618631, "node_id": "PR_kwDNIULOVsTO6Q", "number": 48855, "title": "Add Rack::Lint to DebugExceptions missing test", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-31T07:54:59Z", "updated_at": "2023-08-02T21:52:24Z", "closed_at": "2023-08-01T17:38:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48855", "html_url": "https://github.com/rails/rails/pull/48855", "diff_url": "https://github.com/rails/rails/pull/48855.diff", "patch_url": "https://github.com/rails/rails/pull/48855.patch", "merged_at": "2023-08-01T17:38:33Z"}, "body": "### Motivation / Background\r\n\r\n#48837 missed adding Rack::Lint spec to one of the tests in DebugExceptionsTest.\r\n\r\n### Detail\r\n\r\nThis PR adds the Rack::Lint spec for one of tests that was missed in #48837 \r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48855/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48855/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48854", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48854/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48854/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48854/events", "html_url": "https://github.com/rails/rails/pull/48854", "id": 1828434365, "node_id": "PR_kwDNIULOVsJQkQ", "number": 48854, "title": "Update \"work in progress\" status on guides", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-31T05:27:44Z", "updated_at": "2023-08-02T17:48:19Z", "closed_at": "2023-08-01T23:09:14Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48854", "html_url": "https://github.com/rails/rails/pull/48854", "diff_url": "https://github.com/rails/rails/pull/48854.diff", "patch_url": "https://github.com/rails/rails/pull/48854.patch", "merged_at": null}, "body": "If you scroll through https://edgeguides.rubyonrails.org/ currently, you'd get the impression that *lots* of guides are still in progress. This isn't accurate. Most of the guides marked \"in progress\" are thorough, and don't seem to be under active development right now.\r\n\r\nThis PR makes a few changes:\r\n\r\n- Removes \"in progress\" warning from every guide except two: the 7.1 release notes, and \"Action View Helpers\", since this is [marked as in progress](https://edgeguides.rubyonrails.org/action_view_helpers.html) in the guide.\r\n- Removes Webpacker from the guides index. Now that Webpacker is deprecated it should not be referenced from the guides homepage. The guide itself is not deleted.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48854/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48854/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48853", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48853/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48853/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48853/events", "html_url": "https://github.com/rails/rails/pull/48853", "id": 1828282991, "node_id": "PR_kwDNIULOVsA4fw", "number": 48853, "title": "[Fix #48841] Skip after destroy callbacks on non-persisted records", "user": {"login": "joshuay03", "id": 54629302, "node_id": "MDQ6VXNlcjU0NjI5MzAy", "avatar_url": "https://avatars.githubusercontent.com/u/54629302?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshuay03", "html_url": "https://github.com/joshuay03", "followers_url": "https://api.github.com/users/joshuay03/followers", "following_url": "https://api.github.com/users/joshuay03/following{/other_user}", "gists_url": "https://api.github.com/users/joshuay03/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshuay03/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshuay03/subscriptions", "organizations_url": "https://api.github.com/users/joshuay03/orgs", "repos_url": "https://api.github.com/users/joshuay03/repos", "events_url": "https://api.github.com/users/joshuay03/events{/privacy}", "received_events_url": "https://api.github.com/users/joshuay03/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-31T02:49:00Z", "updated_at": "2023-08-02T20:06:16Z", "closed_at": "2023-08-02T20:06:16Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48853", "html_url": "https://github.com/rails/rails/pull/48853", "diff_url": "https://github.com/rails/rails/pull/48853.diff", "patch_url": "https://github.com/rails/rails/pull/48853.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created to fix https://github.com/rails/rails/issues/48841.\r\n\r\n### Detail\r\n\r\nThis Pull Request updates `#destroy` to only run `before` and `around` destroy callbacks when destroying a non-persisted record.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\nNone.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48853/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48853/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48852", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48852/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48852/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48852/events", "html_url": "https://github.com/rails/rails/pull/48852", "id": 1827908919, "node_id": "PR_kwDNIULOVrteUA", "number": 48852, "title": "Allow escaping of literal colons in `ActionRecord::Sanitization#replace_named_bind_variables`", "user": {"login": "f3ndot", "id": 740289, "node_id": "MDQ6VXNlcjc0MDI4OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/740289?v=4", "gravatar_id": "", "url": "https://api.github.com/users/f3ndot", "html_url": "https://github.com/f3ndot", "followers_url": "https://api.github.com/users/f3ndot/followers", "following_url": "https://api.github.com/users/f3ndot/following{/other_user}", "gists_url": "https://api.github.com/users/f3ndot/gists{/gist_id}", "starred_url": "https://api.github.com/users/f3ndot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/f3ndot/subscriptions", "organizations_url": "https://api.github.com/users/f3ndot/orgs", "repos_url": "https://api.github.com/users/f3ndot/repos", "events_url": "https://api.github.com/users/f3ndot/events{/privacy}", "received_events_url": "https://api.github.com/users/f3ndot/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-30T11:58:24Z", "updated_at": "2023-08-01T16:15:32Z", "closed_at": "2023-08-01T14:38:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48852", "html_url": "https://github.com/rails/rails/pull/48852", "diff_url": "https://github.com/rails/rails/pull/48852.diff", "patch_url": "https://github.com/rails/rails/pull/48852.patch", "merged_at": "2023-08-01T14:38:04Z"}, "body": "**[ This PR replaces #37797 which atrophied over the years. ]**\r\n\r\nFixes https://github.com/rails/rails/issues/37779.\r\n\r\nThis PR simply allows the ability to escape literal colons in SQL when using named bind params. See the above issue for a detailed description of the problem.\r\n\r\n\r\n\r\n<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48852/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48852/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48851", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48851/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48851/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48851/events", "html_url": "https://github.com/rails/rails/pull/48851", "id": 1827798918, "node_id": "PR_kwDNIULOVroOqQ", "number": 48851, "title": "Update `listen` gem version in guide [skip ci]", "user": {"login": "soartec-lab", "id": 18366969, "node_id": "MDQ6VXNlcjE4MzY2OTY5", "avatar_url": "https://avatars.githubusercontent.com/u/18366969?v=4", "gravatar_id": "", "url": "https://api.github.com/users/soartec-lab", "html_url": "https://github.com/soartec-lab", "followers_url": "https://api.github.com/users/soartec-lab/followers", "following_url": "https://api.github.com/users/soartec-lab/following{/other_user}", "gists_url": "https://api.github.com/users/soartec-lab/gists{/gist_id}", "starred_url": "https://api.github.com/users/soartec-lab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/soartec-lab/subscriptions", "organizations_url": "https://api.github.com/users/soartec-lab/orgs", "repos_url": "https://api.github.com/users/soartec-lab/repos", "events_url": "https://api.github.com/users/soartec-lab/events{/privacy}", "received_events_url": "https://api.github.com/users/soartec-lab/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-30T04:21:50Z", "updated_at": "2023-07-30T18:31:34Z", "closed_at": "2023-07-30T18:31:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48851", "html_url": "https://github.com/rails/rails/pull/48851", "diff_url": "https://github.com/rails/rails/pull/48851.diff", "patch_url": "https://github.com/rails/rails/pull/48851.patch", "merged_at": "2023-07-30T18:31:34Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because the documentation specifies 3.3 as the minimum version of the `listen` gem, but according to [this PR](https://github.com/rails/rails/pull/48622), modern `rails` requires the `listen` gem to be version 3.5 or higher.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the version of `listen` gem described in the document to 3.5\r\n\r\n### Additional information\r\n\r\nReferred PR: https://github.com/rails/rails/pull/48622\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48851/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48851/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48850", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48850/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48850/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48850/events", "html_url": "https://github.com/rails/rails/pull/48850", "id": 1827725054, "node_id": "PR_kwDNIULOVrkdog", "number": 48850, "title": "Add test covering SchemaCache members are sorted", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-29T23:41:25Z", "updated_at": "2023-07-30T21:35:06Z", "closed_at": "2023-07-30T16:17:27Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48850", "html_url": "https://github.com/rails/rails/pull/48850", "diff_url": "https://github.com/rails/rails/pull/48850.diff", "patch_url": "https://github.com/rails/rails/pull/48850.patch", "merged_at": "2023-07-30T16:17:27Z"}, "body": "Follow up to #48824\r\n\r\n/cc @byroot ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48850/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48850/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48849", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48849/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48849/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48849/events", "html_url": "https://github.com/rails/rails/pull/48849", "id": 1827476822, "node_id": "PR_kwDNIULOVrXWxQ", "number": 48849, "title": "[Fix #43638] Fix fixtures for namespaced models", "user": {"login": "macuk", "id": 56448, "node_id": "MDQ6VXNlcjU2NDQ4", "avatar_url": "https://avatars.githubusercontent.com/u/56448?v=4", "gravatar_id": "", "url": "https://api.github.com/users/macuk", "html_url": "https://github.com/macuk", "followers_url": "https://api.github.com/users/macuk/followers", "following_url": "https://api.github.com/users/macuk/following{/other_user}", "gists_url": "https://api.github.com/users/macuk/gists{/gist_id}", "starred_url": "https://api.github.com/users/macuk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/macuk/subscriptions", "organizations_url": "https://api.github.com/users/macuk/orgs", "repos_url": "https://api.github.com/users/macuk/repos", "events_url": "https://api.github.com/users/macuk/events{/privacy}", "received_events_url": "https://api.github.com/users/macuk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-29T13:21:06Z", "updated_at": "2023-07-29T13:26:16Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48849", "html_url": "https://github.com/rails/rails/pull/48849", "diff_url": "https://github.com/rails/rails/pull/48849.diff", "patch_url": "https://github.com/rails/rails/pull/48849.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created to fix https://github.com/rails/rails/issues/43638\r\n\r\n### Detail\r\n\r\nWhen a new namespaced model is generated and the namespace is equal to the existing model, the generated tests fail because, in such case, fixtures are generated and loaded incorrectly.\r\n\r\nThere is a possibility to place model fixtures in subdirectories, so for `Customer` model, we can place fixtures in `test/fixtures/customers.yml` and `test/fixtures/customers/*.yml`. This is a problem when there is a namespaced model, for example `Customers::Categories` because the default fixture is placed in `test/fixtures/customers/categories.yml` and is loaded incorrectly.\r\n\r\nThis change adds `model_class` to fixtures generated for namespaced models and skips loading namespaced fixtures while a model class mismatch is detected.\r\n\r\n<!-- ### Additional information -->\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48849/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48849/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48848", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48848/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48848/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48848/events", "html_url": "https://github.com/rails/rails/issues/48848", "id": 1827440074, "node_id": "I_kwDNIULObOyFyg", "number": 48848, "title": "ActiveRecord: relation.count != relation.to_a.count", "user": {"login": "eadz", "id": 11939, "node_id": "MDQ6VXNlcjExOTM5", "avatar_url": "https://avatars.githubusercontent.com/u/11939?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eadz", "html_url": "https://github.com/eadz", "followers_url": "https://api.github.com/users/eadz/followers", "following_url": "https://api.github.com/users/eadz/following{/other_user}", "gists_url": "https://api.github.com/users/eadz/gists{/gist_id}", "starred_url": "https://api.github.com/users/eadz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eadz/subscriptions", "organizations_url": "https://api.github.com/users/eadz/orgs", "repos_url": "https://api.github.com/users/eadz/repos", "events_url": "https://api.github.com/users/eadz/events{/privacy}", "received_events_url": "https://api.github.com/users/eadz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-07-29T10:50:51Z", "updated_at": "2023-07-29T12:12:42Z", "closed_at": "2023-07-29T11:45:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activerecord\", \"~> 7.0.0\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n    t.string \"name\"\r\n  end\r\n\r\n  create_table :comments, force: true do |t|\r\n    t.integer \"post_id\"\r\n    t.string \"author\"\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  has_many :comments\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\n  belongs_to :post\r\nend\r\n\r\n\r\nclass BugTest < Minitest::Test\r\n  def setup\r\n    Post.create! do |p|\r\n      p.name = \"first post\"\r\n      p.comments.build(author: \"bar\")\r\n      p.comments.build(author: \"baz\")\r\n    end\r\n\r\n    Post.create! do |p|\r\n      p.name = \"second post\"\r\n      p.comments.build(author: \"bar\")\r\n      p.comments.build(author: \"baz\")\r\n    end\r\n  end\r\n\r\n  def test_test_setup\r\n    assert_equal 2, Post.count\r\n    assert_equal 4, Comment.count\r\n  end\r\n\r\n  def test_unscoped_bug\r\n    scoped_posts = Post.includes(:comments).where(comments: { author: \"bar\" })\r\n\r\n    scoped_posts.each do |post|\r\n      assert_equal post.comments.to_a.count, post.comments.count\r\n    end\r\n  end\r\nend\r\n```\r\n\r\n### Expected behaviour\r\n\r\n`post.comments.to_a.count` should equal `post.comments.count`\r\n\r\n### Actual behavior\r\n\r\n`post.comments.to_a.count` is not equal to `post.comments.count`\r\n\r\n### System configuration\r\n**Rails version**: main branch\r\n\r\n**Ruby version**: 3.22\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48848/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48848/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48847", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48847/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48847/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48847/events", "html_url": "https://github.com/rails/rails/pull/48847", "id": 1827438415, "node_id": "PR_kwDNIULOVrVjUA", "number": 48847, "title": "Omit `webdrivers` gem from `Gemfile` template", "user": {"login": "seanpdoyle", "id": 2575027, "node_id": "MDQ6VXNlcjI1NzUwMjc=", "avatar_url": "https://avatars.githubusercontent.com/u/2575027?v=4", "gravatar_id": "", "url": "https://api.github.com/users/seanpdoyle", "html_url": "https://github.com/seanpdoyle", "followers_url": "https://api.github.com/users/seanpdoyle/followers", "following_url": "https://api.github.com/users/seanpdoyle/following{/other_user}", "gists_url": "https://api.github.com/users/seanpdoyle/gists{/gist_id}", "starred_url": "https://api.github.com/users/seanpdoyle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/seanpdoyle/subscriptions", "organizations_url": "https://api.github.com/users/seanpdoyle/orgs", "repos_url": "https://api.github.com/users/seanpdoyle/repos", "events_url": "https://api.github.com/users/seanpdoyle/events{/privacy}", "received_events_url": "https://api.github.com/users/seanpdoyle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2023-07-29T10:43:40Z", "updated_at": "2023-08-02T18:00:05Z", "closed_at": "2023-08-02T17:49:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48847", "html_url": "https://github.com/rails/rails/pull/48847", "diff_url": "https://github.com/rails/rails/pull/48847.diff", "patch_url": "https://github.com/rails/rails/pull/48847.patch", "merged_at": "2023-08-02T17:49:29Z"}, "body": "### Motivation / Background\r\n\r\nAs of Selenium 4.6, [the Selenium Manager is capable of managing Chrome Driver installations and integrations][readme]. As of Selenium 4.11, the\r\nSelenium Manager is capable of [capable of resolving the Chrome for\r\nTesting installation][] path.\r\n\r\n\r\n### Detail\r\n\r\nBy omitting the `gem` declaration from the `Gemfile.tt`, newly generated applications and applications updating their `Gemfile` in lockstep with newer Rails versions can shed the dependency and avoid test failures introduced by newly released Chrome versions (like, for example, [titusfortner/webdrivers#247][]).\r\n\r\n[readme]: https://github.com/titusfortner/webdrivers/tree/43f8ac436cc4121c903c1c611dfe76088ef6cbab#update-selenium-manager\r\n[titusfortner/webdrivers#247]: https://github.com/titusfortner/webdrivers/issues/247\r\n[capable of resolving the Chrome for Testing installation]: https://github.com/rails/rails/pull/48847#issuecomment-1656756862\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48847/reactions", "total_count": 3, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 2, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48847/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48846", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48846/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48846/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48846/events", "html_url": "https://github.com/rails/rails/pull/48846", "id": 1827384919, "node_id": "PR_kwDNIULOVrSpOQ", "number": 48846, "title": "Add Rack::Lint to ActionDispatch::Reloader tests", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-29T08:52:41Z", "updated_at": "2023-08-02T18:35:51Z", "closed_at": "2023-07-30T18:35:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48846", "html_url": "https://github.com/rails/rails/pull/48846", "diff_url": "https://github.com/rails/rails/pull/48846.diff", "patch_url": "https://github.com/rails/rails/pull/48846.patch", "merged_at": "2023-07-30T18:35:03Z"}, "body": "### Motivation / Background\r\n\r\nThis adds test coverage to ActionDispatch::Reloader to validate that its behavior conforms to Rack SPEC.\r\n\r\n\r\n### Detail\r\n\r\nThis adds additional test coverage to ActionDispatch::Loader to validate that its input and output follow the Rack SPEC.\r\n\r\nThis also removes some tests that were asserting the body object passed to ActionDispatch::Loader and not the Rack SPEC. See also https://github.com/rack/rack/issues/2100.\r\nref: https://github.com/rails/rails/pull/48825/files#r1275947386\r\n\r\n### Additional information\r\n\r\nhttps://github.com/skipkayhil/tmp-rails/issues/1\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n\r\ncc: @nunosilva800 @skipkayhil \r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48846/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48846/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48845", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48845/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48845/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48845/events", "html_url": "https://github.com/rails/rails/pull/48845", "id": 1827016596, "node_id": "PR_kwDNIULOVq_FZQ", "number": 48845, "title": "Use Rack-compatible casing for x-cascade headers in router", "user": {"login": "adrianna-chang-shopify", "id": 22918438, "node_id": "MDQ6VXNlcjIyOTE4NDM4", "avatar_url": "https://avatars.githubusercontent.com/u/22918438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adrianna-chang-shopify", "html_url": "https://github.com/adrianna-chang-shopify", "followers_url": "https://api.github.com/users/adrianna-chang-shopify/followers", "following_url": "https://api.github.com/users/adrianna-chang-shopify/following{/other_user}", "gists_url": "https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}", "starred_url": "https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adrianna-chang-shopify/subscriptions", "organizations_url": "https://api.github.com/users/adrianna-chang-shopify/orgs", "repos_url": "https://api.github.com/users/adrianna-chang-shopify/repos", "events_url": "https://api.github.com/users/adrianna-chang-shopify/events{/privacy}", "received_events_url": "https://api.github.com/users/adrianna-chang-shopify/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-28T19:53:00Z", "updated_at": "2023-08-02T18:35:51Z", "closed_at": "2023-07-28T20:40:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48845", "html_url": "https://github.com/rails/rails/pull/48845", "diff_url": "https://github.com/rails/rails/pull/48845.diff", "patch_url": "https://github.com/rails/rails/pull/48845.patch", "merged_at": "2023-07-28T20:40:34Z"}, "body": "### Motivation / Background\r\n\r\nThis PR changes the routing + exceptions middleware to use the expected casing for the x-cascade header: in Rack 2, this is mixed-case, and in Rack 3, this is lower case.\r\n\r\nThis also fixes https://github.com/rails/rails/issues/47096, and reimplements the changes [from this PR](https://github.com/rails/rails/pull/47108).\r\n\r\n### Detail\r\n\r\nMore details on taking a conditional constants approach [here](https://github.com/skipkayhil/tmp-rails/issues/1) (as opposed to wrapping the response in `Rack::Response` to allow case-insensitive header access).\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48845/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48845/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48844", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48844/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48844/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48844/events", "html_url": "https://github.com/rails/rails/pull/48844", "id": 1826990552, "node_id": "PR_kwDNIULOVq9qDQ", "number": 48844, "title": "Use `call_args` in the `define_proxy_method` namespace.", "user": {"login": "nvasilevski", "id": 5512772, "node_id": "MDQ6VXNlcjU1MTI3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/5512772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nvasilevski", "html_url": "https://github.com/nvasilevski", "followers_url": "https://api.github.com/users/nvasilevski/followers", "following_url": "https://api.github.com/users/nvasilevski/following{/other_user}", "gists_url": "https://api.github.com/users/nvasilevski/gists{/gist_id}", "starred_url": "https://api.github.com/users/nvasilevski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nvasilevski/subscriptions", "organizations_url": "https://api.github.com/users/nvasilevski/orgs", "repos_url": "https://api.github.com/users/nvasilevski/repos", "events_url": "https://api.github.com/users/nvasilevski/events{/privacy}", "received_events_url": "https://api.github.com/users/nvasilevski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-28T19:29:48Z", "updated_at": "2023-07-31T13:11:48Z", "closed_at": "2023-07-31T13:11:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48844", "html_url": "https://github.com/rails/rails/pull/48844", "diff_url": "https://github.com/rails/rails/pull/48844.diff", "patch_url": "https://github.com/rails/rails/pull/48844.patch", "merged_at": "2023-07-31T13:11:47Z"}, "body": "Substitutes https://github.com/rails/rails/pull/48843\r\n\r\n`define_proxy_call` accepts `call_args` as an argument which impacts method body generation but it doesn't use `call_args` in the `namespace` generation which leads to the same cached method to be reused even if `call_args` differ.\r\n\r\nIt has never been an issue since `define_proxy_call` was only used to generate Active Record attribute methods and we were always passing the same `call_args` per method name.\r\n\r\nHowever, since https://github.com/rails/rails/pull/48533 we are using `define_proxy_call` to generate alias attribute methods where `call_args` differ for the same method name which leads to the same cached method being reused in wrong places.\r\n\r\nThis commit fixes the issue by making sure `call_args` are being considered when generating the `namespace` for the method as anything that results in a different body being generated should be accounted when building the cache key\r\n\r\n### Problem example\r\nConsider the following models:\r\n\r\n```ruby\r\nclass Message < ActiveRecord::Base\r\n  alias_attribute :subject, :header\r\nend\r\n\r\nclass Topic < ActiveRecord::Base\r\n  alias_attribute :subject, :title\r\nend\r\n```\r\n\r\nSince https://github.com/rails/rails/pull/48533 we expect Rails to generate the following getters for aliases:\r\n\r\n```ruby\r\nclass Message < ActiveRecord::Base\r\n  def subject\r\n     attribute(:header)\r\n  end\r\nend\r\n\r\nclass Topic < ActiveRecord::Base\r\n  def subject\r\n     attribute(:title)\r\n  end\r\nend\r\n```\r\n\r\nDue to Rails using caching mechanism for method generation and the cache key consists of the hardcoded `proxy_alias_attribute` plus the `proxy_target` which is `\"attribute\"`  only one `subject` getter method will actually be generated and it depends on whichever of the models gets loaded first, the other model will reuse the cached method with a wrong body", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48844/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48844/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48843", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48843/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48843/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48843/events", "html_url": "https://github.com/rails/rails/pull/48843", "id": 1826948365, "node_id": "PR_kwDNIULOVq7SJw", "number": 48843, "title": "Use `old_name` as part of the method cache namespace for `alias_attribute` methods generation", "user": {"login": "nvasilevski", "id": 5512772, "node_id": "MDQ6VXNlcjU1MTI3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/5512772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nvasilevski", "html_url": "https://github.com/nvasilevski", "followers_url": "https://api.github.com/users/nvasilevski/followers", "following_url": "https://api.github.com/users/nvasilevski/following{/other_user}", "gists_url": "https://api.github.com/users/nvasilevski/gists{/gist_id}", "starred_url": "https://api.github.com/users/nvasilevski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nvasilevski/subscriptions", "organizations_url": "https://api.github.com/users/nvasilevski/orgs", "repos_url": "https://api.github.com/users/nvasilevski/repos", "events_url": "https://api.github.com/users/nvasilevski/events{/privacy}", "received_events_url": "https://api.github.com/users/nvasilevski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-28T18:58:36Z", "updated_at": "2023-07-28T19:33:12Z", "closed_at": "2023-07-28T19:33:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48843", "html_url": "https://github.com/rails/rails/pull/48843", "diff_url": "https://github.com/rails/rails/pull/48843.diff", "patch_url": "https://github.com/rails/rails/pull/48843.patch", "merged_at": null}, "body": "`define_proxy_call` uses `namespace` argument to fetch the cache where the generated method will be stored. `alias_attribute` method generation has to be scoped per `old_name` since otherwise same alias names for different attributes will reuse the same method body and only one will be correct.\r\n\r\nTo elaborate on the problem, consider the following models:\r\n\r\n```ruby\r\nclass Message < ActiveRecord::Base\r\n  alias_attribute :subject, :header\r\nend\r\n\r\nclass Topic < ActiveRecord::Base\r\n  alias_attribute :subject, :title\r\nend\r\n```\r\n\r\nSince https://github.com/rails/rails/pull/48533 we expect Rails to generate the following getters for aliases:\r\n\r\n```ruby\r\nclass Message < ActiveRecord::Base\r\n  def subject\r\n     attribute(:header)\r\n  end\r\nend\r\n\r\nclass Topic < ActiveRecord::Base\r\n  def subject\r\n     attribute(:title)\r\n  end\r\nend\r\n```\r\n\r\nDue to Rails using caching mechanism for method generation and the cache key consists of the hardcoded `proxy_alias_attribute` plus the `proxy_target` which is `\"attribute\"`  only one `subject` getter method will actually be generated and it depends on whichever of the models gets loaded first, the other model will reuse the cached method with a wrong body\r\n\r\nIn order to fix that we are including the `old_name` in the method definition namespace to make sure that methods are taken from the cache when both `new_name` and `old_name` match the existing definition.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48843/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48843/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48842", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48842/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48842/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48842/events", "html_url": "https://github.com/rails/rails/pull/48842", "id": 1826912330, "node_id": "PR_kwDNIULOVq5O9g", "number": 48842, "title": "Add `Rack::Lint` to `ActionDispatch::ShowExceptions` tests", "user": {"login": "adrianna-chang-shopify", "id": 22918438, "node_id": "MDQ6VXNlcjIyOTE4NDM4", "avatar_url": "https://avatars.githubusercontent.com/u/22918438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adrianna-chang-shopify", "html_url": "https://github.com/adrianna-chang-shopify", "followers_url": "https://api.github.com/users/adrianna-chang-shopify/followers", "following_url": "https://api.github.com/users/adrianna-chang-shopify/following{/other_user}", "gists_url": "https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}", "starred_url": "https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adrianna-chang-shopify/subscriptions", "organizations_url": "https://api.github.com/users/adrianna-chang-shopify/orgs", "repos_url": "https://api.github.com/users/adrianna-chang-shopify/repos", "events_url": "https://api.github.com/users/adrianna-chang-shopify/events{/privacy}", "received_events_url": "https://api.github.com/users/adrianna-chang-shopify/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "guilleiguaran", "id": 160941, "node_id": "MDQ6VXNlcjE2MDk0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/160941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guilleiguaran", "html_url": "https://github.com/guilleiguaran", "followers_url": "https://api.github.com/users/guilleiguaran/followers", "following_url": "https://api.github.com/users/guilleiguaran/following{/other_user}", "gists_url": "https://api.github.com/users/guilleiguaran/gists{/gist_id}", "starred_url": "https://api.github.com/users/guilleiguaran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guilleiguaran/subscriptions", "organizations_url": "https://api.github.com/users/guilleiguaran/orgs", "repos_url": "https://api.github.com/users/guilleiguaran/repos", "events_url": "https://api.github.com/users/guilleiguaran/events{/privacy}", "received_events_url": "https://api.github.com/users/guilleiguaran/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "guilleiguaran", "id": 160941, "node_id": "MDQ6VXNlcjE2MDk0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/160941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guilleiguaran", "html_url": "https://github.com/guilleiguaran", "followers_url": "https://api.github.com/users/guilleiguaran/followers", "following_url": "https://api.github.com/users/guilleiguaran/following{/other_user}", "gists_url": "https://api.github.com/users/guilleiguaran/gists{/gist_id}", "starred_url": "https://api.github.com/users/guilleiguaran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guilleiguaran/subscriptions", "organizations_url": "https://api.github.com/users/guilleiguaran/orgs", "repos_url": "https://api.github.com/users/guilleiguaran/repos", "events_url": "https://api.github.com/users/guilleiguaran/events{/privacy}", "received_events_url": "https://api.github.com/users/guilleiguaran/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2023-07-28T18:37:09Z", "updated_at": "2023-08-16T20:03:21Z", "closed_at": "2023-08-01T16:08:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48842", "html_url": "https://github.com/rails/rails/pull/48842", "diff_url": "https://github.com/rails/rails/pull/48842.diff", "patch_url": "https://github.com/rails/rails/pull/48842.patch", "merged_at": "2023-08-01T16:08:21Z"}, "body": "### Motivation / Background\r\n\r\nThis wraps test coverage for `ActionDispatch::ShowExpections` in `Rack::Lint` middleware in order to validate that both `ActionDispatch::ShowExceptions` and `ActionDispatch::PublicExceptions` conform to the Rack SPEC.\r\n\r\nIt also ensures that the response headers returned by the *Exceptions middleware respect casing (mixed case for Rack 2, lower case for Rack 3).\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48842/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48842/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48841", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48841/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48841/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48841/events", "html_url": "https://github.com/rails/rails/issues/48841", "id": 1826860569, "node_id": "I_kwDNIULObOOuGQ", "number": 48841, "title": "`after_destroy` callback should not run on non `persisted?` records", "user": {"login": "smtlaissezfaire", "id": 3690, "node_id": "MDQ6VXNlcjM2OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smtlaissezfaire", "html_url": "https://github.com/smtlaissezfaire", "followers_url": "https://api.github.com/users/smtlaissezfaire/followers", "following_url": "https://api.github.com/users/smtlaissezfaire/following{/other_user}", "gists_url": "https://api.github.com/users/smtlaissezfaire/gists{/gist_id}", "starred_url": "https://api.github.com/users/smtlaissezfaire/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smtlaissezfaire/subscriptions", "organizations_url": "https://api.github.com/users/smtlaissezfaire/orgs", "repos_url": "https://api.github.com/users/smtlaissezfaire/repos", "events_url": "https://api.github.com/users/smtlaissezfaire/events{/privacy}", "received_events_url": "https://api.github.com/users/smtlaissezfaire/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2023-07-28T18:08:02Z", "updated_at": "2023-08-05T05:45:58Z", "closed_at": "2023-08-02T15:15:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\nNon persisted objects should not run callbacks (especially `after_destroy`) after calling `destroy` or `destroy!`\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n\r\nExample with test case:\r\nhttps://gist.github.com/smtlaissezfaire/262f05a54b4c568dc1310f3b52006d61\r\n\r\n```\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\n\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :users, force: true do |t|; end\r\nend\r\n\r\nclass User < ActiveRecord::Base\r\n  class CallbackRanError < StandardError; end\r\n\r\n  after_destroy :raise_an_error\r\n\r\n  def raise_an_error\r\n    raise CallbackRanError\r\n  end\r\nend\r\n\r\nrequire \"minitest/autorun\"\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_non_persisted_destroy_should_not_run_callbacks\r\n    # an persisted? user should run after destroy callbacks\r\n    persisted_user = User.create!\r\n    assert_raises(User::CallbackRanError) { persisted_user.destroy! }\r\n\r\n    # a non persisted user should NOT run callbacks\r\n    non_persisted_user = User.new\r\n    assert_nothing_raised { non_persisted_user.destroy! }\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\n\r\nIt should not run the callbacks.\r\n\r\n### Actual behavior\r\n\r\nIt does run the callbacks.\r\n\r\nWithout this, all callbacks that might touch other objects have to check persisted? (and might also have to check valid?) which seems to violate the principle of least surprise.\r\n\r\n### System configuration\r\n**Rails version**: \r\n\r\n```\r\n>> Rails::VERSION::STRING\r\n=> \"7.0.6\"\r\n```\r\n\r\nalthough same seems to be present in 7.x, 6.x and 5.x series\r\n\r\n**Ruby version**:\r\n\r\n```\r\n>> RUBY_VERSION\r\n=> \"3.1.2\"\r\n```\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48841/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48841/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48840", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48840/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48840/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48840/events", "html_url": "https://github.com/rails/rails/pull/48840", "id": 1826789211, "node_id": "PR_kwDNIULOVqyaKA", "number": 48840, "title": "Removed unnecessary --no-skip-* app generator test", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-28T17:20:01Z", "updated_at": "2023-07-28T18:04:45Z", "closed_at": "2023-07-28T17:38:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48840", "html_url": "https://github.com/rails/rails/pull/48840", "diff_url": "https://github.com/rails/rails/pull/48840.diff", "patch_url": "https://github.com/rails/rails/pull/48840.patch", "merged_at": "2023-07-28T17:38:30Z"}, "body": "### Motivation / Background\r\n\r\nAs per the discussion in #48822, we are currently having some unnecessary tests for --no-skip-* arguments in app generator tests. Since the --no-* behavior is [implemented](https://github.com/rails/thor/blob/5fb6206a6d2d7bfb40bcb851c2e118ba39f69757/lib/thor/parser/options.rb#L253) and [tested](https://github.com/rails/thor/blob/5fb6206a6d2d7bfb40bcb851c2e118ba39f69757/spec/parser/options_spec.rb#L399-L401) by Thor. Based on build time AppGeneratorTest is [one of the longest-running tests](https://buildkite.com/rails/rails/builds/98298#01899662-c3b9-48ba-812a-dd3ee4388752/1066-12267) in the longest running framework suite (railties), so we should avoid adding unnecessary tests, especially expensive tests.\r\n\r\n### Detail\r\n\r\nThis PR removes the unnecessary test for --no-* from app_generator_test.rb.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n\r\ncc: @jonathanhefner ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48840/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48840/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48839", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48839/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48839/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48839/events", "html_url": "https://github.com/rails/rails/pull/48839", "id": 1826775682, "node_id": "PR_kwDNIULOVqxvOQ", "number": 48839, "title": "Fix TestRequest coercing SERVER_PORT to be an int", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-28T17:10:16Z", "updated_at": "2023-07-28T18:42:19Z", "closed_at": "2023-07-28T18:08:47Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48839", "html_url": "https://github.com/rails/rails/pull/48839", "diff_url": "https://github.com/rails/rails/pull/48839.diff", "patch_url": "https://github.com/rails/rails/pull/48839.patch", "merged_at": "2023-07-28T18:08:47Z"}, "body": "### Motivation / Background\r\n\r\nRef skipkayhil#5\r\n\r\nIn both Rack 2 and Rack 3, all headers must be strings. SERVER_PORT has an additional requirement that it must be an Integer (represented as a string).\r\n\r\n### Detail\r\n\r\nWhen using #port= on a TestRequest, the value passed has been coerced into an integer since it was [introduced][1]. Since this is explicitly incorrect per both Rack 2 and Rack SPEC, the coercion is removed.\r\n\r\nThis does have the potential to change the value for users who are checking TestRequest#headers directly, but if they are using Request#port the value will not change because #port also coerces values to ints.\r\n\r\n[1]: https://github.com/rails/rails/commit/61960e7b37767140e9af68bd5373e06dce08492d\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48839/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48839/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48838", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48838/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48838/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48838/events", "html_url": "https://github.com/rails/rails/pull/48838", "id": 1826652461, "node_id": "PR_kwDNIULOVqq_vw", "number": 48838, "title": "Use connection.schema_version inside ActiveRecord::SchemaCache", "user": {"login": "jhbabon", "id": 280452, "node_id": "MDQ6VXNlcjI4MDQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/280452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhbabon", "html_url": "https://github.com/jhbabon", "followers_url": "https://api.github.com/users/jhbabon/followers", "following_url": "https://api.github.com/users/jhbabon/following{/other_user}", "gists_url": "https://api.github.com/users/jhbabon/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhbabon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhbabon/subscriptions", "organizations_url": "https://api.github.com/users/jhbabon/orgs", "repos_url": "https://api.github.com/users/jhbabon/repos", "events_url": "https://api.github.com/users/jhbabon/events{/privacy}", "received_events_url": "https://api.github.com/users/jhbabon/received_events", "type": "User", "site_admin": true}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-28T15:41:51Z", "updated_at": "2023-07-30T21:56:51Z", "closed_at": "2023-07-30T16:19:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48838", "html_url": "https://github.com/rails/rails/pull/48838", "diff_url": "https://github.com/rails/rails/pull/48838.diff", "patch_url": "https://github.com/rails/rails/pull/48838.patch", "merged_at": "2023-07-30T16:19:33Z"}, "body": "\r\n<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because at GitHub we are trying to upgrade our Rails version with the latest changes in `main`. While doing so, we detected an issue where schema `.dump` files generated by a previous version of Rails would be ignored with a message like this:\r\n\r\n```\r\nIgnoring db/schema/schema.dump because it has expired. The current schema version is 0, but the one in the schema cache file is abcdv1.\r\n```\r\n\r\nThe version number `abcdv1` comes from a custom implementation of `ActiveRecord::ConnectionAdapters::AbstractAdapter#schema_version` that we need to use because we don't use standard migrations. However the latest changes in Rails around `ActiveRecord::SchemaCache` don't use this method but `ActiveRecord::ConnectionAdapters::AbstractAdapter#migration_context.current_version`.\r\n\r\nI believe the changes around this part of the code were introduced here https://github.com/rails/rails/pull/48716\r\n\r\n### Detail\r\n\r\nThis Pull Request changes calls to `connection.migration_context.current_version` with `connection.schema_version` inside `ActiveRecord::SchemaVersion` and `ActiveRecord::SchemaReflection`. By default `#schema_version` uses `migration_context.current_version`, so everything should work as before, but for cases where an app is using custom `schema_version` numbers, this fix would allow them to upgrade without issues.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\nN/A\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48838/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48838/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48837", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48837/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48837/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48837/events", "html_url": "https://github.com/rails/rails/pull/48837", "id": 1826586624, "node_id": "PR_kwDNIULOVqnWGA", "number": 48837, "title": "Add Rack::Lint to DebugExceptions tests", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "guilleiguaran", "id": 160941, "node_id": "MDQ6VXNlcjE2MDk0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/160941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guilleiguaran", "html_url": "https://github.com/guilleiguaran", "followers_url": "https://api.github.com/users/guilleiguaran/followers", "following_url": "https://api.github.com/users/guilleiguaran/following{/other_user}", "gists_url": "https://api.github.com/users/guilleiguaran/gists{/gist_id}", "starred_url": "https://api.github.com/users/guilleiguaran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guilleiguaran/subscriptions", "organizations_url": "https://api.github.com/users/guilleiguaran/orgs", "repos_url": "https://api.github.com/users/guilleiguaran/repos", "events_url": "https://api.github.com/users/guilleiguaran/events{/privacy}", "received_events_url": "https://api.github.com/users/guilleiguaran/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "guilleiguaran", "id": 160941, "node_id": "MDQ6VXNlcjE2MDk0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/160941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guilleiguaran", "html_url": "https://github.com/guilleiguaran", "followers_url": "https://api.github.com/users/guilleiguaran/followers", "following_url": "https://api.github.com/users/guilleiguaran/following{/other_user}", "gists_url": "https://api.github.com/users/guilleiguaran/gists{/gist_id}", "starred_url": "https://api.github.com/users/guilleiguaran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guilleiguaran/subscriptions", "organizations_url": "https://api.github.com/users/guilleiguaran/orgs", "repos_url": "https://api.github.com/users/guilleiguaran/repos", "events_url": "https://api.github.com/users/guilleiguaran/events{/privacy}", "received_events_url": "https://api.github.com/users/guilleiguaran/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2023-07-28T15:03:21Z", "updated_at": "2023-07-31T06:58:35Z", "closed_at": "2023-07-31T06:58:35Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48837", "html_url": "https://github.com/rails/rails/pull/48837", "diff_url": "https://github.com/rails/rails/pull/48837.diff", "patch_url": "https://github.com/rails/rails/pull/48837.patch", "merged_at": "2023-07-31T06:58:35Z"}, "body": "### Motivation / Background\r\n\r\nRef skipkayhil#5\r\n\r\nThis adds additional test coverage to DebugExceptions to validate that its behavior conforms to the Rack SPEC.\r\n\r\n### Detail\r\n\r\nThe only changes necessary were to use dynamic header casing for X-Cascade, Content-Type, and Content-Length\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48837/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48837/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48836", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48836/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48836/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48836/events", "html_url": "https://github.com/rails/rails/issues/48836", "id": 1826577019, "node_id": "I_kwDNIULObN9aew", "number": 48836, "title": "ActiveStorage: Support AWS IAM Roles when using S3", "user": {"login": "tbmetcalfe", "id": 52498306, "node_id": "MDQ6VXNlcjUyNDk4MzA2", "avatar_url": "https://avatars.githubusercontent.com/u/52498306?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tbmetcalfe", "html_url": "https://github.com/tbmetcalfe", "followers_url": "https://api.github.com/users/tbmetcalfe/followers", "following_url": "https://api.github.com/users/tbmetcalfe/following{/other_user}", "gists_url": "https://api.github.com/users/tbmetcalfe/gists{/gist_id}", "starred_url": "https://api.github.com/users/tbmetcalfe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tbmetcalfe/subscriptions", "organizations_url": "https://api.github.com/users/tbmetcalfe/orgs", "repos_url": "https://api.github.com/users/tbmetcalfe/repos", "events_url": "https://api.github.com/users/tbmetcalfe/events{/privacy}", "received_events_url": "https://api.github.com/users/tbmetcalfe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-28T14:56:59Z", "updated_at": "2023-08-07T14:58:29Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Description\r\n\r\nCurrently, it is mandatory to use AWS Access Keys when using ActiveStorage. However, it is considered best practice to use AWS IAM roles where possible if operating within AWS. Currently, this does not appear possible when using ActiveStorage.\r\n\r\n### Current behavior\r\nIf you do not set these fields, `access_key_id` and `secret_access_key`, when configuring to use S3, then even when you set the other methods of setting AWS credentials, the service will fail as it cannot locate the credentials. \r\n\r\n### Desired behavior\r\nIf the `access_key_id` and `secret_access_key` are set, then use these fields. If, however, these fields are not set, it will then try to locate the default AWS credentials (as defined in the AWS SDK) such as from environment variables (`AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`) or the IAM role assigned to the resource (e.g. if it's running on an EC2 instance)\r\n\r\nThis behavior is already implemented in the AWS SDK for all programming languages.\r\n\r\n### System configuration\r\n**Rails version**: `6.1.3`\r\n\r\n**Ruby version**: `3.0.5`\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48836/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48836/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48835", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48835/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48835/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48835/events", "html_url": "https://github.com/rails/rails/pull/48835", "id": 1826573672, "node_id": "PR_kwDNIULOVqmoFA", "number": 48835, "title": "Add Rack::Lint to `ActionDispatch::RemoteIp` tests", "user": {"login": "nunosilva800", "id": 1113178, "node_id": "MDQ6VXNlcjExMTMxNzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1113178?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nunosilva800", "html_url": "https://github.com/nunosilva800", "followers_url": "https://api.github.com/users/nunosilva800/followers", "following_url": "https://api.github.com/users/nunosilva800/following{/other_user}", "gists_url": "https://api.github.com/users/nunosilva800/gists{/gist_id}", "starred_url": "https://api.github.com/users/nunosilva800/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nunosilva800/subscriptions", "organizations_url": "https://api.github.com/users/nunosilva800/orgs", "repos_url": "https://api.github.com/users/nunosilva800/repos", "events_url": "https://api.github.com/users/nunosilva800/events{/privacy}", "received_events_url": "https://api.github.com/users/nunosilva800/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "guilleiguaran", "id": 160941, "node_id": "MDQ6VXNlcjE2MDk0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/160941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guilleiguaran", "html_url": "https://github.com/guilleiguaran", "followers_url": "https://api.github.com/users/guilleiguaran/followers", "following_url": "https://api.github.com/users/guilleiguaran/following{/other_user}", "gists_url": "https://api.github.com/users/guilleiguaran/gists{/gist_id}", "starred_url": "https://api.github.com/users/guilleiguaran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guilleiguaran/subscriptions", "organizations_url": "https://api.github.com/users/guilleiguaran/orgs", "repos_url": "https://api.github.com/users/guilleiguaran/repos", "events_url": "https://api.github.com/users/guilleiguaran/events{/privacy}", "received_events_url": "https://api.github.com/users/guilleiguaran/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "guilleiguaran", "id": 160941, "node_id": "MDQ6VXNlcjE2MDk0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/160941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guilleiguaran", "html_url": "https://github.com/guilleiguaran", "followers_url": "https://api.github.com/users/guilleiguaran/followers", "following_url": "https://api.github.com/users/guilleiguaran/following{/other_user}", "gists_url": "https://api.github.com/users/guilleiguaran/gists{/gist_id}", "starred_url": "https://api.github.com/users/guilleiguaran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guilleiguaran/subscriptions", "organizations_url": "https://api.github.com/users/guilleiguaran/orgs", "repos_url": "https://api.github.com/users/guilleiguaran/repos", "events_url": "https://api.github.com/users/guilleiguaran/events{/privacy}", "received_events_url": "https://api.github.com/users/guilleiguaran/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2023-07-28T14:55:16Z", "updated_at": "2023-08-02T18:35:49Z", "closed_at": "2023-07-31T23:37:20Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48835", "html_url": "https://github.com/rails/rails/pull/48835", "diff_url": "https://github.com/rails/rails/pull/48835.diff", "patch_url": "https://github.com/rails/rails/pull/48835.patch", "merged_at": "2023-07-31T23:37:20Z"}, "body": "### Motivation / Background\r\n\r\nTo ensure Rails is and remains compliant with [the Rack 3 spec](https://github.com/rack/rack/blob/6d16306192349e665e4ec820a9bfcc0967009b6a/UPGRADE-GUIDE.md) we can add `Rack::Lint` to the Rails middleware tests.\r\n\r\nThis adds additional test coverage to\r\n`ActionDispatch::RemoteIp` to validate that its input and output follow the Rack SPEC.\r\n\r\n### Detail\r\n\r\nThe only code testing this middleware are the ones for `ActionDispatch::Request`.\r\n\r\nSeveral changes were required to make the tests pass:\r\n\r\n- `CONTENT_LENGTH` must be a string\r\n- `SERVER_PORT` must be a string\r\n- `HTTP_HOST` must be a string\r\n- `rack.input` must be an IO object, with ASCII-8BIT encoding - By leveraging `Rack::MockRequest`, we can pass the symbol :input, and the string value, and it will be converted to an IO object with the correct encoding. - See [definition here](https://github.com/rack/rack/blob/444dc8a130663159ed490f25948b73ff9b5fbba0/lib/rack/mock_request.rb#L89-L97)\r\n- using `Rack::MockRequest` also means that any symbol keys being passed to setup the env, will be discarded. [Only string keys are copied.](https://github.com/rack/rack/blob/444dc8a130663159ed490f25948b73ff9b5fbba0/lib/rack/mock_request.rb#L156)\r\n\r\n\r\n\r\n### Additional information\r\n\r\n- https://github.com/skipkayhil/tmp-rails/issues/1\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48835/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48835/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48834", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48834/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48834/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48834/events", "html_url": "https://github.com/rails/rails/pull/48834", "id": 1826557432, "node_id": "PR_kwDNIULOVqluRA", "number": 48834, "title": "Raise if unable to cast a string to a date [fixes #48802]", "user": {"login": "elebow", "id": 7873686, "node_id": "MDQ6VXNlcjc4NzM2ODY=", "avatar_url": "https://avatars.githubusercontent.com/u/7873686?v=4", "gravatar_id": "", "url": "https://api.github.com/users/elebow", "html_url": "https://github.com/elebow", "followers_url": "https://api.github.com/users/elebow/followers", "following_url": "https://api.github.com/users/elebow/following{/other_user}", "gists_url": "https://api.github.com/users/elebow/gists{/gist_id}", "starred_url": "https://api.github.com/users/elebow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/elebow/subscriptions", "organizations_url": "https://api.github.com/users/elebow/orgs", "repos_url": "https://api.github.com/users/elebow/repos", "events_url": "https://api.github.com/users/elebow/events{/privacy}", "received_events_url": "https://api.github.com/users/elebow/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-28T14:45:58Z", "updated_at": "2023-08-01T23:15:56Z", "closed_at": "2023-08-01T23:10:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48834", "html_url": "https://github.com/rails/rails/pull/48834", "diff_url": "https://github.com/rails/rails/pull/48834.diff", "patch_url": "https://github.com/rails/rails/pull/48834.patch", "merged_at": null}, "body": "This prevents possible data loss where a non-nil value could be silently cast as `nil`.\r\n\r\n### Motivation / Background\r\n\r\nSee #48802.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48834/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48834/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48833", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48833/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48833/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48833/events", "html_url": "https://github.com/rails/rails/pull/48833", "id": 1826173801, "node_id": "PR_kwDNIULOVqQ2Sg", "number": 48833, "title": "Add Rack::Lint to `ActionDispatch::ServerTiming` tests", "user": {"login": "nunosilva800", "id": 1113178, "node_id": "MDQ6VXNlcjExMTMxNzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1113178?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nunosilva800", "html_url": "https://github.com/nunosilva800", "followers_url": "https://api.github.com/users/nunosilva800/followers", "following_url": "https://api.github.com/users/nunosilva800/following{/other_user}", "gists_url": "https://api.github.com/users/nunosilva800/gists{/gist_id}", "starred_url": "https://api.github.com/users/nunosilva800/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nunosilva800/subscriptions", "organizations_url": "https://api.github.com/users/nunosilva800/orgs", "repos_url": "https://api.github.com/users/nunosilva800/repos", "events_url": "https://api.github.com/users/nunosilva800/events{/privacy}", "received_events_url": "https://api.github.com/users/nunosilva800/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-28T10:25:00Z", "updated_at": "2023-08-02T18:35:48Z", "closed_at": "2023-07-28T16:01:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48833", "html_url": "https://github.com/rails/rails/pull/48833", "diff_url": "https://github.com/rails/rails/pull/48833.diff", "patch_url": "https://github.com/rails/rails/pull/48833.patch", "merged_at": "2023-07-28T16:01:48Z"}, "body": "### Motivation / Background\r\n\r\nTo ensure Rails is and remains compliant with [the Rack 3 spec](https://github.com/rack/rack/blob/6d16306192349e665e4ec820a9bfcc0967009b6a/UPGRADE-GUIDE.md) we can add `Rack::Lint` to the Rails middleware tests.\r\n\r\nThis adds additional test coverage to `ActionDispatch::ServerTiming` to validate that its input and output follow the Rack SPEC.\r\n\r\n### Detail\r\n\r\nThe `Server-Timing` header definition was moved to `ActionDispatch::Constants` and is now downcased to match the Rack 3 SPEC.\r\n\r\nThe tests that rely on a `Concurrent::CyclicBarrier` (\"events are tracked by thread\") were changed since passing the required proc in the env is not compatible with the SPEC:\r\n\r\n```\r\nRack::Lint::LintError: env variable proc has non-string value\r\n```\r\n\r\nThe same can be achieved by invoking the proc as a child Rack app.\r\n\r\n### Additional information\r\n\r\n- https://github.com/skipkayhil/tmp-rails/issues/1\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48833/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48833/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48832", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48832/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48832/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48832/events", "html_url": "https://github.com/rails/rails/pull/48832", "id": 1825181210, "node_id": "PR_kwDNIULOVpbSzA", "number": 48832, "title": "Add Rack::Lint to DebugLocks tests", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-27T20:39:06Z", "updated_at": "2023-07-27T21:32:32Z", "closed_at": "2023-07-27T20:51:53Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48832", "html_url": "https://github.com/rails/rails/pull/48832", "diff_url": "https://github.com/rails/rails/pull/48832.diff", "patch_url": "https://github.com/rails/rails/pull/48832.patch", "merged_at": "2023-07-27T20:51:53Z"}, "body": "### Motivation / Background\r\n\r\nRef skipkayhil#5\r\n\r\nThis adds additional test coverage to HostAuthorization to validate that its behavior conforms to Rack SPEC.\r\n\r\n### Details\r\n\r\nThis fixes the following two issues in the reponse returned by DebugLocks:\r\n- Rack::Lint::Error: uppercase character in header name Content-{Type/Length}\r\n- Rack::Lint::Error: a header value must be a String or Array of Strings, but the value of 'content-length' is an Integer\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48832/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48832/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48831", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48831/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48831/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48831/events", "html_url": "https://github.com/rails/rails/pull/48831", "id": 1825124242, "node_id": "PR_kwDNIULOVpYHdw", "number": 48831, "title": "Add Rack::Lint to Static tests", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-27T20:03:20Z", "updated_at": "2023-07-27T20:30:55Z", "closed_at": "2023-07-27T20:26:28Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48831", "html_url": "https://github.com/rails/rails/pull/48831", "diff_url": "https://github.com/rails/rails/pull/48831.diff", "patch_url": "https://github.com/rails/rails/pull/48831.patch", "merged_at": "2023-07-27T20:26:28Z"}, "body": "The test refactor was split out from the Rack::Lint change to make them both easier to review.\r\n\r\nRef skipkayhil#5\r\n\r\n---\r\n\r\n[Refactor StaticTests to use single app builder](https://github.com/rails/rails/commit/f880da0f24f72629563e194d72e6418a1ecaaaa5)\r\n\r\nThis commit refactors the StaticTests class in preparation for adding\r\nRack::Lint to the tests.\r\n\r\nThe first change is inlining the StaticTests module into the StaticTest\r\nclass. It was originally extracted into a module when Static was\r\n[changed][1] to support passing multiple root paths, but support for\r\nmultiple paths has since been [removed][2].\r\n\r\nThe second change is to move all Rack App creation into a single method.\r\nThis will make it extremely easy to add Rack::Lint to the App in a\r\nfollowup commit.\r\n\r\n[1]: https://github.com/rails/rails/commit/401cd97923fb52c8f8c458b8cb276b338e0b20f3\r\n[2]: https://github.com/rails/rails/commit/d5ad92ced1786b742c3ecce3cb60d851c7200bc9\r\n\r\n--- \r\n\r\n[Add Rack::Lint to Static tests](https://github.com/rails/rails/commit/b580df616b1d6d32cc7dee1505f8ae84d0444e04)\r\n\r\nThis adds additional test coverage to Static to validate that its\r\nbehavior conforms to the Rack SPEC.\r\n\r\nThe test changes are just downcasing headers where appropriate:\r\n- the Static `headers` params is purely user configured headers, so its\r\n  reasonable to expect these shoud be correct for an application's Rack\r\n  version\r\n- header assertions can use downcased headers because Rack::MockRequest\r\n  returns a Rack::Response, which uses Rack::Headers internally (so\r\n  either casing will work)\r\n\r\nAdditionally, the unconditionally downcased headers in the Static\r\nmiddleware were updated to be conditional based on the Rack version to\r\nensure that this middleware remains fully compatible with other Rack 2\r\nmiddleware.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48831/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48831/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48830", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48830/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48830/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48830/events", "html_url": "https://github.com/rails/rails/pull/48830", "id": 1825022005, "node_id": "PR_kwDNIULOVpSQVw", "number": 48830, "title": "Make `ActionDispatch::SSL` compatible with Rack 3.0", "user": {"login": "adrianna-chang-shopify", "id": 22918438, "node_id": "MDQ6VXNlcjIyOTE4NDM4", "avatar_url": "https://avatars.githubusercontent.com/u/22918438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adrianna-chang-shopify", "html_url": "https://github.com/adrianna-chang-shopify", "followers_url": "https://api.github.com/users/adrianna-chang-shopify/followers", "following_url": "https://api.github.com/users/adrianna-chang-shopify/following{/other_user}", "gists_url": "https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}", "starred_url": "https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adrianna-chang-shopify/subscriptions", "organizations_url": "https://api.github.com/users/adrianna-chang-shopify/orgs", "repos_url": "https://api.github.com/users/adrianna-chang-shopify/repos", "events_url": "https://api.github.com/users/adrianna-chang-shopify/events{/privacy}", "received_events_url": "https://api.github.com/users/adrianna-chang-shopify/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "guilleiguaran", "id": 160941, "node_id": "MDQ6VXNlcjE2MDk0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/160941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guilleiguaran", "html_url": "https://github.com/guilleiguaran", "followers_url": "https://api.github.com/users/guilleiguaran/followers", "following_url": "https://api.github.com/users/guilleiguaran/following{/other_user}", "gists_url": "https://api.github.com/users/guilleiguaran/gists{/gist_id}", "starred_url": "https://api.github.com/users/guilleiguaran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guilleiguaran/subscriptions", "organizations_url": "https://api.github.com/users/guilleiguaran/orgs", "repos_url": "https://api.github.com/users/guilleiguaran/repos", "events_url": "https://api.github.com/users/guilleiguaran/events{/privacy}", "received_events_url": "https://api.github.com/users/guilleiguaran/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "guilleiguaran", "id": 160941, "node_id": "MDQ6VXNlcjE2MDk0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/160941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guilleiguaran", "html_url": "https://github.com/guilleiguaran", "followers_url": "https://api.github.com/users/guilleiguaran/followers", "following_url": "https://api.github.com/users/guilleiguaran/following{/other_user}", "gists_url": "https://api.github.com/users/guilleiguaran/gists{/gist_id}", "starred_url": "https://api.github.com/users/guilleiguaran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guilleiguaran/subscriptions", "organizations_url": "https://api.github.com/users/guilleiguaran/orgs", "repos_url": "https://api.github.com/users/guilleiguaran/repos", "events_url": "https://api.github.com/users/guilleiguaran/events{/privacy}", "received_events_url": "https://api.github.com/users/guilleiguaran/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2023-07-27T19:16:03Z", "updated_at": "2023-08-02T18:44:27Z", "closed_at": "2023-07-28T18:46:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48830", "html_url": "https://github.com/rails/rails/pull/48830", "diff_url": "https://github.com/rails/rails/pull/48830.diff", "patch_url": "https://github.com/rails/rails/pull/48830.patch", "merged_at": "2023-07-28T18:46:55Z"}, "body": "### Motivation / Background\r\n\r\nRef: https://github.com/skipkayhil/tmp-rails/issues/1\r\nRelated: https://github.com/rails/rails/pull/46594\r\n\r\nRack 3 now requires response header values to be an Array when handling multiple values. Newline encoded headers are no longer supported. (ref: https://github.com/rack/rack/blob/main/UPGRADE-GUIDE.md#rack-2--rack-3-compatibility)\r\n\r\nThis commit updates `ActionDispatch::SSL#flag_cookies_as_secure!` to be Rack-3 compliant by setting the `set-cookie` header to an Array rather than a newline-separated String if the current Rack version is 3+.\r\n\r\nAdditionally, this commit adds `Rack::Lint` to the Rack app in the middleware test suite so that we can ensure all of the tests are compliant with the Rack SPEC.\r\n\r\n### Detail\r\n\r\nWithout the changes to `ActionDispatch::SSL#flag_cookies_as_secure!`, we see `Rack::Lint` raise:\r\n```\r\nError:\r\nSecureCookiesTest#test_cookies_as_not_secure_with_secure_cookies_disabled:\r\nRack::Lint::LintError: invalid header value set-cookie: \"id=1; path=/\\ntoken=abc; path=/; secure; HttpOnly\"\r\n    /Users/adriannachang/.gem/ruby/3.2.1/gems/rack-3.0.8/lib/rack/lint.rb:670:in `check_header_value'\r\n    /Users/adriannachang/.gem/ruby/3.2.1/gems/rack-3.0.8/lib/rack/lint.rb:657:in `block in check_headers'\r\n    /Users/adriannachang/.gem/ruby/3.2.1/gems/rack-3.0.8/lib/rack/lint.rb:637:in `each'\r\n    /Users/adriannachang/.gem/ruby/3.2.1/gems/rack-3.0.8/lib/rack/lint.rb:637:in `check_headers'\r\n    /Users/adriannachang/.gem/ruby/3.2.1/gems/rack-3.0.8/lib/rack/lint.rb:73:in `response'\r\n    /Users/adriannachang/.gem/ruby/3.2.1/gems/rack-3.0.8/lib/rack/lint.rb:35:in `call'\r\n    /Users/adriannachang/src/github.com/rails/actionpack/lib/action_dispatch/middleware/ssl.rb:87:in `call'\r\n    /Users/adriannachang/.gem/ruby/3.2.1/gems/rack-3.0.8/lib/rack/lint.rb:63:in `response'\r\n    /Users/adriannachang/.gem/ruby/3.2.1/gems/rack-3.0.8/lib/rack/lint.rb:35:in `call'\r\n    /Users/adriannachang/.gem/ruby/3.2.1/gems/rack-test-2.1.0/lib/rack/test.rb:360:in `process_request'\r\n    /Users/adriannachang/.gem/ruby/3.2.1/gems/rack-test-2.1.0/lib/rack/test.rb:153:in `request'\r\n    /Users/adriannachang/src/github.com/rails/actionpack/lib/action_dispatch/testing/integration.rb:288:in `process'\r\n    /Users/adriannachang/src/github.com/rails/actionpack/lib/action_dispatch/testing/integration.rb:16:in `get'\r\n    /Users/adriannachang/src/github.com/rails/actionpack/lib/action_dispatch/testing/integration.rb:379:in `get'\r\n    /Users/adriannachang/src/github.com/rails/actionpack/test/dispatch/ssl_test.rb:266:in `get'\r\n    /Users/adriannachang/src/github.com/rails/actionpack/test/dispatch/ssl_test.rb:241:in `test_cookies_as_not_secure_with_secure_cookies_disabled'\r\n\r\n\r\nbin/test test/dispatch/ssl_test.rb:240\r\n```\r\n\r\nNote that we also need to ensure that response headers are downcased for Rack 3, since mixed case headers are no longer supported in the new release. I've taken the approach we settled on in https://github.com/skipkayhil/tmp-rails/issues/1, where we set the casing of the header depending on the Rack version. Rack exposes constants for certain headers (e.g. `RACK::CONTENT_TYPE`), but other headers like location aren't exposed as constants in Rack, so I've defined them inline in `ActionDispatch::SSL`. Other PRs, e.g. https://github.com/rails/rails/pull/48813, are defining these types of constants in `ActionDispatch::Response` -- I can take the same approach if we decide that's the way to go :) \r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48830/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48830/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48829", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48829/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48829/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48829/events", "html_url": "https://github.com/rails/rails/pull/48829", "id": 1824854230, "node_id": "PR_kwDNIULOVpJN4g", "number": 48829, "title": "Add Rack::Lint to ActionDispatch::MiddlewareStack tests", "user": {"login": "nunosilva800", "id": 1113178, "node_id": "MDQ6VXNlcjExMTMxNzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1113178?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nunosilva800", "html_url": "https://github.com/nunosilva800", "followers_url": "https://api.github.com/users/nunosilva800/followers", "following_url": "https://api.github.com/users/nunosilva800/following{/other_user}", "gists_url": "https://api.github.com/users/nunosilva800/gists{/gist_id}", "starred_url": "https://api.github.com/users/nunosilva800/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nunosilva800/subscriptions", "organizations_url": "https://api.github.com/users/nunosilva800/orgs", "repos_url": "https://api.github.com/users/nunosilva800/repos", "events_url": "https://api.github.com/users/nunosilva800/events{/privacy}", "received_events_url": "https://api.github.com/users/nunosilva800/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-27T17:24:45Z", "updated_at": "2023-08-02T18:35:46Z", "closed_at": "2023-07-27T20:12:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48829", "html_url": "https://github.com/rails/rails/pull/48829", "diff_url": "https://github.com/rails/rails/pull/48829.diff", "patch_url": "https://github.com/rails/rails/pull/48829.patch", "merged_at": "2023-07-27T20:12:42Z"}, "body": "### Motivation / Background\r\n\r\nTo ensure Rails is and remains compliant with [the Rack 3 spec](https://github.com/rack/rack/blob/6d16306192349e665e4ec820a9bfcc0967009b6a/UPGRADE-GUIDE.md) we can add `Rack::Lint` to the Rails middleware tests.\r\n\r\nThis adds additional test coverage to `ActionDispatch::MiddlewareStack` to validate that its input and output follow the Rack SPEC.\r\n\r\n### Detail\r\n\r\nIn this case, no changes are required, and the additional test will ensure this middleware remains compliant with the Rack SPEC.\r\n\r\n\r\n### Additional information\r\n\r\n- https://github.com/skipkayhil/tmp-rails/issues/1\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48829/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48829/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48828", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48828/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48828/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48828/events", "html_url": "https://github.com/rails/rails/pull/48828", "id": 1824685045, "node_id": "PR_kwDNIULOVo_99A", "number": 48828, "title": "Convert to xml for has first key pair will print first object", "user": {"login": "sunilsoma", "id": 13345539, "node_id": "MDQ6VXNlcjEzMzQ1NTM5", "avatar_url": "https://avatars.githubusercontent.com/u/13345539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sunilsoma", "html_url": "https://github.com/sunilsoma", "followers_url": "https://api.github.com/users/sunilsoma/followers", "following_url": "https://api.github.com/users/sunilsoma/following{/other_user}", "gists_url": "https://api.github.com/users/sunilsoma/gists{/gist_id}", "starred_url": "https://api.github.com/users/sunilsoma/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sunilsoma/subscriptions", "organizations_url": "https://api.github.com/users/sunilsoma/orgs", "repos_url": "https://api.github.com/users/sunilsoma/repos", "events_url": "https://api.github.com/users/sunilsoma/events{/privacy}", "received_events_url": "https://api.github.com/users/sunilsoma/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-27T15:57:05Z", "updated_at": "2023-07-28T00:25:45Z", "closed_at": "2023-07-28T00:25:45Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48828", "html_url": "https://github.com/rails/rails/pull/48828", "diff_url": "https://github.com/rails/rails/pull/48828.diff", "patch_url": "https://github.com/rails/rails/pull/48828.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because [REPLACE ME]\r\n\r\n### Detail\r\n\r\nThis Pull Request changes [REPLACE ME]\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n- [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48828/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48828/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48827", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48827/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48827/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48827/events", "html_url": "https://github.com/rails/rails/pull/48827", "id": 1824672727, "node_id": "PR_kwDNIULOVo_SXA", "number": 48827, "title": "Add ActionDispatch::Cookies middleware test with Rack::Lint", "user": {"login": "adrianna-chang-shopify", "id": 22918438, "node_id": "MDQ6VXNlcjIyOTE4NDM4", "avatar_url": "https://avatars.githubusercontent.com/u/22918438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adrianna-chang-shopify", "html_url": "https://github.com/adrianna-chang-shopify", "followers_url": "https://api.github.com/users/adrianna-chang-shopify/followers", "following_url": "https://api.github.com/users/adrianna-chang-shopify/following{/other_user}", "gists_url": "https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}", "starred_url": "https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adrianna-chang-shopify/subscriptions", "organizations_url": "https://api.github.com/users/adrianna-chang-shopify/orgs", "repos_url": "https://api.github.com/users/adrianna-chang-shopify/repos", "events_url": "https://api.github.com/users/adrianna-chang-shopify/events{/privacy}", "received_events_url": "https://api.github.com/users/adrianna-chang-shopify/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-27T15:51:28Z", "updated_at": "2023-08-02T18:35:45Z", "closed_at": "2023-07-27T19:45:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48827", "html_url": "https://github.com/rails/rails/pull/48827", "diff_url": "https://github.com/rails/rails/pull/48827.diff", "patch_url": "https://github.com/rails/rails/pull/48827.patch", "merged_at": "2023-07-27T19:45:13Z"}, "body": "### Motivation / Background\r\n\r\nRef: https://github.com/skipkayhil/tmp-rails/issues/1\r\n\r\nThis adds an additional test to the `ActionDispatch::Cookies` middleware test suite to ensure that the middleware sets the expected cookie header when the request contains a cookie jar. Additionally, the test wraps the middleware in `Rack::Lint` to ensure that `ActionDispatch::Cookies` complies with the Rack SPEC, specifically with the [changes](https://github.com/rack/rack/blob/6d16306192349e665e4ec820a9bfcc0967009b6a/UPGRADE-GUIDE.md) in migrating from Rack 2 to Rack 3.\r\n\r\n### Detail\r\n\r\nThe existing tests in `actionpack/test/dispatch/cookies_test.rb` verify cookies behaviour at the unit-test level, but we're missing a test that explicitly tests the middleware piece. This PR adds that test, wrapping it in `Rack::Lint` to also validate Rack SPEC compliance. \r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48827/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48827/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48826", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48826/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48826/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48826/events", "html_url": "https://github.com/rails/rails/issues/48826", "id": 1823983007, "node_id": "I_kwDNIULObLfFnw", "number": 48826, "title": "`ApplicationTests::BinSetupTest#test_bin_setup_output` fails against Ruby 3.3.0dev", "user": {"login": "yahonda", "id": 73684, "node_id": "MDQ6VXNlcjczNjg0", "avatar_url": "https://avatars.githubusercontent.com/u/73684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yahonda", "html_url": "https://github.com/yahonda", "followers_url": "https://api.github.com/users/yahonda/followers", "following_url": "https://api.github.com/users/yahonda/following{/other_user}", "gists_url": "https://api.github.com/users/yahonda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yahonda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yahonda/subscriptions", "organizations_url": "https://api.github.com/users/yahonda/orgs", "repos_url": "https://api.github.com/users/yahonda/repos", "events_url": "https://api.github.com/users/yahonda/events{/privacy}", "received_events_url": "https://api.github.com/users/yahonda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 776781281, "node_id": "MDU6TGFiZWw3NzY3ODEyODE=", "url": "https://api.github.com/repos/rails/rails/labels/ci%20issues", "name": "ci issues", "color": "aaafff", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-27T09:29:05Z", "updated_at": "2023-07-29T03:20:32Z", "closed_at": "2023-07-29T03:20:32Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Managed to reproduce https://buildkite.com/rails/rails/builds/98279#01899424-9e26-4fb8-a685-84607e46d279\r\n\r\n### Steps to reproduce\r\n\r\n```ruby\r\ngit clone https://github.com/rails/rails\r\ncd rails\r\nrm Gemfile.lock\r\nbundle install\r\nbin/test test/application/bin_setup_test.rb:30\r\n```\r\n\r\n### Expected behavior\r\nIt should pass.\r\n\r\n### Actual behavior\r\nIt fails.\r\n\r\n```ruby\r\n$ rm ../Gemfile.lock ; bundle ; RUBYOPT=-W:deprecated bin/test test/application/bin_setup_test.rb:30\r\nFetching https://github.com/github/trilogy.git\r\nFetching https://github.com/matthewd/websocket-client-simple.git\r\nFetching gem metadata from https://rubygems.org/.........\r\nResolving dependencies...\r\nBundle complete! 81 Gemfile dependencies, 215 gems now installed.\r\nUse `bundle info [gemname]` to see where a bundled gem is installed.\r\nmutex_m is not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.\r\ndrb is not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.\r\nbase64 is not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.\r\nbase64 is not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.\r\nmutex_m is not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.\r\nRun options: --seed 1511\r\n\r\n# Running:\r\n\r\nF\r\n\r\nFailure:\r\nApplicationTests::BinSetupTest#test_bin_setup_output [/home/yahonda/src/github.com/rails/rails/railties/test/application/bin_setup_test.rb:51]:\r\n--- expected\r\n+++ actual\r\n@@ -2,10 +2,16 @@\r\n The Gemfile's dependencies are satisfied\r\n\r\n == Preparing database ==\r\n+mutex_m is not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.\r\n+base64 is not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.\r\n Created database 'app_development'\r\n Created database 'app_test'\r\n\r\n == Removing old logs and tempfiles ==\r\n+mutex_m is not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.\r\n+base64 is not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.\r\n\r\n == Restarting application server ==\r\n+mutex_m is not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.\r\n+base64 is not part of the default gems since Ruby 3.4.0. Add it to your Gemfile.\r\n \"\r\n\r\n\r\n\r\nbin/test test/application/bin_setup_test.rb:30\r\n\r\n\r\n\r\nFinished in 5.598662s, 0.1786 runs/s, 0.1786 assertions/s.\r\n1 runs, 1 assertions, 1 failures, 0 errors, 0 skips\r\n$\r\n```\r\n\r\n### System configuration\r\n**Rails version**: main branch\r\n\r\n**Ruby version**: ruby 3.3.0dev (2023-07-26T19:59:59Z master 9bdd485972) [x86_64-linux]\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48826/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48826/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48825", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48825/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48825/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48825/events", "html_url": "https://github.com/rails/rails/pull/48825", "id": 1823906757, "node_id": "PR_kwDNIULOVoV1bw", "number": 48825, "title": "Add Rack::Lint to ActionDispatch::Executor tests", "user": {"login": "nunosilva800", "id": 1113178, "node_id": "MDQ6VXNlcjExMTMxNzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1113178?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nunosilva800", "html_url": "https://github.com/nunosilva800", "followers_url": "https://api.github.com/users/nunosilva800/followers", "following_url": "https://api.github.com/users/nunosilva800/following{/other_user}", "gists_url": "https://api.github.com/users/nunosilva800/gists{/gist_id}", "starred_url": "https://api.github.com/users/nunosilva800/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nunosilva800/subscriptions", "organizations_url": "https://api.github.com/users/nunosilva800/orgs", "repos_url": "https://api.github.com/users/nunosilva800/repos", "events_url": "https://api.github.com/users/nunosilva800/events{/privacy}", "received_events_url": "https://api.github.com/users/nunosilva800/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-27T08:48:10Z", "updated_at": "2023-08-02T18:35:45Z", "closed_at": "2023-07-27T21:43:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48825", "html_url": "https://github.com/rails/rails/pull/48825", "diff_url": "https://github.com/rails/rails/pull/48825.diff", "patch_url": "https://github.com/rails/rails/pull/48825.patch", "merged_at": "2023-07-27T21:43:01Z"}, "body": "### Motivation / Background\r\n\r\nTo ensure Rails is and remains compliant with [the Rack 3 spec](https://github.com/rack/rack/blob/6d16306192349e665e4ec820a9bfcc0967009b6a/UPGRADE-GUIDE.md) we can add `Rack::Lint` to the Rails middleware tests.\r\n\r\n### Detail\r\n\r\nThis adds additional test coverage to `ActionDispatch::Executor` to validate that its input and output follow the Rack SPEC.\r\n\r\nThis also removes some tests that were asserting the body object passed to `ActionDispatch::Executor` and not the Rack SPEC. See also https://github.com/rack/rack/issues/2100.\r\n\r\n### Additional information\r\n\r\n- https://github.com/skipkayhil/tmp-rails/issues/1\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48825/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48825/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48824", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48824/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48824/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48824/events", "html_url": "https://github.com/rails/rails/pull/48824", "id": 1823880068, "node_id": "PR_kwDNIULOVoUZQQ", "number": 48824, "title": "Sort SchemaCache members when dumping it", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-27T08:30:58Z", "updated_at": "2023-07-27T08:56:59Z", "closed_at": "2023-07-27T08:56:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48824", "html_url": "https://github.com/rails/rails/pull/48824", "diff_url": "https://github.com/rails/rails/pull/48824.diff", "patch_url": "https://github.com/rails/rails/pull/48824.patch", "merged_at": "2023-07-27T08:56:53Z"}, "body": "Ref: https://github.com/rails/rails/issues/42717\r\n\r\nThis allow to result to be consistent, allowing to use its digest for cache keys and such.\r\n\r\nFYI: @justin808 ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48824/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48824/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48823", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48823/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48823/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48823/events", "html_url": "https://github.com/rails/rails/pull/48823", "id": 1823875459, "node_id": "PR_kwDNIULOVoUI0Q", "number": 48823, "title": "Add tags to audio analyzer metadata", "user": {"login": "Gambitboy", "id": 15830178, "node_id": "MDQ6VXNlcjE1ODMwMTc4", "avatar_url": "https://avatars.githubusercontent.com/u/15830178?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Gambitboy", "html_url": "https://github.com/Gambitboy", "followers_url": "https://api.github.com/users/Gambitboy/followers", "following_url": "https://api.github.com/users/Gambitboy/following{/other_user}", "gists_url": "https://api.github.com/users/Gambitboy/gists{/gist_id}", "starred_url": "https://api.github.com/users/Gambitboy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Gambitboy/subscriptions", "organizations_url": "https://api.github.com/users/Gambitboy/orgs", "repos_url": "https://api.github.com/users/Gambitboy/repos", "events_url": "https://api.github.com/users/Gambitboy/events{/privacy}", "received_events_url": "https://api.github.com/users/Gambitboy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-27T08:28:37Z", "updated_at": "2023-07-28T00:38:28Z", "closed_at": "2023-07-28T00:38:28Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48823", "html_url": "https://github.com/rails/rails/pull/48823", "diff_url": "https://github.com/rails/rails/pull/48823.diff", "patch_url": "https://github.com/rails/rails/pull/48823.patch", "merged_at": "2023-07-28T00:38:28Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because I'm creating a rails api that allows you to upload mp3 files and serves them back to TV devices. Instead of filling in the data manually I need to analyze the files and access the tags metadata object which will include things like 'title', 'artists' and more.\r\n\r\n### Detail\r\n\r\nThis PR adds a tags key in the metadata hash output by the audio analyzer with the blob tags.\r\n\r\n### Additional information\r\n\r\nN/A\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48823/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48823/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48822", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48822/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48822/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48822/events", "html_url": "https://github.com/rails/rails/pull/48822", "id": 1823838326, "node_id": "PR_kwDNIULOVoSHqg", "number": 48822, "title": "Added more test for --no-skip in app generator", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-07-27T08:06:32Z", "updated_at": "2023-07-28T16:56:17Z", "closed_at": "2023-07-28T15:43:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48822", "html_url": "https://github.com/rails/rails/pull/48822", "diff_url": "https://github.com/rails/rails/pull/48822.diff", "patch_url": "https://github.com/rails/rails/pull/48822.patch", "merged_at": null}, "body": "### Detail\r\n\r\nRight now we only have a test for --skip-git and --skip-jbuilder. So this PR introduces tests for the --no-skip-jbuilder and --no-skip-git command line argument.\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48822/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48822/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48821", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48821/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48821/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48821/events", "html_url": "https://github.com/rails/rails/pull/48821", "id": 1823786517, "node_id": "PR_kwDNIULOVoPUuA", "number": 48821, "title": "Fix Active Support CHANGELOG", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-27T07:30:50Z", "updated_at": "2023-07-27T07:32:12Z", "closed_at": "2023-07-27T07:32:12Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48821", "html_url": "https://github.com/rails/rails/pull/48821", "diff_url": "https://github.com/rails/rails/pull/48821.diff", "patch_url": "https://github.com/rails/rails/pull/48821.patch", "merged_at": null}, "body": "ref: https://github.com/rails/rails/pull/48638#discussion_r1275847930, https://github.com/rails/rails/actions/runs/5677767447/job/15386664092?pr=48820", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48821/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48821/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48820", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48820/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48820/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48820/events", "html_url": "https://github.com/rails/rails/pull/48820", "id": 1823782204, "node_id": "PR_kwDNIULOVoPFuA", "number": 48820, "title": "Add `ActiveSupport::MessageVerifier#expired?`", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2023-07-27T07:27:56Z", "updated_at": "2023-08-02T23:01:19Z", "closed_at": "2023-08-02T23:01:19Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48820", "html_url": "https://github.com/rails/rails/pull/48820", "diff_url": "https://github.com/rails/rails/pull/48820.diff", "patch_url": "https://github.com/rails/rails/pull/48820.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\nI'd like to add support for https://github.com/rails/globalid/issues/141. As noted in that issue, the `expired?` method needs to be added to Active Support first. This PR adds it.\r\n\r\n### Detail\r\n\r\n```ruby\r\nverifier = ActiveSupport::MessageVerifier.new(\"secret\")\r\nmessage = verifier.generate(\"hello\", expires_at: Time.now.tomorrow)\r\nverifier.expired?(message) # false\r\n# 24 hours later...\r\nverifier.expired?(message) # true\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48820/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48820/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48819", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48819/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48819/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48819/events", "html_url": "https://github.com/rails/rails/pull/48819", "id": 1823280535, "node_id": "PR_kwDNIULOVn0Mxg", "number": 48819, "title": "Add and remove some links in IntegrationTest docs [ci skip]", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-26T22:20:13Z", "updated_at": "2023-07-28T13:40:26Z", "closed_at": "2023-07-28T12:54:54Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48819", "html_url": "https://github.com/rails/rails/pull/48819", "diff_url": "https://github.com/rails/rails/pull/48819.diff", "patch_url": "https://github.com/rails/rails/pull/48819.patch", "merged_at": "2023-07-28T12:54:54Z"}, "body": "Add direct links to #get, #post, #parsed_body, and #open_session.\r\n\r\nRemove links to Session when already on the Session page.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48819/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48819/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48818", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48818/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48818/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48818/events", "html_url": "https://github.com/rails/rails/pull/48818", "id": 1822847363, "node_id": "PR_kwDNIULOVnco4A", "number": 48818, "title": "Add Rack::Lint to PermissionsPolicy tests", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-26T17:22:12Z", "updated_at": "2023-07-27T21:33:12Z", "closed_at": "2023-07-27T20:56:03Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48818", "html_url": "https://github.com/rails/rails/pull/48818", "diff_url": "https://github.com/rails/rails/pull/48818.diff", "patch_url": "https://github.com/rails/rails/pull/48818.patch", "merged_at": "2023-07-27T20:56:03Z"}, "body": "### Motivation / Background\r\n\r\nRef skipkayhil#5\r\n\r\nThis adds additional test coverage to PermissionsPolicy::Middleware to validate that it conforms to the Rack SPEC.\r\n\r\n### Detail\r\n\r\nThe only changes necessary were to use the appropriate header casing for Content-Type and Feature-Policy. Since this was the only usage of the CONTENT_TYPE constant, I opted to remove it, but I can replace it with a DeprecatedConstantProxy if that's more desirable.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48818/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48818/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48817", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48817/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48817/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48817/events", "html_url": "https://github.com/rails/rails/pull/48817", "id": 1822824323, "node_id": "PR_kwDNIULOVnbZ1A", "number": 48817, "title": "Return `false` early when a non-AR object passed to `FinderMethods#include?`", "user": {"login": "nvasilevski", "id": 5512772, "node_id": "MDQ6VXNlcjU1MTI3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/5512772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nvasilevski", "html_url": "https://github.com/nvasilevski", "followers_url": "https://api.github.com/users/nvasilevski/followers", "following_url": "https://api.github.com/users/nvasilevski/following{/other_user}", "gists_url": "https://api.github.com/users/nvasilevski/gists{/gist_id}", "starred_url": "https://api.github.com/users/nvasilevski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nvasilevski/subscriptions", "organizations_url": "https://api.github.com/users/nvasilevski/orgs", "repos_url": "https://api.github.com/users/nvasilevski/repos", "events_url": "https://api.github.com/users/nvasilevski/events{/privacy}", "received_events_url": "https://api.github.com/users/nvasilevski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-26T17:05:32Z", "updated_at": "2023-07-27T11:13:41Z", "closed_at": "2023-07-27T06:29:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48817", "html_url": "https://github.com/rails/rails/pull/48817", "diff_url": "https://github.com/rails/rails/pull/48817.diff", "patch_url": "https://github.com/rails/rails/pull/48817.patch", "merged_at": "2023-07-27T06:29:47Z"}, "body": "This PR fixes a bug introduced in https://github.com/rails/rails/pull/48761 which leads to a `NoMethodError` when a non Active Record object passed to `include?` or `member?` since only Active Record objects respond to `composite_primary_key?`.\r\n\r\n### Alternative solution\r\n\r\nI decided to put the early `return` at the top before even performing the `loaded? || offset_value || limit_value || having_clause.any?` checks. I don't think this will impact performance in any noticeable way but if you have concerns feel free to speak up and we will move the check to the `else` branch\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48817/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48817/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48816", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48816/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48816/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48816/events", "html_url": "https://github.com/rails/rails/pull/48816", "id": 1822669117, "node_id": "PR_kwDNIULOVnTDzA", "number": 48816, "title": "Warn if non-AR object passed to `FinderMethods#include?`", "user": {"login": "nvasilevski", "id": 5512772, "node_id": "MDQ6VXNlcjU1MTI3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/5512772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nvasilevski", "html_url": "https://github.com/nvasilevski", "followers_url": "https://api.github.com/users/nvasilevski/followers", "following_url": "https://api.github.com/users/nvasilevski/following{/other_user}", "gists_url": "https://api.github.com/users/nvasilevski/gists{/gist_id}", "starred_url": "https://api.github.com/users/nvasilevski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nvasilevski/subscriptions", "organizations_url": "https://api.github.com/users/nvasilevski/orgs", "repos_url": "https://api.github.com/users/nvasilevski/repos", "events_url": "https://api.github.com/users/nvasilevski/events{/privacy}", "received_events_url": "https://api.github.com/users/nvasilevski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-26T15:28:22Z", "updated_at": "2023-07-26T17:09:27Z", "closed_at": "2023-07-26T17:09:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48816", "html_url": "https://github.com/rails/rails/pull/48816", "diff_url": "https://github.com/rails/rails/pull/48816.diff", "patch_url": "https://github.com/rails/rails/pull/48816.patch", "merged_at": null}, "body": "This PR fixes a bug introduced in https://github.com/rails/rails/pull/48761 which leads to a `NoMethodError` when a non Active Record object passed to `include?` or `member?` since only Active Record objects respond to `composite_primary_key?`.\r\n\r\nWe are also using it as an opportunity to reconsider the future API of the method and completely disallow non Active Record objects to be passed to avoid bugs related to the method returning `false` while not actually performing the check.\r\n\r\nIn my opinion current behavior of the method is not optimal since it gracefully returns `false` for any garbage value being passed to it. This when combined with poor tests coverage may lead to bugs while it could have been avoided by method refusing to provide any meaningful return value and raise instead. \r\n\r\nSo I'm proposing in Rails 7.2 the method will behave as follows: \r\n\r\n```ruby\r\nalice = customers(:alice)\r\nbob = customers(:bob)\r\ncustomer_relation = Customer.where(name: \"Alice\")\r\n\r\ncustomer_relation.include?(alice) # => true, which means we can reliably tell that `alice` record is represented by the relation \r\n\r\ncustomer_relation.include?(bob) # => false, which means we can reliably tell that `bob` is not part of the given customers relation\r\n\r\ncustomer_relation.include?(\"i'm just a string\") # => raises `ArgumentError`, which means we can't reliably answer the question as we can't derive what is being asked\r\n```\r\n\r\nBut until then we will just issue a warning\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48816/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48816/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48815", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48815/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48815/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48815/events", "html_url": "https://github.com/rails/rails/issues/48815", "id": 1822547052, "node_id": "I_kwDNIULObKHcbA", "number": 48815, "title": "CSP Middleware wrongly uses upper case header names", "user": {"login": "andrepiske", "id": 505452, "node_id": "MDQ6VXNlcjUwNTQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/505452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrepiske", "html_url": "https://github.com/andrepiske", "followers_url": "https://api.github.com/users/andrepiske/followers", "following_url": "https://api.github.com/users/andrepiske/following{/other_user}", "gists_url": "https://api.github.com/users/andrepiske/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrepiske/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrepiske/subscriptions", "organizations_url": "https://api.github.com/users/andrepiske/orgs", "repos_url": "https://api.github.com/users/andrepiske/repos", "events_url": "https://api.github.com/users/andrepiske/events{/privacy}", "received_events_url": "https://api.github.com/users/andrepiske/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-07-26T14:30:17Z", "updated_at": "2023-07-29T00:01:21Z", "closed_at": "2023-07-29T00:01:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "`ActionDispatch::ContentSecurityPolicy::Middleware#policy_present` wrongly checks if a policy is already defined in the headers because it checks for a `Content-Security-Policy` header but won't check for `content-security-policy`.\r\nThis leads to the middleware then replacing a previously existing policy.\r\n\r\nFor instance, when using Rails 7.0.6 and Sidekiq 7.1.2 and a strict CSP is configured in rails (e.g. one that requires nonces in inline `script` tags), sidekiq dashboard UI breaks because it contains inline script tags. Those script tags should be affected by Sidekiq's own CSP which is set in https://github.com/sidekiq/sidekiq/blob/b3225ce/lib/sidekiq/web/application.rb#L353 but they're set with a lower case header name, which then gets ignored by rails' CSP middleware.\r\n\r\n[Rack 2 & 3 compatibility guidelines](https://github.com/rack/rack/blob/main/UPGRADE-GUIDE.md#rack-2--rack-3-compatibility) states:\r\n\r\n> Response header keys can no longer include uppercase characters.\r\n\r\nThus I believe rails CSP middleware should check & set only lowercase characters.\r\n\r\nI'm happy to provide a PR with a fix, but I'm unsure if just changing those to lowercase wouldn't impact other things too much.\r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.2.2", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48815/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48815/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48814", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48814/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48814/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48814/events", "html_url": "https://github.com/rails/rails/pull/48814", "id": 1822512877, "node_id": "PR_kwDNIULOVnKoGw", "number": 48814, "title": "Add Rack::Lint to HostAuthorization tests", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-26T14:14:27Z", "updated_at": "2023-07-27T20:31:39Z", "closed_at": "2023-07-27T19:49:10Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48814", "html_url": "https://github.com/rails/rails/pull/48814", "diff_url": "https://github.com/rails/rails/pull/48814.diff", "patch_url": "https://github.com/rails/rails/pull/48814.patch", "merged_at": "2023-07-27T19:49:10Z"}, "body": "### Motivation / Background\r\n\r\nRef skipkayhil#5\r\n\r\nThis adds additional test coverage to HostAuthorization to validate that its behavior conforms to the Rack SPEC.\r\n\r\n### Detail\r\n\r\nBy using Rack:: constants for Content-Type and Content-Length, we are able to use the \"correct\" versions of the headers for applications using each Rack version.\r\n\r\nAdditionally, two tests had to be updated that use an ipv6 address without brackets in the HOST header because Rack::Lint warned that these addresses were not valid HOST values. Rack::Lint checks HOST headers using `URI.parse(\"http://#{HOST}/\")`, and from what I could find, this requirement follows RFC 3986 Section 3.2.2:\r\n\r\n```\r\nhost        = IP-literal / IPv4address / reg-name\r\nIP-literal = \"[\" ( IPv6address / IPvFuture  ) \"]\"\r\nIPvFuture  = \"v\" 1*HEXDIG \".\" 1*( unreserved / sub-delims / \":\" )\r\n```\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48814/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48814/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48813", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48813/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48813/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48813/events", "html_url": "https://github.com/rails/rails/pull/48813", "id": 1822374887, "node_id": "PR_kwDNIULOVnDLew", "number": 48813, "title": "Add Rack::Lint to ActionableExceptions tests", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-26T13:02:48Z", "updated_at": "2023-07-27T20:36:16Z", "closed_at": "2023-07-27T20:22:47Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48813", "html_url": "https://github.com/rails/rails/pull/48813", "diff_url": "https://github.com/rails/rails/pull/48813.diff", "patch_url": "https://github.com/rails/rails/pull/48813.patch", "merged_at": "2023-07-27T20:22:47Z"}, "body": "### Motivation / Background\r\n\r\nRef skipkayhil#5\r\n\r\nThis adds additional test coverage to ActionableExceptions to validate that its behavior conforms to the Rack SPEC.\r\n\r\n### Detail\r\n\r\nThe changes neccesary were to ensure that Response headers are downcased when using Rack 3. For Content-Type and Content-Length, this is trivial because Rack provides constants who's casing is dependent on the version (Rack 2 is mixed, and Rack 3 is downcased). Since Rack does not include a LOCATION constant, the Response::LOCATION constant was updated to have a downcased value when using Rack 3.\r\n\r\nAdditionally, there was some missing coverage for invalid redirect URLs which was addressed as well.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48813/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48813/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48812", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48812/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48812/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48812/events", "html_url": "https://github.com/rails/rails/pull/48812", "id": 1822372296, "node_id": "PR_kwDNIULOVnDCcQ", "number": 48812, "title": "Add Rack::Lint to ContentSecurityPolicy::Middleware tests", "user": {"login": "nunosilva800", "id": 1113178, "node_id": "MDQ6VXNlcjExMTMxNzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1113178?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nunosilva800", "html_url": "https://github.com/nunosilva800", "followers_url": "https://api.github.com/users/nunosilva800/followers", "following_url": "https://api.github.com/users/nunosilva800/following{/other_user}", "gists_url": "https://api.github.com/users/nunosilva800/gists{/gist_id}", "starred_url": "https://api.github.com/users/nunosilva800/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nunosilva800/subscriptions", "organizations_url": "https://api.github.com/users/nunosilva800/orgs", "repos_url": "https://api.github.com/users/nunosilva800/repos", "events_url": "https://api.github.com/users/nunosilva800/events{/privacy}", "received_events_url": "https://api.github.com/users/nunosilva800/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "guilleiguaran", "id": 160941, "node_id": "MDQ6VXNlcjE2MDk0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/160941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guilleiguaran", "html_url": "https://github.com/guilleiguaran", "followers_url": "https://api.github.com/users/guilleiguaran/followers", "following_url": "https://api.github.com/users/guilleiguaran/following{/other_user}", "gists_url": "https://api.github.com/users/guilleiguaran/gists{/gist_id}", "starred_url": "https://api.github.com/users/guilleiguaran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guilleiguaran/subscriptions", "organizations_url": "https://api.github.com/users/guilleiguaran/orgs", "repos_url": "https://api.github.com/users/guilleiguaran/repos", "events_url": "https://api.github.com/users/guilleiguaran/events{/privacy}", "received_events_url": "https://api.github.com/users/guilleiguaran/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "guilleiguaran", "id": 160941, "node_id": "MDQ6VXNlcjE2MDk0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/160941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guilleiguaran", "html_url": "https://github.com/guilleiguaran", "followers_url": "https://api.github.com/users/guilleiguaran/followers", "following_url": "https://api.github.com/users/guilleiguaran/following{/other_user}", "gists_url": "https://api.github.com/users/guilleiguaran/gists{/gist_id}", "starred_url": "https://api.github.com/users/guilleiguaran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guilleiguaran/subscriptions", "organizations_url": "https://api.github.com/users/guilleiguaran/orgs", "repos_url": "https://api.github.com/users/guilleiguaran/repos", "events_url": "https://api.github.com/users/guilleiguaran/events{/privacy}", "received_events_url": "https://api.github.com/users/guilleiguaran/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2023-07-26T13:01:19Z", "updated_at": "2023-08-02T18:35:44Z", "closed_at": "2023-07-28T17:27:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48812", "html_url": "https://github.com/rails/rails/pull/48812", "diff_url": "https://github.com/rails/rails/pull/48812.diff", "patch_url": "https://github.com/rails/rails/pull/48812.patch", "merged_at": "2023-07-28T17:27:27Z"}, "body": "### Motivation / Background\r\n\r\nTo ensure Rails is and remains compliant with [the Rack 3 spec](https://github.com/rack/rack/blob/6d16306192349e665e4ec820a9bfcc0967009b6a/UPGRADE-GUIDE.md) we can add `Rack::Lint` to the Rails middleware tests.\r\n\r\n### Detail\r\n\r\nThis adds additional test coverage to `ContentSecurityPolicy::Middleware` to validate that its input and output follow the Rack SPEC.\r\n\r\nThe changes made are because of:\r\n- [Response Headers must be lower case](https://github.com/rack/rack/blob/6d16306192349e665e4ec820a9bfcc0967009b6a/UPGRADE-GUIDE.md#response-headers-must-be-lower-case)\r\n\r\nAdded tests to ensure that CSP headers set by an app are not overridden, regardless of the casing.\r\nAn example of this is Sidekiq: https://github.com/sidekiq/sidekiq/blob/b3225ce/lib/sidekiq/web/application.rb#L353\r\n\r\n\r\n### Additional information\r\n\r\n- https://github.com/skipkayhil/tmp-rails/issues/1\r\n- https://github.com/rails/rails/issues/48815\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48812/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48812/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48874", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48874/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48874/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48874/events", "html_url": "https://github.com/rails/rails/issues/48874", "id": 1833726665, "node_id": "I_kwDNIULObUxyyQ", "number": 48874, "title": "Rack::Lint on Rails", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 149514554, "node_id": "MDU6TGFiZWwxNDk1MTQ1NTQ=", "url": "https://api.github.com/repos/rails/rails/labels/pinned", "name": "pinned", "color": "f7c6c7", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-07-26T12:30:45Z", "updated_at": "2023-08-03T18:49:36Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Meta issue for adding `Rack::Lint` to Rails middleware tests.\r\n\r\nAs Rack 3 can now be used with Rails main, it is necessary to ensure that all of the middleware defined in Rails adhere to the Rack SPEC. While existing test coverage was able to find many of the incompatibilities, I've seen multiple examples of mixed case header usage left that need to be fixed. Instead of trying to `grep` or otherwise manually find these middleware that aren't adhering to the SPEC, I'd like to add Rack::Lint to (every?) middleware's unit test in Rails so that we can be sure they follow the Rack 3 SPEC programmatically.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48874/reactions", "total_count": 4, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 4, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48874/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48811", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48811/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48811/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48811/events", "html_url": "https://github.com/rails/rails/pull/48811", "id": 1822171887, "node_id": "PR_kwDNIULOVm4Iqw", "number": 48811, "title": "Add Rack::Lint to AssumeSSL middleware tests", "user": {"login": "nunosilva800", "id": 1113178, "node_id": "MDQ6VXNlcjExMTMxNzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1113178?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nunosilva800", "html_url": "https://github.com/nunosilva800", "followers_url": "https://api.github.com/users/nunosilva800/followers", "following_url": "https://api.github.com/users/nunosilva800/following{/other_user}", "gists_url": "https://api.github.com/users/nunosilva800/gists{/gist_id}", "starred_url": "https://api.github.com/users/nunosilva800/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nunosilva800/subscriptions", "organizations_url": "https://api.github.com/users/nunosilva800/orgs", "repos_url": "https://api.github.com/users/nunosilva800/repos", "events_url": "https://api.github.com/users/nunosilva800/events{/privacy}", "received_events_url": "https://api.github.com/users/nunosilva800/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-26T11:12:14Z", "updated_at": "2023-08-02T18:44:25Z", "closed_at": "2023-07-27T19:56:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48811", "html_url": "https://github.com/rails/rails/pull/48811", "diff_url": "https://github.com/rails/rails/pull/48811.diff", "patch_url": "https://github.com/rails/rails/pull/48811.patch", "merged_at": "2023-07-27T19:56:45Z"}, "body": "### Motivation / Background\r\n\r\nTo ensure Rails is and remains compliant with [the Rack 3 spec](https://github.com/rack/rack/blob/6d16306192349e665e4ec820a9bfcc0967009b6a/UPGRADE-GUIDE.md) we can add `Rack::Lint` to the Rails middleware tests.\r\n\r\n- https://github.com/skipkayhil/tmp-rails/issues/1\r\n\r\n### Detail\r\n\r\nThere was no test file for ActionDispatch::AssumeSSL, so this change\r\nadds one and validating that its input and output follow the Rack SPEC.\r\n\r\n### Additional information\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48811/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48811/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48810", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48810/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48810/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48810/events", "html_url": "https://github.com/rails/rails/pull/48810", "id": 1821909996, "node_id": "PR_kwDNIULOVmp5vA", "number": 48810, "title": "Add Rack::Lint to ActionDispatch::Callbacks tests", "user": {"login": "nunosilva800", "id": 1113178, "node_id": "MDQ6VXNlcjExMTMxNzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1113178?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nunosilva800", "html_url": "https://github.com/nunosilva800", "followers_url": "https://api.github.com/users/nunosilva800/followers", "following_url": "https://api.github.com/users/nunosilva800/following{/other_user}", "gists_url": "https://api.github.com/users/nunosilva800/gists{/gist_id}", "starred_url": "https://api.github.com/users/nunosilva800/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nunosilva800/subscriptions", "organizations_url": "https://api.github.com/users/nunosilva800/orgs", "repos_url": "https://api.github.com/users/nunosilva800/repos", "events_url": "https://api.github.com/users/nunosilva800/events{/privacy}", "received_events_url": "https://api.github.com/users/nunosilva800/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-26T09:00:08Z", "updated_at": "2023-08-02T18:35:43Z", "closed_at": "2023-07-27T20:51:20Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48810", "html_url": "https://github.com/rails/rails/pull/48810", "diff_url": "https://github.com/rails/rails/pull/48810.diff", "patch_url": "https://github.com/rails/rails/pull/48810.patch", "merged_at": "2023-07-27T20:51:20Z"}, "body": "### Motivation / Background\r\n\r\nTo ensure Rails is and remains compliant with [the Rack 3 spec](https://github.com/rack/rack/blob/6d16306192349e665e4ec820a9bfcc0967009b6a/UPGRADE-GUIDE.md) we can add `Rack::Lint` to the Rails middleware tests.\r\n\r\nThis adds additional test coverage for ActionDispatch::Callbacks by validating that its input and output follow the Rack SPEC.\r\n\r\n- https://github.com/skipkayhil/tmp-rails/issues/1\r\n\r\n### Detail\r\n\r\n`ActionDispatch::Callbacks` makes no changes to the input or output of the Rack app itself, so these tests are trivial.\r\n\r\n### Additional information\r\n\r\nThe `\"rack.input\" => StringIO.new(\"\")` header value raised the following error:\r\n\r\n```\r\nRack::Lint::LintError: rack.input #<StringIO:0x00007fd7513fe550> does not have ASCII-8BIT as its external encoding\r\n```\r\n\r\nSince this header is not required for the test, it is now removed.\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48810/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48810/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48809", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48809/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48809/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48809/events", "html_url": "https://github.com/rails/rails/pull/48809", "id": 1821669532, "node_id": "PR_kwDNIULOVmdHGA", "number": 48809, "title": "[7-0-stable] Revert singular association breaking changes", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-26T06:22:30Z", "updated_at": "2023-08-02T00:09:26Z", "closed_at": "2023-08-01T23:01:27Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48809", "html_url": "https://github.com/rails/rails/pull/48809", "diff_url": "https://github.com/rails/rails/pull/48809.diff", "patch_url": "https://github.com/rails/rails/pull/48809.patch", "merged_at": "2023-08-01T23:01:27Z"}, "body": "For the `7-0-stable` branch, this reverts the tests added in #48425, and the original breaking change from #46790.\r\n\r\nWhile this breaks the behavior expected from #46737 and #47554, it restores the original behavior expected of `create_record` on a singular association which has persisted for many years. Due to this change, reports came in about the uniqueness validation failing, such as #48632 and #48330, as well as breaking many tests in one of the applications at work.\r\n\r\nThis lead to attempts to circumvent this breaking change like #48643, and others to try and prevent the support of the original behavior by raising in #48683.\r\n\r\nThese are hard problems to solve, and after discussing with @matthewd, the best path forward is to revert and start from scratch. Then we can discuss future changes to this behavior over new PRs.\r\n\r\n\r\n---\r\n\r\nThere is an equivalent PR for `main` at #48808\r\n\r\n/cc @byroot", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48809/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48809/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48808", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48808/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48808/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48808/events", "html_url": "https://github.com/rails/rails/pull/48808", "id": 1821669498, "node_id": "PR_kwDNIULOVmdG-w", "number": 48808, "title": "Revert singular association breaking changes", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-26T06:22:28Z", "updated_at": "2023-08-02T00:09:32Z", "closed_at": "2023-08-01T23:01:36Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48808", "html_url": "https://github.com/rails/rails/pull/48808", "diff_url": "https://github.com/rails/rails/pull/48808.diff", "patch_url": "https://github.com/rails/rails/pull/48808.patch", "merged_at": "2023-08-01T23:01:36Z"}, "body": "Pumping the breaks on the recent changes to singular create associations.\r\n\r\nThis reverts the tests added in #48416 (which added back the behavior from #46790), and the original breaking change from #46386.\r\n\r\nWhile this breaks the behavior expected from #46737 and #47554, it restores the original behavior expected of `create_record` on a singular association which has persisted for many years. Due to this change, reports came in about the uniqueness validation failing, such as #48632 and #48330, as well as breaking many tests in one of the applications at work.\r\n\r\nThis lead to attempts to circumvent this breaking change like #48643, and others to try and prevent the support of the original behavior by raising in #48683.\r\n\r\nThese are hard problems to solve, and after discussing with @matthewd, the best path forward is to revert and start from scratch. Then we can discuss future changes to this behavior over new PRs.\r\n\r\n---\r\n\r\nThere is an equivalent PR for `7-0-stable` at #48809\r\n\r\n/cc @byroot ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48808/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48808/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48807", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48807/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48807/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48807/events", "html_url": "https://github.com/rails/rails/pull/48807", "id": 1821637754, "node_id": "PR_kwDNIULOVmbcvw", "number": 48807, "title": "Support filtering tests by line ranges", "user": {"login": "shouichi", "id": 99586, "node_id": "MDQ6VXNlcjk5NTg2", "avatar_url": "https://avatars.githubusercontent.com/u/99586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shouichi", "html_url": "https://github.com/shouichi", "followers_url": "https://api.github.com/users/shouichi/followers", "following_url": "https://api.github.com/users/shouichi/following{/other_user}", "gists_url": "https://api.github.com/users/shouichi/gists{/gist_id}", "starred_url": "https://api.github.com/users/shouichi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shouichi/subscriptions", "organizations_url": "https://api.github.com/users/shouichi/orgs", "repos_url": "https://api.github.com/users/shouichi/repos", "events_url": "https://api.github.com/users/shouichi/events{/privacy}", "received_events_url": "https://api.github.com/users/shouichi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-26T05:57:52Z", "updated_at": "2023-08-01T07:05:30Z", "closed_at": "2023-08-01T06:40:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48807", "html_url": "https://github.com/rails/rails/pull/48807", "diff_url": "https://github.com/rails/rails/pull/48807.diff", "patch_url": "https://github.com/rails/rails/pull/48807.patch", "merged_at": "2023-08-01T06:40:51Z"}, "body": "The new syntax allows you to filter tests by line ranges. For example, the following command runs tests from line 10 to 20.\r\n\r\n```bash\r\n$ rails test test/models/user_test.rb:10-20\r\n```", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48807/reactions", "total_count": 16, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 2, "rocket": 9, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48807/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48806", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48806/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48806/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48806/events", "html_url": "https://github.com/rails/rails/pull/48806", "id": 1821590767, "node_id": "PR_kwDNIULOVmZCCQ", "number": 48806, "title": "[skip ci] Added some grammatical changes and missing punctuations", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}, {"id": 1072773639, "node_id": "MDU6TGFiZWwxMDcyNzczNjM5", "url": "https://api.github.com/repos/rails/rails/labels/ready", "name": "ready", "color": "fef2c0", "default": false, "description": "PRs ready to merge"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-26T05:09:20Z", "updated_at": "2023-08-02T02:36:38Z", "closed_at": "2023-08-01T22:07:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48806", "html_url": "https://github.com/rails/rails/pull/48806", "diff_url": "https://github.com/rails/rails/pull/48806.diff", "patch_url": "https://github.com/rails/rails/pull/48806.patch", "merged_at": "2023-08-01T22:07:34Z"}, "body": "### Detail\r\n\r\nThis PR includes grammatical changes and added some missing punctuation to the active record multiple database guide.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48806/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48806/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48805", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48805/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48805/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48805/events", "html_url": "https://github.com/rails/rails/pull/48805", "id": 1821572644, "node_id": "PR_kwDNIULOVmYG0w", "number": 48805, "title": "Add Rack::Lint to RequestId tests", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "guilleiguaran", "id": 160941, "node_id": "MDQ6VXNlcjE2MDk0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/160941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guilleiguaran", "html_url": "https://github.com/guilleiguaran", "followers_url": "https://api.github.com/users/guilleiguaran/followers", "following_url": "https://api.github.com/users/guilleiguaran/following{/other_user}", "gists_url": "https://api.github.com/users/guilleiguaran/gists{/gist_id}", "starred_url": "https://api.github.com/users/guilleiguaran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guilleiguaran/subscriptions", "organizations_url": "https://api.github.com/users/guilleiguaran/orgs", "repos_url": "https://api.github.com/users/guilleiguaran/repos", "events_url": "https://api.github.com/users/guilleiguaran/events{/privacy}", "received_events_url": "https://api.github.com/users/guilleiguaran/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "guilleiguaran", "id": 160941, "node_id": "MDQ6VXNlcjE2MDk0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/160941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guilleiguaran", "html_url": "https://github.com/guilleiguaran", "followers_url": "https://api.github.com/users/guilleiguaran/followers", "following_url": "https://api.github.com/users/guilleiguaran/following{/other_user}", "gists_url": "https://api.github.com/users/guilleiguaran/gists{/gist_id}", "starred_url": "https://api.github.com/users/guilleiguaran/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guilleiguaran/subscriptions", "organizations_url": "https://api.github.com/users/guilleiguaran/orgs", "repos_url": "https://api.github.com/users/guilleiguaran/repos", "events_url": "https://api.github.com/users/guilleiguaran/events{/privacy}", "received_events_url": "https://api.github.com/users/guilleiguaran/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2023-07-26T04:48:26Z", "updated_at": "2023-08-02T21:48:24Z", "closed_at": "2023-07-28T17:25:50Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48805", "html_url": "https://github.com/rails/rails/pull/48805", "diff_url": "https://github.com/rails/rails/pull/48805.diff", "patch_url": "https://github.com/rails/rails/pull/48805.patch", "merged_at": "2023-07-28T17:25:50Z"}, "body": "### Motivation / Background\r\n\r\nRef #48874\r\n\r\nThis adds additional test coverage to RequestId to validate that its input and output follow the Rack SPEC.\r\n\r\n### Detail\r\n\r\nIn this case, the only changes necessary were to the Request tests. This is due to the fact that the Request and Response tests use different classes for their Response headers. The Response tests simulate a Rails app, where the Response headers will be a Rack::Headers object for compatbility with both Rack 2 and 3. However, since the Request tests are only using the Hash returned by the test app, the tests must use a downcased header to support both Rack 2 and Rack 3.\r\n\r\n### Additional information\r\n\r\n~In the future when Rack::Headers is eventually removed, `config.action_dispatch.request_id_header` will need to be changed from \"X-Request-Id\" to \"x-request-id\".~ I changed my mind and now think its important to make this change now. Is this something we should be using `new_framework_defaults` for? (Or maybe we just downcase whatever string is passed into the middleware?)\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48805/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48805/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48804", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48804/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48804/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48804/events", "html_url": "https://github.com/rails/rails/pull/48804", "id": 1821538167, "node_id": "PR_kwDNIULOVmWXbQ", "number": 48804, "title": "Change lanes to update callbacks when an autosaved record already exists", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-26T04:05:40Z", "updated_at": "2023-07-26T04:24:53Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48804", "html_url": "https://github.com/rails/rails/pull/48804", "diff_url": "https://github.com/rails/rails/pull/48804.diff", "patch_url": "https://github.com/rails/rails/pull/48804.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThis address the bug identified in #47171, which is occurs when an autosave is triggered in a before_create, resulting in a the create callbacks occurring twice. The second time on a record that was already persisted, but since there are no attributes changed (it's a clean record), the new record receives the default values.\r\n\r\nNow when an autosave occurs in a before_create, we run the update callbacks as well as any create callbacks to avoid confusing situation.\r\n\r\n### Alternatives Considered\r\n\r\n#### 1) Call an aliased method `_update_record_without_callbacks` and return\r\n\r\nThis would avoid creating the duplicate record, but may surprise the developer if any `after_*` callbacks they were expecting didn't occur.\r\n\r\nWe wanted to retain that same guarantee.\r\n\r\n#### 2) Raise if the record is already persisted\r\n\r\nThe previous behavior of creating multiple records may have simply gone unnoticed to users, and raising would be a breaking change.\r\n\r\nWe could roll out that behavior behind a flag and deprecation warning, but we wanted to try and solve for this edge-case.\r\n\r\n#### 3) Return if record is already persisted and no dirty changes\r\n\r\nSimilar to the second option, silently allowing this behavior to change could have unexpected consequences.\r\n\r\nThe interesting thing was also non of the Active Record tests failed if we just stopped the callback chain there.\r\n\r\n### Additional information\r\n\r\nFixes #47171", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48804/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48804/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48803", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48803/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48803/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48803/events", "html_url": "https://github.com/rails/rails/pull/48803", "id": 1821367990, "node_id": "PR_kwDNIULOVmNtzQ", "number": 48803, "title": "Update capybara gem to version 3.38", "user": {"login": "VSPPedro", "id": 18314910, "node_id": "MDQ6VXNlcjE4MzE0OTEw", "avatar_url": "https://avatars.githubusercontent.com/u/18314910?v=4", "gravatar_id": "", "url": "https://api.github.com/users/VSPPedro", "html_url": "https://github.com/VSPPedro", "followers_url": "https://api.github.com/users/VSPPedro/followers", "following_url": "https://api.github.com/users/VSPPedro/following{/other_user}", "gists_url": "https://api.github.com/users/VSPPedro/gists{/gist_id}", "starred_url": "https://api.github.com/users/VSPPedro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/VSPPedro/subscriptions", "organizations_url": "https://api.github.com/users/VSPPedro/orgs", "repos_url": "https://api.github.com/users/VSPPedro/repos", "events_url": "https://api.github.com/users/VSPPedro/events{/privacy}", "received_events_url": "https://api.github.com/users/VSPPedro/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-26T00:28:56Z", "updated_at": "2023-07-26T17:23:23Z", "closed_at": "2023-07-26T17:09:18Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48803", "html_url": "https://github.com/rails/rails/pull/48803", "diff_url": "https://github.com/rails/rails/pull/48803.diff", "patch_url": "https://github.com/rails/rails/pull/48803.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nI noticed that there is a difference between the version being specified for capybara in the gemfile and in the system_test_case.rb.\r\n\r\n### Detail\r\n\r\nThis PR is just a continuation of this https://github.com/rails/rails/pull/46840.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48803/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48803/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48802", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48802/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48802/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48802/events", "html_url": "https://github.com/rails/rails/issues/48802", "id": 1820814581, "node_id": "I_kwDNIULObIds9Q", "number": 48802, "title": "`ActiveModel::Type::DateTime#cast_value` can cause silent data loss", "user": {"login": "elebow", "id": 7873686, "node_id": "MDQ6VXNlcjc4NzM2ODY=", "avatar_url": "https://avatars.githubusercontent.com/u/7873686?v=4", "gravatar_id": "", "url": "https://api.github.com/users/elebow", "html_url": "https://github.com/elebow", "followers_url": "https://api.github.com/users/elebow/followers", "following_url": "https://api.github.com/users/elebow/following{/other_user}", "gists_url": "https://api.github.com/users/elebow/gists{/gist_id}", "starred_url": "https://api.github.com/users/elebow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/elebow/subscriptions", "organizations_url": "https://api.github.com/users/elebow/orgs", "repos_url": "https://api.github.com/users/elebow/repos", "events_url": "https://api.github.com/users/elebow/events{/privacy}", "received_events_url": "https://api.github.com/users/elebow/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-07-25T17:36:11Z", "updated_at": "2023-08-02T21:38:16Z", "closed_at": "2023-08-01T23:10:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "`ActiveModel::Type::DateTime#cast_value` relies on Ruby's `Date._parse` to convert a String to a Hash of date components. The Ruby documentation notes that this function does no validation, and a string that does not represent a valid date causes unpredictable behavior.\r\n\r\nThis causes some undesired behavior in Rails:\r\n\r\n```ruby\r\nArticle.where(date: \"pizza\").to_sql\r\n=> \"SELECT \\\"articles\\\".* FROM \\\"articles\\\" WHERE \\\"articles\\\".\\\"date\\\" = NULL\"\r\n```\r\n\r\n```ruby\r\nArticle.first.update!(date: \"pizza\")\r\n  Article Load (0.1ms)  SELECT \"articles\".* FROM \"articles\" ORDER BY \"articles\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n  TRANSACTION (0.1ms)  begin transaction\r\n  Article Update (0.8ms)  UPDATE \"articles\" SET \"date\" = ?, \"updated_at\" = ? WHERE \"articles\".\"id\" = ?  [[\"date\", nil], [\"updated_at\", \"2023-07-25 17:13:31.934971\"], [\"id\", 1]]\r\n  TRANSACTION (1.4ms)  commit transaction\r\n=> true\r\n\r\nArticle.first.date\r\n  Article Load (0.1ms)  SELECT \"articles\".* FROM \"articles\" ORDER BY \"articles\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n=> nil\r\n```\r\n\r\nI suggest using Ruby's `DateTime.parse` instead of `Date._parse`. It has the same warning about undefined behavior, but it also instantiates a `DateTime` object, which raises an `ArgumentError` if the input is not a datetime\u2014note the test changes in the below diff.\r\n\r\n```diff\r\ndiff --git a/activemodel/lib/active_model/type/date_time.rb b/activemodel/lib/active_model/type/date_time.rb\r\nindex e85dc67a20..03b1576641 100644\r\n--- a/activemodel/lib/active_model/type/date_time.rb\r\n+++ b/activemodel/lib/active_model/type/date_time.rb\r\n@@ -53,27 +53,21 @@ def type\r\n       private\r\n         def cast_value(value)\r\n           return apply_seconds_precision(value) unless value.is_a?(::String)\r\n-          return if value.empty?\r\n \r\n           fast_string_to_time(value) || fallback_string_to_time(value)\r\n         end\r\n \r\n-        # '0.123456' -> 123456\r\n-        # '1.123456' -> 123456\r\n-        def microseconds(time)\r\n-          time[:sec_fraction] ? (time[:sec_fraction] * 1_000_000).to_i : 0\r\n-        end\r\n-\r\n         def fallback_string_to_time(string)\r\n-          time_hash = begin\r\n-            ::Date._parse(string)\r\n-          rescue ArgumentError\r\n-          end\r\n-          return unless time_hash\r\n-\r\n-          time_hash[:sec_fraction] = microseconds(time_hash)\r\n+          datetime = ::DateTime.parse(string)\r\n \r\n-          new_time(*time_hash.values_at(:year, :mon, :mday, :hour, :min, :sec, :sec_fraction, :offset))\r\n+          new_time(datetime.year,\r\n+                   datetime.mon,\r\n+                   datetime.mday,\r\n+                   datetime.hour,\r\n+                   datetime.min,\r\n+                   datetime.sec,\r\n+                   datetime.sec_fraction * 1_000_000, # new_time expects microseconds\r\n+                   datetime.offset * 3600 * 24) # DateTime#offset is fraction of day, but new_time expects seconds\r\n         end\r\n \r\n         def value_from_multiparameter_assignment(values_hash)\r\ndiff --git a/activemodel/test/cases/type/date_time_test.rb b/activemodel/test/cases/type/date_time_test.rb\r\nindex bee7da7124..c7c9d5d520 100644\r\n--- a/activemodel/test/cases/type/date_time_test.rb\r\n+++ b/activemodel/test/cases/type/date_time_test.rb\r\n@@ -8,10 +8,11 @@ class DateTimeTest < ActiveModel::TestCase\r\n       def test_type_cast_datetime_and_timestamp\r\n         type = Type::DateTime.new\r\n         assert_nil type.cast(nil)\r\n-        assert_nil type.cast(\"\")\r\n-        assert_nil type.cast(\"  \")\r\n-        assert_nil type.cast(\"ABC\")\r\n-        assert_nil type.cast(\" \" * 129)\r\n+\r\n+        assert_raises(ArgumentError) { type.cast(\"\") }\r\n+        assert_raises(ArgumentError) { type.cast(\"  \") }\r\n+        assert_raises(ArgumentError) { type.cast(\"ABC\") }\r\n+        assert_raises(ArgumentError) { type.cast(\" \" * 129) }\r\n \r\n         datetime_string = ::Time.now.utc.strftime(\"%FT%T\")\r\n         assert_equal datetime_string, type.cast(datetime_string).strftime(\"%FT%T\")\r\n@@ -21,7 +22,7 @@ def test_string_to_time_with_timezone\r\n         [\"UTC\", \"US/Eastern\"].each do |zone|\r\n           with_timezone_config default: zone do\r\n             type = Type::DateTime.new\r\n-            assert_equal ::Time.utc(2013, 9, 4, 0, 0, 0), type.cast(\"Wed, 04 Sep 2013 03:00:00 EAT\")\r\n+            assert_equal ::DateTime.new(2013, 9, 4, 0, 0, 0.005, 0), type.cast(\"Wed, 04 Sep 2013 03:00:00.0050 EAT\")\r\n           end\r\n         end\r\n       end\r\n```\r\n\r\nI did not measure performance implications. If this change is desirable, I can put together a more complete PR.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48802/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48802/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48801", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48801/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48801/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48801/events", "html_url": "https://github.com/rails/rails/issues/48801", "id": 1820771987, "node_id": "I_kwDNIULObIbGkw", "number": 48801, "title": "ActiveStorage: Convert has no effect on content_type in the variants Options", "user": {"login": "vincent-the", "id": 4801522, "node_id": "MDQ6VXNlcjQ4MDE1MjI=", "avatar_url": "https://avatars.githubusercontent.com/u/4801522?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vincent-the", "html_url": "https://github.com/vincent-the", "followers_url": "https://api.github.com/users/vincent-the/followers", "following_url": "https://api.github.com/users/vincent-the/following{/other_user}", "gists_url": "https://api.github.com/users/vincent-the/gists{/gist_id}", "starred_url": "https://api.github.com/users/vincent-the/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vincent-the/subscriptions", "organizations_url": "https://api.github.com/users/vincent-the/orgs", "repos_url": "https://api.github.com/users/vincent-the/repos", "events_url": "https://api.github.com/users/vincent-the/events{/privacy}", "received_events_url": "https://api.github.com/users/vincent-the/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2023-07-25T17:12:16Z", "updated_at": "2023-08-05T10:37:33Z", "closed_at": "2023-08-05T10:37:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\nIn Model:\r\n```ruby\r\nclass User < ApplicationRecord\r\n  has_one_attached :image do |attachable|\r\n    attachable.variant :medium, {resize_to_limit: [500, 500], convert: :webp}\r\n  end\r\nend\r\n```\r\nIn View:\r\n\r\n```ruby\r\n<%= image_tag user.image.variant(:medium) %>\r\n```\r\n\r\n\r\n### Expected behavior\r\nThe content_type should be set to image/webp, and the filename extension should be changed to .webp as well.\r\n\r\n### Actual behavior\r\nThe image is converted to webp, but content_type and extension remains jpeg.\r\n\r\n### System configuration\r\n**Rails version**: 7.0.4\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48801/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48801/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48800", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48800/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48800/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48800/events", "html_url": "https://github.com/rails/rails/pull/48800", "id": 1820657915, "node_id": "PR_kwDNIULOVlnLjg", "number": 48800, "title": "Fix `ActiveSupport::Inflector.humanize(nil)`", "user": {"login": "robinjam", "id": 657807, "node_id": "MDQ6VXNlcjY1NzgwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/657807?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robinjam", "html_url": "https://github.com/robinjam", "followers_url": "https://api.github.com/users/robinjam/followers", "following_url": "https://api.github.com/users/robinjam/following{/other_user}", "gists_url": "https://api.github.com/users/robinjam/gists{/gist_id}", "starred_url": "https://api.github.com/users/robinjam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robinjam/subscriptions", "organizations_url": "https://api.github.com/users/robinjam/orgs", "repos_url": "https://api.github.com/users/robinjam/repos", "events_url": "https://api.github.com/users/robinjam/events{/privacy}", "received_events_url": "https://api.github.com/users/robinjam/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-25T16:02:22Z", "updated_at": "2023-07-25T19:39:09Z", "closed_at": "2023-07-25T19:34:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48800", "html_url": "https://github.com/rails/rails/pull/48800", "diff_url": "https://github.com/rails/rails/pull/48800.diff", "patch_url": "https://github.com/rails/rails/pull/48800.patch", "merged_at": "2023-07-25T19:34:27Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nFixes a regression introduced in #48348.\r\n\r\nIn activesupport v7.0.5.1, `ActiveSupport::Inflector.humanize(nil)` returned `\"\"`.\r\nIn activesupport v7.0.6, it raises ``NoMethodError: undefined method `end_with?' for nil:NilClass``.\r\n\r\n### Detail\r\n\r\nThis PR adds a regression test to surface the issue, and restores the original behaviour.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48800/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48800/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48799", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48799/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48799/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48799/events", "html_url": "https://github.com/rails/rails/pull/48799", "id": 1819685364, "node_id": "PR_kwDNIULOVkyKkw", "number": 48799, "title": "Clarify on how to return records in order of ids in ActiveRecord", "user": {"login": "chendo", "id": 2661, "node_id": "MDQ6VXNlcjI2NjE=", "avatar_url": "https://avatars.githubusercontent.com/u/2661?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chendo", "html_url": "https://github.com/chendo", "followers_url": "https://api.github.com/users/chendo/followers", "following_url": "https://api.github.com/users/chendo/following{/other_user}", "gists_url": "https://api.github.com/users/chendo/gists{/gist_id}", "starred_url": "https://api.github.com/users/chendo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chendo/subscriptions", "organizations_url": "https://api.github.com/users/chendo/orgs", "repos_url": "https://api.github.com/users/chendo/repos", "events_url": "https://api.github.com/users/chendo/events{/privacy}", "received_events_url": "https://api.github.com/users/chendo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-25T07:01:29Z", "updated_at": "2023-08-02T15:59:42Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48799", "html_url": "https://github.com/rails/rails/pull/48799", "diff_url": "https://github.com/rails/rails/pull/48799.diff", "patch_url": "https://github.com/rails/rails/pull/48799.patch", "merged_at": null}, "body": "#### Motivation\r\n\r\nI was bitten by a subtle bug where code was depending on the order of records being returned by `.find`, however turns out `reorder(\"\")` does not actually clear the order scope, which meant that the order of results was not the order of the ids being passed in.\r\n\r\nThis change makes it clearer what is required to have records be returned in order.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48799/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48799/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48798", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48798/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48798/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48798/events", "html_url": "https://github.com/rails/rails/pull/48798", "id": 1819274595, "node_id": "PR_kwDNIULOVkb4aw", "number": 48798, "title": "Introduce `capture_emails` and `capture_broadcasts`", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107188, "node_id": "MDU6TGFiZWwxMDcxODg=", "url": "https://api.github.com/repos/rails/rails/labels/actionmailer", "name": "actionmailer", "color": "8B00FC", "default": false, "description": null}, {"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-24T23:06:25Z", "updated_at": "2023-07-25T06:39:49Z", "closed_at": "2023-07-25T04:42:54Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48798", "html_url": "https://github.com/rails/rails/pull/48798", "diff_url": "https://github.com/rails/rails/pull/48798.diff", "patch_url": "https://github.com/rails/rails/pull/48798.patch", "merged_at": "2023-07-25T04:42:54Z"}, "body": "ref: https://github.com/rails/rails/pull/47025#issuecomment-1647788766, https://github.com/rails/rails/pull/47793#issuecomment-1647790178\r\n\r\nAddresses @dhh feedback that there should be no side effects on `assert_emails` and `assert_broadcasts`.\r\n\r\nNeither of those PRs have been included in a Rails release yet so I think it is fine to make a breaking change to them.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48798/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48798/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48797", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48797/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48797/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48797/events", "html_url": "https://github.com/rails/rails/issues/48797", "id": 1819038102, "node_id": "I_kwDNIULObGxRlg", "number": 48797, "title": "Changing Encryption Field to Deterministic Causes Encryption Errors", "user": {"login": "aveedibya", "id": 5461802, "node_id": "MDQ6VXNlcjU0NjE4MDI=", "avatar_url": "https://avatars.githubusercontent.com/u/5461802?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aveedibya", "html_url": "https://github.com/aveedibya", "followers_url": "https://api.github.com/users/aveedibya/followers", "following_url": "https://api.github.com/users/aveedibya/following{/other_user}", "gists_url": "https://api.github.com/users/aveedibya/gists{/gist_id}", "starred_url": "https://api.github.com/users/aveedibya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aveedibya/subscriptions", "organizations_url": "https://api.github.com/users/aveedibya/orgs", "repos_url": "https://api.github.com/users/aveedibya/repos", "events_url": "https://api.github.com/users/aveedibya/events{/privacy}", "received_events_url": "https://api.github.com/users/aveedibya/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 5511275119, "node_id": "LA_kwDNIULPAAAAAUh_Ym8", "url": "https://api.github.com/repos/rails/rails/labels/encryption", "name": "encryption", "color": "8D3EA8", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-24T19:52:06Z", "updated_at": "2023-07-26T23:15:02Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Wondering if there is a way to read an encrypted field after changing its encryption to `deterministic`? Seems like currently there is no way in Rails to read the field's value if the field was set to `non-deterministic` (default way)  and then changed to `deterministic`.\r\n\r\n<div class=\"message mb-1\" style=\"box-sizing: border-box; margin: 0px 12px; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; color: rgb(33, 37, 41); font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;\">ActiveRecord::Encryption::Errors::Decryption: ActiveRecord::Encryption::Errors::Decryption</div>\r\n\r\n56 | uncompress_if_needed(cipher.decrypt(message, key: keys.collect(&:secret), **cipher_options), message.headers.compressed)\r\n-- | --\r\n57 | rescue *(ENCODING_ERRORS + DECRYPT_ERRORS)\r\n58 | raise Errors::Decryption\r\n59 | end\r\n\r\nVersions in use:\r\nruby \"3.1.2\"\r\ngem \"rails\", \"~> 7.0.3\"\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48797/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48797/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48796", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48796/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48796/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48796/events", "html_url": "https://github.com/rails/rails/pull/48796", "id": 1818964256, "node_id": "PR_kwDNIULOVkK43Q", "number": 48796, "title": "Fix `#previously_new_record?` on destroyed records", "user": {"login": "adrianna-chang-shopify", "id": 22918438, "node_id": "MDQ6VXNlcjIyOTE4NDM4", "avatar_url": "https://avatars.githubusercontent.com/u/22918438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adrianna-chang-shopify", "html_url": "https://github.com/adrianna-chang-shopify", "followers_url": "https://api.github.com/users/adrianna-chang-shopify/followers", "following_url": "https://api.github.com/users/adrianna-chang-shopify/following{/other_user}", "gists_url": "https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}", "starred_url": "https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adrianna-chang-shopify/subscriptions", "organizations_url": "https://api.github.com/users/adrianna-chang-shopify/orgs", "repos_url": "https://api.github.com/users/adrianna-chang-shopify/repos", "events_url": "https://api.github.com/users/adrianna-chang-shopify/events{/privacy}", "received_events_url": "https://api.github.com/users/adrianna-chang-shopify/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-24T18:59:06Z", "updated_at": "2023-07-25T20:56:58Z", "closed_at": "2023-07-25T20:55:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48796", "html_url": "https://github.com/rails/rails/pull/48796", "diff_url": "https://github.com/rails/rails/pull/48796.diff", "patch_url": "https://github.com/rails/rails/pull/48796.patch", "merged_at": "2023-07-25T20:55:34Z"}, "body": "### Motivation / Background\r\n\r\nRef: #48794\r\ncc @eizengan\r\n\r\nBased on the [documentation](https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-previously_new_record-3F) for `#previously_new_record?`:\r\n> Returns true if this object was just created \u2013 that is, prior to the last save, the object didn't exist in the database and new_record? would have returned true.\r\n\r\nIMO a record that was previously created and has since been destroyed and removed from the database should no longer be considered \"just created\", although one could argue that a `DELETE` is different from a \"save\".\r\n\r\n### Detail\r\n\r\nSet `@previously_new_record` to `false` in `#destroy` and `#delete` methods.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48796/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48796/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48795", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48795/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48795/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48795/events", "html_url": "https://github.com/rails/rails/pull/48795", "id": 1818961904, "node_id": "PR_kwDNIULOVkKwsg", "number": 48795, "title": "Tweak `alias_attribute` deprecation message", "user": {"login": "nvasilevski", "id": 5512772, "node_id": "MDQ6VXNlcjU1MTI3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/5512772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nvasilevski", "html_url": "https://github.com/nvasilevski", "followers_url": "https://api.github.com/users/nvasilevski/followers", "following_url": "https://api.github.com/users/nvasilevski/following{/other_user}", "gists_url": "https://api.github.com/users/nvasilevski/gists{/gist_id}", "starred_url": "https://api.github.com/users/nvasilevski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nvasilevski/subscriptions", "organizations_url": "https://api.github.com/users/nvasilevski/orgs", "repos_url": "https://api.github.com/users/nvasilevski/repos", "events_url": "https://api.github.com/users/nvasilevski/events{/privacy}", "received_events_url": "https://api.github.com/users/nvasilevski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-24T18:57:20Z", "updated_at": "2023-07-25T14:51:15Z", "closed_at": "2023-07-25T14:51:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48795", "html_url": "https://github.com/rails/rails/pull/48795", "diff_url": "https://github.com/rails/rails/pull/48795.diff", "patch_url": "https://github.com/rails/rails/pull/48795.patch", "merged_at": "2023-07-25T14:51:14Z"}, "body": "Addresses https://github.com/rails/rails/pull/48533#issuecomment-1648055838\r\n\r\nA tiny tweak to the deprecation message. It might be a good time to double check the whole message. Should it actually be \"Starting **from**\" ?\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48795/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48795/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48794", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48794/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48794/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48794/events", "html_url": "https://github.com/rails/rails/issues/48794", "id": 1818835559, "node_id": "I_kwDNIULObGk6Zw", "number": 48794, "title": "Incorrect determination from `ActiveRecord::Persistence#previously_new_record?` after create-then-destroy", "user": {"login": "eizengan", "id": 41587522, "node_id": "MDQ6VXNlcjQxNTg3NTIy", "avatar_url": "https://avatars.githubusercontent.com/u/41587522?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eizengan", "html_url": "https://github.com/eizengan", "followers_url": "https://api.github.com/users/eizengan/followers", "following_url": "https://api.github.com/users/eizengan/following{/other_user}", "gists_url": "https://api.github.com/users/eizengan/gists{/gist_id}", "starred_url": "https://api.github.com/users/eizengan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eizengan/subscriptions", "organizations_url": "https://api.github.com/users/eizengan/orgs", "repos_url": "https://api.github.com/users/eizengan/repos", "events_url": "https://api.github.com/users/eizengan/events{/privacy}", "received_events_url": "https://api.github.com/users/eizengan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-24T17:27:12Z", "updated_at": "2023-08-02T21:20:14Z", "closed_at": "2023-08-02T02:50:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n- create a record\r\n- destroy the record\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :records, force: true do |t|\r\n    t.string :text\r\n  end\r\nend\r\n\r\nclass Record < ActiveRecord::Base\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_previously_new_record\r\n    destroyed_record = Record.create(text: \"a record we will destroy\")\r\n    updated_record = Record.create(text: \"a record we will update\")\r\n\r\n    destroyed_record.destroy!\r\n    updated_record.update!(text: \"a record we have updated\")\r\n\r\n    assert_equal updated_record.previously_new_record?, destroyed_record.previously_new_record?\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\n`ActiveRecord::Persistence#previously_new_record?` should be false after create and subsequent destroy, as it would be e.g. after create and subsequent update.\r\n\r\n### Actual behavior\r\n`ActiveRecord::Persistence#previously_new_record?` is true after create and subsequent destroy.\r\n\r\nThis causes callbacks such as the following to unexpectedly fire twice for the destroyed record during the test above:\r\n\r\n```ruby\r\non_commit :do_something_with_the_record, if: :previously_new_record?\r\n```\r\n\r\nThere is, however, a semantic argument to be made about what \"previously new\" means. Depending on interpretation, this behavior could be intentional. \r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48794/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48794/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48793", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48793/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48793/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48793/events", "html_url": "https://github.com/rails/rails/pull/48793", "id": 1818437395, "node_id": "PR_kwDNIULOVjuO3g", "number": 48793, "title": "Never connect to the database in define_attribute_methods initializer", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-24T13:31:16Z", "updated_at": "2023-08-01T06:45:25Z", "closed_at": "2023-08-01T06:45:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48793", "html_url": "https://github.com/rails/rails/pull/48793", "diff_url": "https://github.com/rails/rails/pull/48793.diff", "patch_url": "https://github.com/rails/rails/pull/48793.patch", "merged_at": "2023-08-01T06:45:25Z"}, "body": "Followup: https://github.com/rails/rails/pull/48743\r\n\r\nAfter careful consideration, unless users have a schema cache dump loaded and `check_schema_cache_dump_version = false`, we have no choice but to arbitrate between resiliency and performance.\r\n\r\nIf we define attribute methods during boot, we allow them to be shared between forked workers, and prevent the first requests to be slower.\r\n\r\nHowever, by doing so we'd trigger a connection to the datase, which if it's unresponsive could lead to workers not being able to restart triggering a cascading failure.\r\n\r\nPreviously Rails used to be in some sort of middle-ground where it would define attribute methods during boot if for some reason it was already connected to the database at this point.\r\n\r\nBut this is now deemed undesirable, as an application initializer inadvertantly establishing the database connection woudl lead to a readically different behavior.\r\n\r\nFYI: @zarqman @matthewd ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48793/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48793/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48792", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48792/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48792/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48792/events", "html_url": "https://github.com/rails/rails/pull/48792", "id": 1818086908, "node_id": "PR_kwDNIULOVja-YQ", "number": 48792, "title": "Added test for --no-skip-docker command line argument", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-24T10:07:34Z", "updated_at": "2023-07-27T06:44:23Z", "closed_at": "2023-07-27T06:28:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48792", "html_url": "https://github.com/rails/rails/pull/48792", "diff_url": "https://github.com/rails/rails/pull/48792.diff", "patch_url": "https://github.com/rails/rails/pull/48792.patch", "merged_at": "2023-07-27T06:28:12Z"}, "body": "### Detail\r\n#46762 Added the default Dockerfiles for new rails applications. These files can be skipped via the `--skip-docker` argument.\r\nRight now we only have a test for `--skip-docker`. So this PR introduces tests for the `--no-skip-docker` command line argument.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48792/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48792/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48791", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48791/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48791/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48791/events", "html_url": "https://github.com/rails/rails/pull/48791", "id": 1817823248, "node_id": "PR_kwDNIULOVjM1Jg", "number": 48791, "title": "[ci skip] Add --skip-dev-gems rails command line argument to the guide", "user": {"login": "akhilgkrishnan", "id": 22231095, "node_id": "MDQ6VXNlcjIyMjMxMDk1", "avatar_url": "https://avatars.githubusercontent.com/u/22231095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/akhilgkrishnan", "html_url": "https://github.com/akhilgkrishnan", "followers_url": "https://api.github.com/users/akhilgkrishnan/followers", "following_url": "https://api.github.com/users/akhilgkrishnan/following{/other_user}", "gists_url": "https://api.github.com/users/akhilgkrishnan/gists{/gist_id}", "starred_url": "https://api.github.com/users/akhilgkrishnan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/akhilgkrishnan/subscriptions", "organizations_url": "https://api.github.com/users/akhilgkrishnan/orgs", "repos_url": "https://api.github.com/users/akhilgkrishnan/repos", "events_url": "https://api.github.com/users/akhilgkrishnan/events{/privacy}", "received_events_url": "https://api.github.com/users/akhilgkrishnan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-24T07:34:22Z", "updated_at": "2023-07-24T08:13:32Z", "closed_at": "2023-07-24T08:02:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48791", "html_url": "https://github.com/rails/rails/pull/48791", "diff_url": "https://github.com/rails/rails/pull/48791.diff", "patch_url": "https://github.com/rails/rails/pull/48791.patch", "merged_at": "2023-07-24T08:02:47Z"}, "body": "### Detail\r\n\r\nThis PR documents --skip-dev-gems command line argument (for skip adding development gems) in the guide.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48791/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48791/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48790", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48790/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48790/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48790/events", "html_url": "https://github.com/rails/rails/issues/48790", "id": 1817396793, "node_id": "I_kwDNIULObFNGOQ", "number": 48790, "title": "URL of attachments inside ActionText content are wrong when content is rendered within background jobs", "user": {"login": "Benratelade", "id": 8875705, "node_id": "MDQ6VXNlcjg4NzU3MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/8875705?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Benratelade", "html_url": "https://github.com/Benratelade", "followers_url": "https://api.github.com/users/Benratelade/followers", "following_url": "https://api.github.com/users/Benratelade/following{/other_user}", "gists_url": "https://api.github.com/users/Benratelade/gists{/gist_id}", "starred_url": "https://api.github.com/users/Benratelade/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Benratelade/subscriptions", "organizations_url": "https://api.github.com/users/Benratelade/orgs", "repos_url": "https://api.github.com/users/Benratelade/repos", "events_url": "https://api.github.com/users/Benratelade/events{/privacy}", "received_events_url": "https://api.github.com/users/Benratelade/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1180817762, "node_id": "MDU6TGFiZWwxMTgwODE3NzYy", "url": "https://api.github.com/repos/rails/rails/labels/actiontext", "name": "actiontext", "color": "3bc667", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-24T00:48:22Z", "updated_at": "2023-08-09T06:53:58Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nI couldn't figure out how to use the scripts to replicate the issue, since I had to include background jobs and ActionText with ActiveRecord. Instead, I put together a simple Rails app with a test case that shows the problem. Hopefully that's enough. \r\n\r\nYou can find the app here: https://github.com/Benratelade/rails-workers-routing-bug \r\n\r\n### Expected behavior\r\nThe `src` of images inside the ActionText should match that of the rest of the Rails app when the content is rendered within a Sidekiq job. \r\n\r\n### Actual behavior\r\nThe `src` of images inside the ActionText uses `http://example.org` and ignores the Rails app config, but only when the content is rendered synchronously. \r\n\r\n### System configuration\r\n**Rails version**: 7.0.3\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48790/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48790/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48789", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48789/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48789/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48789/events", "html_url": "https://github.com/rails/rails/issues/48789", "id": 1817072784, "node_id": "I_kwDNIULObE5UkA", "number": 48789, "title": "Behavior changed when passing an array to `form_for` in Rails 7.0", "user": {"login": "krororo", "id": 3143443, "node_id": "MDQ6VXNlcjMxNDM0NDM=", "avatar_url": "https://avatars.githubusercontent.com/u/3143443?v=4", "gravatar_id": "", "url": "https://api.github.com/users/krororo", "html_url": "https://github.com/krororo", "followers_url": "https://api.github.com/users/krororo/followers", "following_url": "https://api.github.com/users/krororo/following{/other_user}", "gists_url": "https://api.github.com/users/krororo/gists{/gist_id}", "starred_url": "https://api.github.com/users/krororo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/krororo/subscriptions", "organizations_url": "https://api.github.com/users/krororo/orgs", "repos_url": "https://api.github.com/users/krororo/repos", "events_url": "https://api.github.com/users/krororo/events{/privacy}", "received_events_url": "https://api.github.com/users/krororo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-07-23T10:18:07Z", "updated_at": "2023-07-25T13:25:15Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n\r\nWhen passing an array of objects that can be call `to_model` to `form_for`, the `method: patch` is not included.\r\nThis issue is similar to #44326. However, it seems that nested routes have not been fixed.\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  # gem \"rails\", \"6.1.7.4\"\r\n  gem \"rails\", \"7.0.6\"\r\nend\r\n\r\nrequire \"rack/test\"\r\nrequire \"active_model\"\r\nrequire \"action_view\"\r\nrequire \"minitest/autorun\"\r\n\r\nclass Post\r\n  include ActiveModel::Model\r\n\r\n  attr_reader :id\r\n\r\n  def initialize(persisted: false)\r\n    @persisted = persisted\r\n    @id = 1 if persisted\r\n  end\r\n\r\n  def persisted?\r\n    @persisted\r\n  end\r\nend\r\n\r\nclass PostForm\r\n  include ActiveModel::Model\r\n\r\n  def initialize(post)\r\n    @post = post\r\n  end\r\n\r\n  def to_model\r\n    @post\r\n  end\r\nend\r\n\r\nclass BugTest < ActionView::TestCase\r\n  tests ActionView::Helpers::FormHelper\r\n\r\n  routes = ActionDispatch::Routing::RouteSet.new\r\n  routes.draw do\r\n    namespace :admin do\r\n      resources :posts\r\n    end\r\n  end\r\n  include routes.url_helpers\r\n\r\n  def test_form_for_namespaced_routes_new_model\r\n    assert_dom_equal(\r\n      '<form class=\"new_post\" id=\"new_post\" action=\"/admin/posts\" accept-charset=\"UTF-8\" method=\"post\">' \\\r\n      '<input name=\"utf8\" type=\"hidden\" value=\"&#x2713;\" autocomplete=\"off\" />' \\\r\n      '</form>',\r\n      form_for([:admin, PostForm.new(Post.new)]) {}\r\n    )\r\n  end\r\n\r\n  def test_form_for_namespaced_routes_edit_model\r\n    assert_dom_equal(\r\n      '<form class=\"edit_post\" id=\"edit_post_1\" action=\"/admin/posts/1\" accept-charset=\"UTF-8\" method=\"post\">' \\\r\n      '<input name=\"utf8\" type=\"hidden\" value=\"&#x2713;\" autocomplete=\"off\" />' \\\r\n      '<input name=\"_method\" type=\"hidden\" value=\"patch\" autocomplete=\"off\" />' \\\r\n      '</form>',\r\n      form_for([:admin, PostForm.new(Post.new(persisted: true))]) {}\r\n    )\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\n<!-- Tell us what should happen -->\r\nThese tests are passed in Rails 6.1 and Rails main branch. So it should work on Rails 7.0 as well.\r\n\r\n```\r\n# Running:\r\n\r\n..\r\n\r\nFinished in 0.069481s, 28.7847 runs/s, 28.7847 assertions/s.\r\n2 runs, 2 assertions, 0 failures, 0 errors, 0 skips\r\n```\r\n\r\n### Actual behavior\r\n<!-- Tell us what happens instead -->\r\n`test_form_for_namespaced_routes_edit_model` fails in Rails 7.0.\r\nThe `_method` of the hidden field is not included.\r\n\r\n```\r\n# Running:\r\n\r\nF\r\n\r\nFailure:\r\nBugTest#test_form_for_namespaced_routes_edit_model [actionview_test.rb:68]:\r\nExpected: <form class=\"edit_post\" id=\"edit_post_1\" action=\"/admin/posts/1\" accept-charset=\"UTF-8\" method=\"post\"><input name=\"utf8\" type=\"hidden\" value=\"&#x2713;\" autocomplete=\"off\" /><input name=\"_method\" type=\"hidden\" value=\"patch\" autocomplete=\"off\" /></form>\r\nActual: <form class=\"edit_post\" id=\"edit_post_1\" action=\"/admin/posts/1\" accept-charset=\"UTF-8\" method=\"post\"><input name=\"utf8\" type=\"hidden\" value=\"&#x2713;\" autocomplete=\"off\" /></form>\r\n\r\n\r\nrails test actionview_test.rb:67\r\n\r\n.\r\n\r\nFinished in 0.036721s, 54.4642 runs/s, 54.4642 assertions/s.\r\n2 runs, 2 assertions, 1 failures, 0 errors, 0 skips\r\n```\r\n\r\n### System configuration\r\n**Rails version**:\r\n7.0.6\r\n**Ruby version**:\r\n3.1.4", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48789/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48789/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48788", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48788/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48788/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48788/events", "html_url": "https://github.com/rails/rails/pull/48788", "id": 1816819026, "node_id": "PR_kwDNIULOViZ1ww", "number": 48788, "title": "Fix: Do not execute selenium driver_path if it is a string.", "user": {"login": "ylecuyer", "id": 1866809, "node_id": "MDQ6VXNlcjE4NjY4MDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1866809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ylecuyer", "html_url": "https://github.com/ylecuyer", "followers_url": "https://api.github.com/users/ylecuyer/followers", "following_url": "https://api.github.com/users/ylecuyer/following{/other_user}", "gists_url": "https://api.github.com/users/ylecuyer/gists{/gist_id}", "starred_url": "https://api.github.com/users/ylecuyer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ylecuyer/subscriptions", "organizations_url": "https://api.github.com/users/ylecuyer/orgs", "repos_url": "https://api.github.com/users/ylecuyer/repos", "events_url": "https://api.github.com/users/ylecuyer/events{/privacy}", "received_events_url": "https://api.github.com/users/ylecuyer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-22T16:22:49Z", "updated_at": "2023-07-28T12:53:35Z", "closed_at": "2023-07-28T12:53:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48788", "html_url": "https://github.com/rails/rails/pull/48788", "diff_url": "https://github.com/rails/rails/pull/48788.diff", "patch_url": "https://github.com/rails/rails/pull/48788.patch", "merged_at": "2023-07-28T12:53:25Z"}, "body": "### Motivation / Background\r\n\r\nIn https://github.com/rails/rails/commit/af2129b4c74732c88ffce76e5c55c805cb9431f6#diff-b39ef19c83412a9c4f132238a266be37e0bc7ed6f1e9d3fc4f98684ba3f6dabc the try calls were improperly replaced by &.\r\n\r\n### Detail\r\n\r\nThe driver path can be a string (a filesystem path), here is an example from selenium specs: https://github.com/SeleniumHQ/selenium/blob/1d459cd52850d3d5189c3003a9dfa2b53b98cacd/rb/lib/selenium/webdriver/safari.rb#L36\r\n\r\n### Additional information\r\n\r\nI'm not sure about the test as it is kind of hackish\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48788/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48788/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48787", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48787/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48787/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48787/events", "html_url": "https://github.com/rails/rails/issues/48787", "id": 1816764710, "node_id": "I_kwDNIULObEmhJg", "number": 48787, "title": "Combing tagged logger without block and with block leaks tags across threads", "user": {"login": "erikbelusic", "id": 4841877, "node_id": "MDQ6VXNlcjQ4NDE4Nzc=", "avatar_url": "https://avatars.githubusercontent.com/u/4841877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erikbelusic", "html_url": "https://github.com/erikbelusic", "followers_url": "https://api.github.com/users/erikbelusic/followers", "following_url": "https://api.github.com/users/erikbelusic/following{/other_user}", "gists_url": "https://api.github.com/users/erikbelusic/gists{/gist_id}", "starred_url": "https://api.github.com/users/erikbelusic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erikbelusic/subscriptions", "organizations_url": "https://api.github.com/users/erikbelusic/orgs", "repos_url": "https://api.github.com/users/erikbelusic/repos", "events_url": "https://api.github.com/users/erikbelusic/events{/privacy}", "received_events_url": "https://api.github.com/users/erikbelusic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-22T13:24:34Z", "updated_at": "2023-07-28T22:35:51Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Using the tagged logger without a block does not appear to have the same threaded isolation that tagging with a block has. The documentation doesn't make it clear if its intended or not, but from a user's perspective, it is unexpected. From the existing tests, it looks like some of this is expected, but the inconsistency is confusing. I left a comment on the original PR to try and get some insight.\r\n\r\nThis could be in some ways related to https://github.com/rails/rails/issues/46084 - however the focus of that is broadcast logging and not threading, however the issues seem similar - tag leak.\r\n\r\n### Steps to reproduce\r\nThis example currently relies on identical setup to what is in `activesupport/test/tagged_logging_test.rb` which should make it easy to add these tests or some modified versions if its agreed this is a bug.\r\n```\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\nend\r\n\r\nrequire \"active_support\"\r\nrequire \"active_support/core_ext/object/blank\"\r\nrequire \"minitest/autorun\"\r\n\r\nclass BugTest < Minitest::Test\r\n  # Copied from activesupport/test/tagged_logging_test.rb\r\n  class MyLogger < ::ActiveSupport::Logger\r\n    def flush(*)\r\n      info \"[FLUSHED]\"\r\n    end\r\n  end\r\n\r\n  # Copied from activesupport/test/tagged_logging_test.rb\r\n  def setup\r\n    @output = StringIO.new\r\n    @logger = ActiveSupport::TaggedLogging.new(MyLogger.new(@output))\r\n  end\r\n\r\n  # Copied from activesupport/test/tagged_logging_test.rb:80\r\n  def test_keeps_each_tag_in_their_own_thread\r\n    @logger.tagged(\"BCX\") do\r\n      Thread.new do\r\n        @logger.info \"Dull story\"\r\n        @logger.tagged(\"OMG\") { @logger.info \"Cool story\" }\r\n      end.join\r\n      @logger.info \"Funky time\"\r\n    end\r\n    assert_equal \"Dull story\\n[OMG] Cool story\\n[BCX] Funky time\\n\", @output.string\r\n  end\r\n  # PASS output:\r\n  # Dull story\r\n  # [OMG] Cool story\r\n  # [BCX] Funky time\r\n\r\n  def test_keeps_each_tag_in_their_own_thread_using_tagged_without_block\r\n    logger1 = @logger.tagged(\"BCX\")\r\n    Thread.new do\r\n      logger1.info \"Dull story\"\r\n      logger2 = logger1.tagged(\"OMG\")\r\n      logger2.info \"Cool story\"\r\n    end.join\r\n    logger1.info \"Funky time\"\r\n\r\n    assert_equal \"Dull story\\n[OMG] Cool story\\n[BCX] Funky time\\n\", @output.string\r\n  end\r\n  # FAIL output:\r\n  # [BCX] Dull story\r\n  # [BCX] [OMG] Cool story\r\n  # [BCX] Funky time\r\n\r\n  def test_keeps_each_tag_in_their_own_thread_using_tagged_without_block_combined_with_tagged_block\r\n    logger1 = @logger.tagged(\"BCX\")\r\n    Thread.new do\r\n      logger1.info \"Dull story\"\r\n      logger1.tagged(\"OMG\") { logger1.info \"Cool story\" }\r\n    end.join\r\n    logger1.info \"Funky time\"\r\n\r\n    assert_equal \"Dull story\\n[OMG] Cool story\\n[BCX] Funky time\\n\", @output.string\r\n  end\r\n  # FAIL output:\r\n  # [BCX] Dull story\r\n  # [BCX] [OMG] Cool story\r\n  # [BCX] Funky time\r\n\r\n  def test_keeps_each_tag_in_their_own_thread_using_tagged_without_block_combined_with_tagged_block_nested\r\n    logger = @logger.tagged(\"BASE_TAG\")\r\n    logger.tagged(\"BCX\") do\r\n      Thread.new do\r\n        logger.info \"Dull story\"\r\n        logger.tagged(\"OMG\") { logger.info \"Cool story\" }\r\n      end.join\r\n      logger.info \"Funky time\"\r\n    end\r\n    assert_equal \"[BASE_TAG] Dull story\\n[BASE_TAG] [OMG] Cool story\\n[BASE_TAG] [BCX] Funky time\\n\", @output.string\r\n  end\r\n  # FAIL output:\r\n  # [BASE_TAG] [BCX] Dull story\r\n  # [BASE_TAG] [BCX] [OMG] Cool story\r\n  # [BASE_TAG] [BCX] Funky time\r\nend\r\n```\r\n\r\n### Expected behavior\r\nI would expect that if `#tagged` has a certain level of thread isolation, it should always have that isolation and behave consistently. At a minimum `test_keeps_each_tag_in_their_own_thread_using_tagged_without_block_combined_with_tagged_block_nested` should pass. It seems awkward that depending on how your current logger instance was created, the behavior of tagging with a block could change. I think it is worth a conversation on the correct behavior here, as maybe my first two failures should remain failures due to some context or intent I am unaware of.\r\n\r\n### Actual behavior\r\n1. When using a new logger created from `#tagged`, tags are shared across threads\r\n2. When tagging with a block from a logger instance created from `#tagged`, all tags are shared\r\n\r\n### System configuration\r\n**Rails version**: main\r\n\r\n**Ruby version**: 3.0.0\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48787/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48787/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48786", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48786/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48786/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48786/events", "html_url": "https://github.com/rails/rails/issues/48786", "id": 1816430198, "node_id": "I_kwDNIULObESGdg", "number": 48786, "title": "Why does ActiveStorage put my attachments in crazy directories", "user": {"login": "mices", "id": 14654866, "node_id": "MDQ6VXNlcjE0NjU0ODY2", "avatar_url": "https://avatars.githubusercontent.com/u/14654866?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mices", "html_url": "https://github.com/mices", "followers_url": "https://api.github.com/users/mices/followers", "following_url": "https://api.github.com/users/mices/following{/other_user}", "gists_url": "https://api.github.com/users/mices/gists{/gist_id}", "starred_url": "https://api.github.com/users/mices/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mices/subscriptions", "organizations_url": "https://api.github.com/users/mices/orgs", "repos_url": "https://api.github.com/users/mices/repos", "events_url": "https://api.github.com/users/mices/events{/privacy}", "received_events_url": "https://api.github.com/users/mices/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-21T22:06:49Z", "updated_at": "2023-07-24T08:42:33Z", "closed_at": "2023-07-21T22:08:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "Look at the path to this image on disk And the top directory under storage there's lots of those directories Why do I need this craziness?\r\n /home/mices/data/websites/mywebsite/storage/uk/rg/ukrgqd7u7pud52r54d9eis3rq7gr/IMG_20230519_225450994.jpg ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48786/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48786/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48785", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48785/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48785/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48785/events", "html_url": "https://github.com/rails/rails/pull/48785", "id": 1816415292, "node_id": "PR_kwDNIULOViFuCg", "number": 48785, "title": "Fix child association loading in `:n_plus_one_only` mode", "user": {"login": "reid-rigo", "id": 2439912, "node_id": "MDQ6VXNlcjI0Mzk5MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/2439912?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reid-rigo", "html_url": "https://github.com/reid-rigo", "followers_url": "https://api.github.com/users/reid-rigo/followers", "following_url": "https://api.github.com/users/reid-rigo/following{/other_user}", "gists_url": "https://api.github.com/users/reid-rigo/gists{/gist_id}", "starred_url": "https://api.github.com/users/reid-rigo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reid-rigo/subscriptions", "organizations_url": "https://api.github.com/users/reid-rigo/orgs", "repos_url": "https://api.github.com/users/reid-rigo/repos", "events_url": "https://api.github.com/users/reid-rigo/events{/privacy}", "received_events_url": "https://api.github.com/users/reid-rigo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-21T21:44:39Z", "updated_at": "2023-07-31T15:08:48Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48785", "html_url": "https://github.com/rails/rails/pull/48785", "diff_url": "https://github.com/rails/rails/pull/48785.diff", "patch_url": "https://github.com/rails/rails/pull/48785.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\nStrict loading in `:n_plus_one_only` mode is designed to prevent performance issues when deeply traversing associations. It allows `Person.find(1).posts`, but _not_ `Person.find(1).posts.map(&:category)`. This fix avoids the surprise that occurs when `person.posts.first` eagerly loads the whole association rather than allowing the user to manage the child association.\r\n\r\nThis fixes a serious correctness issue as well. Without strict loading, `person.posts.first` is guaranteed to return the first post in primary key order. On the other hand, `person.posts.load.first` is nondeterministic. The database is not guaranteed to return in a consistent order, in particular under load with other operations occurring. This is a rude surprise when trying to use `:n_plus_one_only` mode.\r\n\r\n### Detail\r\n\r\nBefore:\r\n\r\n```ruby\r\nperson = Person.find(1)\r\nperson.strict_loading!(mode: :n_plus_one_only)\r\nperson.posts.first\r\n# SELECT * FROM posts WHERE person_id = 1;\r\n```\r\n\r\nAfter:\r\n\r\n```ruby\r\nperson = Person.find(1)\r\nperson.strict_loading!(mode: :n_plus_one_only)\r\nperson.posts.first # this is 1+1, not N+1\r\n# SELECT * FROM posts WHERE person_id = 1 ORDER BY id LIMIT 1;\r\n```\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48785/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48785/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48784", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48784/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48784/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48784/events", "html_url": "https://github.com/rails/rails/pull/48784", "id": 1816280076, "node_id": "PR_kwDNIULOVh-YcQ", "number": 48784, "title": "[ci skip] ActiveStorage guides don't recommend using a deprecated config", "user": {"login": "santib", "id": 6373536, "node_id": "MDQ6VXNlcjYzNzM1MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/6373536?v=4", "gravatar_id": "", "url": "https://api.github.com/users/santib", "html_url": "https://github.com/santib", "followers_url": "https://api.github.com/users/santib/followers", "following_url": "https://api.github.com/users/santib/following{/other_user}", "gists_url": "https://api.github.com/users/santib/gists{/gist_id}", "starred_url": "https://api.github.com/users/santib/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/santib/subscriptions", "organizations_url": "https://api.github.com/users/santib/orgs", "repos_url": "https://api.github.com/users/santib/repos", "events_url": "https://api.github.com/users/santib/events{/privacy}", "received_events_url": "https://api.github.com/users/santib/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-21T19:16:43Z", "updated_at": "2023-07-21T19:30:26Z", "closed_at": "2023-07-21T19:24:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48784", "html_url": "https://github.com/rails/rails/pull/48784", "diff_url": "https://github.com/rails/rails/pull/48784.diff", "patch_url": "https://github.com/rails/rails/pull/48784.patch", "merged_at": "2023-07-21T19:24:29Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because recently a [PR was merged](https://github.com/rails/rails/pull/48722) suggesting to use a configuration that was deprecated and will be removed in the next minor release of Rails.  \r\n\r\n### Detail\r\n\r\nThis Pull Request adjusts the ActiveStorage guides to not mention the deprecated configuration.\r\n\r\n### Additional information\r\n\r\nDeprecation of `replace_on_assign_to_many`: https://github.com/rails/rails/pull/42596\r\nRemoval of `replace_on_assign_to_many`: https://github.com/rails/rails/commit/c720b7eba8bab1d227553ad4f962bf35abd41c88\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n\r\n\r\ncc @adrianna-chang-shopify ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48784/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48784/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48783", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48783/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48783/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48783/events", "html_url": "https://github.com/rails/rails/pull/48783", "id": 1816171721, "node_id": "PR_kwDNIULOVh4fQg", "number": 48783, "title": "Do not use `alias_attribute` to alias an association", "user": {"login": "nvasilevski", "id": 5512772, "node_id": "MDQ6VXNlcjU1MTI3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/5512772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nvasilevski", "html_url": "https://github.com/nvasilevski", "followers_url": "https://api.github.com/users/nvasilevski/followers", "following_url": "https://api.github.com/users/nvasilevski/following{/other_user}", "gists_url": "https://api.github.com/users/nvasilevski/gists{/gist_id}", "starred_url": "https://api.github.com/users/nvasilevski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nvasilevski/subscriptions", "organizations_url": "https://api.github.com/users/nvasilevski/orgs", "repos_url": "https://api.github.com/users/nvasilevski/repos", "events_url": "https://api.github.com/users/nvasilevski/events{/privacy}", "received_events_url": "https://api.github.com/users/nvasilevski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-21T17:50:50Z", "updated_at": "2023-07-24T15:37:33Z", "closed_at": "2023-07-24T15:34:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48783", "html_url": "https://github.com/rails/rails/pull/48783", "diff_url": "https://github.com/rails/rails/pull/48783.diff", "patch_url": "https://github.com/rails/rails/pull/48783.patch", "merged_at": "2023-07-24T15:34:27Z"}, "body": "For reference, the code I'm proposing to remove was added in https://github.com/rails/rails/pull/40835\r\n\r\nUsing `alias_attribute` to alias an association is not an indented use case. This commit removes `alias_attribute` calls to alias an association along with the relevant tests. However, it doesn't mean that the commit brakes any current behaviors.\r\n\r\nCurrently running Active Record tests result in a bunch of deprecation warnings issued related to `alias_attribute :entry, :post` definition. \r\nExample: \r\n```\r\nDEPRECATION WARNING: Comment model aliases `post` and has a method called `post_changed?` defined. In Rails 7.2 `entry_changed?` will not call `post_changed?` anymore.\r\n```\r\n\r\nThis is a falsey warning so in order to get rid of it we have two options:\r\n- Fix the code that issues the warning to account for `alias_attribute` being used to alias an association\r\n- Remove `alias_attribute` usages to alias an association so the warning goes away with them\r\n\r\nSince aliasing an association using `alias_attribute` is not an intended use case I'm leaning towards removing it from the test suite. \r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48783/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48783/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48782", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48782/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48782/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48782/events", "html_url": "https://github.com/rails/rails/pull/48782", "id": 1816121950, "node_id": "PR_kwDNIULOVh11hg", "number": 48782, "title": "Only show SMTP envelope recipient when relevant", "user": {"login": "c960657", "id": 111346, "node_id": "MDQ6VXNlcjExMTM0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/111346?v=4", "gravatar_id": "", "url": "https://api.github.com/users/c960657", "html_url": "https://github.com/c960657", "followers_url": "https://api.github.com/users/c960657/followers", "following_url": "https://api.github.com/users/c960657/following{/other_user}", "gists_url": "https://api.github.com/users/c960657/gists{/gist_id}", "starred_url": "https://api.github.com/users/c960657/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/c960657/subscriptions", "organizations_url": "https://api.github.com/users/c960657/orgs", "repos_url": "https://api.github.com/users/c960657/repos", "events_url": "https://api.github.com/users/c960657/events{/privacy}", "received_events_url": "https://api.github.com/users/c960657/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-21T17:03:49Z", "updated_at": "2023-07-25T11:18:47Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48782", "html_url": "https://github.com/rails/rails/pull/48782", "diff_url": "https://github.com/rails/rails/pull/48782.diff", "patch_url": "https://github.com/rails/rails/pull/48782.patch", "merged_at": null}, "body": "### Motivation\r\nThe SMTP envelope recipient usually reflects the `To`, `Cc` and `Bcc` email headers. The mailer preview only shows SMTP the envelope recipient (SMTP-To) if it differs from `To`, but it does not take Cc and Bcc into account.\r\n\r\nScreenshot:\r\n![image](https://github.com/rails/rails/assets/111346/5ea59067-4c5c-480e-b550-e22ecfdc306c)\r\n\r\n### Detail\r\nThis Pull Request extends the check for SMTP-To to cover also `Cc` and `Bcc`, so it is only displayed in the rare event that the envelope recipient has been manually overriden.\r\n\r\nAlso, show the list of email addresses without array brackets and quotes.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48782/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48782/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48781", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48781/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48781/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48781/events", "html_url": "https://github.com/rails/rails/pull/48781", "id": 1816091927, "node_id": "PR_kwDNIULOVh0OaA", "number": 48781, "title": "Detect if the editor is missing a wait flag and print a warning", "user": {"login": "LukasSkywalker", "id": 282447, "node_id": "MDQ6VXNlcjI4MjQ0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/282447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LukasSkywalker", "html_url": "https://github.com/LukasSkywalker", "followers_url": "https://api.github.com/users/LukasSkywalker/followers", "following_url": "https://api.github.com/users/LukasSkywalker/following{/other_user}", "gists_url": "https://api.github.com/users/LukasSkywalker/gists{/gist_id}", "starred_url": "https://api.github.com/users/LukasSkywalker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LukasSkywalker/subscriptions", "organizations_url": "https://api.github.com/users/LukasSkywalker/orgs", "repos_url": "https://api.github.com/users/LukasSkywalker/repos", "events_url": "https://api.github.com/users/LukasSkywalker/events{/privacy}", "received_events_url": "https://api.github.com/users/LukasSkywalker/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-21T16:37:31Z", "updated_at": "2023-07-21T16:40:49Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48781", "html_url": "https://github.com/rails/rails/pull/48781", "diff_url": "https://github.com/rails/rails/pull/48781.diff", "patch_url": "https://github.com/rails/rails/pull/48781.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThe current code for commands such as `credentials:edit` detects whether $EDITOR or $VISUAL are set, and tells the developer to set them to something like `EDITOR=mate --wait` if they are not. On systems where $EDITOR is set, but it launches a forking process, the message is not displayed and may never be seen by the developer.\r\n\r\n### Description\r\n\r\nThis change detects whether the editor for commands like `credentials:edit` exits in less than one second, such as when `EDITOR` is set to `mate` without the wait flag. This is a sign that the editor process is forking and exited immediately, and that the developer didn't have a chance to edit the file.\r\n\r\nIf an immediate exit is detected, a message is printed that the editor command should be changed to wait instead of exiting.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48781/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48781/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48780", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48780/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48780/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48780/events", "html_url": "https://github.com/rails/rails/pull/48780", "id": 1816054775, "node_id": "PR_kwDNIULOVhyM9g", "number": 48780, "title": "Improve the docs of ActiveRecord::TransactionRollbackError", "user": {"login": "fxn", "id": 3387, "node_id": "MDQ6VXNlcjMzODc=", "avatar_url": "https://avatars.githubusercontent.com/u/3387?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxn", "html_url": "https://github.com/fxn", "followers_url": "https://api.github.com/users/fxn/followers", "following_url": "https://api.github.com/users/fxn/following{/other_user}", "gists_url": "https://api.github.com/users/fxn/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxn/subscriptions", "organizations_url": "https://api.github.com/users/fxn/orgs", "repos_url": "https://api.github.com/users/fxn/repos", "events_url": "https://api.github.com/users/fxn/events{/privacy}", "received_events_url": "https://api.github.com/users/fxn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-21T16:07:39Z", "updated_at": "2023-07-24T17:31:42Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48780", "html_url": "https://github.com/rails/rails/pull/48780", "diff_url": "https://github.com/rails/rails/pull/48780.diff", "patch_url": "https://github.com/rails/rails/pull/48780.patch", "merged_at": null}, "body": "Docs improvements for `ActiveRecord::TransactionRollbackError` and subclasses after some discussions today.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48780/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48780/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48779", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48779/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48779/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48779/events", "html_url": "https://github.com/rails/rails/pull/48779", "id": 1815531907, "node_id": "PR_kwDNIULOVhWAZA", "number": 48779, "title": "Fix inconsistencies writing credentials values", "user": {"login": "etiennebarrie", "id": 3535, "node_id": "MDQ6VXNlcjM1MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/3535?v=4", "gravatar_id": "", "url": "https://api.github.com/users/etiennebarrie", "html_url": "https://github.com/etiennebarrie", "followers_url": "https://api.github.com/users/etiennebarrie/followers", "following_url": "https://api.github.com/users/etiennebarrie/following{/other_user}", "gists_url": "https://api.github.com/users/etiennebarrie/gists{/gist_id}", "starred_url": "https://api.github.com/users/etiennebarrie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/etiennebarrie/subscriptions", "organizations_url": "https://api.github.com/users/etiennebarrie/orgs", "repos_url": "https://api.github.com/users/etiennebarrie/repos", "events_url": "https://api.github.com/users/etiennebarrie/events{/privacy}", "received_events_url": "https://api.github.com/users/etiennebarrie/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-21T10:04:12Z", "updated_at": "2023-07-21T15:03:04Z", "closed_at": "2023-07-21T15:03:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48779", "html_url": "https://github.com/rails/rails/pull/48779", "diff_url": "https://github.com/rails/rails/pull/48779.diff", "patch_url": "https://github.com/rails/rails/pull/48779.patch", "merged_at": "2023-07-21T15:03:03Z"}, "body": "Using [] or the dynamic accessors don't result in the same value because `[]` is delegated to `config` (the decrypted deserialized YAML), whereas `[]=` and the dynamic accessors are delegated to `options`, an ActiveSupport::OrderedOptions instance.\r\n\r\n### Motivation / Background\r\n\r\nWith the deprecation of secrets, we want to fix [ejson-rails](https://github.com/Shopify/ejson-rails) to write to credentials instead. Doing so showed that merging a hash directly into `Rails.application.credentials` resulted in credentials not being readable with element reference (`[]`). Reducing the reproduction steps showed simple failures like:\r\n\r\n```ruby\r\nRails.application.credentials.foo = 42\r\nRails.application.credentials[:foo] # => nil\r\n```\r\n\r\nor even more surprising:\r\n```ruby\r\nRails.application.credentials[:foo] = 42\r\nRails.application.credentials[:foo] # => nil\r\n```\r\n\r\n### Detail\r\n\r\nThe reason is that `[]` and `fetch` are delegated to `config` (the decrypted deserialized YAML configuration), whereas the dynamic accessor (e.g. `foo=`) and the element assignment (`[]=`) would write directly to `options` (the config transformed into an OrderedOptions instance).\r\n\r\n<details>\r\n<summary>Bug reproduction script</summary>\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activesupport\", \"~> 7.0.0\"\r\n  # gem \"activesupport\", path: \"activesupport\" # run locally\r\n  gem \"debug\"\r\nend\r\n\r\nrequire \"minitest/autorun\"\r\nrequire \"tmpdir\"\r\nrequire \"fileutils\"\r\nrequire \"active_support\"\r\nrequire \"active_support/core_ext/hash/keys\" # missing from active_support/encrypted_configuration\r\nrequire \"active_support/encrypted_configuration\"\r\n\r\nclass BugTest < Minitest::Test\r\n  def setup\r\n    super\r\n    @tmpdir = Dir.mktmpdir\r\n    @credentials = ActiveSupport::EncryptedConfiguration.new(\r\n      config_path: \"#@tmpdir/credentials\",\r\n      key_path: \"#@tmpdir/key\",\r\n      env_key: \"RAILS_KEY\",\r\n      raise_if_missing_key: false,\r\n    )\r\n  end\r\n\r\n  def teardown\r\n    super\r\n    FileUtils.remove_entry(@tmpdir)\r\n  end\r\n\r\n  def test_dynamic_accessors_write_to_the_same_objects\r\n    @credentials.foo = 42\r\n    assert_equal 42, @credentials.foo\r\n    assert_equal 42, @credentials[:foo] # fails\r\n  end\r\n\r\n  def test_dynamic_accessors_write_to_the_same_objects_nested\r\n    set_credentials(bar: { baz: 42 })\r\n    @credentials.bar.baz = 21\r\n    assert_equal 21, @credentials.bar.baz\r\n    assert_equal 21, @credentials[:bar][:baz] # fails\r\n  end\r\n\r\n  def test_dynamic_accessors_dont_prevent_updating_with_element_assignment\r\n    set_credentials(baz: 42)\r\n    @credentials.baz\r\n    @credentials[:baz] = 21\r\n    assert_equal 21, @credentials.baz\r\n    assert_equal 21, @credentials[:baz] # fails\r\n  end\r\n\r\n\r\n  def test_dynamic_accessors_dont_prevent_updating_with_element_assignment_nested\r\n    set_credentials(bar: { baz: 42 })\r\n    @credentials.bar.baz\r\n    @credentials[:bar][:baz] = 21\r\n    assert_equal 21, @credentials[:bar][:baz]\r\n    assert_equal 21, @credentials.bar.baz # fails\r\n  end\r\n\r\n\r\n  private\r\n    def set_credentials(contents)\r\n      File.binwrite(@credentials.key_path, ActiveSupport::EncryptedConfiguration.generate_key)\r\n      @credentials.write(YAML.dump(contents))\r\n    end\r\nend\r\n```\r\n\r\n</details>\r\n\r\n\r\n\r\n### Additional information\r\n\r\n* I changed an instance of `InheritableOptions` with `OrderedOptions` (since it wasn't passing a parent, it was unnecessary).\r\n* I also added a require that the test script showed was missing.\r\n* Do I need a changelog? I doubt anyone was happily using the buggy behavior that wasn't writing, any usage that was working before is still working.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48779/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48779/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48778", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48778/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48778/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48778/events", "html_url": "https://github.com/rails/rails/pull/48778", "id": 1814936375, "node_id": "PR_kwDNIULOVg2M-Q", "number": 48778, "title": "Add '.idea' and '.vscode' to '.gitignore'", "user": {"login": "majidalaeinia", "id": 11965368, "node_id": "MDQ6VXNlcjExOTY1MzY4", "avatar_url": "https://avatars.githubusercontent.com/u/11965368?v=4", "gravatar_id": "", "url": "https://api.github.com/users/majidalaeinia", "html_url": "https://github.com/majidalaeinia", "followers_url": "https://api.github.com/users/majidalaeinia/followers", "following_url": "https://api.github.com/users/majidalaeinia/following{/other_user}", "gists_url": "https://api.github.com/users/majidalaeinia/gists{/gist_id}", "starred_url": "https://api.github.com/users/majidalaeinia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/majidalaeinia/subscriptions", "organizations_url": "https://api.github.com/users/majidalaeinia/orgs", "repos_url": "https://api.github.com/users/majidalaeinia/repos", "events_url": "https://api.github.com/users/majidalaeinia/events{/privacy}", "received_events_url": "https://api.github.com/users/majidalaeinia/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-20T23:23:26Z", "updated_at": "2023-07-21T00:38:54Z", "closed_at": "2023-07-21T00:38:54Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48778", "html_url": "https://github.com/rails/rails/pull/48778", "diff_url": "https://github.com/rails/rails/pull/48778.diff", "patch_url": "https://github.com/rails/rails/pull/48778.patch", "merged_at": null}, "body": "- Add `.idea` folder to `.gitignore`\r\n- Add `.vscode` folder to `.gitignore`", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48778/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48778/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48777", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48777/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48777/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48777/events", "html_url": "https://github.com/rails/rails/pull/48777", "id": 1814846257, "node_id": "PR_kwDNIULOVgxOeA", "number": 48777, "title": "Change load error messages to use `Kernel#warn` instead of `$stderr.puts`", "user": {"login": "paracycle", "id": 224488, "node_id": "MDQ6VXNlcjIyNDQ4OA==", "avatar_url": "https://avatars.githubusercontent.com/u/224488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paracycle", "html_url": "https://github.com/paracycle", "followers_url": "https://api.github.com/users/paracycle/followers", "following_url": "https://api.github.com/users/paracycle/following{/other_user}", "gists_url": "https://api.github.com/users/paracycle/gists{/gist_id}", "starred_url": "https://api.github.com/users/paracycle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paracycle/subscriptions", "organizations_url": "https://api.github.com/users/paracycle/orgs", "repos_url": "https://api.github.com/users/paracycle/repos", "events_url": "https://api.github.com/users/paracycle/events{/privacy}", "received_events_url": "https://api.github.com/users/paracycle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-20T21:53:50Z", "updated_at": "2023-07-24T13:02:13Z", "closed_at": "2023-07-20T22:31:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48777", "html_url": "https://github.com/rails/rails/pull/48777", "diff_url": "https://github.com/rails/rails/pull/48777.diff", "patch_url": "https://github.com/rails/rails/pull/48777.patch", "merged_at": "2023-07-20T22:31:04Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because the current method of printing directly to `$stderr` for load errors can be unnecessarily noisy.\r\n\r\nWhen development tools try to load Rails components, [they sometimes end up loading files that will error out since a dependency is missing](https://github.com/Shopify/tapioca/pull/1218#issuecomment-1412269662). In these cases, the tooling can catch the error and change its behaviour, but not suppress the message as easily.\r\n\r\nSince the warning is printed directly to `$stderr`, the tooling has to swap the stderr around to be able to suppress these messages, which is a quite finicky thing to do.\r\n\r\nThis change makes Rails print these warnings using `Kernel#warn` instead, which can be quite easily suppressed by any tooling.\r\n\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the way load error messages are printed from using `$stderr.puts` to `Kernel#warn`.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48777/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48777/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48776", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48776/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48776/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48776/events", "html_url": "https://github.com/rails/rails/pull/48776", "id": 1814824168, "node_id": "PR_kwDNIULOVgwDmA", "number": 48776, "title": "Next try", "user": {"login": "ibiamscapyba", "id": 57356836, "node_id": "MDQ6VXNlcjU3MzU2ODM2", "avatar_url": "https://avatars.githubusercontent.com/u/57356836?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibiamscapyba", "html_url": "https://github.com/ibiamscapyba", "followers_url": "https://api.github.com/users/ibiamscapyba/followers", "following_url": "https://api.github.com/users/ibiamscapyba/following{/other_user}", "gists_url": "https://api.github.com/users/ibiamscapyba/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibiamscapyba/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibiamscapyba/subscriptions", "organizations_url": "https://api.github.com/users/ibiamscapyba/orgs", "repos_url": "https://api.github.com/users/ibiamscapyba/repos", "events_url": "https://api.github.com/users/ibiamscapyba/events{/privacy}", "received_events_url": "https://api.github.com/users/ibiamscapyba/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107188, "node_id": "MDU6TGFiZWwxMDcxODg=", "url": "https://api.github.com/repos/rails/rails/labels/actionmailer", "name": "actionmailer", "color": "8B00FC", "default": false, "description": null}, {"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}, {"id": 123812746, "node_id": "MDU6TGFiZWwxMjM4MTI3NDY=", "url": "https://api.github.com/repos/rails/rails/labels/activejob", "name": "activejob", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-20T21:29:51Z", "updated_at": "2023-07-20T21:32:04Z", "closed_at": "2023-07-20T21:30:41Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48776", "html_url": "https://github.com/rails/rails/pull/48776", "diff_url": "https://github.com/rails/rails/pull/48776.diff", "patch_url": "https://github.com/rails/rails/pull/48776.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because [REPLACE ME]\r\n\r\n### Detail\r\n\r\nThis Pull Request changes [REPLACE ME]\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [ ] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48776/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48776/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48775", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48775/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48775/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48775/events", "html_url": "https://github.com/rails/rails/issues/48775", "id": 1814805867, "node_id": "I_kwDNIULObCu9aw", "number": 48775, "title": "Arel table alias breaks insert, update, and delete statements", "user": {"login": "lavoiesl", "id": 1216046, "node_id": "MDQ6VXNlcjEyMTYwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1216046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lavoiesl", "html_url": "https://github.com/lavoiesl", "followers_url": "https://api.github.com/users/lavoiesl/followers", "following_url": "https://api.github.com/users/lavoiesl/following{/other_user}", "gists_url": "https://api.github.com/users/lavoiesl/gists{/gist_id}", "starred_url": "https://api.github.com/users/lavoiesl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lavoiesl/subscriptions", "organizations_url": "https://api.github.com/users/lavoiesl/orgs", "repos_url": "https://api.github.com/users/lavoiesl/repos", "events_url": "https://api.github.com/users/lavoiesl/events{/privacy}", "received_events_url": "https://api.github.com/users/lavoiesl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-20T21:10:55Z", "updated_at": "2023-08-08T01:17:57Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activerecord\", \"~> 7.0.0\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n    t.string \"name\"\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\nend\r\n\r\n\r\nclass BugTest < Minitest::Test\r\n  def setup\r\n    Post.arel_table.table_alias = nil\r\n  end\r\n\r\n  def test_select\r\n    assert_equal('SELECT \"posts\".* FROM \"posts\"', Post.all.to_sql)\r\n  end\r\n\r\n  def test_select_alias\r\n    Post.arel_table.table_alias = \"p\"\r\n    assert_equal('SELECT \"p\".* FROM \"posts\" \"p\"', Post.all.to_sql)\r\n  end\r\n\r\n  def test_insert\r\n    post = Post.create!\r\n    refute_nil(post)\r\n  end\r\n\r\n  def test_insert_alias\r\n    Post.arel_table.table_alias = \"p\"\r\n    e = assert_raises(ActiveRecord::StatementInvalid) do\r\n      Post.create!\r\n    end\r\n    assert_equal('INSERT INTO \"posts\" \"p\" DEFAULT VALUES', e.sql)\r\n    assert_equal('SQLite3::SQLException: near \"\"p\"\": syntax error', e.message)\r\n  end\r\n\r\n  def test_update\r\n    post = Post.create!\r\n    refute_nil(post)\r\n    post.name = \"foo\"\r\n    post.save!\r\n  end\r\n\r\n  def test_update_alias\r\n    post = Post.create!\r\n    refute_nil(post)\r\n\r\n    Post.arel_table.table_alias = \"p\"\r\n    e = assert_raises(ActiveRecord::StatementInvalid) do\r\n      post.name = \"foo\"\r\n      post.save!\r\n    end\r\n    assert_equal('UPDATE \"posts\" \"p\" SET \"name\" = ? WHERE \"p\".\"id\" = ?', e.sql)\r\n    assert_equal('SQLite3::SQLException: near \"\"p\"\": syntax error', e.message)\r\n  end\r\n\r\n  def test_delete\r\n    post = Post.create!\r\n    refute_nil(post)\r\n    post.delete\r\n  end\r\n\r\n  def test_delete_alias\r\n    post = Post.create!\r\n    refute_nil(post)\r\n\r\n    Post.arel_table.table_alias = \"p\"\r\n    e = assert_raises(ActiveRecord::StatementInvalid) do\r\n      post.delete\r\n    end\r\n    assert_equal('DELETE FROM \"posts\" \"p\" WHERE \"p\".\"id\" = ?', e.sql)\r\n    assert_equal('SQLite3::SQLException: near \"\"p\"\": syntax error', e.message)\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\nThe table alias is valid on SELECTs, but not on INSERT, UPDATE, or DELETE statements.\r\nThe example is with sqlite, but [MySQL has similar rules where it specifically asks for a table _name_](https://dev.mysql.com/doc/refman/8.0/en/insert.html).\r\n\r\nI would expect Arel to _NOT_ use the alias on insert, update, and delete statements\r\n\r\n### System configuration\r\n**Rails version**:\r\n6.1.7.4\r\n\r\n**Ruby version**:\r\n3.2.2\r\n\r\n**MySQL**:\r\nMySQL 5.7, using the mysql2 0.5.5 gem", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48775/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48775/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48774", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48774/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48774/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48774/events", "html_url": "https://github.com/rails/rails/pull/48774", "id": 1814759113, "node_id": "PR_kwDNIULOVgsgpQ", "number": 48774, "title": "Improve readability of case sensitivity description", "user": {"login": "djpowers", "id": 4978418, "node_id": "MDQ6VXNlcjQ5Nzg0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/4978418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/djpowers", "html_url": "https://github.com/djpowers", "followers_url": "https://api.github.com/users/djpowers/followers", "following_url": "https://api.github.com/users/djpowers/following{/other_user}", "gists_url": "https://api.github.com/users/djpowers/gists{/gist_id}", "starred_url": "https://api.github.com/users/djpowers/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/djpowers/subscriptions", "organizations_url": "https://api.github.com/users/djpowers/orgs", "repos_url": "https://api.github.com/users/djpowers/repos", "events_url": "https://api.github.com/users/djpowers/events{/privacy}", "received_events_url": "https://api.github.com/users/djpowers/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-20T20:32:56Z", "updated_at": "2023-07-21T14:19:14Z", "closed_at": "2023-07-21T13:06:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48774", "html_url": "https://github.com/rails/rails/pull/48774", "diff_url": "https://github.com/rails/rails/pull/48774.diff", "patch_url": "https://github.com/rails/rails/pull/48774.patch", "merged_at": "2023-07-21T13:06:22Z"}, "body": "### Motivation / Background\r\n\r\nThis pull request is meant to improve the readability and grammar of the paragraph explaining case sensitivity with regards to uniqueness constraints as part of the validations guide.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48774/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48774/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48773", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48773/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48773/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48773/events", "html_url": "https://github.com/rails/rails/pull/48773", "id": 1814650850, "node_id": "PR_kwDNIULOVgmc-Q", "number": 48773, "title": "Make ActiveRecord's quoted name caches thread-safe on JRuby/TruffleRuby", "user": {"login": "nirvdrum", "id": 12584, "node_id": "MDQ6VXNlcjEyNTg0", "avatar_url": "https://avatars.githubusercontent.com/u/12584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nirvdrum", "html_url": "https://github.com/nirvdrum", "followers_url": "https://api.github.com/users/nirvdrum/followers", "following_url": "https://api.github.com/users/nirvdrum/following{/other_user}", "gists_url": "https://api.github.com/users/nirvdrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/nirvdrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nirvdrum/subscriptions", "organizations_url": "https://api.github.com/users/nirvdrum/orgs", "repos_url": "https://api.github.com/users/nirvdrum/repos", "events_url": "https://api.github.com/users/nirvdrum/events{/privacy}", "received_events_url": "https://api.github.com/users/nirvdrum/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-07-20T19:16:36Z", "updated_at": "2023-07-24T16:21:30Z", "closed_at": "2023-07-24T16:17:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48773", "html_url": "https://github.com/rails/rails/pull/48773", "diff_url": "https://github.com/rails/rails/pull/48773.diff", "patch_url": "https://github.com/rails/rails/pull/48773.patch", "merged_at": "2023-07-24T16:17:50Z"}, "body": "### Motivation / Background\r\n\r\nI've run into a thread-safety issue updating ActiveRecord's quoted name caches when running a Rails application on TruffleRuby. These shared caches are updated when building SQL queries. If two threads are building queries at the same time, they may both attempt to update the cache.\r\n\r\nAdditionally, since the caches were lazily allocated, it's possible both threads could see different cache stores. That may not be much of a problem since none of the cache entries are compared by object identity (at least as far as I can tell), but having multiple live caches across different threads will consume extra memory and may be confusing to debug.\r\n\r\nThis Pull Request has been created to fix the race conditions in allocating and updating the quoted name caches.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the quoted name caches in the ActiveRecord adapters from `Hash` to `Concurrent::Map`, allowing for atomic updates that will be reflected across all threads. Additionally, the quoted name caches are now eagerly allocated to avoid issues with multiple threads trying to resolve the cache lazily, resulting in multiple cache objects being created but not visible across all threads.\r\n\r\n### Additional information\r\n\r\nWe could still lazily resolve the caches if that's desired, but we'll continue to run into the problem where multiple threads attempting to resolve the cache at the same time may create multiple cache objects. As for the issue of concurrent writes to the cache, I think using concurrent-ruby is the best option given it's already a dependency. An alternative approach would be to use a lock, but I don't think that buys us anything in this case.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48773/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48773/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48772", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48772/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48772/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48772/events", "html_url": "https://github.com/rails/rails/pull/48772", "id": 1814433112, "node_id": "PR_kwDNIULOVgahhg", "number": 48772, "title": "Prevent inspecting transmit data if not necessary", "user": {"login": "mhib", "id": 3617925, "node_id": "MDQ6VXNlcjM2MTc5MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/3617925?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mhib", "html_url": "https://github.com/mhib", "followers_url": "https://api.github.com/users/mhib/followers", "following_url": "https://api.github.com/users/mhib/following{/other_user}", "gists_url": "https://api.github.com/users/mhib/gists{/gist_id}", "starred_url": "https://api.github.com/users/mhib/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mhib/subscriptions", "organizations_url": "https://api.github.com/users/mhib/orgs", "repos_url": "https://api.github.com/users/mhib/repos", "events_url": "https://api.github.com/users/mhib/events{/privacy}", "received_events_url": "https://api.github.com/users/mhib/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-20T16:57:05Z", "updated_at": "2023-07-21T06:45:27Z", "closed_at": "2023-07-21T06:45:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48772", "html_url": "https://github.com/rails/rails/pull/48772", "diff_url": "https://github.com/rails/rails/pull/48772.diff", "patch_url": "https://github.com/rails/rails/pull/48772.patch", "merged_at": "2023-07-21T06:45:08Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\n[Currently](https://github.com/rails/rails/blob/0ccde297a1db34703ebf332ce21ceeb9e2fcb6ac/actioncable/lib/action_cable/channel/base.rb#L215) on every call to `ActionCable::Channel::Base#transmit`, debug log message is generated that inspects the provided `data` object. The message is generated even if the logger's level is above `WARN`. This patch makes it so the message is generated only when it can be logged.\r\n\r\n### Detail\r\nIn a [very similar scenario](https://github.com/rails/rails/blob/0ccde297a1db34703ebf332ce21ceeb9e2fcb6ac/actioncable/lib/action_cable/server/broadcasting.rb#L45) in `ActionCable::Server::Broadcasting::Broadcaster#broadcast` debug method with a block is used. To use the same call in `ActionCable::Channel::Base#transmit`, TaggedLoggerProxy must pass block to the wrapped logger.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [*] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [*] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [*] Tests are added or updated if you fix a bug or add a feature.\r\n* [*] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48772/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48772/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48771", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48771/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48771/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48771/events", "html_url": "https://github.com/rails/rails/issues/48771", "id": 1814330972, "node_id": "I_kwDNIULObCR-XA", "number": 48771, "title": "`belongs_to` validating the presence of object and not the object's ID", "user": {"login": "tejanium", "id": 1259814, "node_id": "MDQ6VXNlcjEyNTk4MTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1259814?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tejanium", "html_url": "https://github.com/tejanium", "followers_url": "https://api.github.com/users/tejanium/followers", "following_url": "https://api.github.com/users/tejanium/following{/other_user}", "gists_url": "https://api.github.com/users/tejanium/gists{/gist_id}", "starred_url": "https://api.github.com/users/tejanium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tejanium/subscriptions", "organizations_url": "https://api.github.com/users/tejanium/orgs", "repos_url": "https://api.github.com/users/tejanium/repos", "events_url": "https://api.github.com/users/tejanium/events{/privacy}", "received_events_url": "https://api.github.com/users/tejanium/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-20T15:57:19Z", "updated_at": "2023-07-27T08:55:49Z", "closed_at": "2023-07-27T08:55:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\nGiven I have\r\n\r\n```ruby\r\nclass Post < ActiveRecord::Base\r\n  validates :title, presence: true\r\n\r\n  has_many :comments\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\n  belongs_to :post, optional: false\r\nend\r\n```\r\n\r\nthen I do\r\n\r\n```ruby\r\ncomment = Comment.new(post: Post.new)\r\n```\r\n\r\nI expect\r\n\r\n```ruby\r\ncomment.invalid?\r\n```\r\n\r\nto be true and see a validation error either in `post` or `post_id`\r\n\r\n### Reproducible script\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"mysql2\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"mysql2\", user: 'root', host: 'localhost')\r\n\r\nActiveRecord::Base.connection.execute(\"DROP DATABASE IF EXISTS bug_test\")\r\nActiveRecord::Base.connection.execute(\"CREATE DATABASE bug_test\")\r\n\r\nActiveRecord::Base.establish_connection(adapter: \"mysql2\", database: \"bug_test\", user: 'root', host: 'localhost')\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n    t.string :title\r\n  end\r\n\r\n  create_table :comments, force: true do |t|\r\n    t.references :post, foreign_key: true\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  validates :title, presence: true\r\n\r\n  has_many :comments\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\n  belongs_to :post, optional: false\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_default_belongs_to_validation\r\n    comment = Comment.new(post: Post.new)\r\n\r\n    assert_predicate comment, :invalid?\r\n    assert_equal comment.errors[:post], [\"must exist\"]\r\n  end\r\n\r\n  def test_default_belongs_to_validation_with_id\r\n    comment = Comment.new(post_id: Post.new.id)\r\n\r\n    assert_predicate comment, :invalid?\r\n    assert_equal comment.errors[:post_id], [\"can\u2019t be blank\"]\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\n\r\nSince Rails 5.0 the default for `belongs_to` is `optional: false` (or `required: true` now), which means the presence validator is added automatically.\r\n\r\nSo that when we do `Comment.new(post: Post.new)` it will validate the presence of `post`, however it doesn't translates as `validates :post_id, presence: true`\r\n\r\nWe can explicitly `validates :post_id, presence: true` so it became\r\n\r\n```ruby\r\nclass Comment < ActiveRecord::Base\r\n  belongs_to :post, optional: false\r\n  \r\n  validates :post_id, presence: true\r\nend\r\n```\r\n\r\nBut I think it defeats the purpose of `optional: false` (`require: true`) (and the default behavior of `belongs_to`)\r\n\r\nAlso, Rubocop has this check https://www.rubydoc.info/gems/rubocop-rails/RuboCop/Cop/Rails/RedundantPresenceValidationOnBelongsTo which complains if devs explicitly validating `association` or `association_id` of a `belongs_to`\r\n\r\n```ruby\r\n# bad\r\nbelongs_to :user\r\nvalidates :user, presence: true\r\n\r\n# bad\r\nbelongs_to :user\r\nvalidates :user_id, presence: true\r\n\r\n# bad\r\nbelongs_to :author, foreign_key: :user_id\r\nvalidates :user_id, presence: true\r\n\r\n# good\r\nbelongs_to :user\r\n\r\n# good\r\nbelongs_to :author, foreign_key: :user_id\r\n```\r\n\r\nWhich warn me if I have both `belongs_to :post` and `validates :post_id, presence: true`\r\n\r\nWhile I understand this probably is a Rubocop issue, this behavior is perhaps somehow unexpected since there's no point in automatically validating the presence of the association of `belongs_to`, if the association itself is invalid/incomplete (without `id`) \r\n\r\nTherefore, would it be better for `belongs_to :post, optional: false` actually to automatically add `validates :post_id, presence: true` instead?\r\n\r\n### Actual behavior\r\n\r\nIt persists the broken `comment` without `post_id`\r\n\r\n### System configuration\r\n\r\n**Rails version**: 7.1.0.alpha from https://github.com/rails/rails.git\r\n\r\n**Ruby version**: ruby 3.0.6p216 (2023-03-30 revision 23a532679b) [arm64-darwin22]\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48771/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48771/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48770", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48770/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48770/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48770/events", "html_url": "https://github.com/rails/rails/issues/48770", "id": 1814236326, "node_id": "I_kwDNIULObCMMpg", "number": 48770, "title": "HashWithIndifferentAccess#to_proc does not map keys to values as Hash#to_proc does", "user": {"login": "jasonkarns", "id": 119972, "node_id": "MDQ6VXNlcjExOTk3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/119972?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jasonkarns", "html_url": "https://github.com/jasonkarns", "followers_url": "https://api.github.com/users/jasonkarns/followers", "following_url": "https://api.github.com/users/jasonkarns/following{/other_user}", "gists_url": "https://api.github.com/users/jasonkarns/gists{/gist_id}", "starred_url": "https://api.github.com/users/jasonkarns/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jasonkarns/subscriptions", "organizations_url": "https://api.github.com/users/jasonkarns/orgs", "repos_url": "https://api.github.com/users/jasonkarns/repos", "events_url": "https://api.github.com/users/jasonkarns/events{/privacy}", "received_events_url": "https://api.github.com/users/jasonkarns/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-20T15:13:09Z", "updated_at": "2023-07-23T20:13:54Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "`Hash#to_proc` returns a proc that maps key to its value in the hash.\r\n\r\n`HashWithIndifferentAccess#to_proc` however, does not generate a proc that behaves similarly.\r\n\r\nThere are two distinct behaviors that deviate from expections. Firstly, since HWIA normalizes symbol keys to strings internally, then HWIA#to_proc will _only_ work with string keys. (symbol keys map to nil). If a HWIA is constructed with symbol keys, then it should be expected that `#to_proc` honor that form.\r\n\r\nThe more general behavior, I think, is that one would expect a HWIA#to_proc to still map keys indifferently. So even if the HWIA were constructed with string keys, it should still accept symbols as well, since that is the point of HWIA (and since the proc is intended to essentially equate to `#[]`).\r\n\r\n### Steps to reproduce\r\n\r\nRepro gist: https://gist.github.com/jasonkarns/b8cfea9d681f3754648d807dc6710d63\r\n\r\n```ruby\r\nregular_hash = {a: 1, b: 2}\r\nindifferent_hash = regular_hash.with_indifferent_access\r\n\r\nkeys = regular_hash.keys # symbol keys\r\n\r\nkeys.map(&indifferent_hash)\r\n```\r\n\r\n### Expected behavior\r\n\r\nI would expect the result to be `[1,2]` just as `keys.map(&regular_hash)` would return.\r\n\r\n### Actual behavior\r\n\r\nActual result is `[nil, nil]`\r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.1.3\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48770/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48770/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48769", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48769/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48769/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48769/events", "html_url": "https://github.com/rails/rails/issues/48769", "id": 1813676065, "node_id": "I_kwDNIULObBqAIQ", "number": 48769, "title": "after_commit runs before transaction committed after upgrade Rails from 6.0.4.8 to 6.1.7.4", "user": {"login": "ikarpov-lohika", "id": 72409796, "node_id": "MDQ6VXNlcjcyNDA5Nzk2", "avatar_url": "https://avatars.githubusercontent.com/u/72409796?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ikarpov-lohika", "html_url": "https://github.com/ikarpov-lohika", "followers_url": "https://api.github.com/users/ikarpov-lohika/followers", "following_url": "https://api.github.com/users/ikarpov-lohika/following{/other_user}", "gists_url": "https://api.github.com/users/ikarpov-lohika/gists{/gist_id}", "starred_url": "https://api.github.com/users/ikarpov-lohika/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ikarpov-lohika/subscriptions", "organizations_url": "https://api.github.com/users/ikarpov-lohika/orgs", "repos_url": "https://api.github.com/users/ikarpov-lohika/repos", "events_url": "https://api.github.com/users/ikarpov-lohika/events{/privacy}", "received_events_url": "https://api.github.com/users/ikarpov-lohika/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1071962662, "node_id": "MDU6TGFiZWwxMDcxOTYyNjYy", "url": "https://api.github.com/repos/rails/rails/labels/more-information-needed", "name": "more-information-needed", "color": "bfdadc", "default": false, "description": "When reporter needs to provide more information"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-20T10:36:50Z", "updated_at": "2023-08-04T00:58:46Z", "closed_at": "2023-08-04T00:58:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nClass for reproduction:\r\n```\r\nclass Redemption < ApplicationRecord\r\n  not_sharded\r\n  self.table_name = \"coupon_redemptions\"\r\n  self.primary_key = \"id\"\r\n\r\n  after_commit :find_created_record,\r\n      on: :create\r\n\r\n  def find_created_record\r\n    puts \"in after commit\"\r\n    r = ::Redemption.find(id)\r\n    puts r.inspect\r\n  end\r\nend\r\n```\r\nExecution example:\r\n`redemption = Redemption.new(account_id: 101, coupon_id: 101, active: true).save(validate:false)`\r\n\r\nStarted reproducing after the upgrade Rails from 6.0.4.8 to 6.1.7.4\r\n\r\nUsed properties in application:\r\n```\r\nconfig.active_record.has_many_inversing = false\r\nconfig.active_record.legacy_connection_handling = true \r\n```\r\n\r\n### Expected behavior\r\n```\r\nD, [2023-07-20T09:17:22.308552 #4138] DEBUG -- :   TRANSACTION (2.0ms)  BEGIN\r\nD, [2023-07-20T09:17:22.316227 #4138] DEBUG -- :   Redemption Create (1.9ms)  INSERT INTO coupon_redemptions` (`account_id`, `coupon_id`, `active`, `created_at`, `updated_at`) VALUES (12000, 12000, TRUE, '2023-07-20 09:17:22', '2023-07-20 09:17:22')\r\nD, [2023-07-20T09:17:22.322090 #4138] DEBUG -- :   TRANSACTION (3.3ms)  COMMIT\r\n\r\nin after commit\r\n\r\nD, [2023-07-20T09:17:22.328713 #4138] DEBUG -- :   Redemption Load (2.8ms)  SELECT `coupon_redemptions`.* FROM `coupon_redemptions` WHERE `coupon_redemptions`.`id` = 1006 LIMIT 1\r\n#<Redemption id: 1006, account_id: 12000, coupon_id: 12000, active: true, created_at: \"2023-07-20 09:17:22.000000000 +0000\", updated_at: \"2023-07-20 09:17:22.000000000 +0000\", fact_snapshot: nil, discount_starts_at: nil, discount_ends_at: nil>\r\n\r\n=> true\r\n```\r\n### Actual behavior\r\n```\r\nD, [2023-07-20T09:17:22.308552 #4138] DEBUG -- :   TRANSACTION (2.0ms)  BEGIN\r\nD, [2023-07-20T09:17:22.316227 #4138] DEBUG -- :   Redemption Create (1.9ms)  INSERT INTO `coupon_redemptions` (`account_id`, `coupon_id`, `active`, `created_at`, `updated_at`) VALUES (12000, 12000, TRUE, '2023-07-20 09:17:22', '2023-07-20 09:17:22')\r\nD, [2023-07-20T09:17:22.322090 #4138] DEBUG -- :   TRANSACTION (3.3ms)  COMMIT\r\n\r\nin after commit\r\n\r\nD, [2023-07-20T09:17:22.328713 #4138] DEBUG -- :   ActiveRecord::RecordNotFound Couldn't find Redemption with 'id'=14674\r\n```\r\n\r\n### NOTE:\r\nIf add `sleep` for 1 sec before `find`, code will work fine with 6.1.7.4:\r\n```\r\n def find_created_record\r\n    puts \"in after commit\"\r\n    sleep(1)\r\n    r = ::Redemption.find(id)\r\n    puts r.inspect\r\n  end\r\n```\r\n\r\n### System configuration\r\n**Rails version**: 6.1.7.4\r\n\r\n**Ruby version**: 2.7.7\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48769/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48769/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48768", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48768/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48768/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48768/events", "html_url": "https://github.com/rails/rails/pull/48768", "id": 1812867389, "node_id": "PR_kwDNIULOVfEX9A", "number": 48768, "title": "Fix migration.rb#CheckPending coming from stack.rb", "user": {"login": "mathieujobin", "id": 99191, "node_id": "MDQ6VXNlcjk5MTkx", "avatar_url": "https://avatars.githubusercontent.com/u/99191?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mathieujobin", "html_url": "https://github.com/mathieujobin", "followers_url": "https://api.github.com/users/mathieujobin/followers", "following_url": "https://api.github.com/users/mathieujobin/following{/other_user}", "gists_url": "https://api.github.com/users/mathieujobin/gists{/gist_id}", "starred_url": "https://api.github.com/users/mathieujobin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mathieujobin/subscriptions", "organizations_url": "https://api.github.com/users/mathieujobin/orgs", "repos_url": "https://api.github.com/users/mathieujobin/repos", "events_url": "https://api.github.com/users/mathieujobin/events{/privacy}", "received_events_url": "https://api.github.com/users/mathieujobin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 1071962662, "node_id": "MDU6TGFiZWwxMDcxOTYyNjYy", "url": "https://api.github.com/repos/rails/rails/labels/more-information-needed", "name": "more-information-needed", "color": "bfdadc", "default": false, "description": "When reporter needs to provide more information"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-19T23:16:56Z", "updated_at": "2023-08-08T15:34:56Z", "closed_at": "2023-08-08T15:34:56Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48768", "html_url": "https://github.com/rails/rails/pull/48768", "diff_url": "https://github.com/rails/rails/pull/48768.diff", "patch_url": "https://github.com/rails/rails/pull/48768.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nSeeing this error on rake tasks that calls CheckPending\r\n```\r\nwrong number of arguments (given 2, expected 1)\r\n#<ArgumentError: wrong number of arguments (given 2, expected 1)>\r\n```\r\n\r\nThis is the stack trace, I have not found a bad call, it appears to come from directly from the rails stack. Thus, I came up with this \"fix\".\r\n\r\n```\r\n3.2.0/gems/activerecord-7.0.5.1/lib/active_record/migration.rb:584:in `initialize'\r\n3.2.0/gems/actionpack-7.0.5.1/lib/action_dispatch/middleware/stack.rb:37:in `new'\r\n3.2.0/gems/actionpack-7.0.5.1/lib/action_dispatch/middleware/stack.rb:37:in `build'\r\n3.2.0/gems/actionpack-7.0.5.1/lib/action_dispatch/middleware/stack.rb:166:in `block in build'\r\n3.2.0/gems/actionpack-7.0.5.1/lib/action_dispatch/middleware/stack.rb:162:in `each'\r\n3.2.0/gems/actionpack-7.0.5.1/lib/action_dispatch/middleware/stack.rb:162:in `inject'\r\n3.2.0/gems/actionpack-7.0.5.1/lib/action_dispatch/middleware/stack.rb:162:in `build'\r\n3.2.0/gems/railties-7.0.5.1/lib/rails/engine.rb:516:in `block in app'\r\n3.2.0/gems/railties-7.0.5.1/lib/rails/engine.rb:512:in `synchronize'\r\n3.2.0/gems/railties-7.0.5.1/lib/rails/engine.rb:512:in `app'\r\n3.2.0/gems/railties-7.0.5.1/lib/rails/application/finisher.rb:52:in `block in <module:Finisher>'\r\n3.2.0/gems/railties-7.0.5.1/lib/rails/initializable.rb:32:in `instance_exec'\r\n3.2.0/gems/railties-7.0.5.1/lib/rails/initializable.rb:32:in `run'\r\n3.2.0/gems/railties-7.0.5.1/lib/rails/initializable.rb:61:in `block in run_initializers'\r\n3.2.0/tsort.rb:228:in `block in tsort_each'\r\n3.2.0/tsort.rb:350:in `block (2 levels) in each_strongly_connected_component'\r\n3.2.0/tsort.rb:431:in `each_strongly_connected_component_from'\r\n3.2.0/tsort.rb:349:in `block in each_strongly_connected_component'\r\n3.2.0/tsort.rb:347:in `each'\r\n3.2.0/tsort.rb:347:in `call'\r\n3.2.0/tsort.rb:347:in `each_strongly_connected_component'\r\n3.2.0/tsort.rb:226:in `tsort_each'\r\n3.2.0/tsort.rb:205:in `tsort_each'\r\n3.2.0/gems/railties-7.0.5.1/lib/rails/initializable.rb:60:in `run_initializers'\r\n3.2.0/gems/railties-7.0.5.1/lib/rails/application.rb:372:in `initialize!'\r\n/personal_application/config/environment.rb:6:in `<top (required)>'\r\n3.2.0/rubygems/core_ext/kernel_require.rb>:37:in `require'\r\n3.2.0/rubygems/core_ext/kernel_require.rb>:37:in `require'\r\n3.2.0/gems/zeitwerk-2.6.8/lib/zeitwerk/kernel.rb:38:in `require'\r\n3.2.0/gems/railties-7.0.5.1/lib/rails/application.rb:348:in `require_environment!'\r\n3.2.0/gems/railties-7.0.5.1/lib/rails/application.rb:506:in `block in run_tasks_blocks'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:281:in `block in execute'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:281:in `each'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:281:in `execute'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:219:in `block in invoke_with_call_chain'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:199:in `synchronize'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:199:in `invoke_with_call_chain'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:243:in `block in invoke_prerequisites'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:241:in `each'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:241:in `invoke_prerequisites'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:218:in `block in invoke_with_call_chain'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:199:in `synchronize'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:199:in `invoke_with_call_chain'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:243:in `block in invoke_prerequisites'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:241:in `each'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:241:in `invoke_prerequisites'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:218:in `block in invoke_with_call_chain'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:199:in `synchronize'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:199:in `invoke_with_call_chain'\r\n3.2.0/gems/rake-13.0.6/lib/rake/task.rb:188:in `invoke'\r\n```\r\n\r\n### Detail\r\n\r\nI am adding a `*args` to CheckPending, because it is being sent by https://github.com/rails/rails/blob/7-0-stable/actionpack/lib/action_dispatch/middleware/stack.rb#L37\r\n\r\n### Additional information\r\n\r\nTest and Changelog update pending.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48768/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48768/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48767", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48767/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48767/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48767/events", "html_url": "https://github.com/rails/rails/pull/48767", "id": 1812829600, "node_id": "PR_kwDNIULOVfCRww", "number": 48767, "title": "Prevent header wrapping in email preview", "user": {"login": "c960657", "id": 111346, "node_id": "MDQ6VXNlcjExMTM0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/111346?v=4", "gravatar_id": "", "url": "https://api.github.com/users/c960657", "html_url": "https://github.com/c960657", "followers_url": "https://api.github.com/users/c960657/followers", "following_url": "https://api.github.com/users/c960657/following{/other_user}", "gists_url": "https://api.github.com/users/c960657/gists{/gist_id}", "starred_url": "https://api.github.com/users/c960657/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/c960657/subscriptions", "organizations_url": "https://api.github.com/users/c960657/orgs", "repos_url": "https://api.github.com/users/c960657/repos", "events_url": "https://api.github.com/users/c960657/events{/privacy}", "received_events_url": "https://api.github.com/users/c960657/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-19T22:33:35Z", "updated_at": "2023-07-21T11:40:33Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48767", "html_url": "https://github.com/rails/rails/pull/48767", "diff_url": "https://github.com/rails/rails/pull/48767.diff", "patch_url": "https://github.com/rails/rails/pull/48767.patch", "merged_at": null}, "body": "### Motivation / Background\r\nIn the all header view in email previews, header names may wrap if the header value is very long (see screenshot). Header names are usually short, so I suggest we don't wrap those.\r\n\r\n### Screenshot\r\n#### Before\r\n<img width=\"668\" alt=\"image\" src=\"https://github.com/rails/rails/assets/111346/d1949ad5-2a3d-4c3a-9f25-cd55b3b272a4\">\r\n\r\n#### After\r\n<img width=\"731\" alt=\"image\" src=\"https://github.com/rails/rails/assets/111346/72cb2aea-55bd-4e38-8e78-307d500dc512\">\r\n\r\n\r\n### Checklist\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [n/a] Tests are added or updated if you fix a bug or add a feature.\r\n* [n/a] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48767/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48767/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48766", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48766/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48766/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48766/events", "html_url": "https://github.com/rails/rails/pull/48766", "id": 1812775499, "node_id": "PR_kwDNIULOVe_UZQ", "number": 48766, "title": "Call `other.value_for_database` in ActiveRecord::Relation::QueryAttribute == check", "user": {"login": "ywenc", "id": 20496719, "node_id": "MDQ6VXNlcjIwNDk2NzE5", "avatar_url": "https://avatars.githubusercontent.com/u/20496719?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ywenc", "html_url": "https://github.com/ywenc", "followers_url": "https://api.github.com/users/ywenc/followers", "following_url": "https://api.github.com/users/ywenc/following{/other_user}", "gists_url": "https://api.github.com/users/ywenc/gists{/gist_id}", "starred_url": "https://api.github.com/users/ywenc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ywenc/subscriptions", "organizations_url": "https://api.github.com/users/ywenc/orgs", "repos_url": "https://api.github.com/users/ywenc/repos", "events_url": "https://api.github.com/users/ywenc/events{/privacy}", "received_events_url": "https://api.github.com/users/ywenc/received_events", "type": "User", "site_admin": true}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "jhawthorn", "id": 131752, "node_id": "MDQ6VXNlcjEzMTc1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/131752?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhawthorn", "html_url": "https://github.com/jhawthorn", "followers_url": "https://api.github.com/users/jhawthorn/followers", "following_url": "https://api.github.com/users/jhawthorn/following{/other_user}", "gists_url": "https://api.github.com/users/jhawthorn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhawthorn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhawthorn/subscriptions", "organizations_url": "https://api.github.com/users/jhawthorn/orgs", "repos_url": "https://api.github.com/users/jhawthorn/repos", "events_url": "https://api.github.com/users/jhawthorn/events{/privacy}", "received_events_url": "https://api.github.com/users/jhawthorn/received_events", "type": "User", "site_admin": true}, "assignees": [{"login": "jhawthorn", "id": 131752, "node_id": "MDQ6VXNlcjEzMTc1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/131752?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhawthorn", "html_url": "https://github.com/jhawthorn", "followers_url": "https://api.github.com/users/jhawthorn/followers", "following_url": "https://api.github.com/users/jhawthorn/following{/other_user}", "gists_url": "https://api.github.com/users/jhawthorn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhawthorn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhawthorn/subscriptions", "organizations_url": "https://api.github.com/users/jhawthorn/orgs", "repos_url": "https://api.github.com/users/jhawthorn/repos", "events_url": "https://api.github.com/users/jhawthorn/events{/privacy}", "received_events_url": "https://api.github.com/users/jhawthorn/received_events", "type": "User", "site_admin": true}], "milestone": null, "comments": 1, "created_at": "2023-07-19T21:43:16Z", "updated_at": "2023-07-20T00:41:21Z", "closed_at": "2023-07-20T00:38:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48766", "html_url": "https://github.com/rails/rails/pull/48766", "diff_url": "https://github.com/rails/rails/pull/48766.diff", "patch_url": "https://github.com/rails/rails/pull/48766.patch", "merged_at": "2023-07-20T00:38:17Z"}, "body": "I think this method is meant to check that `value_for_database == other.value_for_database` instead of `value_for_database == value_for_database` since the second will always be true.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48766/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48766/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48765", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48765/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48765/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48765/events", "html_url": "https://github.com/rails/rails/pull/48765", "id": 1812749804, "node_id": "PR_kwDNIULOVe96aQ", "number": 48765, "title": "Fix `StatementCache::Substitute` with serialized type", "user": {"login": "ywenc", "id": 20496719, "node_id": "MDQ6VXNlcjIwNDk2NzE5", "avatar_url": "https://avatars.githubusercontent.com/u/20496719?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ywenc", "html_url": "https://github.com/ywenc", "followers_url": "https://api.github.com/users/ywenc/followers", "following_url": "https://api.github.com/users/ywenc/following{/other_user}", "gists_url": "https://api.github.com/users/ywenc/gists{/gist_id}", "starred_url": "https://api.github.com/users/ywenc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ywenc/subscriptions", "organizations_url": "https://api.github.com/users/ywenc/orgs", "repos_url": "https://api.github.com/users/ywenc/repos", "events_url": "https://api.github.com/users/ywenc/events{/privacy}", "received_events_url": "https://api.github.com/users/ywenc/received_events", "type": "User", "site_admin": true}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-19T21:20:14Z", "updated_at": "2023-07-20T00:40:58Z", "closed_at": "2023-07-20T00:37:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48765", "html_url": "https://github.com/rails/rails/pull/48765", "diff_url": "https://github.com/rails/rails/pull/48765.diff", "patch_url": "https://github.com/rails/rails/pull/48765.patch", "merged_at": "2023-07-20T00:37:52Z"}, "body": "Fixes regression from: https://github.com/rails/rails/pull/48730/\r\n\r\nAt the time of calling `value_for_database` in `ActiveRecord::Relation::QueryAttribute`'s [initialize](https://github.com/Shopify/rails/blob/29205d7928a2c530aceffde25cb1173c3133857a/activerecord/lib/active_record/relation/query_attribute.rb#L8), the value could be a `StatementCache::Substitute`, in which case, `value_for_database` would not work as expected. \r\n\r\nIn our code base, we saw a mismatch in the expected type while type-checking on a custom coder's `self.dump` method.\r\n\r\nThis PR adds a test for serializing a string value. When `ActiveRecord.use_yaml_unsafe_load = false`, we can see that calling `value_for_database` leads to the `ActiveRecord::Coders::YAMLColumn` coder dumping a `StatementCache::Substitute`, instead of the actual value. \r\n\r\nThis PR tries to address the issue by just adding a check to skip calling `value_for_database` in ActiveRecord::Relation::QueryAttribute's initialize if the value is a `StatementCache::Substitute`. Though, we wonder if there's generally a better way to prevent serializing the wrong value and/or calling `value_for_database` on a `StatementCache::Substitute` or similar classes, since `value_for_database` is callable from anywhere in a ActiveRecord::Relation::QueryAttribute.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48765/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48765/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48764", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48764/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48764/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48764/events", "html_url": "https://github.com/rails/rails/issues/48764", "id": 1812566337, "node_id": "I_kwDNIULObAmRQQ", "number": 48764, "title": "Encrypted columns are not decrypted when used in group operations across joins", "user": {"login": "TikiTDO", "id": 326184, "node_id": "MDQ6VXNlcjMyNjE4NA==", "avatar_url": "https://avatars.githubusercontent.com/u/326184?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TikiTDO", "html_url": "https://github.com/TikiTDO", "followers_url": "https://api.github.com/users/TikiTDO/followers", "following_url": "https://api.github.com/users/TikiTDO/following{/other_user}", "gists_url": "https://api.github.com/users/TikiTDO/gists{/gist_id}", "starred_url": "https://api.github.com/users/TikiTDO/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TikiTDO/subscriptions", "organizations_url": "https://api.github.com/users/TikiTDO/orgs", "repos_url": "https://api.github.com/users/TikiTDO/repos", "events_url": "https://api.github.com/users/TikiTDO/events{/privacy}", "received_events_url": "https://api.github.com/users/TikiTDO/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 5511275119, "node_id": "LA_kwDNIULPAAAAAUh_Ym8", "url": "https://api.github.com/repos/rails/rails/labels/encryption", "name": "encryption", "color": "8D3EA8", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-19T19:10:23Z", "updated_at": "2023-07-19T19:42:54Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\n1. Create a DB entry with an encrypted deterministic column as per: https://guides.rubyonrails.org/active_record_encryption.html#deterministic-and-non-deterministic-encryption\r\n\r\nRun the following code on a server with the encryption key:\r\n\r\n```ruby\r\nArticle.joins(:author).group(:email).count\r\n```\r\n\r\n### Expected behavior\r\n\r\n```ruby\r\n=> {\"email@example.com\"=>111,\r\n \"email@example.com\"=>222}\r\n```\r\n\r\n### Actual behavior\r\n\r\n```ruby\r\n=> {\"{\\\"p\\\":\\\"tHc=\\\",\\\"h\\\":{\\\"iv\\\":\\\"AUAnaod3vn4ThiCq\\\",\\\"at\\\":\\\"tNCqVTXFXsTu/7b22+KJkQ==\\\"}}\"=>111,\r\n \"{\\\"p\\\":\\\"vXw=\\\",\\\"h\\\":{\\\"iv\\\":\\\"GzjQbfA1erPDJGcG\\\",\\\"at\\\":\\\"cSCrtBxMJuJI/belpvaGtQ==\\\"}}\"=>222}\r\n```\r\n\r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48764/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48764/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48763", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48763/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48763/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48763/events", "html_url": "https://github.com/rails/rails/pull/48763", "id": 1812535626, "node_id": "PR_kwDNIULOVeyQ-w", "number": 48763, "title": "Add expires_in to generates_token_for instance method", "user": {"login": "lazaronixon", "id": 2651240, "node_id": "MDQ6VXNlcjI2NTEyNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/2651240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lazaronixon", "html_url": "https://github.com/lazaronixon", "followers_url": "https://api.github.com/users/lazaronixon/followers", "following_url": "https://api.github.com/users/lazaronixon/following{/other_user}", "gists_url": "https://api.github.com/users/lazaronixon/gists{/gist_id}", "starred_url": "https://api.github.com/users/lazaronixon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lazaronixon/subscriptions", "organizations_url": "https://api.github.com/users/lazaronixon/orgs", "repos_url": "https://api.github.com/users/lazaronixon/repos", "events_url": "https://api.github.com/users/lazaronixon/events{/privacy}", "received_events_url": "https://api.github.com/users/lazaronixon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-19T18:54:13Z", "updated_at": "2023-07-20T03:37:13Z", "closed_at": "2023-07-20T03:27:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48763", "html_url": "https://github.com/rails/rails/pull/48763", "diff_url": "https://github.com/rails/rails/pull/48763.diff", "patch_url": "https://github.com/rails/rails/pull/48763.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nSometimes we want to generate a token for the same purpose but with a different expiration, ex: Invitation (first password reset) vs regular password reset\r\n\r\nSo I am introducing an optional parameter `expires_in` to `generates_token_for` instance method that can override the default expiration.\r\n\r\n```ruby\r\nclass User < ApplicationRecord\r\n  generates_token_for :password_reset, expires_in: 15.minutes { ... }\r\nend\r\n\r\nuser = User.first\r\nuser.generate_token_for(:password_reset) # Expires in 15 minutes\r\nuser.generate_token_for(:password_reset, expires_in: 2.days) # Same purpose, but expires in 2 days\r\n```\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48763/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48763/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48762", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48762/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48762/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48762/events", "html_url": "https://github.com/rails/rails/pull/48762", "id": 1812241765, "node_id": "PR_kwDNIULOVeh4bg", "number": 48762, "title": "[7-0-stable] Add lower bound to Listen gem requirement", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-19T15:52:36Z", "updated_at": "2023-07-19T16:10:40Z", "closed_at": "2023-07-19T16:09:09Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48762", "html_url": "https://github.com/rails/rails/pull/48762", "diff_url": "https://github.com/rails/rails/pull/48762.diff", "patch_url": "https://github.com/rails/rails/pull/48762.patch", "merged_at": "2023-07-19T16:09:09Z"}, "body": "Backports #48622 and #47002 to 7-0-stable\r\n\r\nThis is useful because #47774 was backported, and `wait_for_state` isn't available until `listen` 3.3\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48762/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48762/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48761", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48761/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48761/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48761/events", "html_url": "https://github.com/rails/rails/pull/48761", "id": 1812036086, "node_id": "PR_kwDNIULOVeWnJg", "number": 48761, "title": "Support `include?` and `member?` on composite primary key relations", "user": {"login": "adrianna-chang-shopify", "id": 22918438, "node_id": "MDQ6VXNlcjIyOTE4NDM4", "avatar_url": "https://avatars.githubusercontent.com/u/22918438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adrianna-chang-shopify", "html_url": "https://github.com/adrianna-chang-shopify", "followers_url": "https://api.github.com/users/adrianna-chang-shopify/followers", "following_url": "https://api.github.com/users/adrianna-chang-shopify/following{/other_user}", "gists_url": "https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}", "starred_url": "https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adrianna-chang-shopify/subscriptions", "organizations_url": "https://api.github.com/users/adrianna-chang-shopify/orgs", "repos_url": "https://api.github.com/users/adrianna-chang-shopify/repos", "events_url": "https://api.github.com/users/adrianna-chang-shopify/events{/privacy}", "received_events_url": "https://api.github.com/users/adrianna-chang-shopify/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-19T14:06:41Z", "updated_at": "2023-07-19T14:39:47Z", "closed_at": "2023-07-19T14:39:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48761", "html_url": "https://github.com/rails/rails/pull/48761", "diff_url": "https://github.com/rails/rails/pull/48761.diff", "patch_url": "https://github.com/rails/rails/pull/48761.patch", "merged_at": "2023-07-19T14:39:43Z"}, "body": "### Motivation / Background\r\n\r\n`include` and `member?` delegate to `exists?` with the record's primary key to determine if an unloaded relation contains a given record. If the primary key is composite, `exists?` believes we are passing where-style conditions and fails. Support for `include?` will allow us to use `assert_includes` / `refute_includes` assertions on composite primary key models.\r\n\r\n### Detail\r\n\r\nThis commit fixes the issue by turning the record's composite primary key into a hash of column / value pairs that `exists?` can accept.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48761/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48761/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48760", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48760/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48760/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48760/events", "html_url": "https://github.com/rails/rails/pull/48760", "id": 1811587108, "node_id": "PR_kwDNIULOVd92ww", "number": 48760, "title": "Fix ActiveStorage Overview CORS examples", "user": {"login": "shunichi", "id": 1687073, "node_id": "MDQ6VXNlcjE2ODcwNzM=", "avatar_url": "https://avatars.githubusercontent.com/u/1687073?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shunichi", "html_url": "https://github.com/shunichi", "followers_url": "https://api.github.com/users/shunichi/followers", "following_url": "https://api.github.com/users/shunichi/following{/other_user}", "gists_url": "https://api.github.com/users/shunichi/gists{/gist_id}", "starred_url": "https://api.github.com/users/shunichi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shunichi/subscriptions", "organizations_url": "https://api.github.com/users/shunichi/orgs", "repos_url": "https://api.github.com/users/shunichi/repos", "events_url": "https://api.github.com/users/shunichi/events{/privacy}", "received_events_url": "https://api.github.com/users/shunichi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-19T09:48:08Z", "updated_at": "2023-07-21T08:15:56Z", "closed_at": "2023-07-20T13:28:56Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48760", "html_url": "https://github.com/rails/rails/pull/48760", "diff_url": "https://github.com/rails/rails/pull/48760.diff", "patch_url": "https://github.com/rails/rails/pull/48760.patch", "merged_at": "2023-07-20T13:28:56Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because S3 CORS configuration example is incorrect.\r\n\r\n### Detail\r\n\r\nS3 CORS configuration's `ExposeHeaders` corresponds to [Access-Control-Expose-Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Expose-Headers) that indicates which **response** headers should be made available to scripts running in the browser.\r\nBut current example contains **request** headers (e.g. Content-MD5).\r\n\r\n`AllowedHeaders` corresponds to [Access-Control-Allow-Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Headers) that indicates which **request** headers are allowed.\r\n\r\nAdditionally, `Origin` is not required in Access-Control-Allow-Headers. \r\nUser agents automatically add the Origin request header to CORS request and JS can't explicitly add it to the request.\r\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n[AWS documentation - S3 CORS configuration](https://docs.aws.amazon.com/AmazonS3/latest/userguide/ManageCorsUsing.html#cors-allowed-headers)\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] ~~Tests are added or updated if you fix a bug or add a feature.~~ \r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48760/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48760/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48759", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48759/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48759/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48759/events", "html_url": "https://github.com/rails/rails/issues/48759", "id": 1811586624, "node_id": "I_kwDNIULOa_qeQA", "number": 48759, "title": "Intermediate table's record is not created when using has_one through association for creation", "user": {"login": "ohbarye", "id": 1811616, "node_id": "MDQ6VXNlcjE4MTE2MTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1811616?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ohbarye", "html_url": "https://github.com/ohbarye", "followers_url": "https://api.github.com/users/ohbarye/followers", "following_url": "https://api.github.com/users/ohbarye/following{/other_user}", "gists_url": "https://api.github.com/users/ohbarye/gists{/gist_id}", "starred_url": "https://api.github.com/users/ohbarye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ohbarye/subscriptions", "organizations_url": "https://api.github.com/users/ohbarye/orgs", "repos_url": "https://api.github.com/users/ohbarye/repos", "events_url": "https://api.github.com/users/ohbarye/events{/privacy}", "received_events_url": "https://api.github.com/users/ohbarye/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-19T09:47:49Z", "updated_at": "2023-08-02T22:48:22Z", "closed_at": "2023-08-02T22:48:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "As the title says, an intermediate table's record is not created when using `has_one through` association for creation.\r\n\r\nUpon performing a git bisect, I found that it started to fail from the following commit: https://github.com/rails/rails/commit/bdbe58b50461dc44c42df4d5427fa78aeb1debcb\r\n\r\n### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire 'bundler/inline'\r\n\r\ngemfile(true) do\r\n  source 'https://rubygems.org'\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem 'activerecord', '7.0.5'\r\n  # gem 'activerecord', '7.0.4.3'\r\n  gem 'sqlite3'\r\nend\r\n\r\nrequire 'active_record'\r\nrequire 'minitest/autorun'\r\nrequire https://github.com/ruby/logger\r\n\r\nActiveRecord::Base.establish_connection(adapter: 'sqlite3', database: ':memory:')\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table 'foos', force: :true do |t|\r\n  end\r\n\r\n  create_table 'bars', force: :true do |t|\r\n  end\r\n\r\n  create_table 'prefix_middles', force: :true do |t|\r\n    t.bigint 'foo_id'\r\n    t.bigint 'bar_id'\r\n  end\r\nend\r\n\r\nclass Foo < ActiveRecord::Base\r\n  has_one :prefix_middle, class_name: 'Prefix::Middle'\r\n  has_one :bar, through: :prefix_middle\r\nend\r\n\r\nclass Bar < ActiveRecord::Base\r\n  has_one :prefix_middle, class_name: 'Prefix::Middle'\r\n  has_one :foo, through: :prefix_middle\r\nend\r\n\r\nmodule Prefix\r\n  class Middle < ActiveRecord::Base\r\n    def self.table_name_prefix\r\n      'prefix_'\r\n    end\r\n\r\n    belongs_to :foo\r\n    belongs_to :bar\r\n\r\n    validates :bar_id, presence: true\r\n  end\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_association_stuff\r\n    foo = Foo.create!\r\n\r\n    foo.create_bar!\r\n    # The value of `foo.prefix_middle.bar_id` differs between the two versions after executing `foo.create_bar!`\r\n    # Once I insert `foo.prefix_middle.bar_id = foo.bar.id` here, it passes.\r\n    foo.save! # <= This creates the intermediate table's  record at 7.0.4.3, but not at 7.0.5\r\n\r\n    assert_equal 1, Prefix::Middle.count\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\n\r\nIt creates (persists) the intermediate table's record when calling `foo.save!`. This was the behavior until version 7.0.4.3\r\n\r\n### Actual behavior\r\n\r\nIt does not create (persist) the intermediate table's record when calling `foo.save!`.\r\n\r\n### System configuration\r\n\r\n**Rails version**: 7.0.5\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48759/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48759/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48758", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48758/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48758/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48758/events", "html_url": "https://github.com/rails/rails/issues/48758", "id": 1810868531, "node_id": "I_kwDNIULOa--pMw", "number": 48758, "title": "ActiveRecord::Base#attribute_names and ActiveRecord::Base#table_exist? to work without connection", "user": {"login": "kirs", "id": 522155, "node_id": "MDQ6VXNlcjUyMjE1NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/522155?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirs", "html_url": "https://github.com/kirs", "followers_url": "https://api.github.com/users/kirs/followers", "following_url": "https://api.github.com/users/kirs/following{/other_user}", "gists_url": "https://api.github.com/users/kirs/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirs/subscriptions", "organizations_url": "https://api.github.com/users/kirs/orgs", "repos_url": "https://api.github.com/users/kirs/repos", "events_url": "https://api.github.com/users/kirs/events{/privacy}", "received_events_url": "https://api.github.com/users/kirs/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-18T23:35:10Z", "updated_at": "2023-07-19T17:33:32Z", "closed_at": "2023-07-19T17:33:32Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "In the app I'm working on, we take resiliency very seriously and we have a hard requirements for the app to boot and be able to access model's `attribute_names` even when the database connection is down. For that, we employ schema cache for each connection.\r\n\r\nWe employ a bunch of patches of connection & connection pooling to make that happen. It would be great to have Rails support that from the box when schema cache is available.\r\n\r\nA snippet to illustrate the idea:\r\n\r\n```ruby\r\nrequire \"active_record\"\r\n\r\nclass ApplicationRecord < ActiveRecord::Base\r\n  self.abstract_class = true\r\n  connects_to database: { writing: :mydb }\r\nend\r\n\r\nclass Post < ApplicationRecord\r\nend\r\n\r\n# on boot, load and set the cache to pool\r\ncache = ActiveRecord::ConnectionAdapters::SchemaCache.load_from(\"./stored_schema_cache.yml\")\r\nApplicationRecord.connection_pool.set_schema_cache(cache)\r\n\r\n# pretend that connection is \"down\"\r\nmodule ActiveRecord\r\n  module ConnectionHandling\r\n    def retrieve_connection\r\n      raise \"should not be called\"\r\n    end\r\n  end\r\nend\r\n\r\nputs Post.attribute_names.inspect\r\n=> expect this to return attribute names based on info from the schema cache, without retrieve_connection being called at all\r\n```\r\n\r\nI believe this could be achieved by changing calls like `connection.schema_cache.columns_hash` and `connection.schema_cache.data_source_exists?(table_name)` into something that can access schema cache without invoking the connection.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48758/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48758/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48757", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48757/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48757/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48757/events", "html_url": "https://github.com/rails/rails/pull/48757", "id": 1809802708, "node_id": "PR_kwDNIULOVcd36Q", "number": 48757, "title": "Draft | Investigate `has_many` `through` polymorphic with `where`", "user": {"login": "joshuay03", "id": 54629302, "node_id": "MDQ6VXNlcjU0NjI5MzAy", "avatar_url": "https://avatars.githubusercontent.com/u/54629302?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshuay03", "html_url": "https://github.com/joshuay03", "followers_url": "https://api.github.com/users/joshuay03/followers", "following_url": "https://api.github.com/users/joshuay03/following{/other_user}", "gists_url": "https://api.github.com/users/joshuay03/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshuay03/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshuay03/subscriptions", "organizations_url": "https://api.github.com/users/joshuay03/orgs", "repos_url": "https://api.github.com/users/joshuay03/repos", "events_url": "https://api.github.com/users/joshuay03/events{/privacy}", "received_events_url": "https://api.github.com/users/joshuay03/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-18T12:12:34Z", "updated_at": "2023-07-18T12:25:46Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48757", "html_url": "https://github.com/rails/rails/pull/48757", "diff_url": "https://github.com/rails/rails/pull/48757.diff", "patch_url": "https://github.com/rails/rails/pull/48757.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created to investigate https://github.com/rails/rails/issues/40109 and https://github.com/rails/rails/issues/34613.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes [REPLACE ME]\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [ ] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48757/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48757/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48756", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48756/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48756/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48756/events", "html_url": "https://github.com/rails/rails/pull/48756", "id": 1809556037, "node_id": "PR_kwDNIULOVcQTng", "number": 48756, "title": "[Docs] Improve `set_load_path` documentation", "user": {"login": "iMacTia", "id": 2527520, "node_id": "MDQ6VXNlcjI1Mjc1MjA=", "avatar_url": "https://avatars.githubusercontent.com/u/2527520?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iMacTia", "html_url": "https://github.com/iMacTia", "followers_url": "https://api.github.com/users/iMacTia/followers", "following_url": "https://api.github.com/users/iMacTia/following{/other_user}", "gists_url": "https://api.github.com/users/iMacTia/gists{/gist_id}", "starred_url": "https://api.github.com/users/iMacTia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iMacTia/subscriptions", "organizations_url": "https://api.github.com/users/iMacTia/orgs", "repos_url": "https://api.github.com/users/iMacTia/repos", "events_url": "https://api.github.com/users/iMacTia/events{/privacy}", "received_events_url": "https://api.github.com/users/iMacTia/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-18T09:37:05Z", "updated_at": "2023-07-18T09:55:30Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48756", "html_url": "https://github.com/rails/rails/pull/48756", "diff_url": "https://github.com/rails/rails/pull/48756.diff", "patch_url": "https://github.com/rails/rails/pull/48756.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because I needed to add a custom folder to `$LOAD_PATH` in my Rails project and I wanted to do it using the framework tools, however when I checked the documentation, I was given incorrect information that didn't work on the current release. More specifically, the existing documentation erroneously mentions `config.load_path` which was removed in Rails 3 and now replaced by `config.paths.load_paths`.\r\n\r\n### Detail\r\n\r\nIn addition to updating the outdated reference from `config.load_path` to `config.paths.load_paths`, the new documentation explicitly lists all \"autoload paths\" for the reader which can otherwise only be known by checking the code, and mentions the `add_autoload_paths_to_load_path` config toggle.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] N/A ~Tests are added or updated if you fix a bug or add a feature.~\r\n* [ ] N/A ~CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.~\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48756/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48756/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48755", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48755/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48755/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48755/events", "html_url": "https://github.com/rails/rails/pull/48755", "id": 1808771218, "node_id": "PR_kwDNIULOVbljPQ", "number": 48755, "title": "Update tests to support changes in Rack 3.1 (head).", "user": {"login": "ioquatix", "id": 30030, "node_id": "MDQ6VXNlcjMwMDMw", "avatar_url": "https://avatars.githubusercontent.com/u/30030?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ioquatix", "html_url": "https://github.com/ioquatix", "followers_url": "https://api.github.com/users/ioquatix/followers", "following_url": "https://api.github.com/users/ioquatix/following{/other_user}", "gists_url": "https://api.github.com/users/ioquatix/gists{/gist_id}", "starred_url": "https://api.github.com/users/ioquatix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ioquatix/subscriptions", "organizations_url": "https://api.github.com/users/ioquatix/orgs", "repos_url": "https://api.github.com/users/ioquatix/repos", "events_url": "https://api.github.com/users/ioquatix/events{/privacy}", "received_events_url": "https://api.github.com/users/ioquatix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-17T23:16:40Z", "updated_at": "2023-07-19T22:08:00Z", "closed_at": "2023-07-19T18:13:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48755", "html_url": "https://github.com/rails/rails/pull/48755", "diff_url": "https://github.com/rails/rails/pull/48755.diff", "patch_url": "https://github.com/rails/rails/pull/48755.patch", "merged_at": "2023-07-19T18:13:29Z"}, "body": "A few small changes required for Rack 3.1, which removed deprecated code paths and introduced some changes that affect Rails:\r\n\r\n- Optional `rack.input` (which also implies optional `CONTENT_LENGTH`).\r\n- JavaScript's mime type was updated to reflect the latest standards.\r\n- `rack-cache` was updated for Rack 3+.\r\n- `rack/file.rb` was finally removed.\r\n\r\nI have tested this locally. We could introduce tests for `RACK=head` if that seems reasonable, but I'm sure we can release Rack 3.1 soon.\r\n\r\nRegarding the JavaScript mime type: https://stackoverflow.com/questions/21098865/text-javascript-vs-application-javascript", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48755/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48755/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48754", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48754/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48754/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48754/events", "html_url": "https://github.com/rails/rails/pull/48754", "id": 1808660227, "node_id": "PR_kwDNIULOVbfb9g", "number": 48754, "title": "Lazily deserialize cache entries", "user": {"login": "jonathanhefner", "id": 771968, "node_id": "MDQ6VXNlcjc3MTk2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/771968?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonathanhefner", "html_url": "https://github.com/jonathanhefner", "followers_url": "https://api.github.com/users/jonathanhefner/followers", "following_url": "https://api.github.com/users/jonathanhefner/following{/other_user}", "gists_url": "https://api.github.com/users/jonathanhefner/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonathanhefner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonathanhefner/subscriptions", "organizations_url": "https://api.github.com/users/jonathanhefner/orgs", "repos_url": "https://api.github.com/users/jonathanhefner/repos", "events_url": "https://api.github.com/users/jonathanhefner/events{/privacy}", "received_events_url": "https://api.github.com/users/jonathanhefner/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-17T21:30:19Z", "updated_at": "2023-07-27T20:42:30Z", "closed_at": "2023-07-27T20:42:30Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48754", "html_url": "https://github.com/rails/rails/pull/48754", "diff_url": "https://github.com/rails/rails/pull/48754.diff", "patch_url": "https://github.com/rails/rails/pull/48754.patch", "merged_at": "2023-07-27T20:42:30Z"}, "body": "This adds a cache optimization such that expired and version-mismatched cache entries can be detected without deserializing their values.  This optimization is enabled when using cache format version >= 7.1 or a custom serializer.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48754/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48754/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48753", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48753/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48753/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48753/events", "html_url": "https://github.com/rails/rails/pull/48753", "id": 1808433864, "node_id": "PR_kwDNIULOVbTs-A", "number": 48753, "title": "Fix Action Text sanitizer initialization", "user": {"login": "flavorjones", "id": 8207, "node_id": "MDQ6VXNlcjgyMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/8207?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flavorjones", "html_url": "https://github.com/flavorjones", "followers_url": "https://api.github.com/users/flavorjones/followers", "following_url": "https://api.github.com/users/flavorjones/following{/other_user}", "gists_url": "https://api.github.com/users/flavorjones/gists{/gist_id}", "starred_url": "https://api.github.com/users/flavorjones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flavorjones/subscriptions", "organizations_url": "https://api.github.com/users/flavorjones/orgs", "repos_url": "https://api.github.com/users/flavorjones/repos", "events_url": "https://api.github.com/users/flavorjones/events{/privacy}", "received_events_url": "https://api.github.com/users/flavorjones/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1180817762, "node_id": "MDU6TGFiZWwxMTgwODE3NzYy", "url": "https://api.github.com/repos/rails/rails/labels/actiontext", "name": "actiontext", "color": "3bc667", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-17T19:12:54Z", "updated_at": "2023-08-03T12:40:01Z", "closed_at": "2023-07-17T19:27:52Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48753", "html_url": "https://github.com/rails/rails/pull/48753", "diff_url": "https://github.com/rails/rails/pull/48753.diff", "patch_url": "https://github.com/rails/rails/pull/48753.patch", "merged_at": "2023-07-17T19:27:52Z"}, "body": "\r\n### Motivation / Background\r\n\r\nUsing `initializer` in the engine _may_ run the block before application initializers. Instead, use `config.after_initialize` to ensure that application initializers take effect properly.\r\n\r\nAlso, don't bother deleting the config value, since that pattern isn't needed here (as it is in other railties like action_view/railtie.rb).\r\n\r\nSee similar fix for Action View in #48747.\r\n\r\n### Detail\r\n\r\nReplace `initializer` with `config.after_initialize`.\r\n\r\n### Additional information\r\n\r\nI'm not sure how to test this behavior properly other than to set up an application and run the code. I would love to learn how to better test initializer order.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48753/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48753/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48752", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48752/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48752/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48752/events", "html_url": "https://github.com/rails/rails/pull/48752", "id": 1808421155, "node_id": "PR_kwDNIULOVbS-mA", "number": 48752, "title": "Use different bucket name in AS Guide for clarity", "user": {"login": "wildmaples", "id": 25471753, "node_id": "MDQ6VXNlcjI1NDcxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/25471753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wildmaples", "html_url": "https://github.com/wildmaples", "followers_url": "https://api.github.com/users/wildmaples/followers", "following_url": "https://api.github.com/users/wildmaples/following{/other_user}", "gists_url": "https://api.github.com/users/wildmaples/gists{/gist_id}", "starred_url": "https://api.github.com/users/wildmaples/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wildmaples/subscriptions", "organizations_url": "https://api.github.com/users/wildmaples/orgs", "repos_url": "https://api.github.com/users/wildmaples/repos", "events_url": "https://api.github.com/users/wildmaples/events{/privacy}", "received_events_url": "https://api.github.com/users/wildmaples/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-17T19:07:10Z", "updated_at": "2023-07-20T16:06:43Z", "closed_at": "2023-07-20T16:06:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48752", "html_url": "https://github.com/rails/rails/pull/48752", "diff_url": "https://github.com/rails/rails/pull/48752.diff", "patch_url": "https://github.com/rails/rails/pull/48752.patch", "merged_at": "2023-07-20T16:06:42Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created to change the code example in the Active Storage guide. Initially it made me confused and I believe this subtle change would improve clarity. \r\n\r\n### Detail\r\n\r\nCurrently the service specified here is `:s3` and it could be confused for the `Service::S3Service`. The modified code example shows more clarity to the reader that the service in this case here refers to the bucket name outlined in `storage.yml` rather than the adapter service.\r\n\r\n\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48752/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48752/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48751", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48751/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48751/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48751/events", "html_url": "https://github.com/rails/rails/pull/48751", "id": 1808305374, "node_id": "PR_kwDNIULOVbMiSA", "number": 48751, "title": "Fix serialization of non-ASCII-only bare strings", "user": {"login": "jonathanhefner", "id": 771968, "node_id": "MDQ6VXNlcjc3MTk2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/771968?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonathanhefner", "html_url": "https://github.com/jonathanhefner", "followers_url": "https://api.github.com/users/jonathanhefner/followers", "following_url": "https://api.github.com/users/jonathanhefner/following{/other_user}", "gists_url": "https://api.github.com/users/jonathanhefner/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonathanhefner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonathanhefner/subscriptions", "organizations_url": "https://api.github.com/users/jonathanhefner/orgs", "repos_url": "https://api.github.com/users/jonathanhefner/repos", "events_url": "https://api.github.com/users/jonathanhefner/events{/privacy}", "received_events_url": "https://api.github.com/users/jonathanhefner/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-17T18:05:23Z", "updated_at": "2023-07-18T16:33:29Z", "closed_at": "2023-07-17T18:18:05Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48751", "html_url": "https://github.com/rails/rails/pull/48751", "diff_url": "https://github.com/rails/rails/pull/48751.diff", "patch_url": "https://github.com/rails/rails/pull/48751.patch", "merged_at": "2023-07-17T18:18:05Z"}, "body": "To use a binary-encoded string as a byte buffer, appended strings should be force-encoded as binary.  Otherwise, appending a non-ASCII-only string will raise `Encoding::CompatibilityError`.\r\n\r\nFixes #48748.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48751/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48751/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48750", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48750/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48750/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48750/events", "html_url": "https://github.com/rails/rails/pull/48750", "id": 1808257828, "node_id": "PR_kwDNIULOVbJ4MQ", "number": 48750, "title": "Removes non-essential rubocop:disable", "user": {"login": "RobertChang0722", "id": 74767965, "node_id": "MDQ6VXNlcjc0NzY3OTY1", "avatar_url": "https://avatars.githubusercontent.com/u/74767965?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RobertChang0722", "html_url": "https://github.com/RobertChang0722", "followers_url": "https://api.github.com/users/RobertChang0722/followers", "following_url": "https://api.github.com/users/RobertChang0722/following{/other_user}", "gists_url": "https://api.github.com/users/RobertChang0722/gists{/gist_id}", "starred_url": "https://api.github.com/users/RobertChang0722/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RobertChang0722/subscriptions", "organizations_url": "https://api.github.com/users/RobertChang0722/orgs", "repos_url": "https://api.github.com/users/RobertChang0722/repos", "events_url": "https://api.github.com/users/RobertChang0722/events{/privacy}", "received_events_url": "https://api.github.com/users/RobertChang0722/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-17T17:39:54Z", "updated_at": "2023-07-18T01:48:40Z", "closed_at": "2023-07-17T17:54:37Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48750", "html_url": "https://github.com/rails/rails/pull/48750", "diff_url": "https://github.com/rails/rails/pull/48750.diff", "patch_url": "https://github.com/rails/rails/pull/48750.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nI actually found an unnecessary `rubocop:disable` when I was practicing reading Railites files.\r\n\r\nI know that maybe this PR will not be accepted, but I carefully checked the whole Codebase and found that these three `rubocop:disable` are unnecessary.\r\n\r\nFor me, after installing Rubocop, I should follow the rules as much as possible, and avoid using disables to break the rules.\r\n\r\nThat's the motivation for this PR.\r\n\r\n### Detail\r\n\r\nRemove the `rubocop:disable` and make sure the test is all passed\r\n\r\n### Additional information\r\n\r\nNo.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48750/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48750/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48749", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48749/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48749/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48749/events", "html_url": "https://github.com/rails/rails/pull/48749", "id": 1808185437, "node_id": "PR_kwDNIULOVbF4bw", "number": 48749, "title": "update cache when has_one:through", "user": {"login": "wyattades", "id": 992076, "node_id": "MDQ6VXNlcjk5MjA3Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/992076?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wyattades", "html_url": "https://github.com/wyattades", "followers_url": "https://api.github.com/users/wyattades/followers", "following_url": "https://api.github.com/users/wyattades/following{/other_user}", "gists_url": "https://api.github.com/users/wyattades/gists{/gist_id}", "starred_url": "https://api.github.com/users/wyattades/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wyattades/subscriptions", "organizations_url": "https://api.github.com/users/wyattades/orgs", "repos_url": "https://api.github.com/users/wyattades/repos", "events_url": "https://api.github.com/users/wyattades/events{/privacy}", "received_events_url": "https://api.github.com/users/wyattades/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-17T16:59:03Z", "updated_at": "2023-08-07T22:41:43Z", "closed_at": "2023-08-07T22:41:38Z", "author_association": "NONE", "active_lock_reason": null, "draft": true, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48749", "html_url": "https://github.com/rails/rails/pull/48749", "diff_url": "https://github.com/rails/rails/pull/48749.diff", "patch_url": "https://github.com/rails/rails/pull/48749.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because [REPLACE ME]\r\n\r\n### Detail\r\n\r\nThis Pull Request changes [REPLACE ME]\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [ ] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48749/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48749/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48748", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48748/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48748/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48748/events", "html_url": "https://github.com/rails/rails/issues/48748", "id": 1808053524, "node_id": "I_kwDNIULOa8S1FA", "number": 48748, "title": "Rails cache storage not working propertly", "user": {"login": "benone", "id": 111381, "node_id": "MDQ6VXNlcjExMTM4MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/111381?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benone", "html_url": "https://github.com/benone", "followers_url": "https://api.github.com/users/benone/followers", "following_url": "https://api.github.com/users/benone/following{/other_user}", "gists_url": "https://api.github.com/users/benone/gists{/gist_id}", "starred_url": "https://api.github.com/users/benone/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benone/subscriptions", "organizations_url": "https://api.github.com/users/benone/orgs", "repos_url": "https://api.github.com/users/benone/repos", "events_url": "https://api.github.com/users/benone/events{/privacy}", "received_events_url": "https://api.github.com/users/benone/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "jonathanhefner", "id": 771968, "node_id": "MDQ6VXNlcjc3MTk2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/771968?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonathanhefner", "html_url": "https://github.com/jonathanhefner", "followers_url": "https://api.github.com/users/jonathanhefner/followers", "following_url": "https://api.github.com/users/jonathanhefner/following{/other_user}", "gists_url": "https://api.github.com/users/jonathanhefner/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonathanhefner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonathanhefner/subscriptions", "organizations_url": "https://api.github.com/users/jonathanhefner/orgs", "repos_url": "https://api.github.com/users/jonathanhefner/repos", "events_url": "https://api.github.com/users/jonathanhefner/events{/privacy}", "received_events_url": "https://api.github.com/users/jonathanhefner/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jonathanhefner", "id": 771968, "node_id": "MDQ6VXNlcjc3MTk2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/771968?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonathanhefner", "html_url": "https://github.com/jonathanhefner", "followers_url": "https://api.github.com/users/jonathanhefner/followers", "following_url": "https://api.github.com/users/jonathanhefner/following{/other_user}", "gists_url": "https://api.github.com/users/jonathanhefner/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonathanhefner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonathanhefner/subscriptions", "organizations_url": "https://api.github.com/users/jonathanhefner/orgs", "repos_url": "https://api.github.com/users/jonathanhefner/repos", "events_url": "https://api.github.com/users/jonathanhefner/events{/privacy}", "received_events_url": "https://api.github.com/users/jonathanhefner/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2023-07-17T15:38:32Z", "updated_at": "2023-07-17T18:18:13Z", "closed_at": "2023-07-17T18:18:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\n\r\n1. Init new app\r\n``` bash\r\nrails new rails-test --main\r\ncd rails-test\r\nbundle add dalli\r\ntouch tmp/caching-dev.txt\r\n```\r\n\r\n2. Set cache store in development.rb\r\n\r\n```ruby\r\nconfig.cache_store = :mem_cache_store\r\n```\r\n\r\n3. Run console\r\n``` bash\r\nrails c\r\n```\r\n\r\n4. Try to write cache\r\n```ruby\r\nirb(main):001:0> Rails.cache.clear\r\nDalli::Server#connect 127.0.0.1:11211\r\n=> [true]\r\nirb(main):002:0> Rails.cache.write(\"test\", \"M\u00e1s\")\r\n/Users/benone/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/bundler/gems/rails-e18791c0bf2e/activesupport/lib/active_support/cache/serializer_with_fallback.rb:80:in `try_dump_bare_string': incompatible character encodings: ASCII-8BIT and UTF-8 (Encoding::CompatibilityError)\r\n```\r\n\r\n### Expected behavior\r\nWritten cache.\r\n\r\n### Actual behavior\r\nEncoding::CompatibilityError Exception \r\n\r\n### System configuration\r\n**Rails version**:\r\nrails main (e18791c0bf2e)\r\n\r\n**Ruby version**:\r\nruby 3.2.2 (2023-03-30 revision e51014f9c0) +YJIT [arm64-darwin22]\r\n\r\n\r\n\r\n### Related issue:\r\nhttps://github.com/rails/rails/issues/48196", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48748/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48748/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48747", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48747/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48747/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48747/events", "html_url": "https://github.com/rails/rails/pull/48747", "id": 1808034761, "node_id": "PR_kwDNIULOVa9peA", "number": 48747, "title": "Fix Action View sanitizer initialization", "user": {"login": "flavorjones", "id": 8207, "node_id": "MDQ6VXNlcjgyMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/8207?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flavorjones", "html_url": "https://github.com/flavorjones", "followers_url": "https://api.github.com/users/flavorjones/followers", "following_url": "https://api.github.com/users/flavorjones/following{/other_user}", "gists_url": "https://api.github.com/users/flavorjones/gists{/gist_id}", "starred_url": "https://api.github.com/users/flavorjones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flavorjones/subscriptions", "organizations_url": "https://api.github.com/users/flavorjones/orgs", "repos_url": "https://api.github.com/users/flavorjones/repos", "events_url": "https://api.github.com/users/flavorjones/events{/privacy}", "received_events_url": "https://api.github.com/users/flavorjones/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-17T15:27:38Z", "updated_at": "2023-07-17T18:46:14Z", "closed_at": "2023-07-17T16:32:09Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48747", "html_url": "https://github.com/rails/rails/pull/48747", "diff_url": "https://github.com/rails/rails/pull/48747.diff", "patch_url": "https://github.com/rails/rails/pull/48747.patch", "merged_at": "2023-07-17T16:32:09Z"}, "body": "\r\n<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\nIn #48293, an Action View railtie `initializer` block was introduced to set the Action View sanitizer vendor. Unfortunately, using `initializer` resulted in the block being run _before_ application initializers, and so any application config would not take effect.\r\n\r\nThis PR changes that block to use `config.after_initialize` to ensure that application initializers take effect properly.\r\n\r\nh/t to @georgeclaghorn for pointing out this issue in https://github.com/rails/rails/commit/ce43ac6088ccda0799636a2488625c8230ed3f49#r121660254, and to @skipkayhil for helping me understand the issue.\r\n\r\n### Detail\r\n\r\nReplace `initializer` with `config.after_initialize`.\r\n\r\n### Additional information\r\n\r\nI'm not sure how to test this behavior properly other than to set up an application and run the code. I would love to learn how to better test this case.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48747/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 1, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48747/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48746", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48746/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48746/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48746/events", "html_url": "https://github.com/rails/rails/pull/48746", "id": 1808020811, "node_id": "PR_kwDNIULOVa84nw", "number": 48746, "title": "Fix ActionText::ContentHelper allowed tags and attrs", "user": {"login": "flavorjones", "id": 8207, "node_id": "MDQ6VXNlcjgyMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/8207?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flavorjones", "html_url": "https://github.com/flavorjones", "followers_url": "https://api.github.com/users/flavorjones/followers", "following_url": "https://api.github.com/users/flavorjones/following{/other_user}", "gists_url": "https://api.github.com/users/flavorjones/gists{/gist_id}", "starred_url": "https://api.github.com/users/flavorjones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flavorjones/subscriptions", "organizations_url": "https://api.github.com/users/flavorjones/orgs", "repos_url": "https://api.github.com/users/flavorjones/repos", "events_url": "https://api.github.com/users/flavorjones/events{/privacy}", "received_events_url": "https://api.github.com/users/flavorjones/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1180817762, "node_id": "MDU6TGFiZWwxMTgwODE3NzYy", "url": "https://api.github.com/repos/rails/rails/labels/actiontext", "name": "actiontext", "color": "3bc667", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-17T15:19:35Z", "updated_at": "2023-07-17T18:46:31Z", "closed_at": "2023-07-17T16:31:41Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48746", "html_url": "https://github.com/rails/rails/pull/48746", "diff_url": "https://github.com/rails/rails/pull/48746.diff", "patch_url": "https://github.com/rails/rails/pull/48746.patch", "merged_at": "2023-07-17T16:31:41Z"}, "body": "\r\n### Motivation / Background\r\n\r\nActionText::ContentHelper \"allowed tags\" and \"allowed attributes\" are being set to the HTML4 defaults before the sanitizer configuration could be applied as a result of the change in #48644.\r\n\r\nAlso, backfill some light tests for sanitization.\r\n\r\nh/t to @georgeclaghorn for pointing this issue out in https://github.com/rails/rails/commit/44d3b44d9d7f42658bda1037f6c7713d02d4b1c0#r121659686\r\n\r\n\r\n### Detail\r\n\r\nThis change implements resolution of allowed tags and attributes at runtime (as opposed to initialization-time), via new methods `sanitizer_allowed_tags` and `sanitizer_allowed_attributes`, so that when a `sanitizer` is set, that sanitizer's defaults take effect (unless the developer has explicitly set `allowed_tags` or `allowed_attributes`).\r\n\r\nA side effect of this change is that, unless explicitly set, `allowed_tags` and `allowed_attributes` readers will return `nil` (where they previously returned the allowed tags and attributes).\r\n\r\n\r\n### Additional information\r\n\r\nAn alternative solution is to implement custom readers for `allowed_tags` and `allowed_attributes` rather than implement `sanitizer_allowed_tags` and `_attributes`.\r\n\r\nHowever, this solution feels unwieldy to me since it requires implementing both class and instance readers (essentially everything that `mattr_reader` implements), and so my personal preference was for this simpler approach.\r\n\r\nBut if the maintainers would prefer to implement mattr readers, I'll do that.\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48746/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48746/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48745", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48745/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48745/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48745/events", "html_url": "https://github.com/rails/rails/pull/48745", "id": 1808009190, "node_id": "PR_kwDNIULOVa8Pzg", "number": 48745, "title": "Implemented ActiveRecord::Base.pretty_print to work with PP.", "user": {"login": "osyo-manga", "id": 214488, "node_id": "MDQ6VXNlcjIxNDQ4OA==", "avatar_url": "https://avatars.githubusercontent.com/u/214488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/osyo-manga", "html_url": "https://github.com/osyo-manga", "followers_url": "https://api.github.com/users/osyo-manga/followers", "following_url": "https://api.github.com/users/osyo-manga/following{/other_user}", "gists_url": "https://api.github.com/users/osyo-manga/gists{/gist_id}", "starred_url": "https://api.github.com/users/osyo-manga/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/osyo-manga/subscriptions", "organizations_url": "https://api.github.com/users/osyo-manga/orgs", "repos_url": "https://api.github.com/users/osyo-manga/repos", "events_url": "https://api.github.com/users/osyo-manga/events{/privacy}", "received_events_url": "https://api.github.com/users/osyo-manga/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-17T15:13:20Z", "updated_at": "2023-07-19T18:35:21Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48745", "html_url": "https://github.com/rails/rails/pull/48745", "diff_url": "https://github.com/rails/rails/pull/48745.diff", "patch_url": "https://github.com/rails/rails/pull/48745.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nWhen checking what columns are defined in an arbitrary model, you may use `console` or other tools to output the model class.\r\nHowever, when a model has many columns, it can be difficult to read when displayed on a single line.\r\n\r\n```ruby\r\np User\r\n# => User(id: integer, first_name: string, last_name: string, birth_at: datetime, email: string, address: string, active: boolean, parent_id: integer, type: string, created_at: datetime, updated_at: datetime)\r\n```\r\n\r\nNOTE: [implement ActiveRecord::Base#pretty_print by notEthan \u00b7 Pull Request #15172 \u00b7 rails/rails](https://github.com/rails/rails/pull/15172)\r\n\r\n### Detail\r\n\r\nDefine `ActiveRecord::Base.pretty_print` to support `pp` output.\r\n\r\n```ruby\r\npp User\r\n# => User(\r\n#     id: integer,\r\n#     first_name: string,\r\n#     last_name: string,\r\n#     birth_at: datetime,\r\n#     email: string,\r\n#     address: string,\r\n#     active: boolean,\r\n#     parent_id: integer,\r\n#     type: string,\r\n#     created_at: datetime,\r\n#     updated_at: datetime)\r\n```\r\n\r\nThe format and implementation are based on [`ActiveRecord::Base#pretty_print`](https://github.com/rails/rails/blob/e18791c0bf2e03d3e6380f69b44e946564c6f873/activerecord/lib/active_record/core.rb#L682-L705) and [`ActiveRecord::Base.inspect`](https://github.com/rails/rails/blob/e18791c0bf2e03d3e6380f69b44e946564c6f873/activerecord/lib/active_record/core.rb#L332-L346).\r\n\r\nNote: Output of `ActiveRecord::Base#pretty_print` is as follows.\r\n\r\n```ruby\r\npp User.new\r\n# => #<User:0x00007f0431d6dc88\r\n#     id: nil,\r\n#     first_name: nil,\r\n#     last_name: nil,\r\n#     birth_at: nil,\r\n#     email: nil,\r\n#     address: nil,\r\n#     active: nil,\r\n#     parent_id: nil,\r\n#     type: nil,\r\n#     created_at: nil,\r\n#     updated_at: nil>\r\n```\r\n\r\n\r\n### Additional information\r\n\r\nI also found the following problem when implementing `ActiveRecord::Base#pretty_print` and have addressed it.\r\n* [pretty_print will use #inspect if a subclass redefines it by notEthan \u00b7 Pull Request #18474 \u00b7 rails/rails](https://github.com/rails/rails/pull/18474)\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48745/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48745/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48744", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48744/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48744/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48744/events", "html_url": "https://github.com/rails/rails/issues/48744", "id": 1808006365, "node_id": "I_kwDNIULOa8P83Q", "number": 48744, "title": "Unable to use named variants for blob preview", "user": {"login": "matiassalles99", "id": 57004457, "node_id": "MDQ6VXNlcjU3MDA0NDU3", "avatar_url": "https://avatars.githubusercontent.com/u/57004457?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matiassalles99", "html_url": "https://github.com/matiassalles99", "followers_url": "https://api.github.com/users/matiassalles99/followers", "following_url": "https://api.github.com/users/matiassalles99/following{/other_user}", "gists_url": "https://api.github.com/users/matiassalles99/gists{/gist_id}", "starred_url": "https://api.github.com/users/matiassalles99/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matiassalles99/subscriptions", "organizations_url": "https://api.github.com/users/matiassalles99/orgs", "repos_url": "https://api.github.com/users/matiassalles99/repos", "events_url": "https://api.github.com/users/matiassalles99/events{/privacy}", "received_events_url": "https://api.github.com/users/matiassalles99/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-17T15:11:51Z", "updated_at": "2023-07-18T01:55:11Z", "closed_at": "2023-07-18T01:54:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\n1. Create a record with named variants\r\n\r\n<img width=\"570\" alt=\"Screenshot 2023-07-17 at 12 05 47\" src=\"https://github.com/rails/rails/assets/57004457/50ab402e-1cdc-433b-b8ee-2ea33e69c63e\">\r\n\r\n2. Upload a previewable file to the record\r\n\r\n3. Try to show the blob preview using named variants\r\n\r\n<img width=\"263\" alt=\"Screenshot 2023-07-17 at 12 06 23\" src=\"https://github.com/rails/rails/assets/57004457/731c4234-2014-4950-9325-06be359aeb20\">\r\n\r\n### Expected behavior\r\nShould decode the transformations based on the symbol passed to preview\r\n\r\n### Actual behavior\r\nGives undefined method deep_symbolize_keys when running into this line\r\n\r\n<img width=\"665\" alt=\"Screenshot 2023-07-17 at 12 08 37\" src=\"https://github.com/rails/rails/assets/57004457/6832d8ee-58fe-40a6-b1e1-89f30db4b841\">\r\n\r\nOpen to help coding in order to resolve this issue, from what I saw we don't have a clear way to the attachment variants.\r\nI was thinking of grabbing the attachments from the has_many relationship in the blob and, if all of them belong to the same model type (eg: User) then grab the variants from there, if not, raise an error.\r\n\r\n### System configuration\r\n**Rails version**: 7.0.4\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48744/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48744/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48743", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48743/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48743/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48743/events", "html_url": "https://github.com/rails/rails/pull/48743", "id": 1807536420, "node_id": "PR_kwDNIULOVaiQzA", "number": 48743, "title": "Cleanup `define_attribute_methods` initializer", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-17T11:15:07Z", "updated_at": "2023-07-24T12:49:46Z", "closed_at": "2023-07-18T08:21:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48743", "html_url": "https://github.com/rails/rails/pull/48743", "diff_url": "https://github.com/rails/rails/pull/48743.diff", "patch_url": "https://github.com/rails/rails/pull/48743.patch", "merged_at": "2023-07-18T08:21:51Z"}, "body": "Followup: https://github.com/rails/rails/pull/48716\r\n\r\n`model.connection_pool.schema_reflection` is never falsy, so that `if` was pointless.\r\n\r\nInstead we more properly check if the schema cache contains that table.\r\n\r\nI also added some more comments to explain why the initializer tries so hard not to touch the database.\r\n\r\n@matthewd ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48743/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48743/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48742", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48742/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48742/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48742/events", "html_url": "https://github.com/rails/rails/pull/48742", "id": 1806254205, "node_id": "PR_kwDNIULOVZe8mg", "number": 48742, "title": "`ActionDispatch::Request` responds to `turbo_frame?`", "user": {"login": "rockwellll", "id": 38360603, "node_id": "MDQ6VXNlcjM4MzYwNjAz", "avatar_url": "https://avatars.githubusercontent.com/u/38360603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rockwellll", "html_url": "https://github.com/rockwellll", "followers_url": "https://api.github.com/users/rockwellll/followers", "following_url": "https://api.github.com/users/rockwellll/following{/other_user}", "gists_url": "https://api.github.com/users/rockwellll/gists{/gist_id}", "starred_url": "https://api.github.com/users/rockwellll/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rockwellll/subscriptions", "organizations_url": "https://api.github.com/users/rockwellll/orgs", "repos_url": "https://api.github.com/users/rockwellll/repos", "events_url": "https://api.github.com/users/rockwellll/events{/privacy}", "received_events_url": "https://api.github.com/users/rockwellll/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-15T17:49:59Z", "updated_at": "2023-07-15T20:06:11Z", "closed_at": "2023-07-15T20:06:11Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48742", "html_url": "https://github.com/rails/rails/pull/48742", "diff_url": "https://github.com/rails/rails/pull/48742.diff", "patch_url": "https://github.com/rails/rails/pull/48742.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\nWith the release of HOTWire and the introduction of Turbo-Frames, sometimes, controllers to check the type of the request and differenciate between a Turbo-Stream or Turbo-Frame response, for example. You might have an initial content load via Turbo-Frame, and subsequent Turbo-Stream requests to update parts of the page. At our company, we needed a way to check in such scenario, and we had to do `request.headers[\"turbo-frame\"].present?`, and at first, we thought this was baked into Rails, imagine our surprise. \r\n\r\nWe have currently extended `ActionDispatch::Controller` to add support for it in our codebase.\r\n \r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because applications using HOTWire (sometimes) need to check whether the the incoming request is a Turbo-Frame or a Turbo-Stream request, or accepts both. Such that, it can serve correct content based on the content type. \r\n\r\n### Detail\r\n\r\nThis Pull Request adds an extra method named `turbo_frame?` on `ActionDispatch::Request` object. This would allow developers to determine if a request originated inside a Turbo-Frame, more the Rails way. Instead of doing something like\r\n\r\n```ruby\r\ndef action \r\n if request.headers[\"turbo-frame\"].present?\r\n    # do something\r\n else\r\n    # do something else\r\n end \r\nend\r\n```\r\n\r\ninto something that feels Rails-y \r\n\r\n```ruby\r\ndef action \r\n if request.turbo_frame?\r\n    # do something\r\n else\r\n    # do something else\r\n end \r\nend\r\n```\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48742/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48742/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48741", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48741/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48741/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48741/events", "html_url": "https://github.com/rails/rails/pull/48741", "id": 1806167793, "node_id": "PR_kwDNIULOVZagWA", "number": 48741, "title": "Adjust link text and add info to AV Helpers API docs", "user": {"login": "mikepmunroe", "id": 514063, "node_id": "MDQ6VXNlcjUxNDA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/514063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikepmunroe", "html_url": "https://github.com/mikepmunroe", "followers_url": "https://api.github.com/users/mikepmunroe/followers", "following_url": "https://api.github.com/users/mikepmunroe/following{/other_user}", "gists_url": "https://api.github.com/users/mikepmunroe/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikepmunroe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikepmunroe/subscriptions", "organizations_url": "https://api.github.com/users/mikepmunroe/orgs", "repos_url": "https://api.github.com/users/mikepmunroe/repos", "events_url": "https://api.github.com/users/mikepmunroe/events{/privacy}", "received_events_url": "https://api.github.com/users/mikepmunroe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}, {"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-15T15:21:20Z", "updated_at": "2023-07-17T19:14:17Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48741", "html_url": "https://github.com/rails/rails/pull/48741", "diff_url": "https://github.com/rails/rails/pull/48741.diff", "patch_url": "https://github.com/rails/rails/pull/48741.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThis Pull Request is a follow up to #48273 \r\nFeedback in that PR requested an adjustment to the link text in the Guide and to add some information to Action View Helpers API docs. \r\n\r\n### Detail\r\n\r\nThis Pull Request changes link text in a guide file and adds info to Action View Helpers API docs landing page. \r\n\r\n### Additional information\r\n\r\n/cc @zzak since this PR started with me, bounced off him after a tweak, and continues with me for some extra based on feedback. \r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48741/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48741/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48740", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48740/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48740/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48740/events", "html_url": "https://github.com/rails/rails/pull/48740", "id": 1805963898, "node_id": "PR_kwDNIULOVZP1tQ", "number": 48740, "title": "Discard connection in ensure, not rescue", "user": {"login": "nicholasdower", "id": 9117775, "node_id": "MDQ6VXNlcjkxMTc3NzU=", "avatar_url": "https://avatars.githubusercontent.com/u/9117775?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nicholasdower", "html_url": "https://github.com/nicholasdower", "followers_url": "https://api.github.com/users/nicholasdower/followers", "following_url": "https://api.github.com/users/nicholasdower/following{/other_user}", "gists_url": "https://api.github.com/users/nicholasdower/gists{/gist_id}", "starred_url": "https://api.github.com/users/nicholasdower/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nicholasdower/subscriptions", "organizations_url": "https://api.github.com/users/nicholasdower/orgs", "repos_url": "https://api.github.com/users/nicholasdower/repos", "events_url": "https://api.github.com/users/nicholasdower/events{/privacy}", "received_events_url": "https://api.github.com/users/nicholasdower/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-15T08:08:55Z", "updated_at": "2023-08-01T23:06:06Z", "closed_at": "2023-08-01T23:06:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48740", "html_url": "https://github.com/rails/rails/pull/48740", "diff_url": "https://github.com/rails/rails/pull/48740.diff", "patch_url": "https://github.com/rails/rails/pull/48740.patch", "merged_at": "2023-08-01T23:06:05Z"}, "body": "### Motivation / Background\r\n\r\nPartially Fixes #48164. Followup to #48200.\r\n\r\n### Detail\r\n\r\n`within_new_transaction` currently discards connections if an error is raised which may have left the connection in a transaction. This change updates that logic to discard connections in an `ensure` block to handle cases where an error is not raised, for instance if the thread is killed.\r\n\r\n### Additional information\r\n\r\nReplaces #48224.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48740/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48740/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48739", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48739/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48739/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48739/events", "html_url": "https://github.com/rails/rails/pull/48739", "id": 1805594561, "node_id": "PR_kwDNIULOVY8I7A", "number": 48739, "title": "Add test for nested content_tags with data attributes outside of erb", "user": {"login": "stefannibrasil", "id": 10670581, "node_id": "MDQ6VXNlcjEwNjcwNTgx", "avatar_url": "https://avatars.githubusercontent.com/u/10670581?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stefannibrasil", "html_url": "https://github.com/stefannibrasil", "followers_url": "https://api.github.com/users/stefannibrasil/followers", "following_url": "https://api.github.com/users/stefannibrasil/following{/other_user}", "gists_url": "https://api.github.com/users/stefannibrasil/gists{/gist_id}", "starred_url": "https://api.github.com/users/stefannibrasil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stefannibrasil/subscriptions", "organizations_url": "https://api.github.com/users/stefannibrasil/orgs", "repos_url": "https://api.github.com/users/stefannibrasil/repos", "events_url": "https://api.github.com/users/stefannibrasil/events{/privacy}", "received_events_url": "https://api.github.com/users/stefannibrasil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-14T21:17:22Z", "updated_at": "2023-07-14T22:44:40Z", "closed_at": "2023-07-14T22:20:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48739", "html_url": "https://github.com/rails/rails/pull/48739", "diff_url": "https://github.com/rails/rails/pull/48739.diff", "patch_url": "https://github.com/rails/rails/pull/48739.patch", "merged_at": "2023-07-14T22:20:43Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because the existing `actionview` `content_tag` tests document how to use `content_tag` outside of erb views with data attributes. But for those who need to use nested `content_tag` and data attributes outside of erb views, it can be time consuming to find out how to do that.\r\n\r\nWhen I had to do this in a project, it took me longer than I wanted. Hopefully adding this test with an explicit example of how to achieve that will others some time. As more and more people get up to speed with Stimulus, I believe this addition is helpful for the community.\r\n\r\n### Detail\r\n\r\nThis Pull Request adds a new test for using nested `content_tag` with data-attributes outside of erb views.\r\n\r\n### Additional information\r\n\r\nI'm open to feedback on how to make the tests more readable.\r\n\r\nThank you @mike-burns for pairing with me when I was working on this!\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48739/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48739/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48738", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48738/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48738/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48738/events", "html_url": "https://github.com/rails/rails/pull/48738", "id": 1805439207, "node_id": "PR_kwDNIULOVYzXRA", "number": 48738, "title": "Restores functionality to the missing method when using enums and fixes #48651", "user": {"login": "paulreece", "id": 96156234, "node_id": "U_kgDOBbs6Sg", "avatar_url": "https://avatars.githubusercontent.com/u/96156234?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paulreece", "html_url": "https://github.com/paulreece", "followers_url": "https://api.github.com/users/paulreece/followers", "following_url": "https://api.github.com/users/paulreece/following{/other_user}", "gists_url": "https://api.github.com/users/paulreece/gists{/gist_id}", "starred_url": "https://api.github.com/users/paulreece/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paulreece/subscriptions", "organizations_url": "https://api.github.com/users/paulreece/orgs", "repos_url": "https://api.github.com/users/paulreece/repos", "events_url": "https://api.github.com/users/paulreece/events{/privacy}", "received_events_url": "https://api.github.com/users/paulreece/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2023-07-14T19:34:45Z", "updated_at": "2023-08-01T03:03:48Z", "closed_at": "2023-07-27T18:18:54Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48738", "html_url": "https://github.com/rails/rails/pull/48738", "diff_url": "https://github.com/rails/rails/pull/48738.diff", "patch_url": "https://github.com/rails/rails/pull/48738.patch", "merged_at": "2023-07-27T18:18:54Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because of the bug raised in issue [48651](https://github.com/rails/rails/issues/48651). \r\n\r\nSay you have the following models in Rails 7.0.6, and have used an enum in one and aliases in the other.\r\n\r\n```Ruby\r\nclass Publisher < ApplicationRecord\r\n  belongs_to :listing\r\n\r\n  enum name: {\r\n    foo: 0,\r\n    bar: 1\r\n  }\r\nend\r\n\r\nclass Listing < ApplicationRecord\r\n  has_many :publishers, dependent: :destroy\r\n  has_one :foo_listing, -> { foo }, class_name: Publisher.name\r\n  has_one :bar_listing, -> { bar }, class_name: Publisher.name\r\nend\r\n```\r\n\r\nIf you have an instance of Listing that has a foo publisher but not a bar publisher and call:\r\n\r\n ```Ruby \r\nListing.joins(:foo_listing).where.missing(:bar_listing)\r\n```\r\n\r\nIt returns nothing whereas one would expect it to return the Listing you created that only has a `:foo_listing`\r\n\r\nPlease see bug fix if more detail is needed linked above. \r\n\r\n### Detail\r\n\r\nThis Pull Request changes the missing method in `active_record/relation/query_methods.rb`\r\n\r\nAdds another conditional check in the missing query method  in ActiveRecord. This extra check makes sure that the values in `:joins` are different than the values in `:left_outer_joins`.  When they are it is likely that you are using an enum.  I do this checking first for the existence of values in `:joins` and `:left_outer_joins`.  Then I compare the size of the intersection of the two Arrays to the size of the `:joins` Array. If they are different then it implements the scope method excluding the desired enum alias.  The `size` method was used to keep this performant.  This passes all checks in ActiveRecord, including those from [47940](https://github.com/rails/rails/issues/47909) and [45015](https://github.com/rails/rails/pull/45015).\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\n* [ X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ X] Tests are added or updated if you fix a bug or add a feature.\r\n* [ X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48738/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48738/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48737", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48737/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48737/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48737/events", "html_url": "https://github.com/rails/rails/pull/48737", "id": 1804973956, "node_id": "PR_kwDNIULOVYZnIw", "number": 48737, "title": "Remove RDoc auto-link from Template text", "user": {"login": "mikepmunroe", "id": 514063, "node_id": "MDQ6VXNlcjUxNDA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/514063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikepmunroe", "html_url": "https://github.com/mikepmunroe", "followers_url": "https://api.github.com/users/mikepmunroe/followers", "following_url": "https://api.github.com/users/mikepmunroe/following{/other_user}", "gists_url": "https://api.github.com/users/mikepmunroe/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikepmunroe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikepmunroe/subscriptions", "organizations_url": "https://api.github.com/users/mikepmunroe/orgs", "repos_url": "https://api.github.com/users/mikepmunroe/repos", "events_url": "https://api.github.com/users/mikepmunroe/events{/privacy}", "received_events_url": "https://api.github.com/users/mikepmunroe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-14T14:24:09Z", "updated_at": "2023-07-15T08:25:52Z", "closed_at": "2023-07-15T08:25:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48737", "html_url": "https://github.com/rails/rails/pull/48737", "diff_url": "https://github.com/rails/rails/pull/48737.diff", "patch_url": "https://github.com/rails/rails/pull/48737.patch", "merged_at": "2023-07-15T08:25:11Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because RDoc auto-links the word `Template` in the documentation for Action View Template API docs and it shouldn't. \r\n\r\n### Detail\r\n\r\nThis Pull Request escapes the auto-link, so `Action View Template` shows in API docs without `Template` showing as hyperlink text.\r\n\r\n### Additional information\r\n\r\nN/A\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48737/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48737/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48736", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48736/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48736/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48736/events", "html_url": "https://github.com/rails/rails/issues/48736", "id": 1804850061, "node_id": "I_kwDNIULOa5PTjQ", "number": 48736, "title": "For midnigh(00:00) only, the processing of the `time` type in the `trilogy` adapter is broken.", "user": {"login": "tmimura39", "id": 11774087, "node_id": "MDQ6VXNlcjExNzc0MDg3", "avatar_url": "https://avatars.githubusercontent.com/u/11774087?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmimura39", "html_url": "https://github.com/tmimura39", "followers_url": "https://api.github.com/users/tmimura39/followers", "following_url": "https://api.github.com/users/tmimura39/following{/other_user}", "gists_url": "https://api.github.com/users/tmimura39/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmimura39/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmimura39/subscriptions", "organizations_url": "https://api.github.com/users/tmimura39/orgs", "repos_url": "https://api.github.com/users/tmimura39/repos", "events_url": "https://api.github.com/users/tmimura39/events{/privacy}", "received_events_url": "https://api.github.com/users/tmimura39/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-14T13:03:49Z", "updated_at": "2023-07-14T14:12:42Z", "closed_at": "2023-07-14T14:12:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\nFor midnigh(00:00) only, the processing of the `time` type in the trilogy adapter is broken.\r\n\u203b An example of mysql2 is also included for reference.\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"trilogy\"\r\n  gem \"mysql2\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\nActiveRecord::Base.establish_connection(adapter: \"trilogy\", database: \"test\", username: \"root\", host: '127.0.0.1', port: 3306)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n    t.time :time_column\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\nend\r\n\r\nPost.create!(time_column: '00:00')\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_mysql2\r\n    ActiveRecord::Base.establish_connection(adapter: \"mysql2\", database: \"test\", username: \"root\", host: '127.0.0.1', port: 3306)\r\n    assert_equal Post.take.time_column, Time.utc(2000, 1, 1, 0, 0)\r\n  end\r\n\r\n  def test_trilogy\r\n    ActiveRecord::Base.establish_connection(adapter: \"trilogy\", database: \"test\", username: \"root\", host: '127.0.0.1', port: 3306)\r\n    assert_equal Post.take.time_column, Time.utc(2000, 1, 1, 0, 0)\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\n\r\nBoth `mysql2` and `torilogy`, `2000-01-01T00:00:00Z` to be returned.\r\n\r\n### Actual behavior\r\n\r\nIn case of `trilogy`, `nil` is returned.\r\n\r\n```\r\nFailure:\r\nBugTest#test_trilogy [midnight.rb:42]:\r\nExpected: nil\r\n  Actual: 2000-01-01 00:00:00 UTC\r\n```\r\n\r\n---\r\n\r\nIs it a problem with Trilogy?\r\n```ruby\r\nclient = Trilogy.new(host: \"127.0.0.1\", port: 13306, username: \"root\")\r\nclient.change_db('test')\r\nclient.query('SELECT * FROM posts;').to_a #=> [[1, nil]]\r\n```\r\n\r\nI was wondering where to report this. [activerecord-trilogy-adapter](https://github.com/trilogy-libraries/activerecord-trilogy-adapter) and [trilogy](https://github.com/trilogy-libraries/trilogy) and [rails/rails](https://github.com/rails/rails).\r\nSorry if I am wrong.\r\n\r\n### System configuration\r\n\r\n**Rails version**: v7.1.0.alpha (main@https://github.com/rails/rails/commit/c9cdd800d30ec38f079b3df0772ab47f4ba4b11f)\r\n\r\n**Ruby version**: v3.2.2\r\n\r\n**Trilogy**: v2.4.1", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48736/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48736/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48735", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48735/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48735/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48735/events", "html_url": "https://github.com/rails/rails/issues/48735", "id": 1804210174, "node_id": "I_kwDNIULOa4oP_g", "number": 48735, "title": "its not working even in Rails 6", "user": {"login": "sgmamsys", "id": 139530425, "node_id": "U_kgDOCFEQuQ", "avatar_url": "https://avatars.githubusercontent.com/u/139530425?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sgmamsys", "html_url": "https://github.com/sgmamsys", "followers_url": "https://api.github.com/users/sgmamsys/followers", "following_url": "https://api.github.com/users/sgmamsys/following{/other_user}", "gists_url": "https://api.github.com/users/sgmamsys/gists{/gist_id}", "starred_url": "https://api.github.com/users/sgmamsys/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sgmamsys/subscriptions", "organizations_url": "https://api.github.com/users/sgmamsys/orgs", "repos_url": "https://api.github.com/users/sgmamsys/repos", "events_url": "https://api.github.com/users/sgmamsys/events{/privacy}", "received_events_url": "https://api.github.com/users/sgmamsys/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-14T05:39:22Z", "updated_at": "2023-07-14T05:44:51Z", "closed_at": "2023-07-14T05:44:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# Your reproduction script goes here\r\n```\r\n\r\n### Expected behavior\r\n<!-- Tell us what should happen -->\r\n\r\n### Actual behavior\r\n<!-- Tell us what happens instead -->\r\n\r\n### System configuration\r\n**Rails version**:\r\n\r\n**Ruby version**:\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48735/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48735/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48734", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48734/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48734/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48734/events", "html_url": "https://github.com/rails/rails/pull/48734", "id": 1803433049, "node_id": "PR_kwDNIULOVXFT0w", "number": 48734, "title": "Fix documentation error for Delegated Types in Rails Guide", "user": {"login": "ron-shinall", "id": 81988008, "node_id": "MDQ6VXNlcjgxOTg4MDA4", "avatar_url": "https://avatars.githubusercontent.com/u/81988008?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ron-shinall", "html_url": "https://github.com/ron-shinall", "followers_url": "https://api.github.com/users/ron-shinall/followers", "following_url": "https://api.github.com/users/ron-shinall/following{/other_user}", "gists_url": "https://api.github.com/users/ron-shinall/gists{/gist_id}", "starred_url": "https://api.github.com/users/ron-shinall/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ron-shinall/subscriptions", "organizations_url": "https://api.github.com/users/ron-shinall/orgs", "repos_url": "https://api.github.com/users/ron-shinall/repos", "events_url": "https://api.github.com/users/ron-shinall/events{/privacy}", "received_events_url": "https://api.github.com/users/ron-shinall/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-13T17:06:53Z", "updated_at": "2023-07-13T19:38:08Z", "closed_at": "2023-07-13T19:37:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48734", "html_url": "https://github.com/rails/rails/pull/48734", "diff_url": "https://github.com/rails/rails/pull/48734.diff", "patch_url": "https://github.com/rails/rails/pull/48734.patch", "merged_at": "2023-07-13T19:37:56Z"}, "body": "### Motivation / Background\r\n\r\nThe Rails Guide for Delegated Types incorrectly references `delegates`.\r\n\r\nThis Pull Request has been created to correct that error.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the references from `delegates` to `delegate`.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48734/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48734/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48733", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48733/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48733/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48733/events", "html_url": "https://github.com/rails/rails/pull/48733", "id": 1803173069, "node_id": "PR_kwDNIULOVW3KSw", "number": 48733, "title": "Allow `accepts_nested_attributes_for` to accept associated record attributes with custom primary keys", "user": {"login": "fatkodima", "id": 5657035, "node_id": "MDQ6VXNlcjU2NTcwMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/5657035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fatkodima", "html_url": "https://github.com/fatkodima", "followers_url": "https://api.github.com/users/fatkodima/followers", "following_url": "https://api.github.com/users/fatkodima/following{/other_user}", "gists_url": "https://api.github.com/users/fatkodima/gists{/gist_id}", "starred_url": "https://api.github.com/users/fatkodima/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fatkodima/subscriptions", "organizations_url": "https://api.github.com/users/fatkodima/orgs", "repos_url": "https://api.github.com/users/fatkodima/repos", "events_url": "https://api.github.com/users/fatkodima/events{/privacy}", "received_events_url": "https://api.github.com/users/fatkodima/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-13T14:38:31Z", "updated_at": "2023-07-20T13:39:36Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48733", "html_url": "https://github.com/rails/rails/pull/48733", "diff_url": "https://github.com/rails/rails/pull/48733.diff", "patch_url": "https://github.com/rails/rails/pull/48733.patch", "merged_at": null}, "body": "Fixes #48714.\r\n\r\nCurrently, when we have an `accepts_nested_attributes_for` for a child relation with a custom primary key, when assigning child attributes we must use `\"id\"` key with a value to provide a primary key, which can be confusing (as in the linked issue).\r\n\r\nExample:\r\n```ruby\r\nclass Owner < ApplicationRecord\r\n  has_many :pets\r\n  accepts_nested_attributes_for :pets\r\nend\r\n\r\nclass Pet < ApplicationRecord\r\n  self.primary_key = :pet_id # custom primary key name\r\n  belongs_to :owner\r\nend\r\n```\r\n\r\nBefore:\r\n\r\n```ruby\r\nowner.update(pets_attributes: { id: 2, name: \"parrot\" }) # works, because we used \"id\" as a key\r\nowner.update(pets_attributes: { pet_id: 2, name: \"parrot\" }) # does not work\r\n```\r\n\r\nAfter - both variants are working", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48733/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48733/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48732", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48732/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48732/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48732/events", "html_url": "https://github.com/rails/rails/issues/48732", "id": 1802788215, "node_id": "I_kwDNIULOa3Rddw", "number": 48732, "title": "[BUG] numericality: { in: ... } is not validating as expected", "user": {"login": "marvoosh", "id": 60466386, "node_id": "MDQ6VXNlcjYwNDY2Mzg2", "avatar_url": "https://avatars.githubusercontent.com/u/60466386?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marvoosh", "html_url": "https://github.com/marvoosh", "followers_url": "https://api.github.com/users/marvoosh/followers", "following_url": "https://api.github.com/users/marvoosh/following{/other_user}", "gists_url": "https://api.github.com/users/marvoosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marvoosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marvoosh/subscriptions", "organizations_url": "https://api.github.com/users/marvoosh/orgs", "repos_url": "https://api.github.com/users/marvoosh/repos", "events_url": "https://api.github.com/users/marvoosh/events{/privacy}", "received_events_url": "https://api.github.com/users/marvoosh/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-07-13T11:11:37Z", "updated_at": "2023-07-16T15:48:52Z", "closed_at": "2023-07-16T15:48:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nCreate a new model with an integer column.\r\nOn the model add a numericality validation {in:..} and give it a range.\r\n\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\ncolumn :quantaty, :integer\r\n\r\nclass dogs\r\n    validates :quantity, numericality: { in: 0..4 }\r\nend\r\n```\r\n\r\n### Expected behavior\r\n<!-- Tell us what should happen -->\r\nI expected this test to pass:\r\n```ruby\r\nit 'should validate the numericality of quantity' do\r\n    expect(dogs).to validate_numericality_of(:quantity).is_in(0..4)\r\nend\r\n```\r\n### Actual behavior\r\n<!-- Tell us what happens instead -->\r\nThe test fails with this error:\r\n> Expected Dogs to validate that :quantity looks like a number\r\nfrom \u20390\u203a to \u20394\u203a, but this could not be proved.\r\nAfter setting :quantity to \u20395\u203a, the matcher expected the Dogs\r\nto be invalid, but it was valid instead.\r\n\r\n\r\n### System configuration\r\n**Rails version**:\r\nRails 6.1.7.2\r\n\r\n**Ruby version**:\r\nruby 3.2.0", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48732/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48732/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48731", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48731/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48731/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48731/events", "html_url": "https://github.com/rails/rails/pull/48731", "id": 1802713295, "node_id": "PR_kwDNIULOVWd2Xg", "number": 48731, "title": "Prevent extra newlines after table generation block in shema.rb", "user": {"login": "knagode", "id": 4473199, "node_id": "MDQ6VXNlcjQ0NzMxOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/4473199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/knagode", "html_url": "https://github.com/knagode", "followers_url": "https://api.github.com/users/knagode/followers", "following_url": "https://api.github.com/users/knagode/following{/other_user}", "gists_url": "https://api.github.com/users/knagode/gists{/gist_id}", "starred_url": "https://api.github.com/users/knagode/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/knagode/subscriptions", "organizations_url": "https://api.github.com/users/knagode/orgs", "repos_url": "https://api.github.com/users/knagode/repos", "events_url": "https://api.github.com/users/knagode/events{/privacy}", "received_events_url": "https://api.github.com/users/knagode/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-13T10:26:54Z", "updated_at": "2023-07-13T15:56:45Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48731", "html_url": "https://github.com/rails/rails/pull/48731", "diff_url": "https://github.com/rails/rails/pull/48731.diff", "patch_url": "https://github.com/rails/rails/pull/48731.patch", "merged_at": null}, "body": "\u2026when there are no foreign keys or indexes.  This will produce valid code without linting issues (issue: Trailing whitespace detected)\r\n\r\n\r\n### Motivation / Background\r\n\r\nSchema generator was generating files with linting issues (Trailing whitespace detected) **when there is no foreign_keys in the database**. Developer who care about linting has to manually fix those issues after every schema dump operation (e.g. `rails db:migrate`). \r\n\r\nExample of schema file **with linting issue** (extra newline on L6): \r\n```\r\nActiveRecord::Schema[7.0].define(version: 2023_03_14_145511) do\r\n  create_table \"action_logs\", force: :cascade do |t|\r\n    t.string \"action\", null: false\r\n    t.index [\"deleted_at\"], name: \"index_action_logs_on_deleted_at\"\r\n  end\r\n\r\nend\r\n```\r\n\r\nExample of schema file **without** linting issues: \r\n\r\n```\r\nActiveRecord::Schema[7.0].define(version: 2023_03_14_145511) do\r\n  create_table \"action_logs\", force: :cascade do |t|\r\n    t.string \"action\", null: false\r\n    t.index [\"deleted_at\"], name: \"index_action_logs_on_deleted_at\"\r\n  end\r\nend\r\n```\r\n\r\n### Details\r\nWe should NOT attach a newline after last table definition. Extra newline is needed only if foreign keys definitions exists in the database. \r\n\r\n### Checklist\r\n Before submitting the PR make sure the following are checked:\r\n \r\n * [x]  This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n * [x]  Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n * [ ]  Tests are added or updated if you fix a bug or add a feature.\r\n * [ ]  CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48731/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48731/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48730", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48730/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48730/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48730/events", "html_url": "https://github.com/rails/rails/pull/48730", "id": 1802547265, "node_id": "PR_kwDNIULOVWUp7g", "number": 48730, "title": "Eagerly cast serialized query attributes", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-13T09:03:40Z", "updated_at": "2023-07-13T10:03:26Z", "closed_at": "2023-07-13T09:58:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48730", "html_url": "https://github.com/rails/rails/pull/48730", "diff_url": "https://github.com/rails/rails/pull/48730.diff", "patch_url": "https://github.com/rails/rails/pull/48730.patch", "merged_at": "2023-07-13T09:58:34Z"}, "body": "Fix: https://github.com/rails/rails/issues/48652\r\nRef: https://github.com/rails/rails/pull/46048\r\nRef: https://github.com/rails/rails/issues/46044\r\nRef: https://github.com/rails/rails/pull/34303\r\nRef: https://github.com/rails/rails/pull/39160\r\nClose: https://github.com/rails/rails/pull/48705\r\n\r\nThis deep_dup was introduced to prevent the value stored in the query cache to be later mutated.\r\n\r\nThe problem is that `ActiveRecord::Base#dup` will return a copy of the record but with the primary key set to nil. One could argue that `#dup` shouldn't behave this way, but I think this ship has sailed (or has it?).\r\n\r\nMy initial fix was to instead always call `type.cast` eagerly so that we'd dup serialized types in a more correct way. However there is a test that explictly ensure this doesn't happen: https://github.com/rails/rails/pull/39160\r\n\r\nThe reason isn't 100% clear to me, but if I get it correctly, it's to avoid a potentially costly operation upfront.\r\n\r\nSo instead we only eagerly cast serialized attributes only, so protect against future mutations.\r\n\r\nMutable types are still deep duped.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48730/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48730/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48729", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48729/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48729/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48729/events", "html_url": "https://github.com/rails/rails/pull/48729", "id": 1802483457, "node_id": "PR_kwDNIULOVWRM3g", "number": 48729, "title": "Add migration generator for drop table action", "user": {"login": "knagode", "id": 4473199, "node_id": "MDQ6VXNlcjQ0NzMxOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/4473199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/knagode", "html_url": "https://github.com/knagode", "followers_url": "https://api.github.com/users/knagode/followers", "following_url": "https://api.github.com/users/knagode/following{/other_user}", "gists_url": "https://api.github.com/users/knagode/gists{/gist_id}", "starred_url": "https://api.github.com/users/knagode/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/knagode/subscriptions", "organizations_url": "https://api.github.com/users/knagode/orgs", "repos_url": "https://api.github.com/users/knagode/repos", "events_url": "https://api.github.com/users/knagode/events{/privacy}", "received_events_url": "https://api.github.com/users/knagode/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-07-13T08:25:55Z", "updated_at": "2023-08-08T17:05:42Z", "closed_at": "2023-08-08T17:05:42Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48729", "html_url": "https://github.com/rails/rails/pull/48729", "diff_url": "https://github.com/rails/rails/pull/48729.diff", "patch_url": "https://github.com/rails/rails/pull/48729.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nPrior this change `rails generate migration drop_users` generated migration file with empty `def change` body. [A lot of users are surprised](https://stackoverflow.com/questions/4020131/rails-db-migration-how-to-drop-a-table) about this not yet being implemented. \r\n\r\n```\r\nclass DropUsers< ActiveRecord::Migration[7.0]\r\n  def change\r\n  end\r\nend\r\n```\r\n\r\n### Details\r\n\r\nThis PR improve codebase in order to generate proper drop migration:\r\n```\r\nclass DropUsers< ActiveRecord::Migration[7.0]\r\n  def change\r\n     drop_table :users\r\n  end\r\nend\r\n```\r\n\r\nNote: Implementation does not contain tests because there is no base code for migration generators yet - it would require quite some efforts to add this. If someone knows how test for such a thing should be written, please give me some hints.\r\n\r\n### Checklist\r\n Before submitting the PR make sure the following are checked:\r\n \r\n * [x]  This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n * [x]  Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n * [ ]  Tests are added or updated if you fix a bug or add a feature.\r\n * [ ]  CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48729/reactions", "total_count": 2, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48729/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48728", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48728/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48728/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48728/events", "html_url": "https://github.com/rails/rails/pull/48728", "id": 1802289321, "node_id": "PR_kwDNIULOVWGm6Q", "number": 48728, "title": "Improve AR Encryption docs", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}, {"id": 1072773639, "node_id": "MDU6TGFiZWwxMDcyNzczNjM5", "url": "https://api.github.com/repos/rails/rails/labels/ready", "name": "ready", "color": "fef2c0", "default": false, "description": "PRs ready to merge"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-13T06:30:53Z", "updated_at": "2023-07-18T22:41:53Z", "closed_at": "2023-07-18T13:49:59Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48728", "html_url": "https://github.com/rails/rails/pull/48728", "diff_url": "https://github.com/rails/rails/pull/48728.diff", "patch_url": "https://github.com/rails/rails/pull/48728.patch", "merged_at": "2023-07-18T13:49:59Z"}, "body": "Before:\r\n\r\n![image](https://github.com/rails/rails/assets/509837/13c6ee19-e1be-49d8-809b-03f61c4d5030)\r\n\r\n- Moves the code example directly below where it's referenced, and the note about naming after it.\r\n- Adds a code example for the other config mentioned.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48728/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48728/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48727", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48727/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48727/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48727/events", "html_url": "https://github.com/rails/rails/pull/48727", "id": 1802075341, "node_id": "PR_kwDNIULOVV654w", "number": 48727, "title": "Fix index_errors and provide :nested_attributes_order mode", "user": {"login": "lulalala", "id": 366910, "node_id": "MDQ6VXNlcjM2NjkxMA==", "avatar_url": "https://avatars.githubusercontent.com/u/366910?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lulalala", "html_url": "https://github.com/lulalala", "followers_url": "https://api.github.com/users/lulalala/followers", "following_url": "https://api.github.com/users/lulalala/following{/other_user}", "gists_url": "https://api.github.com/users/lulalala/gists{/gist_id}", "starred_url": "https://api.github.com/users/lulalala/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lulalala/subscriptions", "organizations_url": "https://api.github.com/users/lulalala/orgs", "repos_url": "https://api.github.com/users/lulalala/repos", "events_url": "https://api.github.com/users/lulalala/events{/privacy}", "received_events_url": "https://api.github.com/users/lulalala/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-13T03:13:17Z", "updated_at": "2023-08-15T03:18:04Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48727", "html_url": "https://github.com/rails/rails/pull/48727", "diff_url": "https://github.com/rails/rails/pull/48727.diff", "patch_url": "https://github.com/rails/rails/pull/48727.patch", "merged_at": null}, "body": "1. Fix #24390, a bug on indexing association validation errors.\r\n1. Add`index_errors: :nested_attributes_order` mode for an alternative ordering of errors.\r\n\r\n### Motivation / Background\r\n\r\nGitLab is using `index_errors` but has to [workaround its bug](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/51623#note_490919557), which is #24390. That bug is about association validation error having the incorrect index because the indexing can be computed from an incomplete collection of association records. The fix would be to index from the full association collection.\r\n\r\n@tijwelch first created https://github.com/rails/rails/pull/24728, however @markedmondson  pointed out that [`reject_if` would not work properly](https://github.com/rails/rails/pull/24728#issuecomment-321361869). Also, from the discussions I found that people have two different interpretations of what \"indexing\" means: \r\n\r\n1. to index by association order (based on database order), which is the current behavior\r\n2. to index by nested attributes order (and `reject_if` is only applicable here)\r\n\r\nThose two are conflicting goals. To cater to both of them, this PR also adds a new ordering mode called `nested_attributes_order`. This mode is more applicable to GitLab's use case, where the frontend could pass nested attributes in arbitrary order, and still want the error index to match such order.\r\n\r\n### Detail\r\n\r\nThis Pull Request adds a new class called `ActiveRecord::Associations::NestedError`, which handles the calculation of index. The original index logic exists in `AutosaveAssociation` and is moved into this class. Base on `index_errors` setting, it would choose whether to index based on `association.target` order or nested attributes order.\r\n\r\nFor nested attributes order, when nested_attributes are assigned (via a setter like `roles_attributes=`), the array of the corresponding records will be stored in the association object as `nested_attributes_target`. The `NestedError` can then access this array to compute the index. The `reject_if` would also work since if something is rejected, the `nested_attributes_target` would have `nil` in its place as a placeholder, therefore maintaining the overall index.\r\n\r\n### Additional information\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48727/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48727/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48726", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48726/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48726/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48726/events", "html_url": "https://github.com/rails/rails/pull/48726", "id": 1801834659, "node_id": "PR_kwDNIULOVVtvuA", "number": 48726, "title": "[7-0-stable] Backport: Use a consistent format when testing BigDecimal.to_s", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-12T22:16:27Z", "updated_at": "2023-07-17T15:56:37Z", "closed_at": "2023-07-17T15:56:36Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48726", "html_url": "https://github.com/rails/rails/pull/48726", "diff_url": "https://github.com/rails/rails/pull/48726.diff", "patch_url": "https://github.com/rails/rails/pull/48726.patch", "merged_at": "2023-07-17T15:56:36Z"}, "body": "This backports #48693 to `7-0-stable` branch", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48726/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48726/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48725", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48725/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48725/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48725/events", "html_url": "https://github.com/rails/rails/pull/48725", "id": 1801775068, "node_id": "PR_kwDNIULOVVqdYA", "number": 48725, "title": "Remove unused suppress_composite_primary_key on HABTM join model class", "user": {"login": "gmcgibbon", "id": 5162312, "node_id": "MDQ6VXNlcjUxNjIzMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5162312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gmcgibbon", "html_url": "https://github.com/gmcgibbon", "followers_url": "https://api.github.com/users/gmcgibbon/followers", "following_url": "https://api.github.com/users/gmcgibbon/following{/other_user}", "gists_url": "https://api.github.com/users/gmcgibbon/gists{/gist_id}", "starred_url": "https://api.github.com/users/gmcgibbon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gmcgibbon/subscriptions", "organizations_url": "https://api.github.com/users/gmcgibbon/orgs", "repos_url": "https://api.github.com/users/gmcgibbon/repos", "events_url": "https://api.github.com/users/gmcgibbon/events{/privacy}", "received_events_url": "https://api.github.com/users/gmcgibbon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-12T21:18:44Z", "updated_at": "2023-07-12T22:13:00Z", "closed_at": "2023-07-12T22:11:20Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48725", "html_url": "https://github.com/rails/rails/pull/48725", "diff_url": "https://github.com/rails/rails/pull/48725.diff", "patch_url": "https://github.com/rails/rails/pull/48725.patch", "merged_at": "2023-07-12T22:11:20Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because `.suppress_composite_primary_key` appears to be dead code. Since it was intended to be private, it _should_ be safe to remove without deprecation (but I'm happy to add one if we decide otherwise).\r\n\r\n### Detail\r\n\r\nThis Pull Request removes `.suppress_composite_primary_key` from join model classes for has_and_belongs_to_many associations.\r\n\r\n### Additional information\r\n\r\nThere's another method with the same name here: https://github.com/rails/rails/blob/50e3ae083683a8a5e38fee4d7952e1576e3ffc31/activerecord/lib/active_record/connection_adapters/postgresql/database_statements.rb#L180\r\n\r\nbut it appears to be used in sequence lookup. Sequences don't support CPK AFAIK, so I guess we can leave that one as-is.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48725/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48725/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48724", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48724/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48724/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48724/events", "html_url": "https://github.com/rails/rails/pull/48724", "id": 1801738842, "node_id": "PR_kwDNIULOVVodnA", "number": 48724, "title": "Improve cpk validation check", "user": {"login": "gmcgibbon", "id": 5162312, "node_id": "MDQ6VXNlcjUxNjIzMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5162312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gmcgibbon", "html_url": "https://github.com/gmcgibbon", "followers_url": "https://api.github.com/users/gmcgibbon/followers", "following_url": "https://api.github.com/users/gmcgibbon/following{/other_user}", "gists_url": "https://api.github.com/users/gmcgibbon/gists{/gist_id}", "starred_url": "https://api.github.com/users/gmcgibbon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gmcgibbon/subscriptions", "organizations_url": "https://api.github.com/users/gmcgibbon/orgs", "repos_url": "https://api.github.com/users/gmcgibbon/repos", "events_url": "https://api.github.com/users/gmcgibbon/events{/privacy}", "received_events_url": "https://api.github.com/users/gmcgibbon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-12T20:48:39Z", "updated_at": "2023-07-12T22:13:24Z", "closed_at": "2023-07-12T22:12:01Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48724", "html_url": "https://github.com/rails/rails/pull/48724", "diff_url": "https://github.com/rails/rails/pull/48724.diff", "patch_url": "https://github.com/rails/rails/pull/48724.patch", "merged_at": "2023-07-12T22:12:01Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because the composite primary key validation check is incomplete. It only checks for one side of the association having a CPK. It should actually check both sides so that more edge cases are caught.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the CPK validation check condition to include `active_record.composite_primary_key?`, which account for CPK owners of associations (not just CPK association classes). \r\n\r\n### Additional information\r\n\r\nThis PR also changes a few other things in other commits. It improves the CPK validation check error message, and changes `<reflection>.association_primary_key` behaviour to better support CPK. The fix for belongs_to assignment included in the `#association_primary_key` change commit doesn't appear to be released, so I don't think a changelog is needed there. \r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48724/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48724/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48723", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48723/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48723/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48723/events", "html_url": "https://github.com/rails/rails/pull/48723", "id": 1801705169, "node_id": "PR_kwDNIULOVVmk7g", "number": 48723, "title": "Allow `type` to be optional", "user": {"login": "gjtorikian", "id": 64050, "node_id": "MDQ6VXNlcjY0MDUw", "avatar_url": "https://avatars.githubusercontent.com/u/64050?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gjtorikian", "html_url": "https://github.com/gjtorikian", "followers_url": "https://api.github.com/users/gjtorikian/followers", "following_url": "https://api.github.com/users/gjtorikian/following{/other_user}", "gists_url": "https://api.github.com/users/gjtorikian/gists{/gist_id}", "starred_url": "https://api.github.com/users/gjtorikian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gjtorikian/subscriptions", "organizations_url": "https://api.github.com/users/gjtorikian/orgs", "repos_url": "https://api.github.com/users/gjtorikian/repos", "events_url": "https://api.github.com/users/gjtorikian/events{/privacy}", "received_events_url": "https://api.github.com/users/gjtorikian/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-12T20:28:25Z", "updated_at": "2023-07-17T21:08:19Z", "closed_at": "2023-07-17T13:40:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48723", "html_url": "https://github.com/rails/rails/pull/48723", "diff_url": "https://github.com/rails/rails/pull/48723.diff", "patch_url": "https://github.com/rails/rails/pull/48723.patch", "merged_at": null}, "body": "\r\n### Motivation / Background\r\n\r\nIn https://github.com/rails/rails/pull/45952, a change was made to ActiveSupport to \"accept an optional parameter to specify the types of callbacks that the user would want to run.\" However, the parameter is mandatory. This has broken downstream gems, such as `activerecord-import`: https://github.com/zdennis/activerecord-import/issues/787\r\n\r\n### Detail\r\n\r\nRather than fix the issue in the dependencies, I think it would be easier/safer to just set this argument to `nil`, for backwards compatibility.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48723/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48723/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48722", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48722/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48722/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48722/events", "html_url": "https://github.com/rails/rails/pull/48722", "id": 1801643433, "node_id": "PR_kwDNIULOVVjNxw", "number": 48722, "title": "Document common ActiveStorage issues", "user": {"login": "thedanbob", "id": 1530175, "node_id": "MDQ6VXNlcjE1MzAxNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/1530175?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thedanbob", "html_url": "https://github.com/thedanbob", "followers_url": "https://api.github.com/users/thedanbob/followers", "following_url": "https://api.github.com/users/thedanbob/following{/other_user}", "gists_url": "https://api.github.com/users/thedanbob/gists{/gist_id}", "starred_url": "https://api.github.com/users/thedanbob/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thedanbob/subscriptions", "organizations_url": "https://api.github.com/users/thedanbob/orgs", "repos_url": "https://api.github.com/users/thedanbob/repos", "events_url": "https://api.github.com/users/thedanbob/events{/privacy}", "received_events_url": "https://api.github.com/users/thedanbob/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-12T19:44:00Z", "updated_at": "2023-07-13T15:28:58Z", "closed_at": "2023-07-13T15:28:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48722", "html_url": "https://github.com/rails/rails/pull/48722", "diff_url": "https://github.com/rails/rails/pull/48722.diff", "patch_url": "https://github.com/rails/rails/pull/48722.patch", "merged_at": "2023-07-13T15:28:17Z"}, "body": "This PR documents how to handle a couple of common situations with ActiveStorage that I always have to look up. \r\n\r\n* How to keep existing attachments on a `has_many_attached` when uploading new ones\r\n* How to retain uploaded files when a form submission fails validation", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48722/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48722/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48721", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48721/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48721/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48721/events", "html_url": "https://github.com/rails/rails/issues/48721", "id": 1801229394, "node_id": "I_kwDNIULOa1yUUg", "number": 48721, "title": "Calling model.decrypt saves the unencrypted entity, which breaks further access to it", "user": {"login": "dsusviela", "id": 18326941, "node_id": "MDQ6VXNlcjE4MzI2OTQx", "avatar_url": "https://avatars.githubusercontent.com/u/18326941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dsusviela", "html_url": "https://github.com/dsusviela", "followers_url": "https://api.github.com/users/dsusviela/followers", "following_url": "https://api.github.com/users/dsusviela/following{/other_user}", "gists_url": "https://api.github.com/users/dsusviela/gists{/gist_id}", "starred_url": "https://api.github.com/users/dsusviela/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dsusviela/subscriptions", "organizations_url": "https://api.github.com/users/dsusviela/orgs", "repos_url": "https://api.github.com/users/dsusviela/repos", "events_url": "https://api.github.com/users/dsusviela/events{/privacy}", "received_events_url": "https://api.github.com/users/dsusviela/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 5511275119, "node_id": "LA_kwDNIULPAAAAAUh_Ym8", "url": "https://api.github.com/repos/rails/rails/labels/encryption", "name": "encryption", "color": "8D3EA8", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-12T15:25:26Z", "updated_at": "2023-07-16T15:51:41Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\n1. Create a model with AR encryption on one of the fields\r\n2. Make sure the chosen field has deterministic encryption\r\n3. Go into the rails console\r\n4. Create an entity of this model, and save it\r\n5. Call `#decrypt`\r\n6. Do `Model.find(:id).inspect`\r\n7. You should get an error\r\n\r\nAny interaction with this record will result in errors\r\n\r\n### Executable use case:\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem 'rails'\r\n  gem \"sqlite3\"\r\n  gem \"pry\"\r\n  gem \"byebug\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Encryption.configure(\r\n  primary_key: SecureRandom.alphanumeric(32),\r\n  deterministic_key: SecureRandom.alphanumeric(32),\r\n  key_derivation_salt: SecureRandom.alphanumeric(32),\r\n  extend_queries: true,\r\n  )\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :users, force: :true do |t|\r\n    t.string :secret\r\n  end\r\nend\r\n\r\nclass User < ActiveRecord::Base\r\n  encrypts :secret, deterministic: true\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_decrypt_breaks_access_to_model\r\n    model = User.create(secret: \"my_test_string\")\r\n    id = model.id\r\n    model.decrypt\r\n\r\n    assert_raises(ActiveRecord::Encryption::Errors::Decryption) do\r\n      User.find(id).inspect\r\n    end\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\nI can still interact with the entity, at the very least I should be able to recover it\r\n\r\n### Actual behavior\r\nAny method calls on this record yield in the after mentioned exception\r\n\r\n### My 2 cents\r\n\r\nI found this behavior when playing around with some records, and called `decrypt` on some of them because I was playing around. My issue is probably the intended behavior (that the record gets updated) and I understand that we get an exception since the record is not in the expected json string format anymore. However I think that we can improve the experience with any of: \r\n\r\n- Improving the documentation; adding a warning that this will result in an `update` of your record\r\n- Changing the implementation so that the `ActiveRecord::Encryption::NullEncryptor.new` returns a string with a single string\r\n\r\nI'm okay with providing any solution that it may be okay\r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48721/reactions", "total_count": 4, "+1": 4, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48721/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48720", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48720/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48720/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48720/events", "html_url": "https://github.com/rails/rails/pull/48720", "id": 1800831323, "node_id": "PR_kwDNIULOVU2oPQ", "number": 48720, "title": "Fix `Enumerable#sum` for `Enumerator#lazy`", "user": {"login": "fatkodima", "id": 5657035, "node_id": "MDQ6VXNlcjU2NTcwMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/5657035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fatkodima", "html_url": "https://github.com/fatkodima", "followers_url": "https://api.github.com/users/fatkodima/followers", "following_url": "https://api.github.com/users/fatkodima/following{/other_user}", "gists_url": "https://api.github.com/users/fatkodima/gists{/gist_id}", "starred_url": "https://api.github.com/users/fatkodima/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fatkodima/subscriptions", "organizations_url": "https://api.github.com/users/fatkodima/orgs", "repos_url": "https://api.github.com/users/fatkodima/repos", "events_url": "https://api.github.com/users/fatkodima/events{/privacy}", "received_events_url": "https://api.github.com/users/fatkodima/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-07-12T12:03:02Z", "updated_at": "2023-07-20T22:24:55Z", "closed_at": "2023-07-20T22:24:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48720", "html_url": "https://github.com/rails/rails/pull/48720", "diff_url": "https://github.com/rails/rails/pull/48720.diff", "patch_url": "https://github.com/rails/rails/pull/48720.patch", "merged_at": "2023-07-20T22:24:52Z"}, "body": "Fixes #48712.\r\n\r\nThe problem was that `.first` method call, used in the condition, evaluated lazy enumerator, and thus lead to the problematic behavior.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48720/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48720/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48719", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48719/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48719/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48719/events", "html_url": "https://github.com/rails/rails/pull/48719", "id": 1800725105, "node_id": "PR_kwDNIULOVUwthQ", "number": 48719, "title": "Doc and spec cookies.delete returning the cookie value", "user": {"login": "henrik", "id": 216, "node_id": "MDQ6VXNlcjIxNg==", "avatar_url": "https://avatars.githubusercontent.com/u/216?v=4", "gravatar_id": "", "url": "https://api.github.com/users/henrik", "html_url": "https://github.com/henrik", "followers_url": "https://api.github.com/users/henrik/followers", "following_url": "https://api.github.com/users/henrik/following{/other_user}", "gists_url": "https://api.github.com/users/henrik/gists{/gist_id}", "starred_url": "https://api.github.com/users/henrik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/henrik/subscriptions", "organizations_url": "https://api.github.com/users/henrik/orgs", "repos_url": "https://api.github.com/users/henrik/repos", "events_url": "https://api.github.com/users/henrik/events{/privacy}", "received_events_url": "https://api.github.com/users/henrik/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-12T11:00:58Z", "updated_at": "2023-07-13T08:38:44Z", "closed_at": "2023-07-13T07:13:46Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48719", "html_url": "https://github.com/rails/rails/pull/48719", "diff_url": "https://github.com/rails/rails/pull/48719.diff", "patch_url": "https://github.com/rails/rails/pull/48719.patch", "merged_at": "2023-07-13T07:13:46Z"}, "body": "Doc and spec `cookies.delete` returning the cookie value.\r\n\r\nI didn't want to rely on this behaviour since it was undocumented and (AFAIK) untested.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48719/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48719/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48718", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48718/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48718/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48718/events", "html_url": "https://github.com/rails/rails/pull/48718", "id": 1799806336, "node_id": "PR_kwDNIULOVT-lDQ", "number": 48718, "title": "ActiveStorage mirror uploads should be asynchronous", "user": {"login": "alexandreruban", "id": 33979976, "node_id": "MDQ6VXNlcjMzOTc5OTc2", "avatar_url": "https://avatars.githubusercontent.com/u/33979976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexandreruban", "html_url": "https://github.com/alexandreruban", "followers_url": "https://api.github.com/users/alexandreruban/followers", "following_url": "https://api.github.com/users/alexandreruban/following{/other_user}", "gists_url": "https://api.github.com/users/alexandreruban/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexandreruban/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexandreruban/subscriptions", "organizations_url": "https://api.github.com/users/alexandreruban/orgs", "repos_url": "https://api.github.com/users/alexandreruban/repos", "events_url": "https://api.github.com/users/alexandreruban/events{/privacy}", "received_events_url": "https://api.github.com/users/alexandreruban/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-11T21:51:38Z", "updated_at": "2023-08-04T21:02:19Z", "closed_at": "2023-08-04T20:59:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48718", "html_url": "https://github.com/rails/rails/pull/48718", "diff_url": "https://github.com/rails/rails/pull/48718.diff", "patch_url": "https://github.com/rails/rails/pull/48718.patch", "merged_at": "2023-08-04T20:59:30Z"}, "body": "Closes https://github.com/rails/rails/issues/47918\r\n\r\n### Context\r\n\r\n`ActiveStorage::Mirror` is really nice to have. However when you define a Mirror service on storage.yml , the upload to the mirror actually happens inline, instead of using `ActiveStorage::MirrorJob`.\r\n\r\nThis actually slows down any uploads to the service, because it is performed n times (n being the number of mirrors), inline, instead of using the `ActiveStorage::MirrorJob`.\r\n\r\n### Fix\r\n\r\nBefore this commit, when a file was uploaded to a mirror service, the file upload to each service (primary and mirrors) was happening synchronously:\r\n\r\n```rb\r\ndef upload(key, io, checksum: nil, **options)\r\n  each_service.collect do |service|\r\n    io.rewind\r\n    service.upload key, io, checksum: checksum, **options\r\n  end\r\nend\r\n```\r\n\r\nIn this commit, we change this behavior to only upload the file to the primary service synchronously and then enqueue a job to upload the file to the mirrors asynchronously.\r\n\r\n```rb\r\ndef upload(key, io, checksum: nil, **options)\r\n  io.rewind\r\n  primary.upload key, io, checksum: checksum, **options\r\n  mirror_later key, checksum: checksum\r\nend\r\n```", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48718/reactions", "total_count": 4, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 3, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48718/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48717", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48717/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48717/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48717/events", "html_url": "https://github.com/rails/rails/pull/48717", "id": 1799343053, "node_id": "PR_kwDNIULOVTlvrA", "number": 48717, "title": "Re-establish connection at end of test", "user": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-11T16:46:26Z", "updated_at": "2023-07-11T17:09:56Z", "closed_at": "2023-07-11T17:09:55Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48717", "html_url": "https://github.com/rails/rails/pull/48717", "diff_url": "https://github.com/rails/rails/pull/48717.diff", "patch_url": "https://github.com/rails/rails/pull/48717.patch", "merged_at": "2023-07-11T17:09:55Z"}, "body": "Fix flaky tests where we needed to re-establish the connection after removing it at the end of the test.\r\n\r\nFixes #48710", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48717/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48717/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48716", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48716/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48716/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48716/events", "html_url": "https://github.com/rails/rails/pull/48716", "id": 1799258482, "node_id": "PR_kwDNIULOVThPKA", "number": 48716, "title": "Refactor Active Record Schema Cache to not hold a connection", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-11T15:58:08Z", "updated_at": "2023-07-17T10:14:47Z", "closed_at": "2023-07-17T10:14:46Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48716", "html_url": "https://github.com/rails/rails/pull/48716", "diff_url": "https://github.com/rails/rails/pull/48716.diff", "patch_url": "https://github.com/rails/rails/pull/48716.patch", "merged_at": "2023-07-17T10:14:46Z"}, "body": "Fix: https://github.com/rails/rails/pull/47582\r\nFix: https://github.com/bensheldon/good_job/issues/796\r\nFix: https://github.com/rails/rails/pull/38577\r\nMaybe: https://github.com/rails/rails/issues/46797 ?\r\n\r\nThis is mostly a rebase of @matthewd's https://github.com/rails/rails/compare/main...matthewd:rails:schema-reflection, I initially went with my own implementation, but it ended up very similar, just less elegant, so I decided to rebase it instead.\r\n\r\n### Context\r\n\r\nA big problem with the current `SchemaCache` implementation is that it holds a reference to a connection, and uses it to lazily query the schema when the information is missing.\r\n\r\nThis cause issues in multi-threaded contexts because all the connections of a pool share the same schema, so they are constantly setting themselves as the connection the schema cache should use, and you can end up in situation where Thread#1 query the schema cache, which end up using the connection currently attributed to Thread#2.\r\n\r\nFor a very long time this worked more or less by accident, because all connection adapters would have an internal Monitor.\r\n\r\nHowever in https://github.com/rails/rails/pull/46519 we got rid of this synchronization, revealing the pre-existing issue. Previously it would work\u2122, but still wasn't ideal because of unexpected the connection sharing between threads.\r\n\r\n### Solution\r\n\r\nThe idea here is to refactor the schema cache so that it doesn't hold a reference onto any connection. \r\n\r\nAnd instead of a SchemaCache, connections now have access to a SchemaReflection. Now the connection that needs a schema information is always provided as an argument, so that in case of a miss, it can be used to populate the cache.\r\n\r\nThat should fix the database thread safety issues that were witnessed.\r\n\r\nHowever note that at this stage, the underlying `SchemaCache` isn't synchronized, so in case of a race condition, the same schema query can be performed more than once. It could make sense to add synchronization in a followup.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48716/reactions", "total_count": 4, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 3, "rocket": 1, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48716/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48715", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48715/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48715/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48715/events", "html_url": "https://github.com/rails/rails/pull/48715", "id": 1799196695, "node_id": "PR_kwDNIULOVTd2VA", "number": 48715, "title": "Clarify comment about debug log level.", "user": {"login": "jcoyne", "id": 92044, "node_id": "MDQ6VXNlcjkyMDQ0", "avatar_url": "https://avatars.githubusercontent.com/u/92044?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcoyne", "html_url": "https://github.com/jcoyne", "followers_url": "https://api.github.com/users/jcoyne/followers", "following_url": "https://api.github.com/users/jcoyne/following{/other_user}", "gists_url": "https://api.github.com/users/jcoyne/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcoyne/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcoyne/subscriptions", "organizations_url": "https://api.github.com/users/jcoyne/orgs", "repos_url": "https://api.github.com/users/jcoyne/repos", "events_url": "https://api.github.com/users/jcoyne/events{/privacy}", "received_events_url": "https://api.github.com/users/jcoyne/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-11T15:27:04Z", "updated_at": "2023-07-19T17:34:08Z", "closed_at": "2023-07-19T17:34:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48715", "html_url": "https://github.com/rails/rails/pull/48715", "diff_url": "https://github.com/rails/rails/pull/48715.diff", "patch_url": "https://github.com/rails/rails/pull/48715.patch", "merged_at": "2023-07-19T17:34:07Z"}, "body": "\r\n\r\n### Motivation / Background\r\n\r\nI believe the previous phrasing could be interpreted ambiguously. See discussion in #48713\r\n### Detail\r\n\r\nn/a\r\n\r\n### Additional information\r\n\r\nn/a\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48715/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48715/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48714", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48714/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48714/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48714/events", "html_url": "https://github.com/rails/rails/issues/48714", "id": 1799178211, "node_id": "I_kwDNIULOaz1H4w", "number": 48714, "title": "accepts_nested_attributes_for does not work with non `id` primary_key", "user": {"login": "fanantoxa", "id": 7717033, "node_id": "MDQ6VXNlcjc3MTcwMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/7717033?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fanantoxa", "html_url": "https://github.com/fanantoxa", "followers_url": "https://api.github.com/users/fanantoxa/followers", "following_url": "https://api.github.com/users/fanantoxa/following{/other_user}", "gists_url": "https://api.github.com/users/fanantoxa/gists{/gist_id}", "starred_url": "https://api.github.com/users/fanantoxa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fanantoxa/subscriptions", "organizations_url": "https://api.github.com/users/fanantoxa/orgs", "repos_url": "https://api.github.com/users/fanantoxa/repos", "events_url": "https://api.github.com/users/fanantoxa/events{/privacy}", "received_events_url": "https://api.github.com/users/fanantoxa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2023-07-11T15:18:06Z", "updated_at": "2023-08-03T16:06:38Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nCurrently `accepts_nested_attributes_for` when it's trying to find existing records in relation it's hardcoded to take a look on `id` column. \r\nProblem is that `id` is not alway a primary key. In our case we have one of tables does not have `id` column at all but uses `uuid` is primary key. \r\nWe've set `self.primary_key = 'uuid'` but `accepts_nested_attributes_for` does not uses this value to use in matching existing records.\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n  end\r\n\r\n  create_table :comments, force: true, id: false do |t|\r\n    t.integer :uuid, primary_key: true\r\n    t.integer :post_id\r\n    t.string :name\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  has_many :comments\r\n\r\n  accepts_nested_attributes_for :comments, allow_destroy: true\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\n  self.primary_key = 'uuid'\r\n\r\n  belongs_to :post\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_association_stuff\r\n    post = Post.create!\r\n    post.comments << Comment.create!(name: 'wonderfull')\r\n\r\n    post.reload\r\n\r\n    assert_equal 1, post.comments.count\r\n    assert_equal 1, Comment.count\r\n    assert_equal post.id, Comment.first.post.id\r\n\r\n    update_posts_data = {\r\n      'id' => post.id,\r\n      'comments_attributes' => [\r\n        {\r\n          'uuid' => Comment.first.uuid,\r\n          'name' => 'Even Better'\r\n        },\r\n        {\r\n          'name' => 'Another comment'\r\n        }\r\n      ]\r\n    }\r\n\r\n    post.assign_attributes(update_posts_data)\r\n\r\n    post.save\r\n\r\n    post.reload\r\n    assert_equal 2, post.comments.count\r\n    assert_equal 2, Comment.count\r\n\r\n    assert_equal post.id, Comment.first.post.id\r\n    assert_equal post.id, Comment.last.post.id\r\n\r\n    assert_equal 'Even Better', Comment.first.name\r\n    assert_equal 'Another comment', Comment.last.name\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\nExisting records are updated and new created.\r\n\r\n### Actual behavior\r\nIt always trying to create new records and hit violation on primary key:\r\n```\r\nActiveRecord::RecordNotUnique: SQLite3::ConstraintException: UNIQUE constraint failed: comments.uuid\r\n```\r\n\r\n### System configuration\r\n**Rails version**: 7.1.0.alpha \r\nBut present in any Rails version\r\n\r\n**Ruby version**: 3.1.2 \r\nBut present in any Ruby version\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48714/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48714/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48713", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48713/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48713/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48713/events", "html_url": "https://github.com/rails/rails/issues/48713", "id": 1799158435, "node_id": "I_kwDNIULOazz6ow", "number": 48713, "title": "Log level in production template doesn't agree with comment", "user": {"login": "jcoyne", "id": 92044, "node_id": "MDQ6VXNlcjkyMDQ0", "avatar_url": "https://avatars.githubusercontent.com/u/92044?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcoyne", "html_url": "https://github.com/jcoyne", "followers_url": "https://api.github.com/users/jcoyne/followers", "following_url": "https://api.github.com/users/jcoyne/following{/other_user}", "gists_url": "https://api.github.com/users/jcoyne/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcoyne/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcoyne/subscriptions", "organizations_url": "https://api.github.com/users/jcoyne/orgs", "repos_url": "https://api.github.com/users/jcoyne/repos", "events_url": "https://api.github.com/users/jcoyne/events{/privacy}", "received_events_url": "https://api.github.com/users/jcoyne/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-11T15:07:11Z", "updated_at": "2023-07-11T15:12:05Z", "closed_at": "2023-07-11T15:12:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Looking at \r\nhttps://github.com/rails/rails/blob/main/railties/lib/rails/generators/rails/app/templates/config/environments/production.rb.tt#L70C1-L73C58\r\n\r\nI see:\r\n> Use \"debug\" for everything.\r\n\r\nBut below that it uses \"info\" as the default. Can these be made consistent?", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48713/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48713/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48712", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48712/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48712/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48712/events", "html_url": "https://github.com/rails/rails/issues/48712", "id": 1798866939, "node_id": "I_kwDNIULOaziH-w", "number": 48712, "title": "Enumerator::Lazy#sum and Enumerator#sum behave differently after Rails 7 update if block relies on side effect", "user": {"login": "goalaleo", "id": 3275302, "node_id": "MDQ6VXNlcjMyNzUzMDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3275302?v=4", "gravatar_id": "", "url": "https://api.github.com/users/goalaleo", "html_url": "https://github.com/goalaleo", "followers_url": "https://api.github.com/users/goalaleo/followers", "following_url": "https://api.github.com/users/goalaleo/following{/other_user}", "gists_url": "https://api.github.com/users/goalaleo/gists{/gist_id}", "starred_url": "https://api.github.com/users/goalaleo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/goalaleo/subscriptions", "organizations_url": "https://api.github.com/users/goalaleo/orgs", "repos_url": "https://api.github.com/users/goalaleo/repos", "events_url": "https://api.github.com/users/goalaleo/events{/privacy}", "received_events_url": "https://api.github.com/users/goalaleo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107186, "node_id": "MDU6TGFiZWwxMDcxODY=", "url": "https://api.github.com/repos/rails/rails/labels/regression", "name": "regression", "color": "e10c02", "default": false, "description": null}, {"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-07-11T12:47:55Z", "updated_at": "2023-07-20T22:28:19Z", "closed_at": "2023-07-20T22:28:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nI'm doing an update from rails `6.1.7.2` to `7.0.6` and some of our tests failed. This seems related to the deprecation of `Enumerable#sum` in Rails 7.\r\n\r\nBasically the problem is that `Enumerator::Lazy#sum` and `Enumerator#sum` - when used without initial value - behave differently if the block relies on a side effect.\r\n```ruby\r\ninput1 = \"\\xEF\\xBB\\xBFinput1\"\r\ninput2 = \"\\xEF\\xBB\\xBFinput2\"\r\n\r\n# returns a lazy enumerator\r\nremove_first_bom = proc do |enum|\r\n  # external state\r\n  first = true\r\n  \r\n  enum.lazy.map do |str|\r\n    if first\r\n      # side effect\r\n      first = false\r\n      str[1..]\r\n    else\r\n      str\r\n    end\r\n  end\r\nend\r\n\r\n# when using deprecated Enumerator::Lazy#sum the BOM bytes [239, 187, 191] are not removed.\r\nremove_first_bom.call([input1, input2]).sum.bytes\r\n=> [239, 187, 191, 105, 110, 112, 117, 116, 49, 239, 187, 191, 105, 110, 112, 117, 116, 50]\r\n\r\n# when using deprecated Enumerator#sum the BOM bytes are removed as expected when\r\n# lazy enumerator is forced to evaluate before using sum\r\nremove_first_bom.call([input1, input2]).force.sum.bytes\r\n=> [105, 110, 112, 117, 116, 49, 239, 187, 191, 105, 110, 112, 117, 116, 50]\r\n\r\n# when the initial value for sum is provided this seems to work, so in that sense not using the deprecated behaviour fixes the issue\r\nremove_first_bom.call([input1, input2]).sum(\"\").bytes\r\n => [105, 110, 112, 117, 116, 49, 239, 187, 191, 105, 110, 112, 117, 116, 50] \r\n```\r\nI suspect that there might be some peeking behaviour which has the side effect of setting `first = false`. I'm pretty sure I saw this when adding `puts` into the conditional.\r\n\r\nI confirmed that this doesn't happen in `6.1.7.2`.\r\n\r\n### Expected behavior\r\n`Enumerator::Lazy#sum` and `Enumerator#sum` should return the same result.\r\n\r\n### Actual behavior\r\n`Enumerator::Lazy#sum` and `Enumerator#sum` return different values if the block relies on a side effect\r\n\r\n### System configuration\r\n**Rails version**: `7.0.6`\r\n\r\n**Ruby version**:  `3.1.2`\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48712/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48712/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48711", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48711/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48711/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48711/events", "html_url": "https://github.com/rails/rails/pull/48711", "id": 1798631060, "node_id": "PR_kwDNIULOVS-l9Q", "number": 48711, "title": "Change form template to use button tag", "user": {"login": "shouichi", "id": 99586, "node_id": "MDQ6VXNlcjk5NTg2", "avatar_url": "https://avatars.githubusercontent.com/u/99586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shouichi", "html_url": "https://github.com/shouichi", "followers_url": "https://api.github.com/users/shouichi/followers", "following_url": "https://api.github.com/users/shouichi/following{/other_user}", "gists_url": "https://api.github.com/users/shouichi/gists{/gist_id}", "starred_url": "https://api.github.com/users/shouichi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shouichi/subscriptions", "organizations_url": "https://api.github.com/users/shouichi/orgs", "repos_url": "https://api.github.com/users/shouichi/repos", "events_url": "https://api.github.com/users/shouichi/events{/privacy}", "received_events_url": "https://api.github.com/users/shouichi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-11T10:32:27Z", "updated_at": "2023-07-11T10:32:31Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48711", "html_url": "https://github.com/rails/rails/pull/48711", "diff_url": "https://github.com/rails/rails/pull/48711.diff", "patch_url": "https://github.com/rails/rails/pull/48711.patch", "merged_at": null}, "body": "Rails 7 uses Turbo/Stimulus by default. Turbo adds disabled attributes when submitting form (see https://github.com/hotwired/turbo/pull/386). As the PR describes, we can change submission text when form is submitted.\r\n\r\n```\r\nbutton                  .show-when-disabled { display: none; }\r\nbutton[disabled]        .show-when-disabled { display: initial; }\r\n\r\nbutton                  .show-when-enabled { display: initial; }\r\nbutton[disabled]        .show-when-enabled { display: none; }\r\n```\r\n\r\n```\r\n<button>\r\n  <span class=\"show-when-enabled\">Submit</span>\r\n  <span class=\"show-when-disabled\">Submitting...</span>\r\n</button>\r\n```\r\n\r\nThis is only possible with the button tag. Because input tag does not allow child elements.\r\n\r\nIt also seems like that button tags are preferred way nowadays.\r\n\r\n> https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/button\r\n> Note: While <input> elements of type button are still perfectly valid\r\n> HTML, the newer <button> element is now the favored way to create\r\n> buttons. Given that a <button>'s label text is inserted between the\r\n> opening and closing tags, you can include HTML in the label, even\r\n> images.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48711/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48711/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48710", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48710/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48710/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48710/events", "html_url": "https://github.com/rails/rails/issues/48710", "id": 1797778702, "node_id": "I_kwDNIULOayftDg", "number": 48710, "title": "`PooledConnectionsTest#test_pooled_connection_checkin_one` fails", "user": {"login": "yahonda", "id": 73684, "node_id": "MDQ6VXNlcjczNjg0", "avatar_url": "https://avatars.githubusercontent.com/u/73684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yahonda", "html_url": "https://github.com/yahonda", "followers_url": "https://api.github.com/users/yahonda/followers", "following_url": "https://api.github.com/users/yahonda/following{/other_user}", "gists_url": "https://api.github.com/users/yahonda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yahonda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yahonda/subscriptions", "organizations_url": "https://api.github.com/users/yahonda/orgs", "repos_url": "https://api.github.com/users/yahonda/repos", "events_url": "https://api.github.com/users/yahonda/events{/privacy}", "received_events_url": "https://api.github.com/users/yahonda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 776781281, "node_id": "MDU6TGFiZWw3NzY3ODEyODE=", "url": "https://api.github.com/repos/rails/rails/labels/ci%20issues", "name": "ci issues", "color": "aaafff", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-10T23:34:52Z", "updated_at": "2023-07-11T17:09:56Z", "closed_at": "2023-07-11T17:09:56Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Managed to reproduce CI failure https://buildkite.com/rails/rails/builds/97935#01893f03-cf32-468a-b1f2-c963b9092bfe\r\n\r\n### Steps to reproduce\r\n```ruby\r\ngit clone https://github.com/rails/rails\r\ncd rails\r\nrm Gemfile.lock\r\nbundle install\r\ncd activerecord\r\nbin/test test/cases/connection_adapters/connection_handler_test.rb test/cases/pooled_connections_test.rb -n \"/^(?:ActiveRecord::ConnectionAdapters::ConnectionHandlerTest#(?:test_remove_connection_with_name_argument_is_deprecated)|PooledConnectionsTest#(?:test_pooled_connection_checkin_one))$/\" --seed 9221\r\n```\r\n\r\n### Expected behavior\r\nIt should pass.\r\n\r\n### Actual behavior\r\nIt gets the error as follows.\r\n\r\n```ruby\r\n$ bin/test test/cases/connection_adapters/connection_handler_test.rb test/cases/pooled_connections_test.rb -n \"/^(?:ActiveRecord::ConnectionAdapters::ConnectionHandlerTest#(?:test_remove_connection_with_name_argument_is_deprecated)|PooledConnectionsTest#(?:test_pooled_connection_checkin_one))$/\" --seed 9221\r\nUsing sqlite3\r\nRun options: -n \"/^(?:ActiveRecord::ConnectionAdapters::ConnectionHandlerTest#(?:test_remove_connection_with_name_argument_is_deprecated)|PooledConnectionsTest#(?:test_pooled_connection_checkin_one))$/\" --seed 9221\r\n\r\n# Running:\r\n\r\n.E\r\n\r\nError:\r\nPooledConnectionsTest#test_pooled_connection_checkin_one:\r\nNoMethodError: undefined method `configuration_hash' for nil:NilClass\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/test/cases/pooled_connections_test.rb:13:in `setup'\r\n\r\nError:\r\nPooledConnectionsTest#test_pooled_connection_checkin_one:\r\nActiveRecord::AdapterNotSpecified: The `test` database is not configured for the `test` environment.\r\n\r\n  Available database configurations are:\r\n\r\n  arunit\r\narunit2\r\narunit_without_prepared_statements\r\n\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/lib/active_record/database_configurations.rb:229:in `resolve_symbol_connection'\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/lib/active_record/database_configurations.rb:179:in `resolve'\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/lib/active_record/connection_handling.rb:354:in `resolve_config_for_connection'\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/lib/active_record/connection_handling.rb:52:in `establish_connection'\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/test/cases/pooled_connections_test.rb:18:in `block in <class:PooledConnectionsTest>'\r\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:448:in `instance_exec'\r\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:448:in `block in make_lambda'\r\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:274:in `block in simple'\r\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:602:in `block in invoke_after'\r\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:602:in `each'\r\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:602:in `invoke_after'\r\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/callbacks.rb:111:in `run_callbacks'\r\n    /home/yahonda/src/github.com/rails/rails/activesupport/lib/active_support/testing/setup_and_teardown.rb:46:in `after_teardown'\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/lib/active_record/test_fixtures.rb:15:in `after_teardown'\r\n\r\n\r\nbin/test test/cases/pooled_connections_test.rb:53\r\n\r\n\r\n\r\nFinished in 0.015183s, 131.7268 runs/s, 263.4535 assertions/s.\r\n2 runs, 4 assertions, 0 failures, 1 errors, 0 skips\r\n$\r\n```\r\n\r\n\r\n### System configuration\r\n**Rails version**: main branch\r\n\r\n**Ruby version**:ruby 3.2.2 (2023-03-30 revision e51014f9c0) [x86_64-linux]\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48710/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48710/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48709", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48709/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48709/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48709/events", "html_url": "https://github.com/rails/rails/pull/48709", "id": 1797049061, "node_id": "PR_kwDNIULOVRoHCg", "number": 48709, "title": "Igsr5 patch 1", "user": {"login": "igsr5", "id": 66525257, "node_id": "MDQ6VXNlcjY2NTI1MjU3", "avatar_url": "https://avatars.githubusercontent.com/u/66525257?v=4", "gravatar_id": "", "url": "https://api.github.com/users/igsr5", "html_url": "https://github.com/igsr5", "followers_url": "https://api.github.com/users/igsr5/followers", "following_url": "https://api.github.com/users/igsr5/following{/other_user}", "gists_url": "https://api.github.com/users/igsr5/gists{/gist_id}", "starred_url": "https://api.github.com/users/igsr5/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/igsr5/subscriptions", "organizations_url": "https://api.github.com/users/igsr5/orgs", "repos_url": "https://api.github.com/users/igsr5/repos", "events_url": "https://api.github.com/users/igsr5/events{/privacy}", "received_events_url": "https://api.github.com/users/igsr5/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-10T15:46:11Z", "updated_at": "2023-07-10T15:50:26Z", "closed_at": "2023-07-10T15:46:17Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48709", "html_url": "https://github.com/rails/rails/pull/48709", "diff_url": "https://github.com/rails/rails/pull/48709.diff", "patch_url": "https://github.com/rails/rails/pull/48709.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because [REPLACE ME]\r\n\r\n### Detail\r\n\r\nThis Pull Request changes [REPLACE ME]\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [ ] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48709/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48709/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48708", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48708/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48708/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48708/events", "html_url": "https://github.com/rails/rails/pull/48708", "id": 1797014345, "node_id": "PR_kwDNIULOVRmRGA", "number": 48708, "title": "Remove connected? check from db_runtime payload", "user": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-10T15:25:07Z", "updated_at": "2023-07-11T16:33:16Z", "closed_at": "2023-07-10T15:44:34Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48708", "html_url": "https://github.com/rails/rails/pull/48708", "diff_url": "https://github.com/rails/rails/pull/48708.diff", "patch_url": "https://github.com/rails/rails/pull/48708.patch", "merged_at": "2023-07-10T15:44:34Z"}, "body": "The check for `Base.connected?` was added in\r\nhttps://github.com/rails/rails/commit/4ecdf24bdedfdd1cca1f079259ff2490e2074067. At the time this change was made, we were calling\r\n`Base.connection.reset_runtime` so it made sense to check if the database was connected. Since\r\nhttps://github.com/rails/rails/commit/dd61a817dea85990f13664d74bca15bc5796b76e we have stored that information in a thread instead, negating the need to check `Base.connected?`.\r\n\r\nThe problem with checking `Base.connected?` is that in a multi-db application this will return `false` for any model running a query not inheriting from `Base`, leaving the `db_runtime` payload `nil`. Since the information we need is stored in a thread rather than on the connection directly we can remove the `Base.connected?` check.\r\n\r\nFixes #48687", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48708/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48708/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48707", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48707/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48707/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48707/events", "html_url": "https://github.com/rails/rails/pull/48707", "id": 1796933183, "node_id": "PR_kwDNIULOVRh1mw", "number": 48707, "title": "Improve QueryCacheMutableParamTest", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-10T14:43:02Z", "updated_at": "2023-07-10T15:03:44Z", "closed_at": "2023-07-10T15:03:44Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48707", "html_url": "https://github.com/rails/rails/pull/48707", "diff_url": "https://github.com/rails/rails/pull/48707.diff", "patch_url": "https://github.com/rails/rails/pull/48707.patch", "merged_at": "2023-07-10T15:03:44Z"}, "body": "By using a Hash subclass, we hit a branch that dup the value in PredicateBuilder, rendering the test useless.\r\n\r\nRef: https://github.com/rails/rails/pull/46048\r\nRef: https://github.com/sholden/rails/blob/c5a99e044e81ce53e2c3472d0478dce24a3f21eb/activerecord/lib/active_record/relation/predicate_builder.rb#L153-L158\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48707/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48707/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48706", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48706/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48706/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48706/events", "html_url": "https://github.com/rails/rails/pull/48706", "id": 1796875226, "node_id": "PR_kwDNIULOVReq8g", "number": 48706, "title": "Delegate `StubConnection#pubsub` and `StubConnection#config` to `ActionCable.server`", "user": {"login": "julianfssen", "id": 25947043, "node_id": "MDQ6VXNlcjI1OTQ3MDQz", "avatar_url": "https://avatars.githubusercontent.com/u/25947043?v=4", "gravatar_id": "", "url": "https://api.github.com/users/julianfssen", "html_url": "https://github.com/julianfssen", "followers_url": "https://api.github.com/users/julianfssen/followers", "following_url": "https://api.github.com/users/julianfssen/following{/other_user}", "gists_url": "https://api.github.com/users/julianfssen/gists{/gist_id}", "starred_url": "https://api.github.com/users/julianfssen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/julianfssen/subscriptions", "organizations_url": "https://api.github.com/users/julianfssen/orgs", "repos_url": "https://api.github.com/users/julianfssen/repos", "events_url": "https://api.github.com/users/julianfssen/events{/privacy}", "received_events_url": "https://api.github.com/users/julianfssen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-10T14:12:44Z", "updated_at": "2023-07-17T14:43:21Z", "closed_at": "2023-07-17T11:25:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48706", "html_url": "https://github.com/rails/rails/pull/48706", "diff_url": "https://github.com/rails/rails/pull/48706.diff", "patch_url": "https://github.com/rails/rails/pull/48706.patch", "merged_at": "2023-07-17T11:25:00Z"}, "body": "### Motivation / Background\r\n\r\nPreviously, `ActionCable::Channel::ConnectionStub` would throw a `NoMethodError` when the channel under test calls `stop_stream_from`, as shown in the test case below:\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"actioncable\", \"~> 7.0.0\"\r\nend\r\n\r\nrequire \"minitest/autorun\"\r\nrequire \"action_cable\"\r\n\r\nActionCable.server.config.cable = { \"adapter\" => \"test\" }\r\n\r\nclass ChatChannel < ActionCable::Channel::Base\r\n  def subscribed\r\n    stream_from \"test\"\r\n  end \r\n\r\n  def unsubscribed\r\n    stop_stream_from \"test\"\r\n  end \r\nend\r\n\r\nclass ChatChannelTest < ActionCable::Channel::TestCase\r\n  test \"unsubscribe\" do\r\n    stub_connection\r\n\r\n    subscribe\r\n    unsubscribe # raises a NoMethodError\r\n\r\n    assert_no_streams\r\n  end \r\nend\r\n```\r\n\r\nThis happens because `stop_stream_from` [calls `pubsub` when unsubscribing from a channel](https://github.com/rails/rails/blob/593893c901f87b4ed205751f72df41519b4d2da3/actioncable/lib/action_cable/channel/streams.rb#L109), which is missing from the [`ConnectionStub` implementation](https://github.com/rails/rails/blob/593893c901f87b4ed205751f72df41519b4d2da3/actioncable/lib/action_cable/channel/test_case.rb#L47).\r\n\r\n### Detail\r\n\r\nThis PR fixes this issue by assigning the `ActionCable.server` singleton to a `@server` instance variable in\r\n`ActionCable::Channel::ConnectionStub`. \r\n\r\nThis lets us delegate the `config` and `pubsub` method calls to it, hence fixing the `NoMethodError` issue.\r\n\r\nI updated `config` to be delegated to `@server` as well since [`config` defaults to `ActionCable::Server::Configuration.new`](https://github.com/rails/rails/blob/593893c901f87b4ed205751f72df41519b4d2da3/actioncable/lib/action_cable/server/base.rb#L15).\r\n\r\nWe do something similar in `ActionCable::TestHelper#pubsub_adapter` as well: https://github.com/rails/rails/blob/13cff7e197ae6b22b0e9ab438fdc412bdf9939e1/actioncable/lib/action_cable/test_helper.rb#L133-L135\r\n\r\n### Additional information\r\n\r\nI'm not sure if I should add a changelog entry for this. But, I added it anyway since I feel adding`@server = ActionCable.server` qualifies as a behavior change.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48706/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48706/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48705", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48705/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48705/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48705/events", "html_url": "https://github.com/rails/rails/pull/48705", "id": 1796813346, "node_id": "PR_kwDNIULOVRbSwg", "number": 48705, "title": "Stop deep duping query values of serialized attributes", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-07-10T13:41:25Z", "updated_at": "2023-07-13T09:58:35Z", "closed_at": "2023-07-13T09:58:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48705", "html_url": "https://github.com/rails/rails/pull/48705", "diff_url": "https://github.com/rails/rails/pull/48705.diff", "patch_url": "https://github.com/rails/rails/pull/48705.patch", "merged_at": null}, "body": "Fix: https://github.com/rails/rails/issues/48652\r\nRef: https://github.com/rails/rails/pull/46048\r\nRef: https://github.com/rails/rails/issues/46044\r\nRef: https://github.com/rails/rails/pull/34303\r\nRef: https://github.com/rails/rails/pull/39160\r\n\r\nThis deep_dup was introduced to prevent the value stored in the query cache to be later mutated.\r\n\r\nThe problem is that `ActiveRecord::Base#dup` will return a copy of the record but with the primary key set to nil. One could argue that `#dup` shouldn't behave this way, but I think this ship has sailed (or has it?).\r\n\r\nMy initial fix was to instead call `type.cast` so that we'd dup serialized types in a more correct way. However there is a test that explictly ensure this doesn't happen: https://github.com/rails/rails/pull/39160\r\n\r\nThe reason isn't 100% clear to me, but if I get it correctly, it's to avoid a potentially costly operation upfront.\r\n\r\nSo instead we can call `deserialize(serialize(value))` for serialized attributes only.\r\n\r\nThis isn't very performant, but honestly it's kind of a miracle this even work. Querying by a serialized attribute is a very weird idea.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48705/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48705/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48704", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48704/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48704/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48704/events", "html_url": "https://github.com/rails/rails/issues/48704", "id": 1796785249, "node_id": "I_kwDNIULOaxjEYQ", "number": 48704, "title": "`filter_parameters` used by `active_record.set_filter_attributes` initializer before it is set", "user": {"login": "nicholasdower", "id": 9117775, "node_id": "MDQ6VXNlcjkxMTc3NzU=", "avatar_url": "https://avatars.githubusercontent.com/u/9117775?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nicholasdower", "html_url": "https://github.com/nicholasdower", "followers_url": "https://api.github.com/users/nicholasdower/followers", "following_url": "https://api.github.com/users/nicholasdower/following{/other_user}", "gists_url": "https://api.github.com/users/nicholasdower/gists{/gist_id}", "starred_url": "https://api.github.com/users/nicholasdower/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nicholasdower/subscriptions", "organizations_url": "https://api.github.com/users/nicholasdower/orgs", "repos_url": "https://api.github.com/users/nicholasdower/repos", "events_url": "https://api.github.com/users/nicholasdower/events{/privacy}", "received_events_url": "https://api.github.com/users/nicholasdower/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-07-10T13:27:37Z", "updated_at": "2023-07-13T17:54:24Z", "closed_at": "2023-07-13T17:54:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "A sample project which demonstrates this issue can be found here: https://github.com/nicholasdower/filter_parameters_issue\r\n\r\n### Steps to reproduce\r\n\r\n- Set `filter_parameters` in a Rails app to prevent a field in an `ActiveRecord` class from being logged.\r\n- Start the application.\r\n- Log an instance of the `ActiveRecord` class.\r\n\r\n### Expected behavior\r\n\r\nThe ActiveRecord object should be filtered based on the `filter_parameters`.\r\n\r\n### Actual behavior\r\n\r\nThe ActiveRecord object is not filtered based on the `filter_parameters`.\r\n\r\n### Potential Cause\r\n\r\nAfaict, this is due to the fact that:\r\n\r\n- `active_record/railtie` requires `rails` (See [here](https://github.com/rails/rails/blob/7b52f56/activerecord/lib/active_record/railtie.rb#L4))\r\n- `rails` requires `rails/application` (See [here](https://github.com/rails/rails/blob/7b52f569c1a05d3c988540a2fc1ccef40165a59c/railties/lib/rails.rb#L15))\r\n- `rails/application` requires `rails/engine` (See [here](https://github.com/rails/rails/blob/7b52f569c1a05d3c988540a2fc1ccef40165a59c/railties/lib/rails/application.rb#L12))\r\n- `rails/engine` adds the initializer `load_config_initializers` (See [here](https://github.com/rails/rails/blob/7b52f569c1a05d3c988540a2fc1ccef40165a59c/railties/lib/rails/engine.rb#L634))\r\n- `active_record/railtie` then adds the initializer `active_record.set_filter_attributes` (See [here](https://github.com/rails/rails/blob/7b52f56/activerecord/lib/active_record/railtie.rb#L339))\r\n\r\nThis means `active_record.set_filter_attributes` will run before `load_config_initializers`. But `active_record.set_filter_attributes` uses `Rails.application.config.filter_parameters` (See [here](https://github.com/rails/rails/blob/7b52f56/activerecord/lib/active_record/railtie.rb#L341)) which is supposed to be set by a config initializer (per https://guides.rubyonrails.org/configuring.html#config-filter-parameters).\r\n\r\n### System configuration\r\n**Rails version**: `7.0.4.3`\r\n\r\n**Ruby version**: `3.2.2`\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48704/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48704/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48703", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48703/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48703/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48703/events", "html_url": "https://github.com/rails/rails/pull/48703", "id": 1796554345, "node_id": "PR_kwDNIULOVRM_xg", "number": 48703, "title": "Adding a new resource to the Security documentation", "user": {"login": "gmontard", "id": 380564, "node_id": "MDQ6VXNlcjM4MDU2NA==", "avatar_url": "https://avatars.githubusercontent.com/u/380564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gmontard", "html_url": "https://github.com/gmontard", "followers_url": "https://api.github.com/users/gmontard/followers", "following_url": "https://api.github.com/users/gmontard/following{/other_user}", "gists_url": "https://api.github.com/users/gmontard/gists{/gist_id}", "starred_url": "https://api.github.com/users/gmontard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gmontard/subscriptions", "organizations_url": "https://api.github.com/users/gmontard/orgs", "repos_url": "https://api.github.com/users/gmontard/repos", "events_url": "https://api.github.com/users/gmontard/events{/privacy}", "received_events_url": "https://api.github.com/users/gmontard/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-10T11:25:04Z", "updated_at": "2023-08-17T15:10:12Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48703", "html_url": "https://github.com/rails/rails/pull/48703", "diff_url": "https://github.com/rails/rails/pull/48703.diff", "patch_url": "https://github.com/rails/rails/pull/48703.patch", "merged_at": null}, "body": "\r\n\r\n### Motivation / Background\r\n\r\nThis Pull Request has been created because providing developer friendly security and privacy tooling is so important.\r\n\r\n### Detail\r\n\r\nAdding [Bearer](https://github.com/Bearer/bearer) open-source tool to the resources section as an alternative to Brakeman. It covers both Ruby and JS code, which is practical for modern Rails application.\r\n\r\n### Additional information\r\n\r\nThis tool is also referenced by OWASP in the [Rails cheat sheet](https://cheatsheetseries.owasp.org/cheatsheets/Ruby_on_Rails_Cheat_Sheet.html#tools).\r\n \r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48703/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48703/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48702", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48702/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48702/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48702/events", "html_url": "https://github.com/rails/rails/issues/48702", "id": 1796160982, "node_id": "I_kwDNIULOaw891g", "number": 48702, "title": "FormData requests with empty body lead to 400 Bad Reqeust", "user": {"login": "mmaier", "id": 765257, "node_id": "MDQ6VXNlcjc2NTI1Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/765257?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mmaier", "html_url": "https://github.com/mmaier", "followers_url": "https://api.github.com/users/mmaier/followers", "following_url": "https://api.github.com/users/mmaier/following{/other_user}", "gists_url": "https://api.github.com/users/mmaier/gists{/gist_id}", "starred_url": "https://api.github.com/users/mmaier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mmaier/subscriptions", "organizations_url": "https://api.github.com/users/mmaier/orgs", "repos_url": "https://api.github.com/users/mmaier/repos", "events_url": "https://api.github.com/users/mmaier/events{/privacy}", "received_events_url": "https://api.github.com/users/mmaier/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-10T07:28:28Z", "updated_at": "2023-08-07T08:15:42Z", "closed_at": "2023-08-07T08:15:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nsend a FormData request (content-type: multipart/form-data; boundary= ...) with no content but only the boundary string as body.\r\n\r\n### Expected behavior\r\nRequest should proceed as before\r\n\r\n### Actual behavior\r\nActionPack parser throws error (Empty content) -> 400 Bad Request\r\n\r\n### System configuration\r\n**Rails version**: 7.0.0\r\n\r\n**Ruby version**: 3.1.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48702/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48702/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48701", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48701/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48701/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48701/events", "html_url": "https://github.com/rails/rails/issues/48701", "id": 1795616922, "node_id": "I_kwDNIULOawbwmg", "number": 48701, "title": "Rails CI `activesupport (3.1)` runs `3.3.0p-1 (2023-07-06 revision 75f8781c08da421d6bcfb2c3c8b7b74efea3bec2) [x86_64-linux]`", "user": {"login": "yahonda", "id": 73684, "node_id": "MDQ6VXNlcjczNjg0", "avatar_url": "https://avatars.githubusercontent.com/u/73684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yahonda", "html_url": "https://github.com/yahonda", "followers_url": "https://api.github.com/users/yahonda/followers", "following_url": "https://api.github.com/users/yahonda/following{/other_user}", "gists_url": "https://api.github.com/users/yahonda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yahonda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yahonda/subscriptions", "organizations_url": "https://api.github.com/users/yahonda/orgs", "repos_url": "https://api.github.com/users/yahonda/repos", "events_url": "https://api.github.com/users/yahonda/events{/privacy}", "received_events_url": "https://api.github.com/users/yahonda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 776781281, "node_id": "MDU6TGFiZWw3NzY3ODEyODE=", "url": "https://api.github.com/repos/rails/rails/labels/ci%20issues", "name": "ci issues", "color": "aaafff", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-07-09T22:52:52Z", "updated_at": "2023-07-10T23:40:40Z", "closed_at": "2023-07-10T23:15:05Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "While investigating CI failure https://buildkite.com/rails/rails/builds/97870#01892cc9-5038-4065-a6d5-56e973eda905 , it should run Ruby 3.1 as it says  `activesupport (3.1)`, it actually run `3.3.0p-1 (2023-07-06 revision 75f8781c08da421d6bcfb2c3c8b7b74efea3bec2) [x86_64-linux]`\r\n\r\n### Steps to reproduce\r\nOpen one of the recent failed build https://buildkite.com/rails/rails/builds/97870#01892cc9-5038-4065-a6d5-56e973eda905\r\n\r\n### Expected behavior\r\nIt should pass and it should use the Ruby 3.1.\r\n\r\n### Actual behavior\r\nThe Ruby version is `Ruby          3.3.0p-1 (2023-07-06 revision 75f8781c08da421d6bcfb2c3c8b7b74efea3bec2) [x86_64-linux]`\r\n\r\n### System configuration\r\n**Rails version**: main\r\n\r\n**Ruby version**:3.3.0p-1 (2023-07-06 revision 75f8781c08da421d6bcfb2c3c8b7b74efea3bec2) [x86_64-linux]\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48701/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48701/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48700", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48700/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48700/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48700/events", "html_url": "https://github.com/rails/rails/pull/48700", "id": 1795570078, "node_id": "PR_kwDNIULOVQXNrg", "number": 48700, "title": "Update inconsistent documentation for `#structurally_compatible?`, `#and` and `#or`", "user": {"login": "joshuay03", "id": 54629302, "node_id": "MDQ6VXNlcjU0NjI5MzAy", "avatar_url": "https://avatars.githubusercontent.com/u/54629302?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshuay03", "html_url": "https://github.com/joshuay03", "followers_url": "https://api.github.com/users/joshuay03/followers", "following_url": "https://api.github.com/users/joshuay03/following{/other_user}", "gists_url": "https://api.github.com/users/joshuay03/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshuay03/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshuay03/subscriptions", "organizations_url": "https://api.github.com/users/joshuay03/orgs", "repos_url": "https://api.github.com/users/joshuay03/repos", "events_url": "https://api.github.com/users/joshuay03/events{/privacy}", "received_events_url": "https://api.github.com/users/joshuay03/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-09T21:24:03Z", "updated_at": "2023-07-18T06:35:49Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48700", "html_url": "https://github.com/rails/rails/pull/48700", "diff_url": "https://github.com/rails/rails/pull/48700.diff", "patch_url": "https://github.com/rails/rails/pull/48700.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created to update some inconsistent documentation for the public methods  `ActiveRecord::QueryMethods#structurally_compatible?`, `ActiveRecord::QueryMethods#and?` and `ActiveRecord::QueryMethods#or?`.\r\n\r\n### Detail\r\n\r\nIn https://github.com/rails/rails/pull/39634, `#structurally_incompatible_values_for` was updated so that a given relation is only considered structurally incompatible to the current relation if it explicitly uses multi value relation value methods that either vary from (eg. joining on a different table) or are not included in the current relation.\r\n\r\nThe public method `#structurally_compatible?` was affected by this change but currently has an example in its documentation that is inconsistent with the current functionality:\r\n\r\n**Expected:**\r\nhttps://github.com/rails/rails/blob/a5fc471b3f4bbd02e6be38dae023526a49e7d049/activerecord/lib/active_record/relation/query_methods.rb#L1011-L1012\r\n\r\n**Actual**\r\n```ruby\r\nPost.joins(:comments).structurally_compatible?(Post.where(\"id = 1\"))\r\n# => true\r\n```\r\n\r\nThe descriptions for `#structurally_compatible?`, `#and` and `#or` also imply that the two relations need to include the exact same relation value methods, which is no longer true.\r\n\r\nThis PR simply updates the documentation for these methods so that:\r\n1. The 'new' functionality is reflected in the descriptions.\r\n2. The incorrect result for the example in `#structurally_compatible?` is fixed.\r\n\r\nI've also added 2 more examples to `#structurally_compatible?` to make the expected output clearer.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\nOriginally, I opened this issue https://github.com/rails/rails/issues/48694 and a PR https://github.com/rails/rails/pull/48695 to address it by reverting the changes in https://github.com/rails/rails/pull/39634. However, I concluded that:\r\n- The changes and reasoning in https://github.com/rails/rails/pull/39634 make sense in that a majority of the time the given relation will probably just vary by `#where`. I was a bit on the fence at first cause I felt like consistently raising an error here might prevent unexpected query results and provide a more meaningful error than the ones you might get due to a malformed query (like referencing a table in the given relation that's only been joined to in the current relation), but at the same time I can see how that approach can be considered to be a bit too heavy handed.\r\n- https://github.com/rails/rails/pull/39634 was merged 3 years ago and I don't see any other open issues relating to it, so I think it's more reasonable to just update the documentation at this point than to revert the changes in that PR which might result in breaking changes on apps running on edge or when upgrading to the version this commit ends up in.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48700/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48700/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48699", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48699/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48699/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48699/events", "html_url": "https://github.com/rails/rails/pull/48699", "id": 1795522921, "node_id": "PR_kwDNIULOVQU5zg", "number": 48699, "title": "AbstractController#internal_methods: ignore action_methods", "user": {"login": "kamil-gwozdz", "id": 15572959, "node_id": "MDQ6VXNlcjE1NTcyOTU5", "avatar_url": "https://avatars.githubusercontent.com/u/15572959?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kamil-gwozdz", "html_url": "https://github.com/kamil-gwozdz", "followers_url": "https://api.github.com/users/kamil-gwozdz/followers", "following_url": "https://api.github.com/users/kamil-gwozdz/following{/other_user}", "gists_url": "https://api.github.com/users/kamil-gwozdz/gists{/gist_id}", "starred_url": "https://api.github.com/users/kamil-gwozdz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kamil-gwozdz/subscriptions", "organizations_url": "https://api.github.com/users/kamil-gwozdz/orgs", "repos_url": "https://api.github.com/users/kamil-gwozdz/repos", "events_url": "https://api.github.com/users/kamil-gwozdz/events{/privacy}", "received_events_url": "https://api.github.com/users/kamil-gwozdz/received_events", "type": "User", "site_admin": true}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-09T19:03:22Z", "updated_at": "2023-07-31T16:56:35Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48699", "html_url": "https://github.com/rails/rails/pull/48699", "diff_url": "https://github.com/rails/rails/pull/48699.diff", "patch_url": "https://github.com/rails/rails/pull/48699.patch", "merged_at": null}, "body": "This PR fixes `AbstractController#internal_methods` to exclude `action_methods`.\r\n\r\n### Motivation / Background\r\n\r\nI tried enabling [`raise_on_missing_callback_actions`](https://github.com/rails/rails/pull/43487) and I found out that `MyController#action_methods` is missing a method that `MyController` actually defines. It only happens when a method is also defined by an ancestor abstract controller.\r\n\r\nxref https://github.com/rails/rails/pull/48559#issuecomment-1624321279\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48699/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48699/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48698", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48698/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48698/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48698/events", "html_url": "https://github.com/rails/rails/pull/48698", "id": 1795372221, "node_id": "PR_kwDNIULOVQNdcQ", "number": 48698, "title": "Add a load hook for `ActiveModel::Model`", "user": {"login": "lewispb", "id": 1773614, "node_id": "MDQ6VXNlcjE3NzM2MTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1773614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lewispb", "html_url": "https://github.com/lewispb", "followers_url": "https://api.github.com/users/lewispb/followers", "following_url": "https://api.github.com/users/lewispb/following{/other_user}", "gists_url": "https://api.github.com/users/lewispb/gists{/gist_id}", "starred_url": "https://api.github.com/users/lewispb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lewispb/subscriptions", "organizations_url": "https://api.github.com/users/lewispb/orgs", "repos_url": "https://api.github.com/users/lewispb/repos", "events_url": "https://api.github.com/users/lewispb/events{/privacy}", "received_events_url": "https://api.github.com/users/lewispb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-09T12:06:07Z", "updated_at": "2023-07-10T08:47:49Z", "closed_at": "2023-07-10T08:43:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48698", "html_url": "https://github.com/rails/rails/pull/48698", "diff_url": "https://github.com/rails/rails/pull/48698.diff", "patch_url": "https://github.com/rails/rails/pull/48698.patch", "merged_at": "2023-07-10T08:43:53Z"}, "body": "\r\n\r\n### Motivation / Background\r\n\r\n`ActiveRecord::Base` has a dedicated ActiveSupport load hook. This adds a hook for `ActiveModel::Model`, so that when ActiveModel is being used without ActiveRecord, it can still be modified.\r\n\r\nKredis would be able to use this hook [here](https://github.com/rails/kredis/blob/6e4f77ca7745efe0878bb408c1242db58d99caf8/lib/kredis/railtie.rb#L25-L27). Instead of:\r\n\r\n```rb\r\nconfig.after_initialize do\r\n  ActiveModel::Model.include Kredis::Attributes if defined?(ActiveModel::Model)\r\nend\r\n```\r\n\r\nwe could write\r\n\r\n```rb\r\nActiveSupport.on_load(:active_model) do\r\n  include Kredis::Attributes\r\nend\r\n```\r\n\r\nThis change would help fix a reported issue at https://github.com/rails/kredis/issues/60.\r\n\r\n### Detail\r\n\r\nSee the motivating issue at https://github.com/rails/kredis/issues/60 and additional comment by @fxn here: https://github.com/rails/kredis/issues/60#issuecomment-1045966571\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48698/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48698/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48697", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48697/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48697/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48697/events", "html_url": "https://github.com/rails/rails/pull/48697", "id": 1795321710, "node_id": "PR_kwDNIULOVQK43w", "number": 48697, "title": "[7-0-stable] Backport: Remove no connection primary key test", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-09T09:54:22Z", "updated_at": "2023-07-11T01:05:47Z", "closed_at": "2023-07-10T13:11:42Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48697", "html_url": "https://github.com/rails/rails/pull/48697", "diff_url": "https://github.com/rails/rails/pull/48697.diff", "patch_url": "https://github.com/rails/rails/pull/48697.patch", "merged_at": "2023-07-10T13:11:42Z"}, "body": "Backports #48488 to `7-0-stable`.\r\n\r\nIt wasn't a clean cherry-pick, so commit by hand. :pray:\r\n\r\n/cc @eileencodes", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48697/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48697/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48696", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48696/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48696/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48696/events", "html_url": "https://github.com/rails/rails/issues/48696", "id": 1795296330, "node_id": "I_kwDNIULOawIMSg", "number": 48696, "title": "Line filtering doesn't work for plugin tests", "user": {"login": "lewispb", "id": 1773614, "node_id": "MDQ6VXNlcjE3NzM2MTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1773614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lewispb", "html_url": "https://github.com/lewispb", "followers_url": "https://api.github.com/users/lewispb/followers", "following_url": "https://api.github.com/users/lewispb/following{/other_user}", "gists_url": "https://api.github.com/users/lewispb/gists{/gist_id}", "starred_url": "https://api.github.com/users/lewispb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lewispb/subscriptions", "organizations_url": "https://api.github.com/users/lewispb/orgs", "repos_url": "https://api.github.com/users/lewispb/repos", "events_url": "https://api.github.com/users/lewispb/events{/privacy}", "received_events_url": "https://api.github.com/users/lewispb/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-09T08:29:24Z", "updated_at": "2023-07-13T07:42:52Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\n- Checkout [rails/kredis](https://github.com/rails/kredis)\r\n- Run `bin/test test/attributes_test.rb:82`\r\n\r\n### Expected behavior\r\n\r\nOnly one test runs\r\n\r\n### Actual behavior\r\n\r\nAll tests in test/attributes_test.rb run\r\n\r\n### More info\r\n\r\nI've fixed this for Kredis only, in this PR: https://github.com/rails/kredis/pull/122\r\n\r\nKredis has a standard `require \"rails/plugin/test\"` in `bin/test`.\r\n\r\n[`rails/plugin/test`](https://github.com/rails/rails/blob/main/railties/lib/rails/plugin/test.rb) does not support line filtering in the same way line filtering is installed for Rails apps or [Rails itself](https://github.com/rails/rails/blob/main/tools/test.rb#L9).\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48696/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48696/timeline", "performed_via_github_app": null, "state_reason": "reopened"}, {"url": "https://api.github.com/repos/rails/rails/issues/48695", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48695/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48695/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48695/events", "html_url": "https://github.com/rails/rails/pull/48695", "id": 1795198692, "node_id": "PR_kwDNIULOVQFHWg", "number": 48695, "title": "[Fix #48694] Ensure `ArgumentError` is always raised on structurally incompatible relations with `#or`", "user": {"login": "joshuay03", "id": 54629302, "node_id": "MDQ6VXNlcjU0NjI5MzAy", "avatar_url": "https://avatars.githubusercontent.com/u/54629302?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshuay03", "html_url": "https://github.com/joshuay03", "followers_url": "https://api.github.com/users/joshuay03/followers", "following_url": "https://api.github.com/users/joshuay03/following{/other_user}", "gists_url": "https://api.github.com/users/joshuay03/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshuay03/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshuay03/subscriptions", "organizations_url": "https://api.github.com/users/joshuay03/orgs", "repos_url": "https://api.github.com/users/joshuay03/repos", "events_url": "https://api.github.com/users/joshuay03/events{/privacy}", "received_events_url": "https://api.github.com/users/joshuay03/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-09T02:01:13Z", "updated_at": "2023-07-09T20:59:05Z", "closed_at": "2023-07-09T20:58:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48695", "html_url": "https://github.com/rails/rails/pull/48695", "diff_url": "https://github.com/rails/rails/pull/48695.diff", "patch_url": "https://github.com/rails/rails/pull/48695.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nFixes #48694.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes `#structurally_incompatible_values_for` to always compare the relation value methods in the two relations when using `#or` and raise when they're incompatible. I've pretty much just reverted the changes [in this PR](https://github.com/rails/rails/pull/39634), meaning that the tests added/amended there will begin to fail.\r\n\r\nThe only tests introduced in that PR seem to be when unscoping ordering inside `#or` but the related changes allow for any incompatible structure so long as it's not explicitly set inside inside `#or`. This 'fix' is pending feedback on whether such cases should raise an error or whether the changes introduced in that PR are valid.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48695/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48695/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48694", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48694/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48694/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48694/events", "html_url": "https://github.com/rails/rails/issues/48694", "id": 1795195618, "node_id": "I_kwDNIULOawCC4g", "number": 48694, "title": "`#or` not raising with some structurally incompatible relations", "user": {"login": "joshuay03", "id": 54629302, "node_id": "MDQ6VXNlcjU0NjI5MzAy", "avatar_url": "https://avatars.githubusercontent.com/u/54629302?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshuay03", "html_url": "https://github.com/joshuay03", "followers_url": "https://api.github.com/users/joshuay03/followers", "following_url": "https://api.github.com/users/joshuay03/following{/other_user}", "gists_url": "https://api.github.com/users/joshuay03/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshuay03/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshuay03/subscriptions", "organizations_url": "https://api.github.com/users/joshuay03/orgs", "repos_url": "https://api.github.com/users/joshuay03/repos", "events_url": "https://api.github.com/users/joshuay03/events{/privacy}", "received_events_url": "https://api.github.com/users/joshuay03/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-09T01:46:06Z", "updated_at": "2023-07-09T23:48:50Z", "closed_at": "2023-07-09T20:58:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Context\r\n\r\nI ran into an error when using `#joins` on a polymorphic association and `#or`. In my case, I was only joining on the association inside `#or`:\r\n```ruby\r\nModel.where(\"1=0\").or(\r\n  Model.joins(:association).where(\"1=1\")\r\n)\r\n```\r\n\r\nThis seemed fine (the query would resolve without any errors) until I tried to reference the association's table inside `#or` and would get an error:\r\n```ruby\r\nModel.where(\"1=0\").or(\r\n  Model.joins(:association).where(\"associations_table.column = ?\", some_value)\r\n)\r\n\r\n# => ActiveRecord::StatementInvalid (PG::UndefinedTable: ERROR:  missing FROM-clause entry for table \"associations_table\")\r\n```\r\n\r\nLooking through the docs and the implementation of `#or` it seems like the first snippet should be raising an error due to the structural incompatibility of the two relations. Having sifted through the code, I thought the reason it doesn't throw an error is due to a regression introduced in https://github.com/rails/rails/pull/39634, however, this didn't seem to be the case as I can still replicate my issue with with the changes in https://github.com/rails/rails/pull/48695. \r\n\r\nIt turns out that the reason my query was failing was due to the join on `association` not being added to the relation at all, which meant that although the query seemed to be resolving before, the resulting SQL was lacking a join, which is probably why the error wasn't raising either:\r\n```ruby\r\nModel.where(\"1=0\").or(\r\n  Model.joins(:association).where(\"1=1\")\r\n).to_sql\r\n\r\n# notice the missing INNER JOIN on associations_table\r\n# this causes the error in the snippet above\r\n\r\n# => \"SELECT \\\"models_table\\\".* FROM \\\"models_table\\\" WHERE (1=0 OR 1=1)\"\r\n```\r\n\r\nThis may be an unrelated issue to my findings below, but I thought I'd provide this context in case it was related. I'm still looking into why the join isn't added onto the relation, and whether `#or` will raise as expected once it is.\r\n\r\n**Update:** Turns out our codebase had monkey patched `#structurally_incompatible_values_for` to return an empty array \ud83d\ude05 This is why I wasn't seeing the error in my example. I'm yet to understand why the join is dropped though...\r\n\r\n### Issue\r\n\r\nGetting back to https://github.com/rails/rails/pull/39634, the changes there in `#structurally_incompatible_values_for` disregard cases where the structurally incompatible value is only before `#or`. Although this seems like the intent behind that PR, I'm only calling it a regression because the current functionality doesn't match up with the current documentation (see below).\r\n\r\n**Note:** This also means that `#structurally_compatible?` (which is a public API) was returning incorrect results. In fact, the example in the documentation itself doesn't return the correct result:\r\n\r\n**Expected:**\r\nhttps://github.com/rails/rails/blob/a5fc471b3f4bbd02e6be38dae023526a49e7d049/activerecord/lib/active_record/relation/query_methods.rb#L1011-L1012\r\n\r\n**Actual**\r\n```ruby\r\nPost.joins(:comments).structurally_compatible?(Post.where(\"id = 1\"))\r\n# => true\r\n```\r\n\r\nIf the changes in that PR are correct, I'll instead change https://github.com/rails/rails/pull/48695 to update the documentation for `#structurally_compatible?`. However I'm unsure what the standard should be going forward.\r\n\r\n### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :authors, force: true do |t|\r\n  end\r\n\r\n  create_table :posts, force: true do |t|\r\n    t.references :author\r\n  end\r\nend\r\n\r\nclass Author < ActiveRecord::Base\r\n  has_many :posts\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  belongs_to :author\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_structurally_incompatible_values\r\n    assert_raises ArgumentError do\r\n      Post.where(id: 1).or(Post.joins(:author)) # raises\r\n    end\r\n\r\n    assert_raises ArgumentError do\r\n      Post.joins(:author).or(Post.where(id: 1)) # doesn't raise\r\n    end\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\n<!-- Tell us what should happen -->\r\nBoth relations should raise an `ArgumentError`.\r\n\r\n### Actual behavior\r\n<!-- Tell us what happens instead -->\r\nThe relation with the incompatible value method before the `#or` doesn't raise an `ArgumentError`.\r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48694/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48694/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48693", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48693/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48693/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48693/events", "html_url": "https://github.com/rails/rails/pull/48693", "id": 1794829131, "node_id": "PR_kwDNIULOVPzHIQ", "number": 48693, "title": "Use a consistent format when testing BigDecimal.to_s", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-08T07:46:45Z", "updated_at": "2023-07-12T07:13:28Z", "closed_at": "2023-07-12T07:13:23Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48693", "html_url": "https://github.com/rails/rails/pull/48693", "diff_url": "https://github.com/rails/rails/pull/48693.diff", "patch_url": "https://github.com/rails/rails/pull/48693.patch", "merged_at": "2023-07-12T07:13:22Z"}, "body": "The previous examples were causing failures in CI, after ruby/bigdecimal#264 was merged.\r\n\r\nFor example:\r\n\r\n```\r\nFailure:\r\nNumericExtFormattingTest#test_default_to_fs [/rails/activesupport/test/core_ext/numeric_ext_test.rb:446]:\r\n--- expected\r\n+++ actual\r\n@@ -1 +1,3 @@\r\n-\"10000 10.0\"\r\n+# encoding: US-ASCII\r\n+#    valid: true\r\n+\"10 00010.0\"\r\n```\r\n\r\nThe recommendation was to adjust the test to deal with the upstream change more flexibly.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48693/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48693/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48692", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48692/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48692/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48692/events", "html_url": "https://github.com/rails/rails/pull/48692", "id": 1794817595, "node_id": "PR_kwDNIULOVPyk3w", "number": 48692, "title": "Try to fix big decimal related encoding errors on Ruby 2.7", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-08T07:05:36Z", "updated_at": "2023-07-08T07:42:41Z", "closed_at": "2023-07-08T07:42:38Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48692", "html_url": "https://github.com/rails/rails/pull/48692", "diff_url": "https://github.com/rails/rails/pull/48692.diff", "patch_url": "https://github.com/rails/rails/pull/48692.patch", "merged_at": null}, "body": "First, this failure seems to occur frequently:\r\nhttps://buildkite.com/rails/rails/builds/97896#01893375-a2aa-4c8e-9d4b-42c9392a6171/1079-1090\r\n\r\nThere was also a somewhat related discovery here:\r\nhttps://github.com/rails/rails/pull/47493/files#diff-9c10b17f0ee079f3e5294d17264e7e06986f6192cff165f6628fe99886c38c24R19\r\n\r\nLet's see what happens in CI!", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48692/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48692/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48691", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48691/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48691/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48691/events", "html_url": "https://github.com/rails/rails/pull/48691", "id": 1794521666, "node_id": "PR_kwDNIULOVPiJGQ", "number": 48691, "title": "Create an `ActiveSupport::Callable` object to do case-equality with objects that implement `#call`", "user": {"login": "bensheldon", "id": 47554, "node_id": "MDQ6VXNlcjQ3NTU0", "avatar_url": "https://avatars.githubusercontent.com/u/47554?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bensheldon", "html_url": "https://github.com/bensheldon", "followers_url": "https://api.github.com/users/bensheldon/followers", "following_url": "https://api.github.com/users/bensheldon/following{/other_user}", "gists_url": "https://api.github.com/users/bensheldon/gists{/gist_id}", "starred_url": "https://api.github.com/users/bensheldon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bensheldon/subscriptions", "organizations_url": "https://api.github.com/users/bensheldon/orgs", "repos_url": "https://api.github.com/users/bensheldon/repos", "events_url": "https://api.github.com/users/bensheldon/events{/privacy}", "received_events_url": "https://api.github.com/users/bensheldon/received_events", "type": "User", "site_admin": true}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}, {"id": 123812746, "node_id": "MDU6TGFiZWwxMjM4MTI3NDY=", "url": "https://api.github.com/repos/rails/rails/labels/activejob", "name": "activejob", "color": "5319e7", "default": false, "description": null}, {"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}, {"id": 1174770998, "node_id": "MDU6TGFiZWwxMTc0NzcwOTk4", "url": "https://api.github.com/repos/rails/rails/labels/actionmailbox", "name": "actionmailbox", "color": "f4a6cb", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-07T23:12:18Z", "updated_at": "2023-07-25T16:34:43Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48691", "html_url": "https://github.com/rails/rails/pull/48691", "diff_url": "https://github.com/rails/rails/pull/48691.diff", "patch_url": "https://github.com/rails/rails/pull/48691.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nRails has some configuration options that explicitly type-check on `Proc` instead of allowing duck-typing. This PR introduces `ActiveSupport::Callable` which case-equals any object that responds to `call`. \r\n\r\n```ruby\r\nclass CustomQueryWarningsAction\r\n  def self.call\r\n    new.very_complex_method\r\n  end\r\n  # ....\r\nend\r\n\r\n# This PR allows this:\r\nconfig.active_record.db_warnings_action = CustomQueryWarningsAction\r\n\r\n# ...instead of previously requiring this:\r\nconfig.active_record.db_warnings_action = CustomQueryWarningsAction.method(:call).to_proc\r\n```\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48691/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48691/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48690", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48690/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48690/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48690/events", "html_url": "https://github.com/rails/rails/pull/48690", "id": 1794294031, "node_id": "PR_kwDNIULOVPVHLQ", "number": 48690, "title": "Prevent `#merge_target_lists` from clearing id column on composite primary key records", "user": {"login": "adrianna-chang-shopify", "id": 22918438, "node_id": "MDQ6VXNlcjIyOTE4NDM4", "avatar_url": "https://avatars.githubusercontent.com/u/22918438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adrianna-chang-shopify", "html_url": "https://github.com/adrianna-chang-shopify", "followers_url": "https://api.github.com/users/adrianna-chang-shopify/followers", "following_url": "https://api.github.com/users/adrianna-chang-shopify/following{/other_user}", "gists_url": "https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}", "starred_url": "https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adrianna-chang-shopify/subscriptions", "organizations_url": "https://api.github.com/users/adrianna-chang-shopify/orgs", "repos_url": "https://api.github.com/users/adrianna-chang-shopify/repos", "events_url": "https://api.github.com/users/adrianna-chang-shopify/events{/privacy}", "received_events_url": "https://api.github.com/users/adrianna-chang-shopify/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-07T20:48:10Z", "updated_at": "2023-07-10T13:06:07Z", "closed_at": "2023-07-10T13:06:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48690", "html_url": "https://github.com/rails/rails/pull/48690", "diff_url": "https://github.com/rails/rails/pull/48690.diff", "patch_url": "https://github.com/rails/rails/pull/48690.patch", "merged_at": "2023-07-10T13:06:07Z"}, "body": "### Motivation / Background\r\n\r\nThis PR addresses a bug with composite primary key models where loading a collection association causes the `id` column to be set to `nil` while merging persisted and in-memory records.\r\n\r\n### Detail\r\n\r\nWhen merging persisted and in-memory records in `#merge_target_list`, we use `record[name]` to get the value of the attribute. For records with a composite primary key, the full CPK is returned from `record[\"id\"]`, which is incompatible with `#_write_attribute`: we attempt to assign an Array to the `id` column, which results in the column being set to nil.\r\n\r\nWhen dealing with a record with a composite primary key, we need to write each part of the primary key individually via `#_write_attribute`.\r\n\r\n### Additional information\r\n\r\nOne alternative to calling `#_write_attribute` for each part of the primary key would be to simply delegate to the `id=` method, which is already capable of assigning each part of the CPK accordingly and ultimately delegates to `#_write_attribute`:\r\nhttps://github.com/rails/rails/blob/a5fc471b3f4bbd02e6be38dae023526a49e7d049/activerecord/lib/active_record/attribute_methods/primary_key.rb#L32-L39\r\n\r\nHowever, this duplicates the check to `composite_primary_key?`, and I felt it would be more appropriate to go through `#_write_attribute` directly in both branches of the conditional.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48690/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48690/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48689", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48689/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48689/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48689/events", "html_url": "https://github.com/rails/rails/issues/48689", "id": 1793880804, "node_id": "I_kwDNIULOauxy5A", "number": 48689, "title": "Custom serialization & storage in ActiveRecord::Encryption (beyond strings)", "user": {"login": "maximerety", "id": 58582, "node_id": "MDQ6VXNlcjU4NTgy", "avatar_url": "https://avatars.githubusercontent.com/u/58582?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maximerety", "html_url": "https://github.com/maximerety", "followers_url": "https://api.github.com/users/maximerety/followers", "following_url": "https://api.github.com/users/maximerety/following{/other_user}", "gists_url": "https://api.github.com/users/maximerety/gists{/gist_id}", "starred_url": "https://api.github.com/users/maximerety/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maximerety/subscriptions", "organizations_url": "https://api.github.com/users/maximerety/orgs", "repos_url": "https://api.github.com/users/maximerety/repos", "events_url": "https://api.github.com/users/maximerety/events{/privacy}", "received_events_url": "https://api.github.com/users/maximerety/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 5511275119, "node_id": "LA_kwDNIULPAAAAAUh_Ym8", "url": "https://api.github.com/repos/rails/rails/labels/encryption", "name": "encryption", "color": "8D3EA8", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-07T17:17:19Z", "updated_at": "2023-07-10T17:26:37Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\nIn https://guides.rubyonrails.org/active_record_encryption.html#supported-types, it is clearer stated:\r\n\r\n> **`active_record.encryption` will serialize values using the underlying type before encrypting them, but they must be serializable as strings**. Structured types like serialized are supported out of the box.\r\n\r\nAs long as you only have string values, a `text`/`varchar` column in the database, and a message serializer that emits and consumes strings (the situation currently described in the docs), everything works just fine.\r\n\r\nBut I'd like to propose to support a wider range of use cases by **allowing custom serializers that output another type than strings**.\r\n\r\nA typical use case would be to use a binary column in the database (e.g. `bytea` in PostgreSQL) and serialize encrypted values using a compact binary format such as the one provided by [MessagePack](https://github.com/msgpack/msgpack-ruby) (example given below), instead of the default JSON string format provided by the default message serializer.\r\n\r\nSetting a custom serializer via `config.active_record.encryption.message_serializer` is already supported (https://guides.rubyonrails.org/active_record_encryption.html#encryption-contexts). Unfortunately, it's not possible to make your custom serializer produce binary values and have things work right out of the box.\r\n\r\nOne small inconvenience is the problem described in https://github.com/rails/rails/issues/48685 (quite straitghforward to fix: https://github.com/rails/rails/pull/48686), but a bigger problem lies in the current design of `ActiveRecord::Encryption::EncryptedAttributeType`.\r\n\r\nTo make my explanation a bit visual, this is what we have today:\r\n\r\n```plaintext\r\nAttribute without encryption:\r\n                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \r\n  user-provided value \u2500\u2500\u2500\u25ba\u2524 cast \u251c\u2500\u2500\u2500\u25ba value for the db\r\n                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \r\n                                        \r\n                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \r\n   value for the user \u25c4\u2500\u2500\u2500\u2524 cast \u251c\u25c4\u2500\u2500\u2500 db-provided value\r\n                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \r\n\r\n\r\nAttribute with encryption:\r\n                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \r\n  user-provided value \u2500\u2500\u2500\u25ba\u2524 cast A \u251c\u2500\u2500\u2500\u25ba\u2524 encrypt \u251c\u2500\u2500\u2500\u25ba\u2524  serialize  \u251c\u2500\u2500\u2500\u25ba\u2524 cast B \u251c\u2500\u2500\u2500\u25ba value for the db\r\n                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \r\n                                                                                         \r\n                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \r\n   value for the user \u25c4\u2500\u2500\u2500\u2524 cast A \u251c\u25c4\u2500\u2500\u2500\u2524 decrypt \u251c\u25c4\u2500\u2500\u2500\u2524 deserialize \u251c\u25c4\u2500\u2500\u2500\u2524 cast B \u251c\u25c4\u2500\u2500\u2500 db-provided value\r\n                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \r\n```\r\n\r\nAs of today, the default implementation of `ActiveRecord::Encryption::EncryptedAttributeType` uses the type of the database column as `cast_type` to perform the `cast A` step in the figure, and there is no `cast B` step.\r\n\r\nWhen a value is extracted from the database, there is no type casting before sending it to the message serializer for deserialization. Conversely, a value serialized with the message serializer is sent directly to the database without any further type casting. So, by default, there is no `cast B` step, and only strings are expected to be sent to/received from the database.\r\n\r\nAs long as you only have string values, a `text`/`varchar` column in the database, and a message serializer that emits and consumes strings (the situation currently described in the docs), everything works just fine.\r\n\r\nBut with this model, you can't easily switch to a `bytea` column and serialize in database-compatible binary format, because you have no built-in way to perform a `cast B` (binary) which is different from `cast A` (strings).\r\n\r\nI think we should recognize the need for two distinct types of casting:\r\n\r\n* Casting clear values before encryption (e.g. ensuring correct type/encoding), and;\r\n* Casting encrypted+serialized values before sending them to the database (e.g. sending a message that is serialized in binary format).\r\n\r\nIdeally, the framework should allow developers to specify the type of casting they need in a particular place, instead of using the database column type for `cast A` (not always appropriate), and providing no support for `cast B`.\r\n\r\n**If you think this could be a good addition to the framework, I would volunteer to help make this happen.**\r\n\r\nFor completeness, a possible workaround is:\r\n\r\n1. To declare the attribute as a string (despite the attribute being stored in a binary format in the database) in order to trick the framework to use a `:string` attribute type when performing `cast A` (see figure above):\r\n\r\n    ```diff\r\n      create_table(:records, force: true) do |t|\r\n        t.bytea :some_attribute\r\n      end\r\n\r\n      class Record < ActiveRecord::Base\r\n    +   attribute :some_attribute, :string\r\n        encrypts :some_attribute\r\n      end\r\n    ```\r\n\r\n2. To perform `cast B` yourself in the serializer, here an example of a binary message serializer using [MessagePack](https://github.com/msgpack/msgpack-ruby) (some details omitted - don't use this in your project):\r\n\r\n    ```ruby\r\n    class ByteaSerializer < ActiveRecord::Encryption::MessageSerializer\r\n      def load(escaped_content)  \r\n        encoded_content = binary_type.deserialize(escaped_content)\r\n        parse_message(MessagePack.unpack(encoded_content), 1)\r\n      end\r\n    \r\n      def dump(message)\r\n        encoded_content = MessagePack.pack message_to_json(message)\r\n        binary_type.serialize(encoded_content)\r\n      end\r\n    \r\n      private\r\n    \r\n      def encode_if_needed(value) = value\r\n      def decode_if_needed(value) = value\r\n    \r\n      def binary_type\r\n        @binary_type ||= ActiveRecord::Type.lookup(:binary, adapter: :postgresql)\r\n      end\r\n    end\r\n    ```\r\n\r\nAlthough this gives us a picture of what we're trying to achieve, I think we'd do better to make `ActiveRecord::Encryption::EncryptedAttributeType` more versatile so that it's possible to achieve this goal without using dangerous tricks.\r\n\r\n### Expected behavior\r\n\r\nVarious database column types and message serializers are supported for encrypted attributes.\r\n\r\n### Actual behavior\r\n\r\nYou can only have string values, a `text`/`varchar` column in the database, and a message serializer that emits and consumes strings.\r\n\r\n### System configuration\r\n\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.2.2\r\n\r\n---------\r\n\r\n**Edit on `2023-07-10`**\r\n\r\nI reworded the explanations around `cast B`, which is a step that does not exist in the default implementation, but which is needed in custom ones.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48689/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48689/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48688", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48688/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48688/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48688/events", "html_url": "https://github.com/rails/rails/issues/48688", "id": 1793824215, "node_id": "I_kwDNIULOauuV1w", "number": 48688, "title": "Callbacks called twice when parent accepts_nested_attributes_for child", "user": {"login": "jakemiller13", "id": 34395972, "node_id": "MDQ6VXNlcjM0Mzk1OTcy", "avatar_url": "https://avatars.githubusercontent.com/u/34395972?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakemiller13", "html_url": "https://github.com/jakemiller13", "followers_url": "https://api.github.com/users/jakemiller13/followers", "following_url": "https://api.github.com/users/jakemiller13/following{/other_user}", "gists_url": "https://api.github.com/users/jakemiller13/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakemiller13/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakemiller13/subscriptions", "organizations_url": "https://api.github.com/users/jakemiller13/orgs", "repos_url": "https://api.github.com/users/jakemiller13/repos", "events_url": "https://api.github.com/users/jakemiller13/events{/privacy}", "received_events_url": "https://api.github.com/users/jakemiller13/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 5511275119, "node_id": "LA_kwDNIULPAAAAAUh_Ym8", "url": "https://api.github.com/repos/rails/rails/labels/encryption", "name": "encryption", "color": "8D3EA8", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-07T16:25:45Z", "updated_at": "2023-07-19T14:44:08Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n    t.string :name\r\n  end\r\n\r\n  create_table :comments, force: true do |t|\r\n    t.integer :post_id\r\n    t.string :name\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  has_one :comment\r\n\r\n  before_validation :before_validation_callback_post\r\n  after_validation :after_validation_callback_post\r\n\r\n  before_save :before_save_callback_post\r\n  after_save :after_save_callback_post\r\n\r\n  before_create :before_create_callback_post\r\n  after_create :after_create_callback_post\r\n\r\n  def before_validation_callback_post\r\n    puts 'Post: before_validation_callback'\r\n  end\r\n\r\n  def after_validation_callback_post\r\n    puts 'Post: after_validation_callback'\r\n  end\r\n\r\n  def before_save_callback_post\r\n    puts 'Post: before_save_callback'\r\n  end\r\n\r\n  def after_save_callback_post\r\n    puts 'Post: after_save_callback'\r\n  end\r\n\r\n  def before_create_callback_post\r\n    puts 'Post: before_create_callback'\r\n  end\r\n\r\n  def after_create_callback_post\r\n    puts 'Post: after_create_callback'\r\n  end\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\n  belongs_to :post\r\n\r\n  accepts_nested_attributes_for :post\r\n\r\n  before_validation :before_validation_callback_comment\r\n  after_validation :after_validation_callback_comment\r\n\r\n  before_save :before_save_callback_comment\r\n  after_save :after_save_callback_comment\r\n\r\n  before_create :before_create_callback_comment\r\n  after_create :after_create_callback_comment\r\n\r\n  def before_validation_callback_comment\r\n    puts 'Comment: before_validation_callback'\r\n  end\r\n\r\n  def after_validation_callback_comment\r\n    puts 'Comment: after_validation_callback'\r\n  end\r\n\r\n  def before_save_callback_comment\r\n    puts 'Comment: before_save_callback'\r\n  end\r\n\r\n  def after_save_callback_comment\r\n    puts 'Comment: after_save_callback'\r\n  end\r\n\r\n  def before_create_callback_comment\r\n    puts 'Comment: before_create_callback'\r\n  end\r\n\r\n  def after_create_callback_comment\r\n    puts 'Comment: after_create_callback'\r\n  end\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_association_stuff\r\n    Comment.create!(name: 'foo', post_attributes: {name: 'bar'})\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\n`before_validation`, `after_validation`, `before_save`, `after_save` callbacks should only be called once when saving a parent record that accepts nested attributes for a child record. Note that `before_create`, `after_create` callbacks **are** only called once, so this inconsistency is especially confusing.\r\n\r\n### Actual behavior\r\n`before_validation`, `after_validation`, `before_save`, `after_save` are all called twice on parent record.\r\n\r\n```\r\n(base) m-apd-jmiller:models jmiller$ ruby active_record_main.rb \r\nFetching https://github.com/rails/rails.git\r\nFetching gem metadata from https://rubygems.org/......\r\nResolving dependencies...\r\nUsing rake 13.0.6\r\nUsing connection_pool 2.4.1\r\nUsing minitest 5.18.1\r\nUsing webrick 1.8.1\r\nUsing erubi 1.12.0\r\nUsing rack 3.0.8\r\nUsing websocket-extensions 0.1.5\r\nUsing marcel 1.0.2\r\nUsing rack-test 2.1.0\r\nUsing bundler 2.4.7\r\nUsing websocket-driver 0.7.5\r\nUsing nio4r 2.5.9\r\nUsing zeitwerk 2.6.8\r\nUsing date 3.3.3\r\nUsing timeout 0.4.0\r\nUsing builder 3.2.4\r\nUsing io-console 0.6.0\r\nUsing racc 1.7.1\r\nUsing crass 1.0.6\r\nUsing thor 1.2.2\r\nUsing sqlite3 1.6.3 (x86_64-darwin)\r\nUsing rack-session 2.0.0\r\nUsing mini_mime 1.1.2\r\nUsing rackup 2.1.0\r\nUsing concurrent-ruby 1.2.2\r\nUsing net-protocol 0.2.1\r\nUsing reline 0.3.5\r\nUsing i18n 1.14.1\r\nUsing net-imap 0.3.6\r\nUsing nokogiri 1.15.3 (x86_64-darwin)\r\nUsing net-pop 0.1.2\r\nUsing net-smtp 0.3.3\r\nUsing loofah 2.21.3\r\nUsing irb 1.7.1\r\nUsing rails-html-sanitizer 1.6.0\r\nUsing tzinfo 2.0.6\r\nUsing mail 2.8.1\r\nUsing activesupport 7.1.0.alpha from https://github.com/rails/rails.git (at main@a5fc471)\r\nUsing activemodel 7.1.0.alpha from https://github.com/rails/rails.git (at main@a5fc471)\r\nUsing rails-dom-testing 2.1.1\r\nUsing activerecord 7.1.0.alpha from https://github.com/rails/rails.git (at main@a5fc471)\r\nUsing actionview 7.1.0.alpha from https://github.com/rails/rails.git (at main@a5fc471)\r\nUsing globalid 1.1.0\r\nUsing actionpack 7.1.0.alpha from https://github.com/rails/rails.git (at main@a5fc471)\r\nUsing activejob 7.1.0.alpha from https://github.com/rails/rails.git (at main@a5fc471)\r\nUsing actioncable 7.1.0.alpha from https://github.com/rails/rails.git (at main@a5fc471)\r\nUsing activestorage 7.1.0.alpha from https://github.com/rails/rails.git (at main@a5fc471)\r\nUsing actionmailer 7.1.0.alpha from https://github.com/rails/rails.git (at main@a5fc471)\r\nUsing actionmailbox 7.1.0.alpha from https://github.com/rails/rails.git (at main@a5fc471)\r\nUsing actiontext 7.1.0.alpha from https://github.com/rails/rails.git (at main@a5fc471)\r\nUsing railties 7.1.0.alpha from https://github.com/rails/rails.git (at main@a5fc471)\r\nUsing rails 7.1.0.alpha from https://github.com/rails/rails.git (at main@a5fc471)\r\n-- create_table(:posts, {:force=>true})\r\nD, [2023-07-07T12:17:20.483607 #2897] DEBUG -- :    (0.1ms)  DROP TABLE IF EXISTS \"posts\"\r\nD, [2023-07-07T12:17:20.485077 #2897] DEBUG -- :    (1.1ms)  CREATE TABLE \"posts\" (\"id\" integer PRIMARY KEY AUTOINCREMENT NOT NULL, \"name\" varchar)\r\n   -> 0.0286s\r\n-- create_table(:comments, {:force=>true})\r\nD, [2023-07-07T12:17:20.485698 #2897] DEBUG -- :    (0.0ms)  DROP TABLE IF EXISTS \"comments\"\r\nD, [2023-07-07T12:17:20.486042 #2897] DEBUG -- :    (0.1ms)  CREATE TABLE \"comments\" (\"id\" integer PRIMARY KEY AUTOINCREMENT NOT NULL, \"post_id\" integer, \"name\" varchar)\r\n   -> 0.0009s\r\nD, [2023-07-07T12:17:20.488263 #2897] DEBUG -- :    (0.1ms)  CREATE TABLE \"schema_migrations\" (\"version\" varchar NOT NULL PRIMARY KEY)\r\nD, [2023-07-07T12:17:20.490839 #2897] DEBUG -- :    (0.1ms)  CREATE TABLE \"ar_internal_metadata\" (\"key\" varchar NOT NULL PRIMARY KEY, \"value\" varchar, \"created_at\" datetime(6) NOT NULL, \"updated_at\" datetime(6) NOT NULL)\r\nD, [2023-07-07T12:17:20.532633 #2897] DEBUG -- :   ActiveRecord::InternalMetadata Load (2.7ms)  SELECT * FROM \"ar_internal_metadata\" WHERE \"ar_internal_metadata\".\"key\" = ? ORDER BY \"ar_internal_metadata\".\"key\" ASC LIMIT 1  [[nil, \"environment\"]]\r\nD, [2023-07-07T12:17:20.533215 #2897] DEBUG -- :   ActiveRecord::InternalMetadata Create (0.1ms)  INSERT INTO \"ar_internal_metadata\" (\"key\", \"value\", \"created_at\", \"updated_at\") VALUES ('environment', 'development', '2023-07-07 16:17:20.532735', '2023-07-07 16:17:20.532743')\r\nRun options: --seed 61519\r\n\r\n# Running:\r\n\r\nComment: before_validation_callback\r\nPost: before_validation_callback\r\nPost: after_validation_callback\r\nComment: after_validation_callback\r\nPost: before_save_callback\r\nPost: before_create_callback\r\nD, [2023-07-07T12:17:20.661392 #2897] DEBUG -- :   TRANSACTION (0.1ms)  begin transaction\r\nD, [2023-07-07T12:17:20.661656 #2897] DEBUG -- :   Post Create (0.4ms)  INSERT INTO \"posts\" (\"name\") VALUES (?)  [[\"name\", \"bar\"]]\r\nComment: before_validation_callback\r\nComment: after_validation_callback\r\nComment: before_save_callback\r\nComment: before_create_callback\r\nD, [2023-07-07T12:17:20.662908 #2897] DEBUG -- :   Comment Create (0.1ms)  INSERT INTO \"comments\" (\"post_id\", \"name\") VALUES (?, ?)  [[\"post_id\", 1], [\"name\", \"foo\"]]\r\nComment: after_create_callback\r\nComment: after_save_callback\r\nPost: after_create_callback\r\nPost: after_save_callback\r\nComment: before_save_callback\r\nComment: after_save_callback\r\nD, [2023-07-07T12:17:20.663528 #2897] DEBUG -- :   TRANSACTION (0.1ms)  commit transaction\r\n```\r\n\r\n### System configuration\r\n**Rails version**: 5.2.8.1, 7.0.6 (tested both)\r\n\r\n**Ruby version**: 2.7.6, 3.2.1 (tested both)\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48688/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48688/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48687", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48687/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48687/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48687/events", "html_url": "https://github.com/rails/rails/issues/48687", "id": 1793789390, "node_id": "I_kwDNIULOausNzg", "number": 48687, "title": "ActiveRecord time not included in request logs when `shard_resolver`  is used", "user": {"login": "pospieszynski", "id": 15077823, "node_id": "MDQ6VXNlcjE1MDc3ODIz", "avatar_url": "https://avatars.githubusercontent.com/u/15077823?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pospieszynski", "html_url": "https://github.com/pospieszynski", "followers_url": "https://api.github.com/users/pospieszynski/followers", "following_url": "https://api.github.com/users/pospieszynski/following{/other_user}", "gists_url": "https://api.github.com/users/pospieszynski/gists{/gist_id}", "starred_url": "https://api.github.com/users/pospieszynski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pospieszynski/subscriptions", "organizations_url": "https://api.github.com/users/pospieszynski/orgs", "repos_url": "https://api.github.com/users/pospieszynski/repos", "events_url": "https://api.github.com/users/pospieszynski/events{/privacy}", "received_events_url": "https://api.github.com/users/pospieszynski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2023-07-07T16:01:39Z", "updated_at": "2023-07-25T13:43:21Z", "closed_at": "2023-07-10T15:44:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n1. Create Rails 7.0.4.3 app in `api_only` mode\r\n2. Configure database for multi-shards as described [here](https://edgeguides.rubyonrails.org/active_record_multiple_databases.html)\r\n3. Add sample `shard_resolver` to `application.rb` file.\r\n3. Implement sample endpoint that calls any db query and observe to last line of logs processing.\r\n4. Put the code below to the initializer.\r\n\r\n```\r\nActiveSupport::Notifications.subscribe \"process_action.action_controller\" do |event|\r\n  Rails.logger.info \"Duration: #{event.duration}; DB: #{event.payload[:db_runtime].to_i}\"\r\n  # Notice that event.payload[:db_runtime] is always nil here\r\nend\r\n```\r\n\r\n### Expected behaviour\r\nThe log line that summarises the request completion should contain `ActiveRecord` time. Also, the instrumentation hook for `process_action.action_controller` event should have `event.payload[:db_runtime]` not being nil. Please see SS below:\r\n\r\n<img width=\"540\" alt=\"image\" src=\"https://github.com/rails/rails/assets/15077823/29574765-0dfd-4d14-b044-d4fb1528ffc4\">\r\n\r\n\r\n### Actual behavior\r\nRails doesn't seem to correctly keep track of database time throughout the request lifecycle for multi-db setup resulting in missing ActiveRecord time in logs. Please see SS below:\r\n\r\n<img width=\"388\" alt=\"image\" src=\"https://github.com/rails/rails/assets/15077823/722cf567-3e1e-4651-884f-96853c2aa35a\">\r\n\r\n### System configuration\r\n**Rails version**: 7.0.4.3\r\n\r\n**Ruby version**: 3.0.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48687/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48687/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48686", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48686/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48686/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48686/events", "html_url": "https://github.com/rails/rails/pull/48686", "id": 1793537744, "node_id": "PR_kwDNIULOVOrDyQ", "number": 48686, "title": "[Fix #48685] Make the encryptor agnostic of the type of data to decrypt", "user": {"login": "maximerety", "id": 58582, "node_id": "MDQ6VXNlcjU4NTgy", "avatar_url": "https://avatars.githubusercontent.com/u/58582?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maximerety", "html_url": "https://github.com/maximerety", "followers_url": "https://api.github.com/users/maximerety/followers", "following_url": "https://api.github.com/users/maximerety/following{/other_user}", "gists_url": "https://api.github.com/users/maximerety/gists{/gist_id}", "starred_url": "https://api.github.com/users/maximerety/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maximerety/subscriptions", "organizations_url": "https://api.github.com/users/maximerety/orgs", "repos_url": "https://api.github.com/users/maximerety/repos", "events_url": "https://api.github.com/users/maximerety/events{/privacy}", "received_events_url": "https://api.github.com/users/maximerety/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-07T13:18:03Z", "updated_at": "2023-07-07T20:30:26Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48686", "html_url": "https://github.com/rails/rails/pull/48686", "diff_url": "https://github.com/rails/rails/pull/48686.diff", "patch_url": "https://github.com/rails/rails/pull/48686.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created to fix https://github.com/rails/rails/issues/48685.\r\n\r\n### Detail\r\n\r\n[Fix #48685] Make the encryptor agnostic of the type of data to decrypt\r\n    \r\nThe default message serializer will raise a `TypeError` when invoking `JSON.parse` on any non-`String` input. This error will subsequently be translated into an `ActiveRecord::Encryption::Errors::Encoding` error and then a `ActiveRecord::Encryption::Errors::Decryption` error by the encryptor, which does not change the current behavior at the encryptor level.\r\n\r\nThis change clarifies that it is the role of the underlying serializer to accept or reject the data to decrypt depending on its type. This behavior mirrors what is done at encryption, where the serializer asserts that the input is an `ActiveRecord::Encryption::Message`.\r\n\r\nThis change is a no-op when using the default `MessageSerializer` class, but it enables the use a wider variety of custom serializers.\r\n\r\nBy being agnostic of the type of data to decrypt at the encryptor level, it is now possible to serialize and store messages in a binary format (e.g. in a `bytea` column in PostgreSQL). A custom message serializer is now able to decrypt binary values coming from the database (`String`) or from user input (`ActiveModel::Type::Binary::Data`) without having an exception raised at the encryptor level because the type is not `String`.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48686/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48686/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48685", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48685/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48685/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48685/events", "html_url": "https://github.com/rails/rails/issues/48685", "id": 1793527161, "node_id": "I_kwDNIULOaucNeQ", "number": 48685, "title": "Make ActiveRecord Encryptor agnostic of the type of serialized data to be decrypted", "user": {"login": "maximerety", "id": 58582, "node_id": "MDQ6VXNlcjU4NTgy", "avatar_url": "https://avatars.githubusercontent.com/u/58582?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maximerety", "html_url": "https://github.com/maximerety", "followers_url": "https://api.github.com/users/maximerety/followers", "following_url": "https://api.github.com/users/maximerety/following{/other_user}", "gists_url": "https://api.github.com/users/maximerety/gists{/gist_id}", "starred_url": "https://api.github.com/users/maximerety/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maximerety/subscriptions", "organizations_url": "https://api.github.com/users/maximerety/orgs", "repos_url": "https://api.github.com/users/maximerety/repos", "events_url": "https://api.github.com/users/maximerety/events{/privacy}", "received_events_url": "https://api.github.com/users/maximerety/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 5511275119, "node_id": "LA_kwDNIULPAAAAAUh_Ym8", "url": "https://api.github.com/repos/rails/rails/labels/encryption", "name": "encryption", "color": "8D3EA8", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-07T13:11:02Z", "updated_at": "2023-07-19T14:44:48Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\nI am using [ActiveRecord Encryption](https://guides.rubyonrails.org/active_record_encryption.html) with latest Rails `7.0.*`, and a custom serializer instead of the default one.\r\n\r\nThis custom serializer outputs binary values that are stored in a `bytea` column in PostgreSQL, instead of a JSON value in a `text` column, as the default MessageSerializer would do.\r\n\r\nIt works pretty well except that the `ActiveRecord::Encryption::Encryptor#deserialize_message` prevents `ActiveModel::Type::Binary::Data` objects to be passed to the custom serializer for decryption. (Note: we get this type of data for user inputs subsequently decrypted, e.g. during attribute validation).\r\n\r\nI would expect the `Encryptor` to be agnostic about the type of values to decrypt, and let the underlying serializer assert the actual types that it supports.\r\n\r\nNote that the default `MessageSerializer` is already able to reject any input which is not a `String`:\r\n\r\n1. A  `TypeError` is raised by `JSON.parse` (not caught here)\r\nhttps://github.com/rails/rails/blob/a5fc471b3f4bbd02e6be38dae023526a49e7d049/activerecord/lib/active_record/encryption/message_serializer.rb#L24-L29\r\n2. The `TypeError` is caught and replaced by an `Encoding` error:\r\nhttps://github.com/rails/rails/blob/a5fc471b3f4bbd02e6be38dae023526a49e7d049/activerecord/lib/active_record/encryption/encryptor.rb#L102-L107\r\n3. And finally caught again and replaced by  a `Decryption` error:\r\nhttps://github.com/rails/rails/blob/a5fc471b3f4bbd02e6be38dae023526a49e7d049/activerecord/lib/active_record/encryption/encryptor.rb#L52-L59\r\n\r\nSo there is no need for this duplicate preventive check at `Encryptor` level in step 2.:\r\n\r\nhttps://github.com/rails/rails/blob/a5fc471b3f4bbd02e6be38dae023526a49e7d049/activerecord/lib/active_record/encryption/encryptor.rb#L103\r\n\r\nWhen I remove that duplicate check, the behavior is unchanged when using the default `MessageSerializer`, but I am able to use a custom serializer too.\r\n\r\n### Expected behavior\r\n\r\nI would expect the `Encryptor` to be agnostic about the type of values to decrypt, and let the underlying serializer assert the actual types that it supports.\r\n\r\n### Actual behavior\r\n\r\nThe `Encryptor` assumes that the input to be deserialized/decrypted is always a `String` when it could be something else. This unnecessarily prevents the use of custom serializers.\r\n\r\n### System configuration\r\n\r\n**Rails version**: 7.0.6 / 7.1\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48685/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48685/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48684", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48684/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48684/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48684/events", "html_url": "https://github.com/rails/rails/pull/48684", "id": 1793117812, "node_id": "PR_kwDNIULOVOT4-w", "number": 48684, "title": "[ci-skip][Doc] Fix `require` paths for \"Using Separate Files\" in Testing Guide", "user": {"login": "hachi8833", "id": 4289625, "node_id": "MDQ6VXNlcjQyODk2MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/4289625?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hachi8833", "html_url": "https://github.com/hachi8833", "followers_url": "https://api.github.com/users/hachi8833/followers", "following_url": "https://api.github.com/users/hachi8833/following{/other_user}", "gists_url": "https://api.github.com/users/hachi8833/gists{/gist_id}", "starred_url": "https://api.github.com/users/hachi8833/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hachi8833/subscriptions", "organizations_url": "https://api.github.com/users/hachi8833/orgs", "repos_url": "https://api.github.com/users/hachi8833/repos", "events_url": "https://api.github.com/users/hachi8833/events{/privacy}", "received_events_url": "https://api.github.com/users/hachi8833/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-07T09:04:24Z", "updated_at": "2023-07-11T02:41:54Z", "closed_at": "2023-07-08T04:13:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48684", "html_url": "https://github.com/rails/rails/pull/48684", "diff_url": "https://github.com/rails/rails/pull/48684.diff", "patch_url": "https://github.com/rails/rails/pull/48684.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because I found simple errors in the sample codes.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the path for `require` as follows.\r\n\r\n```diff\r\n- require \"test_helpers/multiple_assertions\"\r\n+ require \"helpers/multiple_assertions\"\r\n```\r\n\r\nIn my local app, changing `test_helpers/` to the actual `helpers/` is needed to `include` my test helper.\r\n\r\nI'd backport this to 7-0-stable as well if merged.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48684/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48684/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48683", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48683/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48683/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48683/events", "html_url": "https://github.com/rails/rails/pull/48683", "id": 1792862016, "node_id": "PR_kwDNIULOVOGMAA", "number": 48683, "title": "HasOne `create_association` should raise if association already exists", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2023-07-07T06:13:00Z", "updated_at": "2023-07-12T01:07:02Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48683", "html_url": "https://github.com/rails/rails/pull/48683", "diff_url": "https://github.com/rails/rails/pull/48683.diff", "patch_url": "https://github.com/rails/rails/pull/48683.patch", "merged_at": null}, "body": "The goal is to raise an exception when calling `create_association` which would replace an already persisted association.\r\n\r\nHere is a failing test report as well:\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"active_support/testing/assertions\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :authors, force: true\r\n\r\n  create_table :books, force: true do |t|\r\n    t.integer :author_id\r\n  end\r\nend\r\n\r\nclass Author < ActiveRecord::Base\r\n  has_one :book\r\nend\r\n\r\nclass Book < ActiveRecord::Base\r\n  belongs_to :author\r\n  validates :author_id, uniqueness: true\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  include ActiveSupport::Testing::Assertions\r\n\r\n  def test_association_stuff\r\n    author = Author.create!\r\n    author.create_book!\r\n\r\n    assert_no_difference -> { Book.count } do\r\n      assert_raises ActiveRecord::RecordNotSaved do\r\n        author.create_book!\r\n      end\r\n    end\r\n  end\r\nend\r\n```", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48683/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48683/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48682", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48682/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48682/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48682/events", "html_url": "https://github.com/rails/rails/pull/48682", "id": 1792155863, "node_id": "PR_kwDNIULOVNe7NQ", "number": 48682, "title": "Introduce `config.dom_testing_default_html_version` and use Rails::Dom::Testing to parse HTML in test helpers", "user": {"login": "flavorjones", "id": 8207, "node_id": "MDQ6VXNlcjgyMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/8207?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flavorjones", "html_url": "https://github.com/flavorjones", "followers_url": "https://api.github.com/users/flavorjones/followers", "following_url": "https://api.github.com/users/flavorjones/following{/other_user}", "gists_url": "https://api.github.com/users/flavorjones/gists{/gist_id}", "starred_url": "https://api.github.com/users/flavorjones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flavorjones/subscriptions", "organizations_url": "https://api.github.com/users/flavorjones/orgs", "repos_url": "https://api.github.com/users/flavorjones/repos", "events_url": "https://api.github.com/users/flavorjones/events{/privacy}", "received_events_url": "https://api.github.com/users/flavorjones/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107188, "node_id": "MDU6TGFiZWwxMDcxODg=", "url": "https://api.github.com/repos/rails/rails/labels/actionmailer", "name": "actionmailer", "color": "8B00FC", "default": false, "description": null}, {"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}, {"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-06T20:03:36Z", "updated_at": "2023-08-03T21:20:44Z", "closed_at": "2023-08-03T17:47:59Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48682", "html_url": "https://github.com/rails/rails/pull/48682", "diff_url": "https://github.com/rails/rails/pull/48682.diff", "patch_url": "https://github.com/rails/rails/pull/48682.patch", "merged_at": "2023-08-03T17:47:59Z"}, "body": "### Motivation / Background\r\n\r\nSome early users of Rails edge reported test breakage due to the change in #48523 that updated test helpers to use Nokogiri's HTML5 parser.\r\n\r\nAfter discussing with Rafael, he suggested that we introduce a Rails config parameter so users may opt into this change at their convenience, essentially wrapping a config param around the changes in #48523.\r\n\r\nThis PR takes that idea a step further and groups all the test helpers from `ActionView::TestCase`, `ActionDispatch::Assertions`, and everything in `Rails::Dom::Testing` under a single config param:\r\n\r\n```\r\nconfig.dom_testing_default_html_version\r\n```\r\n\r\nAs a result, by setting this config to either `:html4` or `:html5`, a developer can control the HTML parser used by all the test helpers in Action View, Action Dispatch, and Rails::Dom::Testing; and some assertions support overriding that default for individual tests.\r\n\r\n### Detail\r\n\r\n- new config parameter `config.dom_testing_default_html_version`, which is injected into `Dom::Rails::Testing` via the railstie in https://github.com/rails/rails-dom-testing/pull/109\r\n  - the value of that param is `:html5` in Rails 7.1, and `:html4` in earlier config versions\r\n  - though, on JRuby, where Nokogiri::HTML5 is not supported, this will always be `:html4`\r\n- Action View and Dispatch test helpers use `Rails::Dom::Testing.html_document` or `.html_document_fragment` to ensure the desired HTML parser is used\r\n  - Update dependency on `rails-dom-testing` to `~> 2.2`\r\n\r\n### Additional information\r\n\r\nNote that integration testing across gems like this is challenging, but I have actually fired up a Rails app using this PR and https://github.com/rails/rails-dom-testing/pull/109 together, and it worked as expected.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48682/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48682/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48681", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48681/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48681/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48681/events", "html_url": "https://github.com/rails/rails/pull/48681", "id": 1792146155, "node_id": "PR_kwDNIULOVNeYEA", "number": 48681, "title": "Deprecate `name` argument in `remove_connection`", "user": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-06T19:57:23Z", "updated_at": "2023-07-06T20:15:23Z", "closed_at": "2023-07-06T20:15:21Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48681", "html_url": "https://github.com/rails/rails/pull/48681", "diff_url": "https://github.com/rails/rails/pull/48681.diff", "patch_url": "https://github.com/rails/rails/pull/48681.patch", "merged_at": "2023-07-06T20:15:21Z"}, "body": "The `name` argument is not useful as `remove_connection` should be called on the class that established the connection. Allowing `name` to be passed here doesn't match how any of the other methods behave on the connection classes. While this behavior has been around for a long time, I'm not sure anyone is using this as it's not documented when to use name, nor are there any tests.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48681/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48681/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48680", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48680/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48680/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48680/events", "html_url": "https://github.com/rails/rails/pull/48680", "id": 1792143132, "node_id": "PR_kwDNIULOVNeNNw", "number": 48680, "title": "Don't show secrets for `MessageVerifier#inspect` and `KeyGenerator#inspect`", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-06T19:55:12Z", "updated_at": "2023-07-11T07:50:36Z", "closed_at": "2023-07-10T17:56:18Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48680", "html_url": "https://github.com/rails/rails/pull/48680", "diff_url": "https://github.com/rails/rails/pull/48680.diff", "patch_url": "https://github.com/rails/rails/pull/48680.patch", "merged_at": "2023-07-10T17:56:18Z"}, "body": "### Motivation / Background\r\n\r\nIf anyone calls a cypher in the console it will show the secret of the encryptor.\r\n\r\nBy overriding the inspect method to only show the class name we can avoid accidentally outputting sensitive information.\r\n\r\n### Detail\r\n\r\nBefore:\r\n\r\n```ruby\r\nActiveSupport::MessageVerifier.new(secret).inspect\r\n\"#<ActiveSupport::MessageVerifier:0x0000000104888038 ... @secret=\\\"\\\\xAF\\\\bFh]LV}q\\\\nl\\\\xB2U\\\\xB3 ... >\"\r\nActiveSupport::KeyGenerator.new(secret).inspect\r\n\"#<ActiveSupport::KeyGenerator:0x0000000104888038 ... @secret=\\\"\\\\xAF\\\\bFh]LV}q\\\\nl\\\\xB2U\\\\xB3 ... >\"\r\n```\r\n\r\nAfter:\r\n\r\n```ruby\r\nActiveSupport::MessageVerifier::Aes256Gcm(secret).inspect\r\n\"#<ActiveSupport::MessageVerifier:0x0000000104888038>\"\r\nActiveSupport::KeyGenerator::Aes256Gcm(secret).inspect\r\n\"#<ActiveSupport::KeyGenerator:0x0000000104888038>\"\r\n```\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48680/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48680/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48679", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48679/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48679/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48679/events", "html_url": "https://github.com/rails/rails/pull/48679", "id": 1792118018, "node_id": "PR_kwDNIULOVNc0gw", "number": 48679, "title": "Don't show secrets for Active Record's `Cipher::Aes256Gcm#inspect`.", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-06T19:36:22Z", "updated_at": "2023-07-13T14:53:08Z", "closed_at": "2023-07-11T20:55:48Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48679", "html_url": "https://github.com/rails/rails/pull/48679", "diff_url": "https://github.com/rails/rails/pull/48679.diff", "patch_url": "https://github.com/rails/rails/pull/48679.patch", "merged_at": "2023-07-11T20:55:48Z"}, "body": "### Motivation / Background\r\n\r\nIf anyone calls a cypher in the console it will show the secret of the encryptor.\r\n\r\nBy overriding the `inspect` method to only show the class name we can avoid accidentally outputting sensitive information.\r\n\r\n### Detail\r\n\r\nBefore:\r\n\r\n```ruby\r\nActiveRecord::Encryption::Cipher::Aes256Gcm.new(secret).inspect\r\n\"#<ActiveRecord::Encryption::Cipher::Aes256Gcm:0x0000000104888038 ... @secret=\\\"\\\\xAF\\\\bFh]LV}q\\\\nl\\\\xB2U\\\\xB3 ... >\"\r\n```\r\n\r\nAfter:\r\n\r\n```ruby\r\nActiveRecord::Encryption::Cipher::Aes256Gcm(secret).inspect\r\n\"#<ActiveRecord::Encryption::Cipher::Aes256Gcm:0x0000000104888038>\"\r\n```\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48679/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48679/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48678", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48678/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48678/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48678/events", "html_url": "https://github.com/rails/rails/pull/48678", "id": 1791420611, "node_id": "PR_kwDNIULOVM3FiA", "number": 48678, "title": "Remove unused RedisCacheStore#redis_options", "user": {"login": "jdelStrother", "id": 2377, "node_id": "MDQ6VXNlcjIzNzc=", "avatar_url": "https://avatars.githubusercontent.com/u/2377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdelStrother", "html_url": "https://github.com/jdelStrother", "followers_url": "https://api.github.com/users/jdelStrother/followers", "following_url": "https://api.github.com/users/jdelStrother/following{/other_user}", "gists_url": "https://api.github.com/users/jdelStrother/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdelStrother/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdelStrother/subscriptions", "organizations_url": "https://api.github.com/users/jdelStrother/orgs", "repos_url": "https://api.github.com/users/jdelStrother/repos", "events_url": "https://api.github.com/users/jdelStrother/events{/privacy}", "received_events_url": "https://api.github.com/users/jdelStrother/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-06T12:00:39Z", "updated_at": "2023-07-06T13:08:40Z", "closed_at": "2023-07-06T13:08:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48678", "html_url": "https://github.com/rails/rails/pull/48678", "diff_url": "https://github.com/rails/rails/pull/48678.diff", "patch_url": "https://github.com/rails/rails/pull/48678.patch", "merged_at": "2023-07-06T13:08:33Z"}, "body": "The underlying ivar was removed in c07812cee2be727b334ed2c89ef1ceaa6b467447 / https://github.com/rails/rails/pull/48381\r\n\r\ncc @casperisfine \r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48678/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48678/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48677", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48677/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48677/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48677/events", "html_url": "https://github.com/rails/rails/pull/48677", "id": 1791342631, "node_id": "PR_kwDNIULOVMyz0g", "number": 48677, "title": "[ci-skip] Backport update in contribution guide to 7-0-stable branch", "user": {"login": "hachi8833", "id": 4289625, "node_id": "MDQ6VXNlcjQyODk2MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/4289625?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hachi8833", "html_url": "https://github.com/hachi8833", "followers_url": "https://api.github.com/users/hachi8833/followers", "following_url": "https://api.github.com/users/hachi8833/following{/other_user}", "gists_url": "https://api.github.com/users/hachi8833/gists{/gist_id}", "starred_url": "https://api.github.com/users/hachi8833/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hachi8833/subscriptions", "organizations_url": "https://api.github.com/users/hachi8833/orgs", "repos_url": "https://api.github.com/users/hachi8833/repos", "events_url": "https://api.github.com/users/hachi8833/events{/privacy}", "received_events_url": "https://api.github.com/users/hachi8833/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-06T11:14:18Z", "updated_at": "2023-07-12T09:28:00Z", "closed_at": "2023-07-12T09:27:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48677", "html_url": "https://github.com/rails/rails/pull/48677", "diff_url": "https://github.com/rails/rails/pull/48677.diff", "patch_url": "https://github.com/rails/rails/pull/48677.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because the recent updates in contribution guide are good for backport to 7-0-stable branch.\r\n\r\n### Detail\r\n\r\nThis Pull Request adds the following to 7-0-stable branch.\r\n\r\n- https://github.com/rails/rails/commit/e4002fcc40de73894ba416d5e932fbf11bd002b6\r\n- https://github.com/rails/rails/commit/11213ce8eb2f98435b0f642989fc3dbfd47ed8ef\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48677/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48677/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48676", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48676/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48676/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48676/events", "html_url": "https://github.com/rails/rails/pull/48676", "id": 1791297492, "node_id": "PR_kwDNIULOVMwVdA", "number": 48676, "title": "Fix queries for deterministically encrypted attributed for data migrated from 7.0", "user": {"login": "jorgemanrubia", "id": 129938, "node_id": "MDQ6VXNlcjEyOTkzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/129938?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jorgemanrubia", "html_url": "https://github.com/jorgemanrubia", "followers_url": "https://api.github.com/users/jorgemanrubia/followers", "following_url": "https://api.github.com/users/jorgemanrubia/following{/other_user}", "gists_url": "https://api.github.com/users/jorgemanrubia/gists{/gist_id}", "starred_url": "https://api.github.com/users/jorgemanrubia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jorgemanrubia/subscriptions", "organizations_url": "https://api.github.com/users/jorgemanrubia/orgs", "repos_url": "https://api.github.com/users/jorgemanrubia/repos", "events_url": "https://api.github.com/users/jorgemanrubia/events{/privacy}", "received_events_url": "https://api.github.com/users/jorgemanrubia/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-06T10:45:43Z", "updated_at": "2023-07-17T17:38:55Z", "closed_at": "2023-07-17T17:38:54Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48676", "html_url": "https://github.com/rails/rails/pull/48676", "diff_url": "https://github.com/rails/rails/pull/48676.diff", "patch_url": "https://github.com/rails/rails/pull/48676.patch", "merged_at": "2023-07-17T17:38:54Z"}, "body": "#48530 introduced a problem for the system that extends AR queries involving deterministically encrypted attributes. The problem is that this option added the same \"previous scheme\" for all the attributes, when the only intended ones were the \"non deterministic\" ones. A side effect of this is that, when encrypting query param values, it was using the wrong encryption scheme.\r\n\r\nFixes https://github.com/rails/rails/issues/48204#issuecomment-1623301440\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48676/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48676/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48675", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48675/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48675/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48675/events", "html_url": "https://github.com/rails/rails/issues/48675", "id": 1790872854, "node_id": "I_kwDNIULOar6NFg", "number": 48675, "title": "Potential bug with use of `create_#{association}!` method.", "user": {"login": "rishijain", "id": 946527, "node_id": "MDQ6VXNlcjk0NjUyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/946527?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rishijain", "html_url": "https://github.com/rishijain", "followers_url": "https://api.github.com/users/rishijain/followers", "following_url": "https://api.github.com/users/rishijain/following{/other_user}", "gists_url": "https://api.github.com/users/rishijain/gists{/gist_id}", "starred_url": "https://api.github.com/users/rishijain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rishijain/subscriptions", "organizations_url": "https://api.github.com/users/rishijain/orgs", "repos_url": "https://api.github.com/users/rishijain/repos", "events_url": "https://api.github.com/users/rishijain/events{/privacy}", "received_events_url": "https://api.github.com/users/rishijain/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 126910270, "node_id": "MDU6TGFiZWwxMjY5MTAyNzA=", "url": "https://api.github.com/repos/rails/rails/labels/With%20reproduction%20steps", "name": "With reproduction steps", "color": "009800", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-06T06:01:08Z", "updated_at": "2023-08-08T13:32:50Z", "closed_at": "2023-08-08T13:32:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n```\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", \"7.0.5\"\r\n  gem \"debug\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :users, force: true do |t|\r\n    t.references :totp_setting\r\n  end\r\n\r\n  create_table :totp_settings, force: true do |t|\r\n    t.references :user\r\n  end\r\nend\r\n\r\nclass User < ActiveRecord::Base\r\n  belongs_to :totp_setting, optional: true\r\n\r\n  after_create :setup_totp_setting\r\n\r\n  def setup_totp_setting\r\n    create_totp_setting!(user: self)\r\n  end\r\nend\r\n\r\nclass TotpSetting < ActiveRecord::Base\r\n  belongs_to :user, touch: true\r\n\r\n  before_create :set_parent\r\n\r\n  def set_parent\r\n    puts '1'*100\r\n    puts user.totp_setting\r\n  end\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_bug\r\n    @user = User.create!\r\n  end\r\nend\r\n```\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# Your reproduction script goes here\r\n```\r\n\r\n### Expected behavior\r\n\r\nIf you set the rails version to '7.0.4.3' and run the script, the puts statements would print\r\n```\r\n  1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\r\n  nil\r\n```\r\n\r\nIf you set the rails version to '7.0.5' and run the script, the puts statements would print\r\n```\r\n  1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\r\n  #<TotpSetting:0x00007fcd86d0da80>\r\n```\r\n\r\n\r\n### Actual behavior\r\nI don't know what behaviour is broken, is the Rails 7.0.4.3 correct or 7.0.5?\r\n\r\n### System configuration\r\n**Rails version**:\r\n7.0.4.3 & 7.0.5\r\n\r\n**Ruby version**:\r\n2.7.7\r\n\r\n### My analysis:\r\nThe difference in behaviour was introduced with this commit: https://github.com/rails/rails/commit/bdbe58b50461dc44c42df4d5427fa78aeb1debcb\r\n\r\nSpecifically this line https://github.com/rails/rails/blob/bdbe58b50461dc44c42df4d5427fa78aeb1debcb/activerecord/lib/active_record/associations/singular_association.rb#L58\r\n\r\nIf I change that to `build_record` instead of using `build` in Rails 7.0.5 code, it works the same way as 7.0.4.3.\r\nI understand the `build` method calls `build_record` internally and does an additional step `set_new_record` here https://github.com/rails/rails/blob/bdbe58b50461dc44c42df4d5427fa78aeb1debcb/activerecord/lib/active_record/associations/singular_association.rb#L22C8-L22C8.\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48675/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48675/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48674", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48674/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48674/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48674/events", "html_url": "https://github.com/rails/rails/pull/48674", "id": 1790771896, "node_id": "PR_kwDNIULOVMUEtA", "number": 48674, "title": "Fix has_one through singular building with inverse.", "user": {"login": "gmcgibbon", "id": 5162312, "node_id": "MDQ6VXNlcjUxNjIzMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5162312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gmcgibbon", "html_url": "https://github.com/gmcgibbon", "followers_url": "https://api.github.com/users/gmcgibbon/followers", "following_url": "https://api.github.com/users/gmcgibbon/following{/other_user}", "gists_url": "https://api.github.com/users/gmcgibbon/gists{/gist_id}", "starred_url": "https://api.github.com/users/gmcgibbon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gmcgibbon/subscriptions", "organizations_url": "https://api.github.com/users/gmcgibbon/orgs", "repos_url": "https://api.github.com/users/gmcgibbon/repos", "events_url": "https://api.github.com/users/gmcgibbon/events{/privacy}", "received_events_url": "https://api.github.com/users/gmcgibbon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-06T04:20:05Z", "updated_at": "2023-07-06T13:09:29Z", "closed_at": "2023-07-06T13:09:28Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48674", "html_url": "https://github.com/rails/rails/pull/48674", "diff_url": "https://github.com/rails/rails/pull/48674.diff", "patch_url": "https://github.com/rails/rails/pull/48674.patch", "merged_at": "2023-07-06T13:09:28Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because `has_one` `through:` behaviour is currently broken and crashed when trying to link build records.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes `ActiveRecord::Associations::ThroughAssociation` so that built record linking to inverse is skipped when the source reflection is singular (`has_one` / `belongs_to`). The code is only meant for collection associations.\r\n\r\n### Additional information\r\n\r\nI also noticed while debugging this that `record.build_<association>` does not include an attributes hash by default: https://github.com/rails/rails/blob/1d4c28858e6395d4cbf79c22af2442e65deca696/activerecord/lib/active_record/associations/builder/singular_association.rb#L32\r\n\r\nWhereas `record.<association>s.build` does: https://github.com/rails/rails/blob/1d4c28858e6395d4cbf79c22af2442e65deca696/activerecord/lib/active_record/associations/collection_proxy.rb#L318\r\n\r\nThis might be a bug, but singular association code seems to account for this, so I didn't bother to fix. It seems `ActiveRecord::Associations::ThroughAssociation#build_record` was the only code path where we assumed `attributes` is a hash.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48674/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48674/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48673", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48673/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48673/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48673/events", "html_url": "https://github.com/rails/rails/pull/48673", "id": 1790434812, "node_id": "PR_kwDNIULOVMBk1g", "number": 48673, "title": "Lay groundwork for replaceable cache compressor", "user": {"login": "jonathanhefner", "id": 771968, "node_id": "MDQ6VXNlcjc3MTk2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/771968?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonathanhefner", "html_url": "https://github.com/jonathanhefner", "followers_url": "https://api.github.com/users/jonathanhefner/followers", "following_url": "https://api.github.com/users/jonathanhefner/following{/other_user}", "gists_url": "https://api.github.com/users/jonathanhefner/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonathanhefner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonathanhefner/subscriptions", "organizations_url": "https://api.github.com/users/jonathanhefner/orgs", "repos_url": "https://api.github.com/users/jonathanhefner/repos", "events_url": "https://api.github.com/users/jonathanhefner/events{/privacy}", "received_events_url": "https://api.github.com/users/jonathanhefner/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T22:18:57Z", "updated_at": "2023-07-05T22:35:28Z", "closed_at": "2023-07-05T22:35:28Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48673", "html_url": "https://github.com/rails/rails/pull/48673", "diff_url": "https://github.com/rails/rails/pull/48673.diff", "patch_url": "https://github.com/rails/rails/pull/48673.patch", "merged_at": "2023-07-05T22:35:28Z"}, "body": "This extracts several small changes from #48451 in order to make #48451 easier to review.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48673/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48673/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48672", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48672/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48672/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48672/events", "html_url": "https://github.com/rails/rails/pull/48672", "id": 1790353946, "node_id": "PR_kwDNIULOVL9Bpw", "number": 48672, "title": "Refactor CollectionAssociation to improve thread-safety; Fixes #48671", "user": {"login": "mullican", "id": 347652, "node_id": "MDQ6VXNlcjM0NzY1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/347652?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mullican", "html_url": "https://github.com/mullican", "followers_url": "https://api.github.com/users/mullican/followers", "following_url": "https://api.github.com/users/mullican/following{/other_user}", "gists_url": "https://api.github.com/users/mullican/gists{/gist_id}", "starred_url": "https://api.github.com/users/mullican/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mullican/subscriptions", "organizations_url": "https://api.github.com/users/mullican/orgs", "repos_url": "https://api.github.com/users/mullican/repos", "events_url": "https://api.github.com/users/mullican/events{/privacy}", "received_events_url": "https://api.github.com/users/mullican/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T21:22:38Z", "updated_at": "2023-07-13T21:18:33Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48672", "html_url": "https://github.com/rails/rails/pull/48672", "diff_url": "https://github.com/rails/rails/pull/48672.diff", "patch_url": "https://github.com/rails/rails/pull/48672.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created to resolve race conditions in threaded code when loading instances of `CollectionAssociation` on an object which is shared across threads, as described in issue #48671\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the implementation of two methods to prevent them from mutating an instance variable in ways that would violate the expectations of other methods which rely on the state of that variable. \r\n\r\nSpecifically, in the current state, the instance variable `@target` is:\r\n\r\n1. Initialized as `nil`, then subsequently reinitialized to an empty array (many methods depend on it being enumerable and will raise errors if called during the window of time in which it is `nil`)\r\n2. Mutated by calling `delete` on each of its elements prior to overwriting it with a new value (creating a window of time where it contains partial data or no data)\r\n\r\nBoth of these situations present a race condition when the object is shared by multiple threads.\r\n\r\nThe changes in this pull request:\r\n1. Resolve the first issue by replacing a call to `super` with explicit initializations appropriate to the subclass\r\n2. Resolve the second issue by replacing the call to `delete` with an index lookup, which makes the reassignment behavior atomic.\r\n\r\n### Additional information\r\n\r\n**Performance**: the array lookup in `merge_target_lists` could be done in other ways; the `index` lookup measures at least as fast as `delete` on my hardware; other approaches using enumerable methods like `detect` would be slower.\r\n\r\n**Testing:** although the linked issue includes a test script that can demonstrate the problem, the nature of it is timing-dependent in a way that makes it difficult to write explicit tests to reproduce, and the changes are straightforward. I think that a lack of regression in existing tests should be sufficient verification.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] ~Tests are added or updated if you fix a bug or add a feature.~\r\n* [x] ~CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.~\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48672/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48672/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48671", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48671/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48671/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48671/events", "html_url": "https://github.com/rails/rails/issues/48671", "id": 1790337154, "node_id": "I_kwDNIULOarZggg", "number": 48671, "title": "Loading a CollectionAssociation is not threadsafe in all contexts", "user": {"login": "mullican", "id": 347652, "node_id": "MDQ6VXNlcjM0NzY1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/347652?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mullican", "html_url": "https://github.com/mullican", "followers_url": "https://api.github.com/users/mullican/followers", "following_url": "https://api.github.com/users/mullican/following{/other_user}", "gists_url": "https://api.github.com/users/mullican/gists{/gist_id}", "starred_url": "https://api.github.com/users/mullican/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mullican/subscriptions", "organizations_url": "https://api.github.com/users/mullican/orgs", "repos_url": "https://api.github.com/users/mullican/repos", "events_url": "https://api.github.com/users/mullican/events{/privacy}", "received_events_url": "https://api.github.com/users/mullican/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T21:13:21Z", "updated_at": "2023-07-24T17:33:57Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\nThe superclass `CollectionAssociation` applies to `has_many` and HABTM relations. Its implementation of the `load_target` method relies on the value of an instance variable `@target` which is initialized in `reset` to an empty array. When a given association has not been loaded, this variable is passed as an argument to the method `merge_target_lists`, where database results are compared to the current copy of the records held in memory.\r\n\r\nThis presents two potential race conditions in threaded code:\r\n1. The `reset` method calls `super` before assigning the empty array to `@target`. On the `Association` superclass, `@target` is assigned as `nil`, so there is a brief moment between the two assignments where it may evaluate as `nil`. Many methods on `CollectionAssociation` assume that its value is always an array and will throw a `NoMethodError` exception if called in this state.\r\n2. The implementation of `merge_target_lists` mutates the value of the passed argument by calling `delete` on its elements before subsequently returning a final result back to the caller, where it is reassigned to the `@target` variable. Thus, there is also a brief moment, while this method is iterating over a result set, where `@target` may contain either partial data or no data. If another thread relies on the value of `@target` at this point in time, it will see inconsistent results.\r\n\r\nConsider the following scenario:\r\n```ruby\r\nclass Post < ApplicationRecord\r\n  has_many :comments\r\nend\r\n\r\n@post = Post.find(1)\r\nThread.new { @post.comments.do_some_work }\r\nThread.new { @post.comments.do_other_work }\r\n```\r\n\r\n### Expected behavior\r\nBecause the call to `comments` will lazily load the association, and there is no guaranteed order of execution, either thread, or both, may load records from the database, depending on when the value of `@loaded` is read and written. However, the load should occur atomically, so that if both threads evaluate `@loaded` as false, they both fetch and return the correct records consistently. In the current implementation, a thread in this scenario may see no data, partial data, or throw an exception.\r\n\r\n### Actual behavior\r\nFor example:\r\n```ruby\r\n@post = Post.first\r\nexpected_result_count = @post.comments.count\r\nthread_count = @post.class.connection_pool.size-1\r\n\r\n1_000.times { |i|\r\n  @post.association(:comments).reset\r\n  thread_count.times.map { |j|\r\n    Thread.new {\r\n      begin\r\n        actual_count = @post.comments.load.size\r\n        if actual_count != expected_result_count\r\n          STDOUT.puts \"Thread ##{j}[#{i}]: Expected #{expected_result_count}, found #{actual_count}\"\r\n        end\r\n      rescue => e\r\n        STDOUT.puts \"Thread ##{j}[#{i}]: Caught exception #{e}\"\r\n      end\r\n    }\r\n  }.each(&:join)\r\n}\r\n```\r\n\r\nOutput of an example run on my hardware, using 50 threads with 1K iterations \u2014 14 of the 50K loads returned inconsistent data or errors:\r\n```\r\nThread #5[246]: Caught exception undefined method `persisted?' for nil:NilClass\r\nThread #20[246]: Caught exception undefined method `persisted?' for nil:NilClass\r\nThread #29[246]: Caught exception undefined method `persisted?' for nil:NilClass\r\nThread #40[246]: Caught exception undefined method `persisted?' for nil:NilClass\r\nThread #41[246]: Caught exception undefined method `persisted?' for nil:NilClass\r\nThread #36[246]: Caught exception undefined method `persisted?' for nil:NilClass\r\nThread #49[246]: Caught exception undefined method `persisted?' for nil:NilClass\r\nThread #45[268]: Expected 500, found 468\r\nThread #42[268]: Expected 500, found 468\r\nThread #39[268]: Expected 500, found 468\r\nThread #49[268]: Expected 500, found 468\r\nThread #46[495]: Expected 500, found 469\r\nThread #46[533]: Expected 500, found 454\r\nThread #47[810]: Caught exception undefined method `persisted?' for nil:NilClass\r\n```\r\n\r\n### System configuration\r\n**Rails version**: 6.1, 7.0\r\n**Ruby version**: 3.0, 3.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48671/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48671/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48670", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48670/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48670/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48670/events", "html_url": "https://github.com/rails/rails/pull/48670", "id": 1790188932, "node_id": "PR_kwDNIULOVLzyIQ", "number": 48670, "title": "Fix flaky time test", "user": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T19:44:46Z", "updated_at": "2023-07-05T20:06:32Z", "closed_at": "2023-07-05T20:06:31Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48670", "html_url": "https://github.com/rails/rails/pull/48670", "diff_url": "https://github.com/rails/rails/pull/48670.diff", "patch_url": "https://github.com/rails/rails/pull/48670.patch", "merged_at": "2023-07-05T20:06:31Z"}, "body": "A combination of 3 tests using the `Topic` model and working with timezones would cause the time test to fail. I noticed that one of the tests required to reproduce changes the configured timezone for `Topic` but doesn't reset column information. Adding that fixes the flaky test.\r\n\r\nFixes #48664\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48670/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48670/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48669", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48669/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48669/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48669/events", "html_url": "https://github.com/rails/rails/pull/48669", "id": 1790180006, "node_id": "PR_kwDNIULOVLzROw", "number": 48669, "title": "Improve performance of JSON HTML entity escaping", "user": {"login": "jhawthorn", "id": 131752, "node_id": "MDQ6VXNlcjEzMTc1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/131752?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhawthorn", "html_url": "https://github.com/jhawthorn", "followers_url": "https://api.github.com/users/jhawthorn/followers", "following_url": "https://api.github.com/users/jhawthorn/following{/other_user}", "gists_url": "https://api.github.com/users/jhawthorn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhawthorn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhawthorn/subscriptions", "organizations_url": "https://api.github.com/users/jhawthorn/orgs", "repos_url": "https://api.github.com/users/jhawthorn/repos", "events_url": "https://api.github.com/users/jhawthorn/events{/privacy}", "received_events_url": "https://api.github.com/users/jhawthorn/received_events", "type": "User", "site_admin": true}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-07-05T19:41:19Z", "updated_at": "2023-08-18T06:12:14Z", "closed_at": "2023-07-31T21:15:44Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48669", "html_url": "https://github.com/rails/rails/pull/48669", "diff_url": "https://github.com/rails/rails/pull/48669.diff", "patch_url": "https://github.com/rails/rails/pull/48669.patch", "merged_at": "2023-07-31T21:15:44Z"}, "body": "This improves `.to_json` performance to be another ~2x faster (now ~4.5 faster than Rails 7.0)\r\n\r\nIn this case (likely not others!), running `gsub!` 5 times with string arguments seems to be faster than running it once with a regex and Hash.\r\n\r\nWhen there are matches to the regex (there are characters to escape) this is faster in part because CRuby will allocate a new match object and string as a key to lookup in the map hash provided. It's possible that could be optimized upstream, but at the moment this avoids those allocations.\r\n\r\nSurprisingly (at least to me) this is still much faster when there is no replacement needed: in my test ~3x faster on a short ~200 byte string, and ~5x faster on a pre-escaped ~600k twitter.json.\r\n\r\n## Benchmarks\r\n\r\n### Just escaping\r\n\r\n<details>\r\n<summary>script</summary>\r\n\r\n``` ruby\r\nrequire \"rails/all\"\r\nrequire \"benchmark/ips\"\r\nrequire \"json_escape\"\r\n\r\n\r\nsource_file = ENV[\"FILE\"] || \"twitter.json\"\r\njson = File.read(source_file).freeze\r\n\r\nESCAPED_CHARS = {\r\n  \"\\u2028\" => '\\u2028',\r\n  \"\\u2029\" => '\\u2029',\r\n  \">\"      => '\\u003e',\r\n  \"<\"      => '\\u003c',\r\n  \"&\"      => '\\u0026',\r\n}\r\n\r\nescaped_json = json.gsub(/[\\u2028\\u2029><&]/u, ESCAPED_CHARS).freeze\r\n\r\nBenchmark.ips do |x|\r\n  x.report(\"original\") do\r\n    s = json.dup\r\n    s.gsub!(/[\\u2028\\u2029><&]/u, ESCAPED_CHARS)\r\n  end\r\n  x.report(\"original (noop)\") do\r\n    s = escaped_json.dup\r\n    s.gsub!(/[\\u2028\\u2029><&]/u, ESCAPED_CHARS)\r\n  end\r\n  x.report(\"gsub(str) x 5\") do\r\n    s = json.dup\r\n    s.gsub!(\">\", '\\u003e')\r\n    s.gsub!(\"<\", '\\u003c')\r\n    s.gsub!(\"&\", '\\u0026')\r\n    s.gsub!(\"\\u2028\", '\\u2028')\r\n    s.gsub!(\"\\u2029\", '\\u2029')\r\n  end\r\n  x.report(\"gsub(str) x 5 (noop)\") do\r\n    s = escaped_json.dup\r\n    s.gsub!(\">\", '\\u003e')\r\n    s.gsub!(\"<\", '\\u003c')\r\n    s.gsub!(\"&\", '\\u0026')\r\n    s.gsub!(\"\\u2028\", '\\u2028')\r\n    s.gsub!(\"\\u2029\", '\\u2029')\r\n  end\r\n  x.report(\"gsub(ascii_re) + gsub(utf8)\") do\r\n    s = json.dup\r\n    s.gsub!(/[<>&]/, ESCAPED_CHARS)\r\n    s.gsub!(\"\\u2028\", '\\u2028')\r\n    s.gsub!(\"\\u2029\", '\\u2029')\r\n  end\r\n  x.report(\"gsub(ascii_re) + gsub(utf8) (noop)\") do\r\n    s = escaped_json.dup\r\n    s.gsub!(/[<>&]/, ESCAPED_CHARS)\r\n    s.gsub!(\"\\u2028\", '\\u2028')\r\n    s.gsub!(\"\\u2029\", '\\u2029')\r\n  end\r\n  x.report(\"json_escape gem\") do\r\n    JsonEscape.json_escape(json)\r\n  end\r\n  x.compare!\r\nend\r\n```\r\n\r\n`short.json` is\r\n\r\n```\r\n{\"locale\":\"en\",\"featureFlags\":[\"redactedredactedredact\",\"redactedredactedredac\",\"redactedredactedre\",\"redactedredactedred\",\"redactedredact\",\"redactedredactedredacted\",\"redactedredactedredactedr\"]}\r\n```\r\n\r\n</details>\r\n\r\n```\r\n$ FILE=twitter.json be ruby benchmark_escaping2.rb\r\nWarming up --------------------------------------\r\n            original     9.000  i/100ms\r\n     original (noop)    10.000  i/100ms\r\n       gsub(str) x 5    44.000  i/100ms\r\ngsub(str) x 5 (noop)   229.000  i/100ms\r\ngsub(ascii_re) + gsub(utf8)\r\n                        25.000  i/100ms\r\ngsub(ascii_re) + gsub(utf8) (noop)\r\n                        32.000  i/100ms\r\n     json_escape gem   919.000  i/100ms\r\nCalculating -------------------------------------\r\n            original     94.573  (\u00b1 0.0%) i/s -    477.000  in   5.043877s\r\n     original (noop)    100.715  (\u00b1 0.0%) i/s -    510.000  in   5.063885s\r\n       gsub(str) x 5    496.012  (\u00b1 7.9%) i/s -      2.464k in   5.002329s\r\ngsub(str) x 5 (noop)      2.302k (\u00b1 0.7%) i/s -     11.679k in   5.074632s\r\ngsub(ascii_re) + gsub(utf8)\r\n                        257.878  (\u00b1 0.8%) i/s -      1.300k in   5.041332s\r\ngsub(ascii_re) + gsub(utf8) (noop)\r\n                        321.248  (\u00b1 0.6%) i/s -      1.632k in   5.080333s\r\n     json_escape gem      8.958k (\u00b1 0.3%) i/s -     45.031k in   5.026965s\r\n\r\nComparison:\r\n     json_escape gem:     8958.0 i/s\r\ngsub(str) x 5 (noop):     2301.5 i/s - 3.89x  slower\r\n       gsub(str) x 5:      496.0 i/s - 18.06x  slower\r\ngsub(ascii_re) + gsub(utf8) (noop):      321.2 i/s - 27.88x  slower\r\ngsub(ascii_re) + gsub(utf8):      257.9 i/s - 34.74x  slower\r\n     original (noop):      100.7 i/s - 88.94x  slower\r\n            original:       94.6 i/s - 94.72x  slower\r\n```\r\n\r\n```\r\n$ FILE=short.json be ruby benchmark_escaping2.rb\r\nWarming up --------------------------------------\r\n            original    26.846k i/100ms\r\n     original (noop)    27.998k i/100ms\r\n       gsub(str) x 5    82.923k i/100ms\r\ngsub(str) x 5 (noop)    83.683k i/100ms\r\ngsub(ascii_re) + gsub(utf8)\r\n                       103.509k i/100ms\r\ngsub(ascii_re) + gsub(utf8) (noop)\r\n                       103.445k i/100ms\r\n     json_escape gem     1.424M i/100ms\r\nCalculating -------------------------------------\r\n            original    279.761k (\u00b1 1.6%) i/s -      1.423M in   5.087410s\r\n     original (noop)    279.118k (\u00b1 2.1%) i/s -      1.400M in   5.017966s\r\n       gsub(str) x 5    835.196k (\u00b1 0.5%) i/s -      4.229M in   5.063709s\r\ngsub(str) x 5 (noop)    832.362k (\u00b1 0.9%) i/s -      4.184M in   5.027225s\r\ngsub(ascii_re) + gsub(utf8)\r\n                          1.028M (\u00b1 0.7%) i/s -      5.175M in   5.035134s\r\ngsub(ascii_re) + gsub(utf8) (noop)\r\n                          1.032M (\u00b1 0.5%) i/s -      5.172M in   5.014163s\r\n     json_escape gem     14.476M (\u00b1 0.7%) i/s -     72.617M in   5.016768s\r\n\r\nComparison:\r\n     json_escape gem: 14475588.1 i/s\r\ngsub(ascii_re) + gsub(utf8) (noop):  1031551.3 i/s - 14.03x  slower\r\ngsub(ascii_re) + gsub(utf8):  1027913.4 i/s - 14.08x  slower\r\n       gsub(str) x 5:   835196.3 i/s - 17.33x  slower\r\ngsub(str) x 5 (noop):   832361.5 i/s - 17.39x  slower\r\n            original:   279761.3 i/s - 51.74x  slower\r\n     original (noop):   279117.6 i/s - 51.86x  slower\r\n```\r\n\r\n`json_escape` is the same escaping implemented in C (please don't use this gem, if it's something we need we should find a different home for it)\r\n\r\nOn a short string, performing the ASCII portion of escaping as a regex and then the unicode portion as strings seems optimal, but it's not that much faster than the 5 gsub! approach, so I stick with that for simplicity and for the significantly better performance on long strings.\r\n\r\n### to_json\r\n\r\nUsing the same benchmark as #48614. `JSON.generate` and `RapidJSON.generate` are for scale, they don't perform the extra escaping described here.\r\n\r\n**Before:**\r\n```\r\nCalculating -------------------------------------\r\n source_data.to_json     74.671  (\u00b1 1.3%) i/s -    378.000  in   5.062521s\r\nsource_data_sym.to_json\r\n                         76.969  (\u00b1 0.0%) i/s -    385.000  in   5.002087s\r\nJSON.generate(source_data)\r\n                        576.164  (\u00b1 1.2%) i/s -      2.916k in   5.061908s\r\nRapidJSON.generate(source_data)\r\n                        852.714  (\u00b1 3.2%) i/s -      4.316k in   5.067053s\r\n```\r\n\r\n**After:**\r\n\r\n```\r\nCalculating -------------------------------------\r\n source_data.to_json    142.762  (\u00b1 2.1%) i/s -    715.000  in   5.010974s\r\nsource_data_sym.to_json\r\n                        150.613  (\u00b1 2.0%) i/s -    756.000  in   5.021137s\r\nJSON.generate(source_data)\r\n                        575.412  (\u00b1 1.0%) i/s -      2.915k in   5.066603s\r\nRapidJSON.generate(source_data)\r\n                        873.174  (\u00b1 2.9%) i/s -      4.368k in   5.006853s\r\n```\r\n\r\nAbout 2x faster than #48614 and 4.5x faster than Rails 7.0.\r\n\r\n\r\n## Next?\r\n\r\nThis is much faster but escaping still has an impact on performance (though it's no longer the majority). One thing we could do is rewrite the escaping in a C extension (ideally upstreaming it into a standard library). However I think first we need to confirm that this is really how we should be escaping in 2023 and beyond.\r\n\r\n@matthewd and I looked into this and we may only need to escape [`<script`, `</script>`, and `<!--`](https://html.spec.whatwg.org/multipage/scripting.html#restrictions-for-contents-of-script-elements) (assuming we're only targeting HTML5 vs this was likely intended for XHTML). The quirk of JSON/JavaScript interop which required our handling of U+2028 and U+2029 is also [no longer a concern as of ES2019](https://github.com/tc39/proposal-json-superset) which is now [widely available](https://caniuse.com/mdn-javascript_builtins_json_json_superset).\r\n\r\nThat's all outside the scope of this PR though, which provides a performance gain without any change to escaping behaviour.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48669/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48669/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48668", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48668/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48668/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48668/events", "html_url": "https://github.com/rails/rails/issues/48668", "id": 1790031012, "node_id": "I_kwDNIULOarG0pA", "number": 48668, "title": "BSON Document Deep_transform_keys not converting keys to symbols", "user": {"login": "mekasudheer", "id": 77742690, "node_id": "MDQ6VXNlcjc3NzQyNjkw", "avatar_url": "https://avatars.githubusercontent.com/u/77742690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mekasudheer", "html_url": "https://github.com/mekasudheer", "followers_url": "https://api.github.com/users/mekasudheer/followers", "following_url": "https://api.github.com/users/mekasudheer/following{/other_user}", "gists_url": "https://api.github.com/users/mekasudheer/gists{/gist_id}", "starred_url": "https://api.github.com/users/mekasudheer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mekasudheer/subscriptions", "organizations_url": "https://api.github.com/users/mekasudheer/orgs", "repos_url": "https://api.github.com/users/mekasudheer/repos", "events_url": "https://api.github.com/users/mekasudheer/events{/privacy}", "received_events_url": "https://api.github.com/users/mekasudheer/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-05T18:00:06Z", "updated_at": "2023-07-05T18:11:43Z", "closed_at": "2023-07-05T18:11:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\n```ruby\r\n  I see that this issue is coming because we are not converting to hash, instead using the same object at \r\n  `https://github.com/rails/rails/commit/f5e597638853e5550509347254889d50c738ea56` \r\n  BSON::Document.new('hello' => {\"hello\" => {\"hello\" => 'world'}}).deep_transform_keys(&:to_sym) should convert all the keys to symbols.\r\n```\r\n\r\n### Expected behavior\r\n{:hello=>{:hello=>{:hello=>\"world\"}}}\r\n\r\n### Actual behavior\r\n{\"hello\"=>{\"hello\"=>{\"hello\"=>\"world\"}}}\r\n\r\n### System configuration\r\n**Rails version**: 7.0.5 & 7.0.6\r\n\r\n**Ruby version**: 3.0.6\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48668/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48668/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48667", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48667/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48667/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48667/events", "html_url": "https://github.com/rails/rails/pull/48667", "id": 1789988047, "node_id": "PR_kwDNIULOVLoyTQ", "number": 48667, "title": "Add ruby2_keywords to ActionView::TestCase#method_missing", "user": {"login": "igor-drozdov", "id": 3660805, "node_id": "MDQ6VXNlcjM2NjA4MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/3660805?v=4", "gravatar_id": "", "url": "https://api.github.com/users/igor-drozdov", "html_url": "https://github.com/igor-drozdov", "followers_url": "https://api.github.com/users/igor-drozdov/followers", "following_url": "https://api.github.com/users/igor-drozdov/following{/other_user}", "gists_url": "https://api.github.com/users/igor-drozdov/gists{/gist_id}", "starred_url": "https://api.github.com/users/igor-drozdov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/igor-drozdov/subscriptions", "organizations_url": "https://api.github.com/users/igor-drozdov/orgs", "repos_url": "https://api.github.com/users/igor-drozdov/repos", "events_url": "https://api.github.com/users/igor-drozdov/events{/privacy}", "received_events_url": "https://api.github.com/users/igor-drozdov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T17:26:32Z", "updated_at": "2023-07-06T21:24:50Z", "closed_at": "2023-07-06T21:24:49Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48667", "html_url": "https://github.com/rails/rails/pull/48667", "diff_url": "https://github.com/rails/rails/pull/48667.diff", "patch_url": "https://github.com/rails/rails/pull/48667.patch", "merged_at": "2023-07-06T21:24:49Z"}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because RSpec predicates in helper tests fail with the following error:\r\n\r\n```ruby\r\nexpect(helper).to be_something(project: project)\r\n```\r\n\r\nError:\r\n\r\n```ruby\r\nArgumentError:\r\n  wrong number of arguments (given 1, expected 0; required keyword: project)\r\n```\r\n\r\n### Detail\r\n\r\nThese matches rely on method_missing chain and Ruby 3.2 requires every method in the chain to use ruby2_keywords (if it uses `*args`): https://www.ruby-lang.org/en/news/2022/12/25/ruby-3-2-0-released/\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48667/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48667/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48666", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48666/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48666/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48666/events", "html_url": "https://github.com/rails/rails/issues/48666", "id": 1789911189, "node_id": "I_kwDNIULOaq_glQ", "number": 48666, "title": "New Rails project fails to find Redis \"Could not find gem 'redis (~> 4.0)' in locally installed gems.\"", "user": {"login": "softwaregravy", "id": 426690, "node_id": "MDQ6VXNlcjQyNjY5MA==", "avatar_url": "https://avatars.githubusercontent.com/u/426690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/softwaregravy", "html_url": "https://github.com/softwaregravy", "followers_url": "https://api.github.com/users/softwaregravy/followers", "following_url": "https://api.github.com/users/softwaregravy/following{/other_user}", "gists_url": "https://api.github.com/users/softwaregravy/gists{/gist_id}", "starred_url": "https://api.github.com/users/softwaregravy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/softwaregravy/subscriptions", "organizations_url": "https://api.github.com/users/softwaregravy/orgs", "repos_url": "https://api.github.com/users/softwaregravy/repos", "events_url": "https://api.github.com/users/softwaregravy/events{/privacy}", "received_events_url": "https://api.github.com/users/softwaregravy/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-05T16:36:02Z", "updated_at": "2023-07-05T18:34:32Z", "closed_at": "2023-07-05T18:34:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n```zsh\r\n# gem install rails\r\n# rails new ./ -d postgresql -T --skip-system-test -c tailwind\r\n```\r\n\r\n### Expected behavior\r\nSuccess!\r\n\r\n### Actual behavior\r\n\r\nFull output available [here](https://github.com/softwaregravy/test_rails_new_error)\r\n\r\nfirst error:\r\n```zsh\r\nBundle complete! 13 Gemfile dependencies, 62 gems now installed.\r\nUse `bundle info [gemname]` to see where a bundled gem is installed.\r\n         run  bundle binstubs bundler\r\n       rails  importmap:install\r\nAdd Importmap include tags in application layout\r\n      insert  app/views/layouts/application.html.erb\r\nCreate application.js module as entrypoint\r\n      create  app/javascript/application.js\r\nUse vendor/javascript for downloaded pins\r\n      create  vendor/javascript\r\n      create  vendor/javascript/.keep\r\nEnsure JavaScript files are in the Sprocket manifest\r\n      append  app/assets/config/manifest.js\r\nConfigure importmap paths in config/importmap.rb\r\n      create  config/importmap.rb\r\nCopying binstub\r\n      create  bin/importmap\r\n       rails  turbo:install stimulus:install\r\nImport Turbo\r\n      append  app/javascript/application.js\r\nPin Turbo\r\n      append  config/importmap.rb\r\nEnable redis in bundle\r\n        gsub  Gemfile\r\n         run  bundle install\r\n[92801, #<Thread:0x000000010262cd40 run>, #<NameError: uninitialized constant Gem::Source\r\n\r\n      (defined?(@source) && @source) || Gem::Source::Installed.new\r\n\r\n```\r\n\r\nSecond error / root cause?:\r\n```zsh\r\nCould not find gem 'redis (~> 4.0)' in locally installed gems.\r\nRun `bundle install` to install missing gems.\r\n       rails  tailwindcss:install\r\nCould not find gem 'redis (~> 4.0)' in locally installed gems.\r\nRun `bundle install` to install missing gems.\r\n```\r\n\r\n### System configuration\r\n**Rails version**:  7.0.6\r\n\r\n**Ruby version**: 3.1.2p20\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48666/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48666/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48665", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48665/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48665/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48665/events", "html_url": "https://github.com/rails/rails/pull/48665", "id": 1789843570, "node_id": "PR_kwDNIULOVLg3kA", "number": 48665, "title": "Fix counter_cache create/concat with overlapping counter_cache_column", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-05T15:52:20Z", "updated_at": "2023-07-13T12:02:31Z", "closed_at": "2023-07-13T11:57:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48665", "html_url": "https://github.com/rails/rails/pull/48665", "diff_url": "https://github.com/rails/rails/pull/48665.diff", "patch_url": "https://github.com/rails/rails/pull/48665.patch", "merged_at": "2023-07-13T11:57:45Z"}, "body": "Fix: https://github.com/rails/rails/pull/41250\r\nFix: https://github.com/rails/rails/pull/41321\r\n\r\nFix when multiple `belongs_to` maps to the same counter_cache column. In such situation `inverse_which_updates_counter_cache` may find the wrong relation which leads into an invalid increment of the counter_cache.\r\n\r\nThis is done by releying on the `inverse_of` property of the relation as well as comparing the models the association points two.\r\n\r\nNote however that this second check doesn't work for polymorphic associations.\r\n\r\nMost if not al of the credit goes to @intrip as this is just a cleanup of https://github.com/rails/rails/pull/41321. I simply replaced the `rescue` by a proper check for `polymorphic?`.\r\n\r\nFYI: @kylefox ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48665/reactions", "total_count": 3, "+1": 0, "-1": 0, "laugh": 0, "hooray": 3, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48665/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48664", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48664/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48664/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48664/events", "html_url": "https://github.com/rails/rails/issues/48664", "id": 1789794051, "node_id": "I_kwDNIULOaq4XAw", "number": 48664, "title": "`ActiveRecord::Type::TimeTest#test_default_year_is_correct` gets failed", "user": {"login": "yahonda", "id": 73684, "node_id": "MDQ6VXNlcjczNjg0", "avatar_url": "https://avatars.githubusercontent.com/u/73684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yahonda", "html_url": "https://github.com/yahonda", "followers_url": "https://api.github.com/users/yahonda/followers", "following_url": "https://api.github.com/users/yahonda/following{/other_user}", "gists_url": "https://api.github.com/users/yahonda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yahonda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yahonda/subscriptions", "organizations_url": "https://api.github.com/users/yahonda/orgs", "repos_url": "https://api.github.com/users/yahonda/repos", "events_url": "https://api.github.com/users/yahonda/events{/privacy}", "received_events_url": "https://api.github.com/users/yahonda/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T15:23:44Z", "updated_at": "2023-07-05T20:06:33Z", "closed_at": "2023-07-05T20:06:33Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Managed to reproduce CI failure https://buildkite.com/rails/rails/builds/97816#01892608-a43f-4b21-b269-583051fb425e\r\n\r\n\r\n### Steps to reproduce\r\n\r\n```ruby\r\ngit clone https://github.com/rails/rails\r\ncd rails\r\nrm Gemfile.lock\r\nbundle install\r\ncd activerecord\r\nARCONN=mysql2 bin/test test/cases/attribute_methods_test.rb test/cases/yaml_serialization_test.rb test/cases/type/time_test.rb --seed 34223 -n \"/^(?:AttributeMethodsTest#(?:test_YAML_dumping_a_record_with_time_zone-aware_attribute)|YamlSerializationTest#(?:test_to_yaml_with_time_with_zone_should_not_raise_exception)|ActiveRecord::Type::TimeTest#(?:test_default_year_is_correct))$/\"\r\n```\r\n\r\n### Expected behavior\r\nIt should pass.\r\n\r\n### Actual behavior\r\nIt gets NoMethodError: undefined method `local_to_utc' for nil:NilClass\r\n\r\n```ruby\r\n$ ARCONN=mysql2 bin/test test/cases/attribute_methods_test.rb test/cases/yaml_serialization_test.rb test/cases/type/time_test.rb --seed 34223 -n \"/^(?:AttributeMethodsTest#(?:test_YAML_dumping_a_record_with_time_zone-aware_attribute)|YamlSerializationTest#(?:test_to_yaml_with_time_with_zone_should_not_raise_exception)|ActiveRecord::Type::TimeTest#(?:test_default_year_is_correct))$/\"\r\nUsing mysql2\r\nRun options: --seed 34223 -n \"/^(?:AttributeMethodsTest#(?:test_YAML_dumping_a_record_with_time_zone-aware_attribute)|YamlSerializationTest#(?:test_to_yaml_with_time_with_zone_should_not_raise_exception)|ActiveRecord::Type::TimeTest#(?:test_default_year_is_correct))$/\"\r\n\r\n# Running:\r\n\r\n..E\r\n\r\nError:\r\nActiveRecord::Type::TimeTest#test_default_year_is_correct:\r\nNoMethodError: undefined method `local_to_utc' for nil:NilClass\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/lib/active_record/attribute_methods/time_zone_conversion.rb:49:in `set_time_zone_without_conversion'\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/lib/active_record/attribute_methods/time_zone_conversion.rb:21:in `cast'\r\n    /home/yahonda/src/github.com/rails/rails/activemodel/lib/active_model/attribute.rb:199:in `type_cast'\r\n    /home/yahonda/src/github.com/rails/rails/activemodel/lib/active_model/attribute.rb:43:in `value'\r\n    /home/yahonda/src/github.com/rails/rails/activemodel/lib/active_model/attribute_set.rb:51:in `fetch_value'\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/lib/active_record/attribute_methods/read.rb:45:in `_read_attribute'\r\n    /home/yahonda/src/github.com/rails/rails/activemodel/lib/active_model/attribute_methods.rb:271:in `bonus_time'\r\n    /home/yahonda/src/github.com/rails/rails/activerecord/test/cases/type/time_test.rb:13:in `test_default_year_is_correct'\r\n\r\n\r\nbin/test test/cases/type/time_test.rb:9\r\n\r\n\r\n\r\nFinished in 0.076464s, 39.2341 runs/s, 26.1561 assertions/s.\r\n3 runs, 2 assertions, 0 failures, 1 errors, 0 skips\r\n$\r\n```\r\n\r\n### System configuration\r\n**Rails version**: main branch\r\n\r\n**Ruby version**: ruby 3.2.2 (2023-03-30 revision e51014f9c0) [x86_64-linux]\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48664/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48664/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48663", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48663/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48663/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48663/events", "html_url": "https://github.com/rails/rails/pull/48663", "id": 1789707176, "node_id": "PR_kwDNIULOVLZamw", "number": 48663, "title": "Make Active Support Cache treat deserialization errors like cache misses", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T14:37:47Z", "updated_at": "2023-07-06T09:03:07Z", "closed_at": "2023-07-06T09:03:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48663", "html_url": "https://github.com/rails/rails/pull/48663", "diff_url": "https://github.com/rails/rails/pull/48663.diff", "patch_url": "https://github.com/rails/rails/pull/48663.patch", "merged_at": "2023-07-06T09:03:07Z"}, "body": "Fix: https://github.com/rails/rails/issues/48611\r\n\r\nThis help treating caches entries as expandable.\r\n\r\nBecause Marshal will hapily serialize almost everything, It's not uncommon to inadvertently cache a class that's not particularly stable, and cause deserialization errors on rollout when the implementation changes.\r\n\r\nE.g. https://github.com/sporkmonger/addressable/pull/508\r\n\r\nFYI: @jonathanhefner @matthewd @matthutchinson", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48663/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48663/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48662", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48662/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48662/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48662/events", "html_url": "https://github.com/rails/rails/pull/48662", "id": 1789633658, "node_id": "PR_kwDNIULOVLVb1A", "number": 48662, "title": "Fix MemCacheStore not warning on 6.1 cache format", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T14:01:04Z", "updated_at": "2023-07-06T14:27:04Z", "closed_at": "2023-07-06T13:10:51Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48662", "html_url": "https://github.com/rails/rails/pull/48662", "diff_url": "https://github.com/rails/rails/pull/48662.diff", "patch_url": "https://github.com/rails/rails/pull/48662.patch", "merged_at": "2023-07-06T13:10:51Z"}, "body": "### Motivation / Background\r\n\r\nWhile working on fixing some deprecation warnings introduced when the 6.1 cache_format deprecation was [moved][1] to be on usage, I found that the MemCacheStore actually has its own `default_coder` method.\r\n\r\n### Detail\r\n\r\nThis adds the warning to MemCacheStore's `default_coder` method so that every cache store will warn on using the 6.1 format.\r\n\r\n[1]: https://github.com/rails/rails/commit/088551c802bb4005a667aaa33814cfbb1feb3927\r\n\r\ncc @byroot\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48662/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48662/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48661", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48661/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48661/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48661/events", "html_url": "https://github.com/rails/rails/pull/48661", "id": 1789613204, "node_id": "PR_kwDNIULOVLUUqA", "number": 48661, "title": "Document return value of `Rails.cache.delete_multi`", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T13:50:29Z", "updated_at": "2023-07-06T19:58:46Z", "closed_at": "2023-07-06T19:58:42Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48661", "html_url": "https://github.com/rails/rails/pull/48661", "diff_url": "https://github.com/rails/rails/pull/48661.diff", "patch_url": "https://github.com/rails/rails/pull/48661.patch", "merged_at": "2023-07-06T19:58:42Z"}, "body": "`delete_multi` returns the number of deleted entries.\r\nThis is behavior is asserted in the following test:\r\n\r\nhttps://github.com/rails/rails/blob/495cbe9f8fec01ed3f2c0128dda39ca07bad00b3/activesupport/test/cache/behaviors/cache_store_behavior.rb#L433\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48661/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48661/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48660", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48660/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48660/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48660/events", "html_url": "https://github.com/rails/rails/pull/48660", "id": 1789403365, "node_id": "PR_kwDNIULOVLIzDA", "number": 48660, "title": "Fix AS::Cache 7.1 format to properly compress bare strings", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-05T11:59:25Z", "updated_at": "2023-07-05T17:03:00Z", "closed_at": "2023-07-05T12:29:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48660", "html_url": "https://github.com/rails/rails/pull/48660", "diff_url": "https://github.com/rails/rails/pull/48660.diff", "patch_url": "https://github.com/rails/rails/pull/48660.patch", "merged_at": "2023-07-05T12:29:13Z"}, "body": "The bare string and compression features weren't working properly together.\r\n\r\nI discovered this while trying to fix deprecation warnings.\r\n\r\nFYI: @jonathanhefner ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48660/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48660/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48659", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48659/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48659/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48659/events", "html_url": "https://github.com/rails/rails/pull/48659", "id": 1789091273, "node_id": "PR_kwDNIULOVK33iA", "number": 48659, "title": "Fix test flakiness introduced in encryption tests", "user": {"login": "jorgemanrubia", "id": 129938, "node_id": "MDQ6VXNlcjEyOTkzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/129938?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jorgemanrubia", "html_url": "https://github.com/jorgemanrubia", "followers_url": "https://api.github.com/users/jorgemanrubia/followers", "following_url": "https://api.github.com/users/jorgemanrubia/following{/other_user}", "gists_url": "https://api.github.com/users/jorgemanrubia/gists{/gist_id}", "starred_url": "https://api.github.com/users/jorgemanrubia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jorgemanrubia/subscriptions", "organizations_url": "https://api.github.com/users/jorgemanrubia/orgs", "repos_url": "https://api.github.com/users/jorgemanrubia/repos", "events_url": "https://api.github.com/users/jorgemanrubia/events{/privacy}", "received_events_url": "https://api.github.com/users/jorgemanrubia/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T08:53:35Z", "updated_at": "2023-07-05T09:48:07Z", "closed_at": "2023-07-05T09:48:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48659", "html_url": "https://github.com/rails/rails/pull/48659", "diff_url": "https://github.com/rails/rails/pull/48659.diff", "patch_url": "https://github.com/rails/rails/pull/48659.patch", "merged_at": "2023-07-05T09:48:06Z"}, "body": "This fixes some flakiness I introduced with 4f365720d1b87b7a8fe7d8d77c157b63d853e334.\r\n\r\nWe'll make sure we eager load all the encrypted attribute types declared before tests start, to prevent local encryption settings changes in tests from interfering with other tests.\r\n\r\nKudos to @p8 for tracking this one down and seeing how to fix it. This PR is just a generalization of his solution from #48641.\r\n\r\nI'm sorry I missed this one with that commit \ud83d\ude4f.\r\n\r\nFixes #48605\r\nCloses #48641\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48659/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48659/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48658", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48658/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48658/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48658/events", "html_url": "https://github.com/rails/rails/pull/48658", "id": 1789059821, "node_id": "PR_kwDNIULOVK2Lbw", "number": 48658, "title": "Fix `include_hidden` documentation for File Upload", "user": {"login": "alexpapworth", "id": 25950768, "node_id": "MDQ6VXNlcjI1OTUwNzY4", "avatar_url": "https://avatars.githubusercontent.com/u/25950768?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexpapworth", "html_url": "https://github.com/alexpapworth", "followers_url": "https://api.github.com/users/alexpapworth/followers", "following_url": "https://api.github.com/users/alexpapworth/following{/other_user}", "gists_url": "https://api.github.com/users/alexpapworth/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexpapworth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexpapworth/subscriptions", "organizations_url": "https://api.github.com/users/alexpapworth/orgs", "repos_url": "https://api.github.com/users/alexpapworth/repos", "events_url": "https://api.github.com/users/alexpapworth/events{/privacy}", "received_events_url": "https://api.github.com/users/alexpapworth/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T08:34:27Z", "updated_at": "2023-07-12T14:36:43Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48658", "html_url": "https://github.com/rails/rails/pull/48658", "diff_url": "https://github.com/rails/rails/pull/48658.diff", "patch_url": "https://github.com/rails/rails/pull/48658.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\nThe current [documentation](https://api.rubyonrails.org/v7.0.4/classes/ActionView/Helpers/FormHelper.html#method-i-file_field) implies calling `multiple: true` and `include_hidden: true` will stop existing files from being replaced when saving a record that has ActiveStorage attached. However it appears `include_hidden: false` is needed to achieve this functionality.\r\n\r\nFixes #48006\r\n\r\n### Detail\r\n\r\nUpdating documentation to reflect the current functionality of `multiple: true` and `include_hidden: false`\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48658/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48658/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48657", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48657/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48657/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48657/events", "html_url": "https://github.com/rails/rails/pull/48657", "id": 1789048322, "node_id": "PR_kwDNIULOVK1khw", "number": 48657, "title": "Fix de-duplication of unsaved records for `ActiveRecord::Associations::CollectionProxy#<<`", "user": {"login": "alpaca-tc", "id": 1688137, "node_id": "MDQ6VXNlcjE2ODgxMzc=", "avatar_url": "https://avatars.githubusercontent.com/u/1688137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alpaca-tc", "html_url": "https://github.com/alpaca-tc", "followers_url": "https://api.github.com/users/alpaca-tc/followers", "following_url": "https://api.github.com/users/alpaca-tc/following{/other_user}", "gists_url": "https://api.github.com/users/alpaca-tc/gists{/gist_id}", "starred_url": "https://api.github.com/users/alpaca-tc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alpaca-tc/subscriptions", "organizations_url": "https://api.github.com/users/alpaca-tc/orgs", "repos_url": "https://api.github.com/users/alpaca-tc/repos", "events_url": "https://api.github.com/users/alpaca-tc/events{/privacy}", "received_events_url": "https://api.github.com/users/alpaca-tc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-05T08:27:02Z", "updated_at": "2023-07-06T05:44:22Z", "closed_at": "2023-07-06T05:37:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48657", "html_url": "https://github.com/rails/rails/pull/48657", "diff_url": "https://github.com/rails/rails/pull/48657.diff", "patch_url": "https://github.com/rails/rails/pull/48657.patch", "merged_at": "2023-07-06T05:37:07Z"}, "body": "### Motivation / Background\r\n\r\nCurrently, there is a bug that changes the duplicity elimination depending on whether the association is `#loaded?` or not as the followings, but this change will fix it.\r\n\r\n```ruby\r\nhuman = Human.create!\r\ninterest = Interest.new(human: human)\r\nhuman.interests << interest\r\nhuman.interests.size #=> 1\r\n```\r\n\r\n```ruby\r\nhuman = Human.create!\r\ninterest = Interest.new(human: human)\r\nhuman.interests.load\r\nhuman.interests << interest\r\nhuman.interests.size #=> expected 1, got 2\r\n```\r\n\r\n### Detail\r\n\r\nThe existing process was attempting to detect duplicates by storing added records in `Set.new`. \r\nWhen a record is added to `Set.new`, the identity is calculated using [`ActiveRecord::Core#hash`](https://github.com/rails/rails//blob/f256e1f085f25f1c2cc4e4d1a533c6b103ff7aee/activerecord/lib/active_record/core.rb#L564-L572), but this value changes before and after saving, so duplicates were not detected before and after saving even for the same object.\r\n\r\n### Additional information\r\n\r\nThis PR fixed the problem by using the `#object_id` of the record to detect duplicates. Note that when storing a new object obtained by `ActiveRecord::Base.find` etc., duplicates are not eliminated because the `#object_id` is different. \r\nThis is the same behavior as the current `ActiveRecord::Associations::CollectionProxy#<<`.\r\n\r\nThe mechanism to eliminate the duplicate nature of newly added records using `Set.new` was added in https://github.com/rails/rails/pull/42524.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48657/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48657/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48656", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48656/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48656/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48656/events", "html_url": "https://github.com/rails/rails/issues/48656", "id": 1789020857, "node_id": "I_kwDNIULOaqJKuQ", "number": 48656, "title": "Skips mailer and 7.0.6", "user": {"login": "dawidof", "id": 1425756, "node_id": "MDQ6VXNlcjE0MjU3NTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1425756?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dawidof", "html_url": "https://github.com/dawidof", "followers_url": "https://api.github.com/users/dawidof/followers", "following_url": "https://api.github.com/users/dawidof/following{/other_user}", "gists_url": "https://api.github.com/users/dawidof/gists{/gist_id}", "starred_url": "https://api.github.com/users/dawidof/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dawidof/subscriptions", "organizations_url": "https://api.github.com/users/dawidof/orgs", "repos_url": "https://api.github.com/users/dawidof/repos", "events_url": "https://api.github.com/users/dawidof/events{/privacy}", "received_events_url": "https://api.github.com/users/dawidof/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-05T08:10:33Z", "updated_at": "2023-07-05T14:06:32Z", "closed_at": "2023-07-05T10:09:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# Your reproduction script goes here\r\n`rails new --skip-action-cable --skip-active-storage --skip-asset-pipeline --skip-javascript --skip-hotwire --skip-jbuilder --skip-action-mailbox --skip-active-job --skip-test --skip-system-test --api -d=postgresql backend`\r\n```\r\n\r\nthe key `--no-skip-action-mailer` make no difference\r\n\r\n### Expected behavior, Actual behavior\r\n<!-- Tell us what should happen -->\r\nCreating new app with command above it does not generate files for mailer. Also it in `application.rb` mailer is commented out.\r\n\r\n<img width=\"1680\" alt=\"Screenshot 2023-07-05 at 10 02 05\" src=\"https://github.com/rails/rails/assets/1425756/a80ca5f2-a5ea-4671-9662-9edeb797e441\">\r\n<img width=\"1189\" alt=\"Screenshot 2023-07-05 at 10 01 49\" src=\"https://github.com/rails/rails/assets/1425756/37694174-b0d2-40fe-9b62-079a807e694a\">\r\n\r\n### System configuration\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48656/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48656/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48655", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48655/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48655/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48655/events", "html_url": "https://github.com/rails/rails/pull/48655", "id": 1788953955, "node_id": "PR_kwDNIULOVKwgfA", "number": 48655, "title": "Remove unused code from encryption tests", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T07:29:48Z", "updated_at": "2023-08-01T08:56:15Z", "closed_at": "2023-07-05T09:48:54Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48655", "html_url": "https://github.com/rails/rails/pull/48655", "diff_url": "https://github.com/rails/rails/pull/48655.diff", "patch_url": "https://github.com/rails/rails/pull/48655.patch", "merged_at": "2023-07-05T09:48:54Z"}, "body": "The Book model isn't used in the `EncryptionSchemesTest`.\r\n`SchemeTest#declare_and_use_class` is declared but never used.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48655/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48655/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48654", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48654/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48654/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48654/events", "html_url": "https://github.com/rails/rails/pull/48654", "id": 1788690702, "node_id": "PR_kwDNIULOVKiP1Q", "number": 48654, "title": "Fix typo in activerecord tests (hash_many -> has_many)", "user": {"login": "alpaca-tc", "id": 1688137, "node_id": "MDQ6VXNlcjE2ODgxMzc=", "avatar_url": "https://avatars.githubusercontent.com/u/1688137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alpaca-tc", "html_url": "https://github.com/alpaca-tc", "followers_url": "https://api.github.com/users/alpaca-tc/followers", "following_url": "https://api.github.com/users/alpaca-tc/following{/other_user}", "gists_url": "https://api.github.com/users/alpaca-tc/gists{/gist_id}", "starred_url": "https://api.github.com/users/alpaca-tc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alpaca-tc/subscriptions", "organizations_url": "https://api.github.com/users/alpaca-tc/orgs", "repos_url": "https://api.github.com/users/alpaca-tc/repos", "events_url": "https://api.github.com/users/alpaca-tc/events{/privacy}", "received_events_url": "https://api.github.com/users/alpaca-tc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T03:19:43Z", "updated_at": "2023-07-05T05:36:12Z", "closed_at": "2023-07-05T04:06:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48654", "html_url": "https://github.com/rails/rails/pull/48654", "diff_url": "https://github.com/rails/rails/pull/48654.diff", "patch_url": "https://github.com/rails/rails/pull/48654.patch", "merged_at": "2023-07-05T04:06:22Z"}, "body": "changes `hash_many` -> `has_many` in activerecord test\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48654/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48654/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48653", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48653/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48653/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48653/events", "html_url": "https://github.com/rails/rails/pull/48653", "id": 1788667976, "node_id": "PR_kwDNIULOVKhElg", "number": 48653, "title": "Fix a bug that prevented #pretty_print from displaying records unsaved in collection association.", "user": {"login": "alpaca-tc", "id": 1688137, "node_id": "MDQ6VXNlcjE2ODgxMzc=", "avatar_url": "https://avatars.githubusercontent.com/u/1688137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alpaca-tc", "html_url": "https://github.com/alpaca-tc", "followers_url": "https://api.github.com/users/alpaca-tc/followers", "following_url": "https://api.github.com/users/alpaca-tc/following{/other_user}", "gists_url": "https://api.github.com/users/alpaca-tc/gists{/gist_id}", "starred_url": "https://api.github.com/users/alpaca-tc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alpaca-tc/subscriptions", "organizations_url": "https://api.github.com/users/alpaca-tc/orgs", "repos_url": "https://api.github.com/users/alpaca-tc/repos", "events_url": "https://api.github.com/users/alpaca-tc/events{/privacy}", "received_events_url": "https://api.github.com/users/alpaca-tc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-05T02:42:45Z", "updated_at": "2023-07-05T05:35:27Z", "closed_at": "2023-07-05T04:23:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48653", "html_url": "https://github.com/rails/rails/pull/48653", "diff_url": "https://github.com/rails/rails/pull/48653.diff", "patch_url": "https://github.com/rails/rails/pull/48653.patch", "merged_at": "2023-07-05T04:23:06Z"}, "body": "\r\n\r\n### Motivation / Background\r\n\r\nThe change in PR #43302 introduced a bug where unsaved records are not displayed in pretty_print. The following code will not show unsaved records until this PR is merged.\r\n\r\n```ruby\r\npost = Post.create!\r\npost.comments.build\r\n\r\npp(post.comments) #=> expected \"[#<Comment:0x000000014c0b48a0 ...>]\", got \"[]\"\r\n```\r\n\r\n### Detail\r\n\r\nFixed to call `#load_target` before display as well as [`#inspect`](https://github.com/alpaca-tc/rails/blob/fe6b96afd/activerecord/lib/active_record/associations/collection_proxy.rb#L1105-L1108).\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48653/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48653/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48652", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48652/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48652/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48652/events", "html_url": "https://github.com/rails/rails/issues/48652", "id": 1788556376, "node_id": "I_kwDNIULOaps0WA", "number": 48652, "title": "ActiveRecord serialize stripping obj's attributes before sending the data to the serializer on rails 7.0.5", "user": {"login": "TopRoupi", "id": 38011914, "node_id": "MDQ6VXNlcjM4MDExOTE0", "avatar_url": "https://avatars.githubusercontent.com/u/38011914?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TopRoupi", "html_url": "https://github.com/TopRoupi", "followers_url": "https://api.github.com/users/TopRoupi/followers", "following_url": "https://api.github.com/users/TopRoupi/following{/other_user}", "gists_url": "https://api.github.com/users/TopRoupi/gists{/gist_id}", "starred_url": "https://api.github.com/users/TopRoupi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TopRoupi/subscriptions", "organizations_url": "https://api.github.com/users/TopRoupi/orgs", "repos_url": "https://api.github.com/users/TopRoupi/repos", "events_url": "https://api.github.com/users/TopRoupi/events{/privacy}", "received_events_url": "https://api.github.com/users/TopRoupi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-07-04T23:23:54Z", "updated_at": "2023-07-13T10:03:44Z", "closed_at": "2023-07-13T09:58:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "upgrading from rails **7.0.4.3** to **7.0.5** causes activerecord models with serialized params to break since the data sent to the serializer on **7.0.5** is now being passed to `deep_dup` before being sent to the serializer, and this makes activerecord objs passed inside the parameters to lose attributes.\r\nthis was changed on this commit [activerecord/lib/active_record/relation/predicate_builder.rb](https://github.com/rails/rails/commit/213972e1ef8b50d5a930fed52780846f674eb808#diff-b8fadd6d1ec091c30f94738b9b193b78ec90681790dd3a6aa79938b4dacbe904)\r\n\r\nexample of a case that this change is causing problems https://github.com/excid3/noticed/issues/296 \r\n\r\n### Steps to reproduce\r\n```ruby\r\n#!/usr/bin/env ruby\r\n\r\nrequire 'bundler/inline'\r\n\r\ngemfile(true) do\r\n  source 'https://rubygems.org'\r\n\r\n  gem 'rails', '= 7.0.5'\r\n  # gem 'rails', '= 7.0.4.3'\r\n  gem 'sqlite3'\r\n  gem 'byebug'\r\nend\r\n\r\nrequire 'active_record'\r\nrequire 'minitest/autorun'\r\nrequire 'logger'\r\n\r\nActiveRecord::Base.establish_connection(adapter: 'sqlite3', database: ':memory:')\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :notifications do |t|\r\n    t.json :params\r\n  end\r\n\r\n  create_table :comments do |t|\r\n    t.string :body\r\n  end\r\nend\r\n\r\nclass DummyCoder\r\n  def self.load(data)\r\n    return if data.nil?\r\n    puts \"load\"\r\n    p data\r\n    \"dummy\"\r\n  end\r\n\r\n  def self.dump(data)\r\n    return if data.nil?\r\n    puts \"dump\"\r\n    p data\r\n    raise \"object has no id\" if data[:comment].id.nil?\r\n    \"dummy\"\r\n  end\r\nend\r\n\r\nclass Notification < ActiveRecord::Base\r\n  serialize :params, DummyCoder\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\nend\r\n\r\nclass TestWhereQueryWithSerializedParam < Minitest::Test\r\n  def test_where_query_with_serialized_param\r\n    comment = Comment.create(body: \"1\")\r\n    notifications = Notification.where(params: {comment: comment}).last\r\n    assert_equal notifications, nil\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\ncalling Notification.where(params: {comment: comment}).last should not raise since the `data` variable on `DummyCoder.dump(data)`  method will have an id: `{:comment=>#<Comment id: 1, body: \"1\">}`\r\n\r\nthis was the behavior on rails 7.0.4.3 \r\n\r\n### Actual behavior\r\ncalling Notification.where(params: {comment: comment}).last will raise since the `data` variable on `DummyCoder.dump(data)`  method wont have an id: `{:comment=>#<Comment id: nil, body: \"1\">}`\r\nwhich is cause by this new change [activerecord/lib/active_record/relation/predicate_builder.rb](https://github.com/rails/rails/commit/213972e1ef8b50d5a930fed52780846f674eb808#diff-b8fadd6d1ec091c30f94738b9b193b78ec90681790dd3a6aa79938b4dacbe904)\r\n\r\n### System configuration\r\n**Rails version**: 7.0.5\r\n\r\n**Ruby version**: 3.0.0\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48652/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48652/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48651", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48651/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48651/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48651/events", "html_url": "https://github.com/rails/rails/issues/48651", "id": 1788519172, "node_id": "I_kwDNIULOapqjBA", "number": 48651, "title": "Behaviour of `where.missing` changed in rails 7.0.6", "user": {"login": "robingram", "id": 118558, "node_id": "MDQ6VXNlcjExODU1OA==", "avatar_url": "https://avatars.githubusercontent.com/u/118558?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robingram", "html_url": "https://github.com/robingram", "followers_url": "https://api.github.com/users/robingram/followers", "following_url": "https://api.github.com/users/robingram/following{/other_user}", "gists_url": "https://api.github.com/users/robingram/gists{/gist_id}", "starred_url": "https://api.github.com/users/robingram/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robingram/subscriptions", "organizations_url": "https://api.github.com/users/robingram/orgs", "repos_url": "https://api.github.com/users/robingram/repos", "events_url": "https://api.github.com/users/robingram/events{/privacy}", "received_events_url": "https://api.github.com/users/robingram/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-07-04T22:08:21Z", "updated_at": "2023-07-27T18:19:28Z", "closed_at": "2023-07-27T18:19:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\nCreate a model called `Publisher` that has an enum on the `name` attribute.\r\n\r\n```ruby\r\nclass Publisher < ApplicationRecord\r\n  belongs_to :listing\r\n\r\n  enum name: {\r\n    foo: 0,\r\n    bar: 1\r\n  }\r\nend\r\n```\r\n\r\nCreate another model named `Listing` that has a `has_many` association and scoped `has_one` associations to `Publisher`.\r\n\r\n```ruby\r\nclass Listing < ApplicationRecord\r\n  has_many :publishers, dependent: :destroy\r\n  has_one :foo_listing, -> { foo }, class_name: Publisher.name\r\n  has_one :bar_listing, -> { bar }, class_name: Publisher.name\r\nend\r\n```\r\n\r\nCreate an instance of Listing that has a `foo` publisher but not a `bar` publisher (using Factory Bot here for brevity).\r\n\r\n```ruby\r\ncreate(:listing, publishers: [build(:publisher, :foo)])\r\n```\r\n\r\nRun a query using `where.missing` to select listings with a `foo` publisher but not a `bar` publisher.\r\n\r\n```ruby\r\nListing.joins(:foo_listing).where.missing(:bar_listing)\r\n```\r\n\r\n### Expected behavior\r\n\r\nThe query should return the listing created above. This works in Rails 7.0.5.1.\r\n\r\n### Actual behavior\r\n\r\nNo records are returned in Rails 7.0.6.\r\n\r\nThe table alias seems to have changed in the generated SQL.\r\n\r\nRails 7.0.5.1:\r\n\r\n```sql\r\nSELECT listings.*\r\nFROM listings\r\n    INNER JOIN publishers ON publishers.name = 0 AND publishers.listing_id = listings.id\r\n    LEFT OUTER JOIN publishers bar_listing ON bar_listing.name = 1\r\n        AND bar_listing.listing_id = listings.id\r\nWHERE bar_listing.id IS NULL\r\n```\r\n\r\nRails-7.0.6:\r\n\r\n```sql\r\nSELECT listings.*\r\nFROM listings\r\n    INNER JOIN publishers ON publishers.name = 0 AND publishers.listing_id = listings.id\r\n    LEFT OUTER JOIN publishers bar_listings_listings ON bar_listings_listings.name = 1\r\n        AND bar_listings_listings.listing_id = listings.id\r\nWHERE publishers.id IS NULL\r\n```\r\n\r\nExplicitly creating the left join and checking for blank ID works in 7.0.6:\r\n\r\n```ruby\r\nListing.joins(:foo_listing).left_joins(:bar_listing).where(bar_listing: {id: nil})\r\n```\r\n\r\n### System configuration\r\n\r\n**Rails version**: 7.0.6\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48651/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48651/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48650", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48650/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48650/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48650/events", "html_url": "https://github.com/rails/rails/pull/48650", "id": 1788364627, "node_id": "PR_kwDNIULOVKQrDA", "number": 48650, "title": "Make has_many through singular associations build CPK records", "user": {"login": "gmcgibbon", "id": 5162312, "node_id": "MDQ6VXNlcjUxNjIzMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5162312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gmcgibbon", "html_url": "https://github.com/gmcgibbon", "followers_url": "https://api.github.com/users/gmcgibbon/followers", "following_url": "https://api.github.com/users/gmcgibbon/following{/other_user}", "gists_url": "https://api.github.com/users/gmcgibbon/gists{/gist_id}", "starred_url": "https://api.github.com/users/gmcgibbon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gmcgibbon/subscriptions", "organizations_url": "https://api.github.com/users/gmcgibbon/orgs", "repos_url": "https://api.github.com/users/gmcgibbon/repos", "events_url": "https://api.github.com/users/gmcgibbon/events{/privacy}", "received_events_url": "https://api.github.com/users/gmcgibbon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-04T19:16:01Z", "updated_at": "2023-07-05T22:34:52Z", "closed_at": "2023-07-05T18:03:32Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48650", "html_url": "https://github.com/rails/rails/pull/48650", "diff_url": "https://github.com/rails/rails/pull/48650.diff", "patch_url": "https://github.com/rails/rails/pull/48650.patch", "merged_at": "2023-07-05T18:03:32Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because composite primary key records cannot be build when using `has_many` through singular (`has_one`) associations.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes `build_record` on `ActiveRecord::Associations::ThroughAssociation` to support composite primary key associations.\r\n\r\n### Additional information\r\n\r\nI noticed some odd behaviour for `build_record` that I'll be submitting fixes for in separate patches.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48650/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48650/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48649", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48649/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48649/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48649/events", "html_url": "https://github.com/rails/rails/pull/48649", "id": 1788280952, "node_id": "PR_kwDNIULOVKMIPQ", "number": 48649, "title": "Test branch", "user": {"login": "taitran19", "id": 8312148, "node_id": "MDQ6VXNlcjgzMTIxNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/8312148?v=4", "gravatar_id": "", "url": "https://api.github.com/users/taitran19", "html_url": "https://github.com/taitran19", "followers_url": "https://api.github.com/users/taitran19/followers", "following_url": "https://api.github.com/users/taitran19/following{/other_user}", "gists_url": "https://api.github.com/users/taitran19/gists{/gist_id}", "starred_url": "https://api.github.com/users/taitran19/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/taitran19/subscriptions", "organizations_url": "https://api.github.com/users/taitran19/orgs", "repos_url": "https://api.github.com/users/taitran19/repos", "events_url": "https://api.github.com/users/taitran19/events{/privacy}", "received_events_url": "https://api.github.com/users/taitran19/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-04T17:38:11Z", "updated_at": "2023-07-05T02:16:17Z", "closed_at": "2023-07-04T17:57:53Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48649", "html_url": "https://github.com/rails/rails/pull/48649", "diff_url": "https://github.com/rails/rails/pull/48649.diff", "patch_url": "https://github.com/rails/rails/pull/48649.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because [REPLACE ME]\r\n\r\n### Detail\r\n\r\nThis Pull Request changes [REPLACE ME]\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [ ] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48649/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48649/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48648", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48648/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48648/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48648/events", "html_url": "https://github.com/rails/rails/pull/48648", "id": 1788256055, "node_id": "PR_kwDNIULOVKKvvw", "number": 48648, "title": "Rework initialization", "user": {"login": "taitran19", "id": 8312148, "node_id": "MDQ6VXNlcjgzMTIxNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/8312148?v=4", "gravatar_id": "", "url": "https://api.github.com/users/taitran19", "html_url": "https://github.com/taitran19", "followers_url": "https://api.github.com/users/taitran19/followers", "following_url": "https://api.github.com/users/taitran19/following{/other_user}", "gists_url": "https://api.github.com/users/taitran19/gists{/gist_id}", "starred_url": "https://api.github.com/users/taitran19/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/taitran19/subscriptions", "organizations_url": "https://api.github.com/users/taitran19/orgs", "repos_url": "https://api.github.com/users/taitran19/repos", "events_url": "https://api.github.com/users/taitran19/events{/privacy}", "received_events_url": "https://api.github.com/users/taitran19/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107188, "node_id": "MDU6TGFiZWwxMDcxODg=", "url": "https://api.github.com/repos/rails/rails/labels/actionmailer", "name": "actionmailer", "color": "8B00FC", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-04T17:17:42Z", "updated_at": "2023-07-05T02:16:27Z", "closed_at": "2023-07-04T17:30:24Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48648", "html_url": "https://github.com/rails/rails/pull/48648", "diff_url": "https://github.com/rails/rails/pull/48648.diff", "patch_url": "https://github.com/rails/rails/pull/48648.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because [REPLACE ME]\r\n\r\n### Detail\r\n\r\nThis Pull Request changes [REPLACE ME]\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [ ] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48648/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48648/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48647", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48647/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48647/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48647/events", "html_url": "https://github.com/rails/rails/pull/48647", "id": 1788005162, "node_id": "PR_kwDNIULOVJ9DBQ", "number": 48647, "title": "Fix has_many_inversing records with same references", "user": {"login": "abaldwin88", "id": 15172605, "node_id": "MDQ6VXNlcjE1MTcyNjA1", "avatar_url": "https://avatars.githubusercontent.com/u/15172605?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abaldwin88", "html_url": "https://github.com/abaldwin88", "followers_url": "https://api.github.com/users/abaldwin88/followers", "following_url": "https://api.github.com/users/abaldwin88/following{/other_user}", "gists_url": "https://api.github.com/users/abaldwin88/gists{/gist_id}", "starred_url": "https://api.github.com/users/abaldwin88/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abaldwin88/subscriptions", "organizations_url": "https://api.github.com/users/abaldwin88/orgs", "repos_url": "https://api.github.com/users/abaldwin88/repos", "events_url": "https://api.github.com/users/abaldwin88/events{/privacy}", "received_events_url": "https://api.github.com/users/abaldwin88/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-04T14:08:03Z", "updated_at": "2023-07-31T14:10:06Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48647", "html_url": "https://github.com/rails/rails/pull/48647", "diff_url": "https://github.com/rails/rails/pull/48647.diff", "patch_url": "https://github.com/rails/rails/pull/48647.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nResolves #47559\r\n\r\nProperly handle an intermediate model with has_many_inversing when creating two records with the same references.\r\n\r\n- Prevents database error when references have a NOT NULL constraint\r\n- When NULLS are permitted avoid an extra UPDATE statement by inserting the correct values from the outset\r\n\r\n### Detail\r\n\r\n```rb\r\nActiveRecord::Base.has_many_inversing = true\r\n\r\nclass Comment < ActiveRecord::Base\r\n  belongs_to :post, inverse_of: :comments\r\n  belongs_to :author, inverse_of: :comments\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  has_many :comments\r\nend\r\n\r\nclass Author < ActiveRecord::Base\r\n  has_many :comments\r\nend\r\n\r\npost = Post.new\r\nauthor = Author.new\r\npost.comments.build(author: author)\r\npost.comments.build(author: author)\r\npost.save!\r\n```\r\n\r\nBefore:\r\n```sql\r\nBEGIN\r\n  INSERT INTO \"posts\" DEFAULT VALUES RETURNING \"id\"\r\n  INSERT INTO \"authors\" DEFAULT VALUES RETURNING \"id\"\r\n  INSERT INTO \"comments\" (\"post_id\", \"author_id\") VALUES ($1, $2) RETURNING \"id\"  [[\"post_id\", 1], [\"author_id\", 1]]\r\n  -- Error if NOT NULL constraint on post_id\r\n  INSERT INTO \"comments\" (\"author_id\") VALUES ($1) RETURNING \"id\"  [[\"author_id\", 1]]\r\n  UPDATE \"comments\" SET \"post_id\" = $1 WHERE \"comments\".\"id\" = $2  [[\"post_id\", 1], [\"id\", 2]]\r\nCOMMIT\r\n```\r\n\r\nAfter:\r\n```sql\r\nBEGIN\r\n  INSERT INTO \"posts\" DEFAULT VALUES RETURNING \"id\"\r\n  INSERT INTO \"authors\" DEFAULT VALUES RETURNING \"id\"\r\n  INSERT INTO \"comments\" (\"post_id\", \"author_id\") VALUES ($1, $2) RETURNING \"id\"  [[\"post_id\", 1], [\"author_id\", 1]]\r\n  INSERT INTO \"comments\" (\"post_id\", \"author_id\") VALUES ($1, $2) RETURNING \"id\"  [[\"post_id\", 1], [\"author_id\", 1]]\r\nCOMMIT\r\n```\r\n\r\n`insert_record` within `save_collection_association` will trigger a recursive call. By fully processing `set_inverse_instance` for each layer we ensure associations are up to date before `INSERT INTO comments` statements are sent to the database.\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48647/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48647/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48646", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48646/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48646/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48646/events", "html_url": "https://github.com/rails/rails/pull/48646", "id": 1787930115, "node_id": "PR_kwDNIULOVJ49-g", "number": 48646, "title": "Update streaming_template_renderer.rb", "user": {"login": "RicardoTrindade", "id": 13217751, "node_id": "MDQ6VXNlcjEzMjE3NzUx", "avatar_url": "https://avatars.githubusercontent.com/u/13217751?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RicardoTrindade", "html_url": "https://github.com/RicardoTrindade", "followers_url": "https://api.github.com/users/RicardoTrindade/followers", "following_url": "https://api.github.com/users/RicardoTrindade/following{/other_user}", "gists_url": "https://api.github.com/users/RicardoTrindade/gists{/gist_id}", "starred_url": "https://api.github.com/users/RicardoTrindade/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RicardoTrindade/subscriptions", "organizations_url": "https://api.github.com/users/RicardoTrindade/orgs", "repos_url": "https://api.github.com/users/RicardoTrindade/repos", "events_url": "https://api.github.com/users/RicardoTrindade/events{/privacy}", "received_events_url": "https://api.github.com/users/RicardoTrindade/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-04T13:23:52Z", "updated_at": "2023-07-04T20:28:27Z", "closed_at": "2023-07-04T19:31:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48646", "html_url": "https://github.com/rails/rails/pull/48646", "diff_url": "https://github.com/rails/rails/pull/48646.diff", "patch_url": "https://github.com/rails/rails/pull/48646.patch", "merged_at": "2023-07-04T19:31:53Z"}, "body": "Micro optimization for ActionView.\r\nRemove extra `layout_name` check on the `render_template` method. At that point, `layout_name` due to the condition `layout_name && template.supports_streaming?` so there's no need to check for it once again when creating the `layout` variable.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48646/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48646/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48645", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48645/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48645/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48645/events", "html_url": "https://github.com/rails/rails/pull/48645", "id": 1787916864, "node_id": "PR_kwDNIULOVJ4Pvg", "number": 48645, "title": "Fix Action View collection caching to store fragments as bare strings", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-07-04T13:16:17Z", "updated_at": "2023-08-14T13:15:31Z", "closed_at": "2023-07-05T10:14:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48645", "html_url": "https://github.com/rails/rails/pull/48645", "diff_url": "https://github.com/rails/rails/pull/48645.diff", "patch_url": "https://github.com/rails/rails/pull/48645.patch", "merged_at": "2023-07-05T10:14:23Z"}, "body": "Ref: https://github.com/rails/rails/issues/48611\r\n\r\nIndividual fragments have been cached as bare string since forever, but somehow fragment cached via collection caching were stored as `ActionView::OutputBuffer` instances.\r\n\r\nThis is both bad for performance, but also can cause issues on Rails upgrades if the internal representation of `AV::OutputBuffer` changes.\r\n\r\nI think we should consider this PR as a bug fix, and backport it accordingly.\r\n\r\ncc @matthewd, @matthutchinson, @skipkayhil ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48645/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48645/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48644", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48644/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48644/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48644/events", "html_url": "https://github.com/rails/rails/pull/48644", "id": 1787861941, "node_id": "PR_kwDNIULOVJ1Q0g", "number": 48644, "title": "Introduce config for Action Text sanitizer", "user": {"login": "flavorjones", "id": 8207, "node_id": "MDQ6VXNlcjgyMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/8207?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flavorjones", "html_url": "https://github.com/flavorjones", "followers_url": "https://api.github.com/users/flavorjones/followers", "following_url": "https://api.github.com/users/flavorjones/following{/other_user}", "gists_url": "https://api.github.com/users/flavorjones/gists{/gist_id}", "starred_url": "https://api.github.com/users/flavorjones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flavorjones/subscriptions", "organizations_url": "https://api.github.com/users/flavorjones/orgs", "repos_url": "https://api.github.com/users/flavorjones/repos", "events_url": "https://api.github.com/users/flavorjones/events{/privacy}", "received_events_url": "https://api.github.com/users/flavorjones/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}, {"id": 1180817762, "node_id": "MDU6TGFiZWwxMTgwODE3NzYy", "url": "https://api.github.com/repos/rails/rails/labels/actiontext", "name": "actiontext", "color": "3bc667", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-04T12:43:49Z", "updated_at": "2023-07-14T21:58:37Z", "closed_at": "2023-07-04T21:07:59Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48644", "html_url": "https://github.com/rails/rails/pull/48644", "diff_url": "https://github.com/rails/rails/pull/48644.diff", "patch_url": "https://github.com/rails/rails/pull/48644.patch", "merged_at": "2023-07-04T21:07:59Z"}, "body": "### Motivation / Background\r\n\r\n#48523 changed the behavior of Action Text to use the HTML5 safe list sanitizer when available, else fall back to the HTML4 safe list sanitizer. At @rafaelfranca's suggestion, this PR introduces `config.action_text.sanitizer_vendor` (very similar to `config.action_view.sanitizer_vendor`) and a Rails 7.1 default to control that behavior change.\r\n\r\nThis PR also backfills test coverage for `config.action_view.sanitizer_vendor`.\r\n\r\n### Detail\r\n\r\nThis PR introduces `config.action_text.sanitizer_vendor`, which behaves the same way as `config.action_view.sanitizer_vendor`.\r\n\r\n### Additional information\r\n\r\nI'm curious if the maintainers think we really need two config params for Action View and Action Text, or if we should merge these into something like `config.sanitizer_vendor` for all of Rails.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48644/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48644/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48643", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48643/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48643/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48643/events", "html_url": "https://github.com/rails/rails/pull/48643", "id": 1787232963, "node_id": "PR_kwDNIULOVJTSqQ", "number": 48643, "title": "Add a new option `existing` to `has_one` to run validations before deleting", "user": {"login": "sinsoku", "id": 248174, "node_id": "MDQ6VXNlcjI0ODE3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/248174?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinsoku", "html_url": "https://github.com/sinsoku", "followers_url": "https://api.github.com/users/sinsoku/followers", "following_url": "https://api.github.com/users/sinsoku/following{/other_user}", "gists_url": "https://api.github.com/users/sinsoku/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinsoku/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinsoku/subscriptions", "organizations_url": "https://api.github.com/users/sinsoku/orgs", "repos_url": "https://api.github.com/users/sinsoku/repos", "events_url": "https://api.github.com/users/sinsoku/events{/privacy}", "received_events_url": "https://api.github.com/users/sinsoku/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-04T06:23:56Z", "updated_at": "2023-08-10T16:02:42Z", "closed_at": "2023-08-09T01:22:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48643", "html_url": "https://github.com/rails/rails/pull/48643", "diff_url": "https://github.com/rails/rails/pull/48643.diff", "patch_url": "https://github.com/rails/rails/pull/48643.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nUniqueness validators no longer works on `create_association` when using `dependent: :destroy` option in the commit below.\r\nrefs: bdbe58b, 3255411\r\n\r\nHowever, we often expect validation errors as well.\r\nrefs #48330, #48632\r\n\r\n### Detail\r\n\r\nThis commit adds new option `existing` to `has_one` to run validations before deleting an existing record.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48643/reactions", "total_count": 13, "+1": 13, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48643/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48642", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48642/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48642/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48642/events", "html_url": "https://github.com/rails/rails/pull/48642", "id": 1786956029, "node_id": "PR_kwDNIULOVJEyBg", "number": 48642, "title": "[7-0-stable] Backport: \"Fix issue with attr_protected where malformed input could circumvent protection\"", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-04T00:22:32Z", "updated_at": "2023-07-04T05:24:45Z", "closed_at": "2023-07-04T04:02:59Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48642", "html_url": "https://github.com/rails/rails/pull/48642", "diff_url": "https://github.com/rails/rails/pull/48642.diff", "patch_url": "https://github.com/rails/rails/pull/48642.patch", "merged_at": "2023-07-04T04:02:59Z"}, "body": "Backport #47509 to `7-0-stable` branch\r\n\r\nFixes: CVE-2013-0276", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48642/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48642/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48641", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48641/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48641/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48641/events", "html_url": "https://github.com/rails/rails/pull/48641", "id": 1786729031, "node_id": "PR_kwDNIULOVI4ikQ", "number": 48641, "title": "Fix flaky encryption tests", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2023-07-03T19:47:05Z", "updated_at": "2023-07-05T09:16:09Z", "closed_at": "2023-07-05T09:15:46Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48641", "html_url": "https://github.com/rails/rails/pull/48641", "diff_url": "https://github.com/rails/rails/pull/48641.diff", "patch_url": "https://github.com/rails/rails/pull/48641.patch", "merged_at": null}, "body": "`4f365720d1b87b7a8fe7d8d77c157b63d853e334` introduced lazy loading\r\nencryption schemes. Schemes for attributes are loaded when the attribute\r\ntype is used.\r\n\r\nThis change introduced some flakiness to the tests:\r\n\r\n```bash\r\nARCONN=mysql2 bin/test test/cases/encryption/encryption_schemes_test.rb test/cases/encryption/encrypted_fixtures_test.rb -n \"/^(?:ActiveRecord::Encryption::EncryptionSchemesTest#(?:test_returns_ciphertext_all_the_previous_schemes_fail_to_decrypt_and_support_for_unencrypted_data_is_on)|ActiveRecord::Encryption::EncryptableFixtureTest#(?:test_preserved_columns_due_to_ignore_case:_true_gets_encrypted_automatically))$/\" --seed 39616\r\n\r\n...\r\n\r\n.E\r\n\r\n Error:\r\n    ActiveRecord::Encryption::EncryptableFixtureTest#test_preserved_columns_due_to_ignore_case:_true_gets_encrypted_automatically:\r\n    ActiveRecord::Encryption::Errors::Decryption: Couldn't find a match for ruby for rails ({\"1\"=>\"2\"})\r\n        /Users/petrik/Projects/All/_forks/rails/activerecord/test/cases/encryption/encryption_schemes_test.rb:144:in `decrypt'\r\n```\r\n\r\n\r\nBy calling the attribute type in the test models the schemes are eager\r\nloaded and the flakiness is hopefully fixed. (The original commit added\r\na similar call for the type).\r\n\r\ncc: @jorgemanrubia \r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48641/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48641/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48640", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48640/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48640/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48640/events", "html_url": "https://github.com/rails/rails/pull/48640", "id": 1786550343, "node_id": "PR_kwDNIULOVIuzww", "number": 48640, "title": "fix: Raise an exception on `has_one` failed to autosave", "user": {"login": "wata727", "id": 9624059, "node_id": "MDQ6VXNlcjk2MjQwNTk=", "avatar_url": "https://avatars.githubusercontent.com/u/9624059?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wata727", "html_url": "https://github.com/wata727", "followers_url": "https://api.github.com/users/wata727/followers", "following_url": "https://api.github.com/users/wata727/following{/other_user}", "gists_url": "https://api.github.com/users/wata727/gists{/gist_id}", "starred_url": "https://api.github.com/users/wata727/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wata727/subscriptions", "organizations_url": "https://api.github.com/users/wata727/orgs", "repos_url": "https://api.github.com/users/wata727/repos", "events_url": "https://api.github.com/users/wata727/events{/privacy}", "received_events_url": "https://api.github.com/users/wata727/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-07-03T17:12:25Z", "updated_at": "2023-08-08T13:41:27Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48640", "html_url": "https://github.com/rails/rails/pull/48640", "diff_url": "https://github.com/rails/rails/pull/48640.diff", "patch_url": "https://github.com/rails/rails/pull/48640.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nFixes https://github.com/rails/rails/issues/36833\r\nFixes https://github.com/rails/rails/issues/48633\r\n\r\nPreviously, failure to autosave a `has_one` association returned `nil` instead of raising an exception.\r\n\r\n```ruby\r\nclass Supplier < ActiveRecord::Base\r\n  has_one :account, autosave: true\r\nend\r\n\r\nclass Account < ActiveRecord::Base\r\n  before_save { throw(:abort) }\r\nend\r\n\r\nsupplier = Supplier.new\r\nsupplier.build_account\r\nsupplier.save! # => nil\r\n```\r\n\r\nBut it's counter-intuitive for `save!` to fail without raising an exception.\r\n\r\n### Detail\r\n\r\nThis pull request changes the `save_has_one_association` to raise `ActiveRecord::RecordInvalid` instead of `ActiveRecord::Rollback`. This allows it to raise an exception if it fails to autosave the `has_one` association with `save!`.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\nThis pull request is very similar to [the pull request for `has_many` association](https://github.com/rails/rails/pull/36210).\r\n\r\nAlso, it seems that the reason why `ActiveRecord::Rollback` was raised was to return `false` while rolling back with `save`, but there is also no problem with `ActiveRecord::RecordInvalid`.\r\nhttps://github.com/rails/rails/commit/f2aacd51405724cdf7cfd36a439c9dbfce16973a\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48640/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48640/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48639", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48639/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48639/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48639/events", "html_url": "https://github.com/rails/rails/pull/48639", "id": 1786493296, "node_id": "PR_kwDNIULOVIrwow", "number": 48639, "title": "Fix deprecation warnings in Active Support tests", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-07-03T16:27:32Z", "updated_at": "2023-07-06T00:44:05Z", "closed_at": "2023-07-05T14:02:32Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48639", "html_url": "https://github.com/rails/rails/pull/48639", "diff_url": "https://github.com/rails/rails/pull/48639.diff", "patch_url": "https://github.com/rails/rails/pull/48639.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThese were introduced when the cache_format_version warning was [moved][1] to initialization of an ActiveSupport::Cache.\r\n\r\n### Detail\r\n\r\n7.0 was chosen as the new default cache_format in tests because other tests started to fail when 7.1 was made the default.\r\n\r\nThis also uncovered that the moved deprecation warning did not cover the MemCacheStore since it overrides the `default_coder` method for the 6.1 format.\r\n\r\n[1]: https://github.com/rails/rails/commit/088551c802bb4005a667aaa33814cfbb1feb3927\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48639/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48639/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48638", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48638/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48638/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48638/events", "html_url": "https://github.com/rails/rails/pull/48638", "id": 1786236352, "node_id": "PR_kwDNIULOVId-qg", "number": 48638, "title": "Make all cache stores return a boolean for `#delete`", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-03T13:55:16Z", "updated_at": "2023-08-01T08:56:45Z", "closed_at": "2023-07-27T06:48:53Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48638", "html_url": "https://github.com/rails/rails/pull/48638", "diff_url": "https://github.com/rails/rails/pull/48638.diff", "patch_url": "https://github.com/rails/rails/pull/48638.patch", "merged_at": "2023-07-27T06:48:53Z"}, "body": "`Rails.cache.delete('key')` is [supposed](https://github.com/rails/rails/blob/e552fca4a6f44db6035abfdf5a48e965fdff29f2/activesupport/lib/active_support/cache.rb#L586) to return `true` if an entry exists (and `false` otherwise?). This is how most stores behave.\r\n\r\nHowever, the `RedisCacheStore` would return a `1` when deleting an entry that does exist and a `0` otherwise.\r\nAs `0` is truthy this is unexpected behaviour.\r\n\r\n`RedisCacheStore` now returns `true` if the entry exists and `false` otherwise, making it consistent with the other cache stores.\r\n\r\nSimilarly the `FileCacheStore` now returns `false` instead of `nil` if the entry doesn't exist.\r\n\r\nA test is added to make sure this behaviour applies to all stores.\r\n\r\nThe documentation for `delete` has been updated to make the behaviour explicit.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48638/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48638/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48637", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48637/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48637/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48637/events", "html_url": "https://github.com/rails/rails/issues/48637", "id": 1786122529, "node_id": "I_kwDNIULOanYRIQ", "number": 48637, "title": "Postgres daterange bug in upper bound", "user": {"login": "morgoth", "id": 10766, "node_id": "MDQ6VXNlcjEwNzY2", "avatar_url": "https://avatars.githubusercontent.com/u/10766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/morgoth", "html_url": "https://github.com/morgoth", "followers_url": "https://api.github.com/users/morgoth/followers", "following_url": "https://api.github.com/users/morgoth/following{/other_user}", "gists_url": "https://api.github.com/users/morgoth/gists{/gist_id}", "starred_url": "https://api.github.com/users/morgoth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/morgoth/subscriptions", "organizations_url": "https://api.github.com/users/morgoth/orgs", "repos_url": "https://api.github.com/users/morgoth/repos", "events_url": "https://api.github.com/users/morgoth/events{/privacy}", "received_events_url": "https://api.github.com/users/morgoth/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-03T12:51:20Z", "updated_at": "2023-07-03T14:04:18Z", "closed_at": "2023-07-03T14:04:18Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "The created range object is different than when read from the database:\r\n\r\n```ruby\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"pg\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"postgresql\", database: \"replenisher_test\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :inactivities, force: true do |t|\r\n    t.daterange :period, null: false\r\n  end\r\nend\r\n\r\nclass Inactivity < ActiveRecord::Base\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_bug\r\n    inactivity = Inactivity.create!(period: Date.current..Date.current)\r\n\r\n    assert_equal Date.current, inactivity.period.begin\r\n    assert_equal Date.current, inactivity.period.end\r\n\r\n    inactivity.reload\r\n    assert_equal Date.current, inactivity.period.begin\r\n    assert_equal Date.current, inactivity.period.end # This one fails as it's tomorrow\r\n  end\r\nend\r\n```\r\n\r\nWhat I see in AR logs is:\r\n`D, [2023-07-03T14:35:01.016148 #1121465] DEBUG -- :   Inactivity Create (0.8ms)  INSERT INTO \"inactivities\" (\"period\") VALUES ($1) RETURNING \"id\"  [[\"period\", \"[2023-07-03,2023-07-03]\"]]` which seems correct but the actual value in the database is stored as `\"[2023-07-03,2023-07-04)\"` (note the exclusive upper bound)", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48637/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48637/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48636", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48636/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48636/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48636/events", "html_url": "https://github.com/rails/rails/pull/48636", "id": 1786065895, "node_id": "PR_kwDNIULOVIUsCg", "number": 48636, "title": "[7-0-stable] Backport: \"Warm-up to avoid autoloads interfering with class serial\"", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-03T12:19:14Z", "updated_at": "2023-07-08T01:06:48Z", "closed_at": "2023-07-08T00:51:00Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48636", "html_url": "https://github.com/rails/rails/pull/48636", "diff_url": "https://github.com/rails/rails/pull/48636.diff", "patch_url": "https://github.com/rails/rails/pull/48636.patch", "merged_at": "2023-07-08T00:51:00Z"}, "body": "This is just a shot in the dark, but my gut tells me this commit fixes this flaky test.\r\n\r\nMost recently failed today in CI:\r\nhttps://buildkite.com/rails/rails/builds/97733#018919b9-fd8e-4fef-8536-671e68ffd2ac/1080-2620\r\n\r\n/cc @matthewd ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48636/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48636/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48635", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48635/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48635/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48635/events", "html_url": "https://github.com/rails/rails/pull/48635", "id": 1786043815, "node_id": "PR_kwDNIULOVITfZw", "number": 48635, "title": "[7-0-stable] Backport \"Fix flaky test in railties/test/applications/rake/dbs_test.rb\"", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-03T12:05:22Z", "updated_at": "2023-07-05T13:46:53Z", "closed_at": "2023-07-05T13:46:52Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48635", "html_url": "https://github.com/rails/rails/pull/48635", "diff_url": "https://github.com/rails/rails/pull/48635.diff", "patch_url": "https://github.com/rails/rails/pull/48635.patch", "merged_at": "2023-07-05T13:46:52Z"}, "body": "Backports #46965 to `7-0-stable` branch.\r\n\r\nThis error occurred today in CI:\r\nhttps://buildkite.com/rails/rails/builds/97733#018919b9-fc7c-4441-b5c6-64c45a6e4474", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48635/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48635/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48634", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48634/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48634/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48634/events", "html_url": "https://github.com/rails/rails/issues/48634", "id": 1785983573, "node_id": "I_kwDNIULOanPyVQ", "number": 48634, "title": "create_enum in migration does not drop type when rolling back", "user": {"login": "jarl-dk", "id": 191521, "node_id": "MDQ6VXNlcjE5MTUyMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/191521?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jarl-dk", "html_url": "https://github.com/jarl-dk", "followers_url": "https://api.github.com/users/jarl-dk/followers", "following_url": "https://api.github.com/users/jarl-dk/following{/other_user}", "gists_url": "https://api.github.com/users/jarl-dk/gists{/gist_id}", "starred_url": "https://api.github.com/users/jarl-dk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jarl-dk/subscriptions", "organizations_url": "https://api.github.com/users/jarl-dk/orgs", "repos_url": "https://api.github.com/users/jarl-dk/repos", "events_url": "https://api.github.com/users/jarl-dk/events{/privacy}", "received_events_url": "https://api.github.com/users/jarl-dk/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-03T11:29:12Z", "updated_at": "2023-08-17T09:01:03Z", "closed_at": "2023-07-03T11:39:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nUse Postgres backend.\r\n\r\nCreate a migration like\r\n```ruby\r\nclass CreateEnum < ActiveRecord::Migration[7.0]\r\n  def change\r\n    create_enum :direction [\"left\", \"right\"]\r\n  end\r\nend\r\n```\r\n\r\nThen run\r\n```\r\nrails db:migrate\r\nrails db:rollback\r\n```\r\n### Expected behavior\r\nI expect db/schema.rb not to contain a `create_enum` line\r\n\r\n### Actual behavior\r\nThe `db/schema.rn` file still contains a `create_enum` line after the rollback.\r\n\r\n### System configuration\r\nRails: 7.0.4\r\nRuby: 3.1.3\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48634/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48634/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48633", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48633/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48633/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48633/events", "html_url": "https://github.com/rails/rails/issues/48633", "id": 1785850610, "node_id": "I_kwDNIULOanHq8g", "number": 48633, "title": "Throwing abort on an autosaved `has_one` association does not raise an exception", "user": {"login": "wata727", "id": 9624059, "node_id": "MDQ6VXNlcjk2MjQwNTk=", "avatar_url": "https://avatars.githubusercontent.com/u/9624059?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wata727", "html_url": "https://github.com/wata727", "followers_url": "https://api.github.com/users/wata727/followers", "following_url": "https://api.github.com/users/wata727/following{/other_user}", "gists_url": "https://api.github.com/users/wata727/gists{/gist_id}", "starred_url": "https://api.github.com/users/wata727/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wata727/subscriptions", "organizations_url": "https://api.github.com/users/wata727/orgs", "repos_url": "https://api.github.com/users/wata727/repos", "events_url": "https://api.github.com/users/wata727/events{/privacy}", "received_events_url": "https://api.github.com/users/wata727/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-03T10:16:56Z", "updated_at": "2023-07-05T04:06:07Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activerecord\", \"7.0.6\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :suppliers, force: true do |t|\r\n  end\r\n  create_table :accounts, force: true do |t|\r\n    t.integer :supplier_id\r\n  end\r\nend\r\n\r\nclass Supplier < ActiveRecord::Base\r\n  has_one :account, autosave: true\r\nend\r\n\r\nclass Account < ActiveRecord::Base\r\n  before_save { throw(:abort) }\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_has_one\r\n    supplier = Supplier.new\r\n    supplier.build_account\r\n    assert_raises(ActiveRecord::RecordNotSaved) { supplier.save! }\r\n\r\n    assert_equal 0, Supplier.count\r\n    assert_equal 0, Account.count\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\n<!-- Tell us what should happen -->\r\n\r\nThe tests should pass without errors.\r\n\r\n### Actual behavior\r\n<!-- Tell us what happens instead -->\r\n\r\n`ActiveRecord::RecordNotSaved` is not raised.\r\n\r\n```\r\n# Running:\r\n\r\nFinished in 0.004507s, 221.8771 runs/s, 221.8771 assertions/s.\r\n\r\n  1) Failure:\r\nBugTest#test_has_one [has_one_abort_autosave.rb:43]:\r\nActiveRecord::RecordNotSaved expected but nothing was raised.\r\n\r\n1 runs, 1 assertions, 1 failures, 0 errors, 0 skips\r\n```\r\n\r\n### Detailed description\r\n\r\nWhen I first encountered this issue, I wasn't sure if this was a bug or intended behavior. So, I investigated the behavior of `has_many`, `has_one`, `belongs_to`. Below is the test:\r\n\r\n<details>\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activerecord\", \"7.0.6\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n  end\r\n  create_table :comments, force: true do |t|\r\n    t.integer :post_id\r\n    t.text :content\r\n  end\r\n\r\n  create_table :suppliers, force: true do |t|\r\n  end\r\n  create_table :accounts, force: true do |t|\r\n    t.integer :supplier_id\r\n    t.string :name\r\n  end\r\n\r\n  create_table :books, force: true do |t|\r\n    t.integer :author_id\r\n  end\r\n  create_table :authors, force: true do |t|\r\n    t.string :name\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  has_many :comments\r\n  has_many :autosave_comments, class_name: 'Comment', autosave: true\r\n  has_many :abort_comments\r\n  has_many :abort_autosave_comments, class_name: 'AbortComment', autosave: true\r\n  has_many :invalid_comments\r\n  has_many :invalid_autosave_comments, class_name: 'InvalidComment', autosave: true\r\nend\r\n\r\nclass Comment < ActiveRecord::Base; end\r\nclass AbortComment < Comment\r\n  before_save { throw(:abort) }\r\nend\r\nclass InvalidComment < Comment\r\n  validates :content, presence: true\r\nend\r\n\r\nclass Supplier < ActiveRecord::Base\r\n  has_one :account\r\n  has_one :autosave_account, class_name: 'Account', autosave: true\r\n  has_one :abort_account\r\n  has_one :abort_autosave_account, class_name: 'AbortAccount', autosave: true\r\n  has_one :invalid_account\r\n  has_one :invalid_autosave_account, class_name: 'InvalidAccount', autosave: true\r\nend\r\n\r\nclass Account < ActiveRecord::Base; end\r\nclass AbortAccount < Account\r\n  before_save { throw(:abort) }\r\nend\r\nclass InvalidAccount < Account\r\n  validates :name, presence: true\r\nend\r\n\r\nclass Book < ActiveRecord::Base\r\n  belongs_to :author\r\n  belongs_to :autosave_author, class_name: 'Author', foreign_key: 'author_id', autosave: true\r\n  belongs_to :abort_author, foreign_key: 'author_id'\r\n  belongs_to :abort_autosave_author, class_name: 'AbortAuthor', foreign_key: 'author_id', autosave: true\r\n  belongs_to :invalid_author, foreign_key: 'author_id'\r\n  belongs_to :invalid_autosave_author, class_name: 'InvalidAuthor', foreign_key: 'author_id', autosave: true\r\nend\r\n\r\nclass Author < ActiveRecord::Base; end\r\nclass AbortAuthor < Author\r\n  before_save { throw(:abort) }\r\nend\r\nclass InvalidAuthor < Author\r\n  validates :name, presence: true\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def teardown\r\n    Post.delete_all\r\n    Comment.delete_all\r\n    Supplier.delete_all\r\n    Account.delete_all\r\n    Book.delete_all\r\n    Author.delete_all\r\n  end\r\n\r\n  def test_has_many\r\n    post = Post.new\r\n    post.comments.build\r\n    assert post.save!\r\n\r\n    assert_equal 1, Post.count\r\n    assert_equal 1, Comment.count\r\n  end\r\n\r\n  def test_has_many_autosave\r\n    post = Post.new\r\n    post.autosave_comments.build\r\n    assert post.save!\r\n\r\n    assert_equal 1, Post.count\r\n    assert_equal 1, Comment.count\r\n  end\r\n\r\n  def test_has_many_abort\r\n    post = Post.new\r\n    post.abort_comments.build\r\n    assert_raises(ActiveRecord::RecordInvalid) { post.save!}\r\n\r\n    assert_equal 0, Post.count\r\n    assert_equal 0, Comment.count\r\n  end\r\n\r\n  def test_has_many_abort_autosave\r\n    post = Post.new\r\n    post.abort_autosave_comments.build\r\n    assert_raises(ActiveRecord::RecordInvalid) { post.save!}\r\n\r\n    assert_equal 0, Post.count\r\n    assert_equal 0, Comment.count\r\n  end\r\n\r\n  def test_has_many_invalid\r\n    post = Post.new\r\n    post.invalid_comments.build\r\n    assert_raises(ActiveRecord::RecordInvalid) { post.save!}\r\n\r\n    assert_equal 0, Post.count\r\n    assert_equal 0, Comment.count\r\n  end\r\n\r\n  def test_has_many_invalid_autosave\r\n    post = Post.new\r\n    post.invalid_autosave_comments.build\r\n    assert_raises(ActiveRecord::RecordInvalid) { post.save!}\r\n\r\n    assert_equal 0, Post.count\r\n    assert_equal 0, Comment.count\r\n  end\r\n\r\n  def test_has_one\r\n    supplier = Supplier.new\r\n    supplier.build_account\r\n    assert supplier.save!\r\n\r\n    assert_equal 1, Supplier.count\r\n    assert_equal 1, Account.count\r\n  end\r\n\r\n  def test_has_one_autosave\r\n    supplier = Supplier.new\r\n    supplier.build_autosave_account\r\n    assert supplier.save!\r\n\r\n    assert_equal 1, Supplier.count\r\n    assert_equal 1, Account.count\r\n  end\r\n\r\n  def test_has_one_abort\r\n    supplier = Supplier.new\r\n    supplier.build_abort_account\r\n    assert supplier.save!\r\n\r\n    assert_equal 1, Supplier.count\r\n    assert_equal 0, Account.count\r\n  end\r\n\r\n  def test_has_one_abort_autosave\r\n    supplier = Supplier.new\r\n    supplier.build_abort_autosave_account\r\n    assert_raises(ActiveRecord::RecordNotSaved) { supplier.save! }\r\n\r\n    assert_equal 0, Supplier.count\r\n    assert_equal 0, Account.count\r\n  end\r\n\r\n  def test_has_one_invalid\r\n    supplier = Supplier.new\r\n    supplier.build_invalid_account\r\n    assert supplier.save!\r\n\r\n    assert_equal 1, Supplier.count\r\n    assert_equal 0, Account.count\r\n  end\r\n\r\n  def test_has_one_invalid_autosave\r\n    supplier = Supplier.new\r\n    supplier.build_invalid_autosave_account\r\n    assert_raises(ActiveRecord::RecordInvalid) { supplier.save! }\r\n\r\n    assert_equal 0, Supplier.count\r\n    assert_equal 0, Account.count\r\n  end\r\n\r\n  def test_belongs_to\r\n    book = Book.new\r\n    book.build_author\r\n    assert book.save!\r\n\r\n    assert_equal 1, Book.count\r\n    assert_equal 1, Author.count\r\n  end\r\n\r\n  def test_belongs_to_autosave\r\n    book = Book.new\r\n    book.build_autosave_author\r\n    assert book.save!\r\n\r\n    assert_equal 1, Book.count\r\n    assert_equal 1, Author.count\r\n  end\r\n\r\n  def test_belongs_to_abort\r\n    book = Book.new\r\n    book.build_abort_author\r\n    assert book.save!\r\n\r\n    assert_equal 1, Book.count\r\n    assert_equal 0, Author.count\r\n  end\r\n\r\n  def test_belongs_to_abort_autosave\r\n    book = Book.new\r\n    book.build_abort_autosave_author\r\n    assert_raises(ActiveRecord::RecordNotSaved) { book.save! }\r\n\r\n    assert_equal 0, Book.count\r\n    assert_equal 0, Author.count\r\n  end\r\n\r\n  def test_belongs_to_invalid\r\n    book = Book.new\r\n    book.build_invalid_author\r\n    assert book.save!\r\n\r\n    assert_equal 1, Book.count\r\n    assert_equal 0, Author.count\r\n  end\r\n\r\n  def test_belongs_to_invalid_autosave\r\n    book = Book.new\r\n    book.build_invalid_autosave_author\r\n    assert_raises(ActiveRecord::RecordInvalid) { book.save! }\r\n\r\n    assert_equal 0, Book.count\r\n    assert_equal 0, Author.count\r\n  end\r\nend\r\n```\r\n\r\n</details>\r\n\r\nThis test describes the consistent behavior of each association, but when I run it the test fails only in the case of `has_one` + abort + autosave:\r\n\r\n```\r\nFinished in 0.073115s, 246.1875 runs/s, 711.2084 assertions/s.\r\n\r\n  1) Failure:\r\nBugTest#test_has_one_abort_autosave [test.rb:191]:\r\nActiveRecord::RecordNotSaved expected but nothing was raised.\r\n\r\n18 runs, 52 assertions, 1 failures, 0 errors, 0 skips\r\n```\r\n\r\nAlso, in Active Record's documentation on callbacks, you'll find something like this:\r\n\r\n> If a before_* callback cancels the action a ROLLBACK is issued. You can also trigger a ROLLBACK raising an exception in any of the callbacks, including after_* hooks. Note, however, that in that case the client needs to be aware of it because an ordinary [#save](https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-save) will raise such exception instead of quietly returning false.\r\n\r\nhttps://github.com/rails/rails/blob/v7.0.6/activerecord/lib/active_record/callbacks.rb#L268-L272\r\n\r\nThe current behavior of `has_one` seems to contradict this explanation.\r\n\r\nNote that this behavior has been around for a long time and is not a regression. As far as I can see, https://github.com/rails/rails/issues/22184 mentions the same issue.\r\n\r\nA possible fix would be to `throw(:abort)` if `save_has_one_association` returns `false`, as with `belongs_to`, but we need to investigate whether it works correctly under multiple conditions.\r\nhttps://github.com/rails/rails/blob/v7.0.6/activerecord/lib/active_record/autosave_association.rb#L198\r\nhttps://github.com/rails/rails/blob/v7.0.6/activerecord/lib/active_record/autosave_association.rb#L210\r\n\r\n### System configuration\r\n**Rails version**:\r\n```\r\n7.0.6\r\n```\r\n\r\n**Ruby version**:\r\n```\r\nruby 3.0.6p216 (2023-03-30 revision 23a532679b) [arm64-darwin22]\r\n```", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48633/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48633/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48632", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48632/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48632/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48632/events", "html_url": "https://github.com/rails/rails/issues/48632", "id": 1785808864, "node_id": "I_kwDNIULOanFH4A", "number": 48632, "title": "Uniqueness validation not triggering when calling create_association", "user": {"login": "rcpj", "id": 1983035, "node_id": "MDQ6VXNlcjE5ODMwMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/1983035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rcpj", "html_url": "https://github.com/rcpj", "followers_url": "https://api.github.com/users/rcpj/followers", "following_url": "https://api.github.com/users/rcpj/following{/other_user}", "gists_url": "https://api.github.com/users/rcpj/gists{/gist_id}", "starred_url": "https://api.github.com/users/rcpj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rcpj/subscriptions", "organizations_url": "https://api.github.com/users/rcpj/orgs", "repos_url": "https://api.github.com/users/rcpj/repos", "events_url": "https://api.github.com/users/rcpj/events{/privacy}", "received_events_url": "https://api.github.com/users/rcpj/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-03T09:54:09Z", "updated_at": "2023-07-04T23:18:47Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "From Rails version v7.0.5 onwards, the uniqueness validation stopped working when calling the create_association method from the model with the _has_one_. This doesn't happen if the create method is issued directly from the association model instead.\r\n\r\n### Steps to reproduce\r\n```ruby\r\n#!/usr/bin/env ruby\r\n\r\nrequire 'bundler/inline'\r\n\r\ngemfile(true) do\r\n  source 'https://rubygems.org'\r\n\r\n  gem 'rails', '~> 7.0.5'\r\n  gem 'sqlite3'\r\n  gem 'byebug'\r\nend\r\n\r\nrequire 'active_record'\r\nrequire 'minitest/autorun'\r\nrequire 'logger'\r\n\r\nActiveRecord::Base.establish_connection(adapter: 'sqlite3', database: ':memory:')\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :invoices do |t|\r\n    t.string :name\r\n  end\r\n\r\n  create_table :payments do |t|\r\n    t.string :name\r\n    t.references :invoice\r\n  end\r\nend\r\n\r\nclass Invoice < ActiveRecord::Base\r\n  has_one :payment, dependent: :destroy\r\nend\r\n\r\nclass Payment < ActiveRecord::Base\r\n  belongs_to :invoice, optional: true\r\n  validates :invoice_id, uniqueness: true\r\nend\r\n\r\nclass TestUniquenessValidationNotTriggering < Minitest::Test\r\n  def test_uniqueness_validation_not_triggering\r\n    assert_raises ActiveRecord::RecordInvalid do\r\n      invoice = Invoice.create(name: 'Example invoice')\r\n      invoice.create_payment!(name: \"Alice's payment\")\r\n      assert_equal \"Alice's payment\", invoice.payment.name\r\n\r\n      invoice.create_payment!(name: \"Bob's payment\")\r\n    end\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\nIt should raise ActiveRecord::RecordInvalid due to uniqueness validation\r\n\r\n### Actual behavior\r\nIt creates the record successfully not raising the ActiveRecord::RecordInvalid exception\r\n\r\n### System configuration\r\n**Rails version**: ~> 7.0.5\r\n\r\n**Ruby version**: 3.2.1\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48632/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48632/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48631", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48631/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48631/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48631/events", "html_url": "https://github.com/rails/rails/pull/48631", "id": 1785574907, "node_id": "PR_kwDNIULOVH5z6Q", "number": 48631, "title": "Disable database prepared statements when query logs are enabled", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-03T08:00:30Z", "updated_at": "2023-07-03T10:41:20Z", "closed_at": "2023-07-03T10:39:34Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48631", "html_url": "https://github.com/rails/rails/pull/48631", "diff_url": "https://github.com/rails/rails/pull/48631.diff", "patch_url": "https://github.com/rails/rails/pull/48631.patch", "merged_at": "2023-07-03T10:39:34Z"}, "body": "Fixes #48398\r\n\r\nPrepared Statements and Query Logs are incompatible features due to query logs making every query unique.\r\n\r\nMarginalia [explains](https://github.com/basecamp/marginalia#prepared-statements) the situation pretty well:\r\n\r\n> Be careful when using Marginalia with prepared statements. If you use a component like request_id then every query will be unique and so ActiveRecord will create a new prepared statement for each potentially exhausting system resources. Disable prepared statements if you wish to use components with high cardinality values.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48631/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48631/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48629", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48629/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48629/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48629/events", "html_url": "https://github.com/rails/rails/issues/48629", "id": 1785111394, "node_id": "I_kwDNIULOamajYg", "number": 48629, "title": "Rails 7.0.6 label_for translations not working in index views", "user": {"login": "augustosamame", "id": 16038063, "node_id": "MDQ6VXNlcjE2MDM4MDYz", "avatar_url": "https://avatars.githubusercontent.com/u/16038063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/augustosamame", "html_url": "https://github.com/augustosamame", "followers_url": "https://api.github.com/users/augustosamame/followers", "following_url": "https://api.github.com/users/augustosamame/following{/other_user}", "gists_url": "https://api.github.com/users/augustosamame/gists{/gist_id}", "starred_url": "https://api.github.com/users/augustosamame/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/augustosamame/subscriptions", "organizations_url": "https://api.github.com/users/augustosamame/orgs", "repos_url": "https://api.github.com/users/augustosamame/repos", "events_url": "https://api.github.com/users/augustosamame/events{/privacy}", "received_events_url": "https://api.github.com/users/augustosamame/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-07-03T01:29:09Z", "updated_at": "2023-07-04T21:40:28Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\ngenerate a new rails project\r\ngenerate a scaffold: `rails g scaffold Post title body`\r\nrun migrations\r\nmodify i18n `en.yml` file with the following content:\r\n\r\n```\r\nen:\r\n  hello: \"Hello world\"\r\n  activerecord:\r\n    attributes:\r\n      post:\r\n        title: \"Title from i18n\"\r\n        body: \"Body from i18n\"\r\n```\r\n\r\nReplace the labels in both index and show views with `<%= label(:post, :body) %>`\r\nOr you can even do the replace in the single `posts` shared partial\r\n\r\n```\r\n<div id=\"<%= dom_id post %>\">\r\n  <p>\r\n    <strong>Title:</strong>\r\n    <%= post.title %>\r\n  </p>\r\n\r\n  <p>\r\n    <strong><%= label(:post, :body) %>:</strong>\r\n    <%= post.body %>\r\n  </p>\r\n\r\n</div>\r\n\r\n```\r\n\r\n### Expected behavior\r\n\r\nThe body label should show 'Body from i18n' in all views\r\n\r\n### Actual behavior\r\n\r\nAll views show correct translated label. Index view shows the incorrect (default) `body` label\r\n\r\nI did some testing and all views are fine, but for some reason, index view fails.\r\n\r\n\r\n### System configuration\r\n\r\n**Rails version 7.0.6**:\r\n\r\n**Ruby version 3.2.2**:\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48629/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48629/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48628", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48628/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48628/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48628/events", "html_url": "https://github.com/rails/rails/pull/48628", "id": 1784594954, "node_id": "PR_kwDNIULOVHEbRg", "number": 48628, "title": "PostgreSQL reload virtual attributes on update", "user": {"login": "abaldwin88", "id": 15172605, "node_id": "MDQ6VXNlcjE1MTcyNjA1", "avatar_url": "https://avatars.githubusercontent.com/u/15172605?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abaldwin88", "html_url": "https://github.com/abaldwin88", "followers_url": "https://api.github.com/users/abaldwin88/followers", "following_url": "https://api.github.com/users/abaldwin88/following{/other_user}", "gists_url": "https://api.github.com/users/abaldwin88/gists{/gist_id}", "starred_url": "https://api.github.com/users/abaldwin88/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abaldwin88/subscriptions", "organizations_url": "https://api.github.com/users/abaldwin88/orgs", "repos_url": "https://api.github.com/users/abaldwin88/repos", "events_url": "https://api.github.com/users/abaldwin88/events{/privacy}", "received_events_url": "https://api.github.com/users/abaldwin88/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-02T11:30:36Z", "updated_at": "2023-08-10T16:50:31Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48628", "html_url": "https://github.com/rails/rails/pull/48628", "diff_url": "https://github.com/rails/rails/pull/48628.diff", "patch_url": "https://github.com/rails/rails/pull/48628.patch", "merged_at": null}, "body": "Extends Active Record to automatically reload virtual attributes on update when using PostgreSQL. This is done by issuing a single UPDATE query that includes a RETURNING clause.\r\n\r\n### Motivation\r\n\r\nSaves an extra round trip to the database for reload and removes a developer pitfall around stale virtual attribute values.\r\n\r\n### Detail\r\n\r\nGiven a `Post` model represented by the following schema:\r\n```ruby\r\ncreate_table :posts do |t|\r\n  t.integer :upvotes_count\r\n  t.integer :downvotes_count\r\n  t.virtual :total_votes_count, type: :integer, as: \"upvotes_count + downvotes_count\", stored: true\r\nend\r\n```\r\n`total_votes_count` will reflect the sum of upvotes and downvotes after `update` is successfully called. Prior to this change calling `reload` would have been necessary to obtain the value calculated by the database.\r\n```ruby\r\npost = Post.find(1)\r\npost.update(upvotes_count: 2, downvotes_count: 2)\r\n# Calling `post.reload` no longer necessary\r\npost.total_votes => 4\r\n```\r\n\r\n* At this moment MySQL and SQLite adapters do not support this behavior\r\n\r\n### Additional information\r\n\r\n* Follow-up from PR #48241\r\n* Related to PR #48434\r\n* Closes #48423 when using Postgresql\r\n\r\nCC: @nvasilevski\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n~* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.~. \r\n* I'll update the docs and changelog after a core team member confirms this is the right approach\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48628/reactions", "total_count": 7, "+1": 4, "-1": 0, "laugh": 0, "hooray": 3, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48628/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48627", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48627/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48627/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48627/events", "html_url": "https://github.com/rails/rails/pull/48627", "id": 1784539773, "node_id": "PR_kwDNIULOVHBoYA", "number": 48627, "title": "Document generated scopes for `has_one_attached` and `has_many_attached`", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-02T09:06:55Z", "updated_at": "2023-07-03T05:27:37Z", "closed_at": "2023-07-03T05:27:33Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48627", "html_url": "https://github.com/rails/rails/pull/48627", "diff_url": "https://github.com/rails/rails/pull/48627.diff", "patch_url": "https://github.com/rails/rails/pull/48627.patch", "merged_at": "2023-07-03T05:27:33Z"}, "body": "`has_one_attached` and `has_many_attached` generate several scopes and relations:\r\n\r\n* `with_attached_*`\r\n* `*_attachment`\r\n* `*_attachments`\r\n* `*_blob`\r\n* `*_blobs`\r\n\r\nBut these are all undocumented.\r\n\r\nWe can document these methods similar to ee58c8e6be using the `:method:` directive.\r\n\r\n<img width=\"1035\" alt=\"image\" src=\"https://github.com/rails/rails/assets/28561/68137c45-4eae-49c1-a26e-0019c9f3d280\">\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48627/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48627/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48626", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48626/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48626/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48626/events", "html_url": "https://github.com/rails/rails/pull/48626", "id": 1784505846, "node_id": "PR_kwDNIULOVG_7gA", "number": 48626, "title": "Active Job: `async` adapter should always run jobs immediately if `immediate` set", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123812746, "node_id": "MDU6TGFiZWwxMjM4MTI3NDY=", "url": "https://api.github.com/repos/rails/rails/labels/activejob", "name": "activejob", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-02T07:39:17Z", "updated_at": "2023-07-03T00:41:14Z", "closed_at": "2023-07-03T00:37:57Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48626", "html_url": "https://github.com/rails/rails/pull/48626", "diff_url": "https://github.com/rails/rails/pull/48626.diff", "patch_url": "https://github.com/rails/rails/pull/48626.patch", "merged_at": "2023-07-03T00:37:57Z"}, "body": "This is an internal fix, not user facing. I noticed it while working on https://github.com/rails/rails/pull/48585.\r\n\r\nThe `async` adapter has an `immediate` option, which should only be used in tests. This option should tell the adapter to run jobs inline. This works correctly with `perform_later`, but it does not work with `enqueue_at`, which is what other internal mechanisms such as `retry_job` use.\r\n\r\nThis PR fixes this bug.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48626/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48626/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48625", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48625/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48625/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48625/events", "html_url": "https://github.com/rails/rails/pull/48625", "id": 1784493928, "node_id": "PR_kwDNIULOVG_XWw", "number": 48625, "title": "[ci-skip][Doc] Fix inconsistency in 7-0-stable sample codes ", "user": {"login": "hachi8833", "id": 4289625, "node_id": "MDQ6VXNlcjQyODk2MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/4289625?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hachi8833", "html_url": "https://github.com/hachi8833", "followers_url": "https://api.github.com/users/hachi8833/followers", "following_url": "https://api.github.com/users/hachi8833/following{/other_user}", "gists_url": "https://api.github.com/users/hachi8833/gists{/gist_id}", "starred_url": "https://api.github.com/users/hachi8833/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hachi8833/subscriptions", "organizations_url": "https://api.github.com/users/hachi8833/orgs", "repos_url": "https://api.github.com/users/hachi8833/repos", "events_url": "https://api.github.com/users/hachi8833/events{/privacy}", "received_events_url": "https://api.github.com/users/hachi8833/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-02T07:01:53Z", "updated_at": "2023-07-02T21:21:13Z", "closed_at": "2023-07-02T10:21:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48625", "html_url": "https://github.com/rails/rails/pull/48625", "diff_url": "https://github.com/rails/rails/pull/48625.diff", "patch_url": "https://github.com/rails/rails/pull/48625.patch", "merged_at": "2023-07-02T10:21:01Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because we found an inconsistency that breaks some sample codes.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes `dir` to `direction` as current main branch does.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48625/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48625/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48624", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48624/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48624/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48624/events", "html_url": "https://github.com/rails/rails/pull/48624", "id": 1784492704, "node_id": "PR_kwDNIULOVG_TxA", "number": 48624, "title": "[ci-skip] Fix inconsistency in sample codes in migration guide", "user": {"login": "hachi8833", "id": 4289625, "node_id": "MDQ6VXNlcjQyODk2MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/4289625?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hachi8833", "html_url": "https://github.com/hachi8833", "followers_url": "https://api.github.com/users/hachi8833/followers", "following_url": "https://api.github.com/users/hachi8833/following{/other_user}", "gists_url": "https://api.github.com/users/hachi8833/gists{/gist_id}", "starred_url": "https://api.github.com/users/hachi8833/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hachi8833/subscriptions", "organizations_url": "https://api.github.com/users/hachi8833/orgs", "repos_url": "https://api.github.com/users/hachi8833/repos", "events_url": "https://api.github.com/users/hachi8833/events{/privacy}", "received_events_url": "https://api.github.com/users/hachi8833/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-02T06:57:42Z", "updated_at": "2023-07-02T21:21:16Z", "closed_at": "2023-07-02T06:59:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48624", "html_url": "https://github.com/rails/rails/pull/48624", "diff_url": "https://github.com/rails/rails/pull/48624.diff", "patch_url": "https://github.com/rails/rails/pull/48624.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because we found an inconsistency that breaks some sample codes.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes `dir` to `direction` as current main branch does.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48624/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48624/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48623", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48623/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48623/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48623/events", "html_url": "https://github.com/rails/rails/pull/48623", "id": 1784479707, "node_id": "PR_kwDNIULOVG-pEA", "number": 48623, "title": "Fix incorrect arguments for Active Job test job [internal]", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123812746, "node_id": "MDU6TGFiZWwxMjM4MTI3NDY=", "url": "https://api.github.com/repos/rails/rails/labels/activejob", "name": "activejob", "color": "5319e7", "default": false, "description": null}, {"id": 1072773639, "node_id": "MDU6TGFiZWwxMDcyNzczNjM5", "url": "https://api.github.com/repos/rails/rails/labels/ready", "name": "ready", "color": "fef2c0", "default": false, "description": "PRs ready to merge"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-02T06:27:45Z", "updated_at": "2023-07-03T00:37:33Z", "closed_at": "2023-07-03T00:36:57Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48623", "html_url": "https://github.com/rails/rails/pull/48623", "diff_url": "https://github.com/rails/rails/pull/48623.diff", "patch_url": "https://github.com/rails/rails/pull/48623.patch", "merged_at": "2023-07-03T00:36:57Z"}, "body": "This is an internal fix, not user facing. I noticed it while working on https://github.com/rails/rails/pull/48585.\r\n\r\nCurrently the `LoggingJob` does not accept more than one argument. But there's [a few tests](https://github.com/rails/rails/blob/f46d3452ae30c46d3e213c687decbbca0cee9119/activejob/test/cases/test_helper_test.rb#L518-L537) that call it with multiple arguments and assert that it is queued correctly. Those tests pass because the job is not performed, but if the job was performed, they'd fail.\r\n\r\nThis PR just fixes `LoggingJob` to accept a splat of arguments, and adds a test to ensure that it works correctly.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48623/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48623/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48622", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48622/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48622/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48622/events", "html_url": "https://github.com/rails/rails/pull/48622", "id": 1784286124, "node_id": "PR_kwDNIULOVG0K3g", "number": 48622, "title": "Add lower bound to Listen gem requirement", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-07-01T22:05:19Z", "updated_at": "2023-07-02T13:23:24Z", "closed_at": "2023-07-02T05:10:48Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48622", "html_url": "https://github.com/rails/rails/pull/48622", "diff_url": "https://github.com/rails/rails/pull/48622.diff", "patch_url": "https://github.com/rails/rails/pull/48622.patch", "merged_at": "2023-07-02T05:10:48Z"}, "body": "### Motivation / Background\r\n\r\nRef #48620\r\n\r\nAn issue was recently opened with the following error message:\r\n\r\n```\r\n.../activesupport-7.0.6/lib/active_support/evented_file_update_checker.rb:120:in `start': undefined method `wait_for_state' for #<Listen::Listener ...>\r\n```\r\n\r\nThe issue is that the user was using Listen 3.0.8, however the `wait_for_state` method was [added][1] in Listen 3.3.0\r\n\r\n### Detail\r\n\r\nWe can make the error message a little better by defining a lower bound on Listen 3.3.0 (like we do for other optional dependencies):\r\n\r\n```\r\n.../bundler/rubygems_integration.rb:280:in `block (2 levels) in replace_gem': can't activate listen (~> 3.3), already activated listen-3.0.8. Make sure all dependencies are added to Gemfile. (Gem::LoadError)\r\n```\r\n\r\nThere is definitely still room for improvement here, but this should be much more helpful in figuring out that the issue is a bad Listen version and not a bug in Rails.\r\n\r\n[1]: https://github.com/guard/listen/commit/12b4fc54a965f6a07c71bd53207ce8be8b0d7869\r\n\r\n### Additional Information\r\n\r\nIf this is backport worthy, we would need to backport #47002 as well\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48622/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48622/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48621", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48621/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48621/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48621/events", "html_url": "https://github.com/rails/rails/issues/48621", "id": 1784100094, "node_id": "I_kwDNIULOalc0_g", "number": 48621, "title": "Cannot load `Rails.application.database_configuration", "user": {"login": "JayPanchani1054", "id": 42607347, "node_id": "MDQ6VXNlcjQyNjA3MzQ3", "avatar_url": "https://avatars.githubusercontent.com/u/42607347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JayPanchani1054", "html_url": "https://github.com/JayPanchani1054", "followers_url": "https://api.github.com/users/JayPanchani1054/followers", "following_url": "https://api.github.com/users/JayPanchani1054/following{/other_user}", "gists_url": "https://api.github.com/users/JayPanchani1054/gists{/gist_id}", "starred_url": "https://api.github.com/users/JayPanchani1054/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JayPanchani1054/subscriptions", "organizations_url": "https://api.github.com/users/JayPanchani1054/orgs", "repos_url": "https://api.github.com/users/JayPanchani1054/repos", "events_url": "https://api.github.com/users/JayPanchani1054/events{/privacy}", "received_events_url": "https://api.github.com/users/JayPanchani1054/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-07-01T17:14:37Z", "updated_at": "2023-07-01T20:04:13Z", "closed_at": "2023-07-01T20:04:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "After installing refinerycms gem and creating a new app with $ refinerycms rickrockstar\r\nwhen I tried to run rails server it shows:\r\n\r\n```\r\n=> Booting Puma\r\n=> Rails 5.1.7 application starting in development\r\n=> Run `rails server -h` for more startup options\r\nExiting\r\nC:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:431:in `visit_Psych_Nodes_Alias': Cannot load `Rails.application.database_configuration`: (ArgumentError)\r\nwrong number of arguments (given 1, expected 0)\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:30:in `visit'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:6:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:35:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:347:in `block in revive_hash'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:345:in `each'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:345:in `each_slice'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:345:in `revive_hash'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:169:in `visit_Psych_Nodes_Mapping'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:30:in `visit'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:6:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:35:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:347:in `block in revive_hash'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:345:in `each'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:345:in `each_slice'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:345:in `revive_hash'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:169:in `visit_Psych_Nodes_Mapping'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:30:in `visit'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:6:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:35:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:320:in `visit_Psych_Nodes_Document'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:30:in `visit'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:6:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:35:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych.rb:334:in `safe_load'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych.rb:369:in `load'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/application/configuration.rb:133:in `database_configuration'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activerecord-5.1.7/lib/active_record/railtie.rb:121:in `block (2 levels) in <class:Railtie>'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:69:in `instance_eval'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:69:in `block in execute_hook'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:60:in `with_execution_control'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:65:in `execute_hook'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:41:in `block in on_load'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:40:in `each'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:40:in `on_load'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activerecord-5.1.7/lib/active_record/railtie.rb:120:in `block in <class:Railtie>'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/initializable.rb:30:in `instance_exec'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/initializable.rb:30:in `run'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/initializable.rb:59:in `block in run_initializers'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:228:in `block in tsort_each'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:350:in `block (2 levels) in each_strongly_connected_component'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:431:in `each_strongly_connected_component_from'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:349:in `block in each_strongly_connected_component'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:347:in `each'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:347:in `call'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:347:in `each_strongly_connected_component'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:226:in `tsort_each'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:205:in `tsort_each'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/initializable.rb:58:in `run_initializers'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/application.rb:353:in `initialize!'\r\n        from W:/Computer ENG/Dev/Reel Canteen/reelc/config/environment.rb:5:in `<top (required)>'\r\n        from config.ru:3:in `require_relative'\r\n        from config.ru:3:in `block in <main>'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/builder.rb:116:in `eval'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/builder.rb:116:in `new_from_string'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/builder.rb:105:in `load_file'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/builder.rb:66:in `parse_file'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/server.rb:349:in `build_app_and_options_from_config'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/server.rb:249:in `app'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/commands/server/server_command.rb:24:in `app'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/server.rb:422:in `wrapped_app'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/commands/server/server_command.rb:80:in `log_to_stdout'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/commands/server/server_command.rb:42:in `start'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/commands/server/server_command.rb:135:in `block in perform'\r\n        from <internal:kernel>:90:in `tap'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/commands/server/server_command.rb:130:in `perform'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/thor-1.2.2/lib/thor/command.rb:27:in `run'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/thor-1.2.2/lib/thor/invocation.rb:127:in `invoke_command'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/thor-1.2.2/lib/thor.rb:392:in `dispatch'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/command/base.rb:63:in `perform'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/command.rb:44:in `invoke'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/commands.rb:16:in `<top (required)>'\r\n        from <internal:C:/Ruby32-x64/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb>:37:in `require'\r\n        from <internal:C:/Ruby32-x64/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb>:37:in `require'\r\n        from bin/rails:4:in `<main>'\r\nC:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:431:in `visit_Psych_Nodes_Alias': wrong number of arguments (given 1, expected 0) (ArgumentError)\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:30:in `visit'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:6:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:35:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:347:in `block in revive_hash'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:345:in `each'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:345:in `each_slice'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:345:in `revive_hash'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:169:in `visit_Psych_Nodes_Mapping'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:30:in `visit'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:6:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:35:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:347:in `block in revive_hash'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:345:in `each'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:345:in `each_slice'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:345:in `revive_hash'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:169:in `visit_Psych_Nodes_Mapping'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:30:in `visit'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:6:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:35:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:320:in `visit_Psych_Nodes_Document'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:30:in `visit'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/visitor.rb:6:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych/visitors/to_ruby.rb:35:in `accept'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych.rb:334:in `safe_load'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/psych.rb:369:in `load'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/application/configuration.rb:133:in `database_configuration'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activerecord-5.1.7/lib/active_record/railtie.rb:121:in `block (2 levels) in <class:Railtie>'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:69:in `instance_eval'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:69:in `block in execute_hook'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:60:in `with_execution_control'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:65:in `execute_hook'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:41:in `block in on_load'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:40:in `each'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activesupport-5.1.7/lib/active_support/lazy_load_hooks.rb:40:in `on_load'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/activerecord-5.1.7/lib/active_record/railtie.rb:120:in `block in <class:Railtie>'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/initializable.rb:30:in `instance_exec'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/initializable.rb:30:in `run'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/initializable.rb:59:in `block in run_initializers'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:228:in `block in tsort_each'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:350:in `block (2 levels) in each_strongly_connected_component'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:431:in `each_strongly_connected_component_from'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:349:in `block in each_strongly_connected_component'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:347:in `each'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:347:in `call'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:347:in `each_strongly_connected_component'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:226:in `tsort_each'\r\n        from C:/Ruby32-x64/lib/ruby/3.2.0/tsort.rb:205:in `tsort_each'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/initializable.rb:58:in `run_initializers'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/application.rb:353:in `initialize!'\r\n        from W:/Computer ENG/Dev/Reel Canteen/reelc/config/environment.rb:5:in `<top (required)>'\r\n        from config.ru:3:in `require_relative'\r\n        from config.ru:3:in `block in <main>'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/builder.rb:116:in `eval'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/builder.rb:116:in `new_from_string'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/builder.rb:105:in `load_file'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/builder.rb:66:in `parse_file'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/server.rb:349:in `build_app_and_options_from_config'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/server.rb:249:in `app'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/commands/server/server_command.rb:24:in `app'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/server.rb:422:in `wrapped_app'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/commands/server/server_command.rb:80:in `log_to_stdout'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/commands/server/server_command.rb:42:in `start'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/commands/server/server_command.rb:135:in `block in perform'\r\n        from <internal:kernel>:90:in `tap'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/commands/server/server_command.rb:130:in `perform'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/thor-1.2.2/lib/thor/command.rb:27:in `run'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/thor-1.2.2/lib/thor/invocation.rb:127:in `invoke_command'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/thor-1.2.2/lib/thor.rb:392:in `dispatch'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/command/base.rb:63:in `perform'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/command.rb:44:in `invoke'\r\n        from C:/Ruby32-x64/lib/ruby/gems/3.2.0/gems/railties-5.1.7/lib/rails/commands.rb:16:in `<top (required)>'\r\n        from <internal:C:/Ruby32-x64/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb>:37:in `require'\r\n        from <internal:C:/Ruby32-x64/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb>:37:in `require'\r\n        from bin/rails:4:in `<main>'\r\n```", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48621/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48621/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48620", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48620/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48620/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48620/events", "html_url": "https://github.com/rails/rails/issues/48620", "id": 1783369129, "node_id": "I_kwDNIULOakwNqQ", "number": 48620, "title": "Rails 7.0.6 - undefined method `wait_for_state' ", "user": {"login": "OskarEichler", "id": 62393985, "node_id": "MDQ6VXNlcjYyMzkzOTg1", "avatar_url": "https://avatars.githubusercontent.com/u/62393985?v=4", "gravatar_id": "", "url": "https://api.github.com/users/OskarEichler", "html_url": "https://github.com/OskarEichler", "followers_url": "https://api.github.com/users/OskarEichler/followers", "following_url": "https://api.github.com/users/OskarEichler/following{/other_user}", "gists_url": "https://api.github.com/users/OskarEichler/gists{/gist_id}", "starred_url": "https://api.github.com/users/OskarEichler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/OskarEichler/subscriptions", "organizations_url": "https://api.github.com/users/OskarEichler/orgs", "repos_url": "https://api.github.com/users/OskarEichler/repos", "events_url": "https://api.github.com/users/OskarEichler/events{/privacy}", "received_events_url": "https://api.github.com/users/OskarEichler/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-07-01T02:36:51Z", "updated_at": "2023-07-01T06:58:52Z", "closed_at": "2023-07-01T06:58:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nAfter upgrading to Rails 7.0.6 we are getting an `undefined method `wait_for_state' ` error, please see below for error log.\r\n\r\n### Expected behavior\r\nRails App should initialize\r\n\r\n### Actual behavior\r\nGetting error: undefined method `wait_for_state' \r\n\r\n### System configuration\r\n**Rails version**:\r\n7.0.6\r\n\r\n**Ruby version**:\r\n3.2.1\r\n\r\n**Error Log**:\r\n\r\n```\r\n/Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/activesupport-7.0.6/lib/active_support/evented_file_update_checker.rb:120:in `start': undefined method `wait_for_state' for #<Listen::Listener:0x000000010b2838e8 @config=#<Listen::Listener::Config:0x000000010b283898 @options={:debug=>false, :wait_for_delay=>nil, :relative=>false, :force_polling=>false, :polling_fallback_message=>nil}, @relative=false, @min_delay_between_events=nil, @silencer_rules={:debug=>false, :wait_for_delay=>nil, :relative=>false, :force_polling=>false, :polling_fallback_message=>nil}>, @silencer_controller=#<Listen::Silencer::Controller:0x000000010b2a1e10 @silencer=#<Listen::Silencer:0x000000010b2a2040 @only_patterns=nil, @ignore_patterns=[/^(?: (NoMethodError)\r\n      \\.git\r\n      | \\.svn\r\n      | \\.hg\r\n      | \\.rbx\r\n      | \\.bundle\r\n      | bundle\r\n      | vendor\\/bundle\r\n      | log\r\n      | tmp\r\n      |vendor\\/ruby\r\n    )(\\/|$)/x, /(?:\r\n      # Kate's tmp\\/swp files\r\n      \\..*\\d+\\.new\r\n      | \\.kate-swp\r\n\r\n      # Gedit tmp files\r\n      | \\.goutputstream-.{6}\r\n\r\n      # Intellij files\r\n      | ___jb_bak___\r\n      | ___jb_old___\r\n\r\n      # Vim swap files and write test\r\n      | \\.sw[px]\r\n      | \\.swpx\r\n      | ^4913\r\n\r\n      # Sed temporary files - but without actual words, like 'sedatives'\r\n      | (?:^\r\n         sed\r\n\r\n         (?:\r\n          [a-zA-Z0-9]{0}[A-Z]{1}[a-zA-Z0-9]{5} |\r\n          [a-zA-Z0-9]{1}[A-Z]{1}[a-zA-Z0-9]{4} |\r\n          [a-zA-Z0-9]{2}[A-Z]{1}[a-zA-Z0-9]{3} |\r\n          [a-zA-Z0-9]{3}[A-Z]{1}[a-zA-Z0-9]{2} |\r\n          [a-zA-Z0-9]{4}[A-Z]{1}[a-zA-Z0-9]{1} |\r\n          [a-zA-Z0-9]{5}[A-Z]{1}[a-zA-Z0-9]{0}\r\n         )\r\n        )\r\n\r\n      # other files\r\n      | \\.DS_Store\r\n      | \\.tmp\r\n      | ~\r\n    )$/x]>, @prev_silencer_options={}>, @backend=#<Listen::Backend:0x000000010b2a1af0 @min_delay_between_events=0.05, @adapter=#<Listen::Adapter::Polling:0x000000010b282cb8 @started=true, @config=#<Listen::Adapter::Config:0x000000010b282df8 @directories=[#<Pathname:/Users/Oskar/1001tl/config/locales>], @silencer=#<Listen::Silencer:0x000000010b2a2040 @only_patterns=nil, @ignore_patterns=[/^(?:\r\n      \\.git\r\n      | \\.svn\r\n      | \\.hg\r\n      | \\.rbx\r\n      | \\.bundle\r\n      | bundle\r\n      | vendor\\/bundle\r\n      | log\r\n      | tmp\r\n      |vendor\\/ruby\r\n    )(\\/|$)/x, /(?:\r\n      # Kate's tmp\\/swp files\r\n      \\..*\\d+\\.new\r\n      | \\.kate-swp\r\n\r\n      # Gedit tmp files\r\n      | \\.goutputstream-.{6}\r\n\r\n      # Intellij files\r\n      | ___jb_bak___\r\n      | ___jb_old___\r\n\r\n      # Vim swap files and write test\r\n      | \\.sw[px]\r\n      | \\.swpx\r\n      | ^4913\r\n\r\n      # Sed temporary files - but without actual words, like 'sedatives'\r\n      | (?:^\r\n         sed\r\n\r\n         (?:\r\n          [a-zA-Z0-9]{0}[A-Z]{1}[a-zA-Z0-9]{5} |\r\n          [a-zA-Z0-9]{1}[A-Z]{1}[a-zA-Z0-9]{4} |\r\n          [a-zA-Z0-9]{2}[A-Z]{1}[a-zA-Z0-9]{3} |\r\n          [a-zA-Z0-9]{3}[A-Z]{1}[a-zA-Z0-9]{2} |\r\n          [a-zA-Z0-9]{4}[A-Z]{1}[a-zA-Z0-9]{1} |\r\n          [a-zA-Z0-9]{5}[A-Z]{1}[a-zA-Z0-9]{0}\r\n         )\r\n        )\r\n\r\n      # other files\r\n      | \\.DS_Store\r\n      | \\.tmp\r\n      | ~\r\n    )$/x]>, @queue=#<Listen::Event::Queue:0x000000010b2a21f8 @event_queue=#<Thread::Queue:0x000000010b2a2158>, @block=#<Proc:0x000000010b2a20b8 /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/listen-3.0.8/lib/listen/listener.rb:40>, @config=#<Listen::Event::Queue::Config:0x000000010b2a2298 @relative=false>>, @adapter_options={:wait_for_delay=>nil}>, @configured=true, @options=#<Listen::Options:0x000000010b2ee148 @options={:latency=>1.0, :wait_for_delay=>0.05}>, @callbacks={#<Pathname:/Users/Oskar/1001tl/config/locales>=>#<Proc:0x000000010b2ed7c0 /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/listen-3.0.8/lib/listen/adapter/base.rb:41 (lambda)>}, @polling_callbacks=[#<Proc:0x000000010b2ed7c0 /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/listen-3.0.8/lib/listen/adapter/base.rb:41 (lambda)>], @snapshots={#<Pathname:/Users/Oskar/1001tl/config/locales>=>#<Listen::Change:0x000000010b2ed450 @config=#<Listen::Change::Config:0x000000010b2ed680 @queue=#<Listen::Event::Queue:0x000000010b2a21f8 @event_queue=#<Thread::Queue:0x000000010b2a2158>, @block=#<Proc:0x000000010b2a20b8 /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/listen-3.0.8/lib/listen/listener.rb:40>, @config=#<Listen::Event::Queue::Config:0x000000010b2a2298 @relative=false>>, @silencer=#<Listen::Silencer:0x000000010b2a2040 @only_patterns=nil, @ignore_patterns=[/^(?:\r\n      \\.git\r\n      | \\.svn\r\n      | \\.hg\r\n      | \\.rbx\r\n      | \\.bundle\r\n      | bundle\r\n      | vendor\\/bundle\r\n      | log\r\n      | tmp\r\n      |vendor\\/ruby\r\n    )(\\/|$)/x, /(?:\r\n      # Kate's tmp\\/swp files\r\n      \\..*\\d+\\.new\r\n      | \\.kate-swp\r\n\r\n      # Gedit tmp files\r\n      | \\.goutputstream-.{6}\r\n\r\n      # Intellij files\r\n      | ___jb_bak___\r\n      | ___jb_old___\r\n\r\n      # Vim swap files and write test\r\n      | \\.sw[px]\r\n      | \\.swpx\r\n      | ^4913\r\n\r\n      # Sed temporary files - but without actual words, like 'sedatives'\r\n      | (?:^\r\n         sed\r\n\r\n         (?:\r\n          [a-zA-Z0-9]{0}[A-Z]{1}[a-zA-Z0-9]{5} |\r\n          [a-zA-Z0-9]{1}[A-Z]{1}[a-zA-Z0-9]{4} |\r\n          [a-zA-Z0-9]{2}[A-Z]{1}[a-zA-Z0-9]{3} |\r\n          [a-zA-Z0-9]{3}[A-Z]{1}[a-zA-Z0-9]{2} |\r\n          [a-zA-Z0-9]{4}[A-Z]{1}[a-zA-Z0-9]{1} |\r\n          [a-zA-Z0-9]{5}[A-Z]{1}[a-zA-Z0-9]{0}\r\n         )\r\n        )\r\n\r\n      # other files\r\n      | \\.DS_Store\r\n      | \\.tmp\r\n      | ~\r\n    )$/x]>>, @record=#<Listen::Record:0x000000010b2ed5e0 @tree={\"devise.en.yml\"=>{:mtime=>1686929602.3669014, :mode=>33188}}, @root=\"/Users/Oskar/1001tl/config/locales\">>}>>, @processor=#<Listen::Event::Loop:0x000000010b282c18 @config=#<Listen::Event::Config:0x000000010b282c68 @listener=#<Listen::Listener:0x000000010b2838e8 ...>, @event_queue=#<Listen::Event::Queue:0x000000010b2a21f8 @event_queue=#<Thread::Queue:0x000000010b2a2158>, @block=#<Proc:0x000000010b2a20b8 /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/listen-3.0.8/lib/listen/listener.rb:40>, @config=#<Listen::Event::Queue::Config:0x000000010b2a2298 @relative=false>>, @queue_optimizer=#<Listen::QueueOptimizer:0x000000010b2edf68 @config=#<Listen::QueueOptimizer::Config:0x000000010b2ee030 @adapter_class=#<Listen::Backend:0x000000010b2a1af0 @min_delay_between_events=0.05, @adapter=#<Listen::Adapter::Polling:0x000000010b282cb8 @started=true, @config=#<Listen::Adapter::Config:0x000000010b282df8 @directories=[#<Pathname:/Users/Oskar/1001tl/config/locales>], @silencer=#<Listen::Silencer:0x000000010b2a2040 @only_patterns=nil, @ignore_patterns=[/^(?:\r\n      \\.git\r\n      | \\.svn\r\n      | \\.hg\r\n      | \\.rbx\r\n      | \\.bundle\r\n      | bundle\r\n      | vendor\\/bundle\r\n      | log\r\n      | tmp\r\n      |vendor\\/ruby\r\n    )(\\/|$)/x, /(?:\r\n      # Kate's tmp\\/swp files\r\n      \\..*\\d+\\.new\r\n      | \\.kate-swp\r\n\r\n      # Gedit tmp files\r\n      | \\.goutputstream-.{6}\r\n\r\n      # Intellij files\r\n      | ___jb_bak___\r\n      | ___jb_old___\r\n\r\n      # Vim swap files and write test\r\n      | \\.sw[px]\r\n      | \\.swpx\r\n      | ^4913\r\n\r\n      # Sed temporary files - but without actual words, like 'sedatives'\r\n      | (?:^\r\n         sed\r\n\r\n         (?:\r\n          [a-zA-Z0-9]{0}[A-Z]{1}[a-zA-Z0-9]{5} |\r\n          [a-zA-Z0-9]{1}[A-Z]{1}[a-zA-Z0-9]{4} |\r\n          [a-zA-Z0-9]{2}[A-Z]{1}[a-zA-Z0-9]{3} |\r\n          [a-zA-Z0-9]{3}[A-Z]{1}[a-zA-Z0-9]{2} |\r\n          [a-zA-Z0-9]{4}[A-Z]{1}[a-zA-Z0-9]{1} |\r\n          [a-zA-Z0-9]{5}[A-Z]{1}[a-zA-Z0-9]{0}\r\n         )\r\n        )\r\n\r\n      # other files\r\n      | \\.DS_Store\r\n      | \\.tmp\r\n      | ~\r\n    )$/x]>, @queue=#<Listen::Event::Queue:0x000000010b2a21f8 @event_queue=#<Thread::Queue:0x000000010b2a2158>, @block=#<Proc:0x000000010b2a20b8 /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/listen-3.0.8/lib/listen/listener.rb:40>, @config=#<Listen::Event::Queue::Config:0x000000010b2a2298 @relative=false>>, @adapter_options={:wait_for_delay=>nil}>, @configured=true, @options=#<Listen::Options:0x000000010b2ee148 @options={:latency=>1.0, :wait_for_delay=>0.05}>, @callbacks={#<Pathname:/Users/Oskar/1001tl/config/locales>=>#<Proc:0x000000010b2ed7c0 /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/listen-3.0.8/lib/listen/adapter/base.rb:41 (lambda)>}, @polling_callbacks=[#<Proc:0x000000010b2ed7c0 /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/listen-3.0.8/lib/listen/adapter/base.rb:41 (lambda)>], @snapshots={#<Pathname:/Users/Oskar/1001tl/config/locales>=>#<Listen::Change:0x000000010b2ed450 @config=#<Listen::Change::Config:0x000000010b2ed680 @queue=#<Listen::Event::Queue:0x000000010b2a21f8 @event_queue=#<Thread::Queue:0x000000010b2a2158>, @block=#<Proc:0x000000010b2a20b8 /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/listen-3.0.8/lib/listen/listener.rb:40>, @config=#<Listen::Event::Queue::Config:0x000000010b2a2298 @relative=false>>, @silencer=#<Listen::Silencer:0x000000010b2a2040 @only_patterns=nil, @ignore_patterns=[/^(?:\r\n      \\.git\r\n      | \\.svn\r\n      | \\.hg\r\n      | \\.rbx\r\n      | \\.bundle\r\n      | bundle\r\n      | vendor\\/bundle\r\n      | log\r\n      | tmp\r\n      |vendor\\/ruby\r\n    )(\\/|$)/x, /(?:\r\n      # Kate's tmp\\/swp files\r\n      \\..*\\d+\\.new\r\n      | \\.kate-swp\r\n\r\n      # Gedit tmp files\r\n      | \\.goutputstream-.{6}\r\n\r\n      # Intellij files\r\n      | ___jb_bak___\r\n      | ___jb_old___\r\n\r\n      # Vim swap files and write test\r\n      | \\.sw[px]\r\n      | \\.swpx\r\n      | ^4913\r\n\r\n      # Sed temporary files - but without actual words, like 'sedatives'\r\n      | (?:^\r\n         sed\r\n\r\n         (?:\r\n          [a-zA-Z0-9]{0}[A-Z]{1}[a-zA-Z0-9]{5} |\r\n          [a-zA-Z0-9]{1}[A-Z]{1}[a-zA-Z0-9]{4} |\r\n          [a-zA-Z0-9]{2}[A-Z]{1}[a-zA-Z0-9]{3} |\r\n          [a-zA-Z0-9]{3}[A-Z]{1}[a-zA-Z0-9]{2} |\r\n          [a-zA-Z0-9]{4}[A-Z]{1}[a-zA-Z0-9]{1} |\r\n          [a-zA-Z0-9]{5}[A-Z]{1}[a-zA-Z0-9]{0}\r\n         )\r\n        )\r\n\r\n      # other files\r\n      | \\.DS_Store\r\n      | \\.tmp\r\n      | ~\r\n    )$/x]>>, @record=#<Listen::Record:0x000000010b2ed5e0 @tree={\"devise.en.yml\"=>{:mtime=>1686929602.3669014, :mode=>33188}}, @root=\"/Users/Oskar/1001tl/config/locales\">>}>>, @silencer=#<Listen::Silencer:0x000000010b2a2040 @only_patterns=nil, @ignore_patterns=[/^(?:\r\n      \\.git\r\n      | \\.svn\r\n      | \\.hg\r\n      | \\.rbx\r\n      | \\.bundle\r\n      | bundle\r\n      | vendor\\/bundle\r\n      | log\r\n      | tmp\r\n      |vendor\\/ruby\r\n    )(\\/|$)/x, /(?:\r\n      # Kate's tmp\\/swp files\r\n      \\..*\\d+\\.new\r\n      | \\.kate-swp\r\n\r\n      # Gedit tmp files\r\n      | \\.goutputstream-.{6}\r\n\r\n      # Intellij files\r\n      | ___jb_bak___\r\n      | ___jb_old___\r\n\r\n      # Vim swap files and write test\r\n      | \\.sw[px]\r\n      | \\.swpx\r\n      | ^4913\r\n\r\n      # Sed temporary files - but without actual words, like 'sedatives'\r\n      | (?:^\r\n         sed\r\n\r\n         (?:\r\n          [a-zA-Z0-9]{0}[A-Z]{1}[a-zA-Z0-9]{5} |\r\n          [a-zA-Z0-9]{1}[A-Z]{1}[a-zA-Z0-9]{4} |\r\n          [a-zA-Z0-9]{2}[A-Z]{1}[a-zA-Z0-9]{3} |\r\n          [a-zA-Z0-9]{3}[A-Z]{1}[a-zA-Z0-9]{2} |\r\n          [a-zA-Z0-9]{4}[A-Z]{1}[a-zA-Z0-9]{1} |\r\n          [a-zA-Z0-9]{5}[A-Z]{1}[a-zA-Z0-9]{0}\r\n         )\r\n        )\r\n\r\n      # other files\r\n      | \\.DS_Store\r\n      | \\.tmp\r\n      | ~\r\n    )$/x]>>>, @min_delay_between_events=0.05, @block=#<Proc:0x000000010b2a25e0 (lambda)>>, @wait_thread=#<Thread:0x000000010b2ecfa0 /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/listen-3.0.8/lib/listen/internals/thread_pool.rb:6 sleep>, @state=:processing, @reasons=#<Thread::Queue:0x000000010b2ede00>>, @state=:processing_events>\r\n\r\n        @listener&.wait_for_state(:processing_events)\r\n                 ^^^^^^^^^^^^^^^^\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/activesupport-7.0.6/lib/active_support/evented_file_update_checker.rb:90:in `initialize'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/activesupport-7.0.6/lib/active_support/evented_file_update_checker.rb:42:in `new'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/activesupport-7.0.6/lib/active_support/evented_file_update_checker.rb:42:in `initialize'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/activesupport-7.0.6/lib/active_support/i18n_railtie.rb:64:in `new'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/activesupport-7.0.6/lib/active_support/i18n_railtie.rb:64:in `initialize_i18n'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/activesupport-7.0.6/lib/active_support/i18n_railtie.rb:20:in `block in <class:Railtie>'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/activesupport-7.0.6/lib/active_support/lazy_load_hooks.rb:92:in `block in execute_hook'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/activesupport-7.0.6/lib/active_support/lazy_load_hooks.rb:85:in `with_execution_control'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/activesupport-7.0.6/lib/active_support/lazy_load_hooks.rb:90:in `execute_hook'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/activesupport-7.0.6/lib/active_support/lazy_load_hooks.rb:76:in `block in run_load_hooks'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/activesupport-7.0.6/lib/active_support/lazy_load_hooks.rb:75:in `each'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/activesupport-7.0.6/lib/active_support/lazy_load_hooks.rb:75:in `run_load_hooks'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/railties-7.0.6/lib/rails/application/finisher.rb:87:in `block in <module:Finisher>'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/railties-7.0.6/lib/rails/initializable.rb:32:in `instance_exec'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/railties-7.0.6/lib/rails/initializable.rb:32:in `run'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/railties-7.0.6/lib/rails/initializable.rb:61:in `block in run_initializers'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/3.2.0/tsort.rb:228:in `block in tsort_each'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/3.2.0/tsort.rb:350:in `block (2 levels) in each_strongly_connected_component'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/3.2.0/tsort.rb:431:in `each_strongly_connected_component_from'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/3.2.0/tsort.rb:349:in `block in each_strongly_connected_component'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/3.2.0/tsort.rb:347:in `each'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/3.2.0/tsort.rb:347:in `call'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/3.2.0/tsort.rb:347:in `each_strongly_connected_component'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/3.2.0/tsort.rb:226:in `tsort_each'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/3.2.0/tsort.rb:205:in `tsort_each'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/railties-7.0.6/lib/rails/initializable.rb:60:in `run_initializers'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/railties-7.0.6/lib/rails/application.rb:372:in `initialize!'\r\n\tfrom /Users/Oskar/1001tl/config/environment.rb:5:in `<main>'\r\n\tfrom config.ru:5:in `require_relative'\r\n\tfrom config.ru:5:in `block in <main>'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/builder.rb:116:in `eval'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/builder.rb:116:in `new_from_string'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/builder.rb:105:in `load_file'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/builder.rb:66:in `parse_file'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/server.rb:349:in `build_app_and_options_from_config'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/server.rb:249:in `app'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/rack-2.2.7/lib/rack/server.rb:422:in `wrapped_app'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/railties-7.0.6/lib/rails/commands/server/server_command.rb:76:in `log_to_stdout'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/railties-7.0.6/lib/rails/commands/server/server_command.rb:36:in `start'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/railties-7.0.6/lib/rails/commands/server/server_command.rb:143:in `block in perform'\r\n\tfrom <internal:kernel>:90:in `tap'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/railties-7.0.6/lib/rails/commands/server/server_command.rb:134:in `perform'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/thor-1.2.2/lib/thor/command.rb:27:in `run'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/thor-1.2.2/lib/thor/invocation.rb:127:in `invoke_command'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/thor-1.2.2/lib/thor.rb:392:in `dispatch'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/railties-7.0.6/lib/rails/command/base.rb:87:in `perform'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/railties-7.0.6/lib/rails/command.rb:48:in `invoke'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/railties-7.0.6/lib/rails/commands.rb:18:in `<main>'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/bootsnap-1.15.0/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:32:in `require'\r\n\tfrom /Users/Oskar/.rbenv/versions/3.2.1/lib/ruby/gems/3.2.0/gems/bootsnap-1.15.0/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:32:in `require'\r\n\tfrom bin/rails:4:in `<main>'\r\n```", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48620/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48620/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48619", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48619/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48619/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48619/events", "html_url": "https://github.com/rails/rails/pull/48619", "id": 1783188419, "node_id": "PR_kwDNIULOVF22eQ", "number": 48619, "title": "Add attributes_with_aliases and attribute_names_with_aliases", "user": {"login": "kawamotosatoshi", "id": 18253416, "node_id": "MDQ6VXNlcjE4MjUzNDE2", "avatar_url": "https://avatars.githubusercontent.com/u/18253416?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kawamotosatoshi", "html_url": "https://github.com/kawamotosatoshi", "followers_url": "https://api.github.com/users/kawamotosatoshi/followers", "following_url": "https://api.github.com/users/kawamotosatoshi/following{/other_user}", "gists_url": "https://api.github.com/users/kawamotosatoshi/gists{/gist_id}", "starred_url": "https://api.github.com/users/kawamotosatoshi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kawamotosatoshi/subscriptions", "organizations_url": "https://api.github.com/users/kawamotosatoshi/orgs", "repos_url": "https://api.github.com/users/kawamotosatoshi/repos", "events_url": "https://api.github.com/users/kawamotosatoshi/events{/privacy}", "received_events_url": "https://api.github.com/users/kawamotosatoshi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-30T21:34:32Z", "updated_at": "2023-07-01T03:21:54Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48619", "html_url": "https://github.com/rails/rails/pull/48619", "diff_url": "https://github.com/rails/rails/pull/48619.diff", "patch_url": "https://github.com/rails/rails/pull/48619.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created because get attributes with aliases.\r\n\r\nFor more information, please check here.\r\nhttps://discuss.rubyonrails.org/t/i-would-like-an-idea-to-create-an-issue-about-add-alias-attribute-to-method-attributes/82793\r\n\r\n### Detail\r\n\r\nThis Pull Request changes ActiveModel and ActiveRecord\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n```\r\n% cd activemodel\r\n% bin/test test/cases/attributes_test.rb \r\nRun options: --seed 887\r\n\r\n# Running:\r\n\r\n................\r\n\r\nFinished in 0.009967s, 1605.2975 runs/s, 3411.2571 assertions/s.\r\n16 runs, 34 assertions, 0 failures, 0 errors, 0 skips\r\n```\r\n\r\n```\r\n% cd activerecord\r\n% bin/test test/cases/attribute_methods_test.rb\r\nUsing sqlite3\r\nRun options: --seed 19232\r\n\r\n# Running:\r\n\r\n................................................................................................................\r\n\r\nFinished in 0.629886s, 177.8100 runs/s, 779.5061 assertions/s.\r\n112 runs, 491 assertions, 0 failures, 0 errors, 0 skips\r\n```\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48619/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48619/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48618", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48618/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48618/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48618/events", "html_url": "https://github.com/rails/rails/pull/48618", "id": 1783034930, "node_id": "PR_kwDNIULOVFucHg", "number": 48618, "title": "Fix some formatting in ActiveModel::Dirty docs [ci-skip]", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-30T19:05:24Z", "updated_at": "2023-06-30T19:06:16Z", "closed_at": "2023-06-30T19:06:12Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48618", "html_url": "https://github.com/rails/rails/pull/48618", "diff_url": "https://github.com/rails/rails/pull/48618.diff", "patch_url": "https://github.com/rails/rails/pull/48618.patch", "merged_at": "2023-06-30T19:06:12Z"}, "body": null, "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48618/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48618/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48617", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48617/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48617/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48617/events", "html_url": "https://github.com/rails/rails/issues/48617", "id": 1782847017, "node_id": "I_kwDNIULOakQWKQ", "number": 48617, "title": "strict_loading error in Association#find_target", "user": {"login": "michael-ujet", "id": 131704618, "node_id": "U_kgDOB9mnKg", "avatar_url": "https://avatars.githubusercontent.com/u/131704618?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michael-ujet", "html_url": "https://github.com/michael-ujet", "followers_url": "https://api.github.com/users/michael-ujet/followers", "following_url": "https://api.github.com/users/michael-ujet/following{/other_user}", "gists_url": "https://api.github.com/users/michael-ujet/gists{/gist_id}", "starred_url": "https://api.github.com/users/michael-ujet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michael-ujet/subscriptions", "organizations_url": "https://api.github.com/users/michael-ujet/orgs", "repos_url": "https://api.github.com/users/michael-ujet/repos", "events_url": "https://api.github.com/users/michael-ujet/events{/privacy}", "received_events_url": "https://api.github.com/users/michael-ujet/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-06-30T16:53:17Z", "updated_at": "2023-08-18T17:02:01Z", "closed_at": "2023-07-05T19:48:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nI'm not sure what a minimal representation would be.  We've been running a large application on rails 7.0.5 for a while, but a recent change caused the following error:\r\n\r\n```\r\nThe :mode option must be one of [:all, :n_plus_one_only].\r\nruby/3.1.4/lib/ruby/gems/3.1.0/gems/activerecord-7.0.5/lib/active_record/core.rb:663:in `strict_loading!'\r\nruby/3.1.4/lib/ruby/gems/3.1.0/gems/activerecord-7.0.5/lib/active_record/associations/association.rb:237:in `block in find_target'\r\nruby/3.1.4/lib/ruby/gems/3.1.0/gems/activerecord-7.0.5/lib/active_record/core.rb:504:in `init_with_attributes'\r\nruby/3.1.4/lib/ruby/gems/3.1.0/gems/activerecord-7.0.5/lib/active_record/persistence.rb:537:in `instantiate_instance_of'\r\nruby/3.1.4/lib/ruby/gems/3.1.0/gems/activerecord-7.0.5/lib/active_record/querying.rb:76:in `block (2 levels) in _load_from_sql'\r\nruby/3.1.4/lib/ruby/gems/3.1.0/gems/activerecord-7.0.5/lib/active_record/result.rb:69:in `each'\r\n```\r\n\r\nwe're not using strict loading anywhere in our code.  It _seems_ this is due to the following in `Association#find_target`:\r\n\r\n```ruby\r\nif owner.strict_loading_n_plus_one_only? && reflection.macro == :has_many\r\n  record.strict_loading!\r\nelse\r\n  record.strict_loading!(false, mode: owner.strict_loading_mode)\r\nend\r\n```\r\n\r\nwhich should maybe be:\r\n```ruby\r\n  record.strict_loading!(false)\r\n```\r\n\r\n### Expected behavior\r\nNo ArgumentError\r\n\r\n### Actual behavior\r\nArgumentError raised\r\n\r\n### System configuration\r\n**Rails version**: 7.0.5\r\n\r\n**Ruby version**: 3.1.4\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48617/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48617/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48616", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48616/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48616/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48616/events", "html_url": "https://github.com/rails/rails/pull/48616", "id": 1782126924, "node_id": "PR_kwDNIULOVE9u4A", "number": 48616, "title": "Document `ActiveRecord::Dirty` module in the API docs", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-30T08:34:24Z", "updated_at": "2023-06-30T20:18:56Z", "closed_at": "2023-06-30T20:07:13Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48616", "html_url": "https://github.com/rails/rails/pull/48616", "diff_url": "https://github.com/rails/rails/pull/48616.diff", "patch_url": "https://github.com/rails/rails/pull/48616.patch", "merged_at": "2023-06-30T20:07:13Z"}, "body": "Currently it is a bit unclear which dirty methods can be called on Active Record models. You have to know that methods from ActiveModel::Dirty are included.\r\n\r\nIt also unclear if methods can be invoked in the form of `saved_change_to_name?` unless you read the documentation of the `saved_change_to_attribute?` method.\r\n\r\nBy adding an introduction to the module we can show which methods are defined specifically for Active Record, and how to call them, very similar to the ActiveModel::Dirty introduction.\r\nLinking to ActiveModel::Dirty makes it's also easier to find methods defined there.\r\n\r\n<img width=\"1032\" alt=\"image\" src=\"https://github.com/rails/rails/assets/28561/33308260-0816-4bf6-ab78-c45abb2c49b0\">\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48616/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48616/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48615", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48615/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48615/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48615/events", "html_url": "https://github.com/rails/rails/pull/48615", "id": 1781786158, "node_id": "PR_kwDNIULOVErk-A", "number": 48615, "title": "Add a public API for broadcasting logs", "user": {"login": "Edouard-chin", "id": 8122246, "node_id": "MDQ6VXNlcjgxMjIyNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/8122246?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edouard-chin", "html_url": "https://github.com/Edouard-chin", "followers_url": "https://api.github.com/users/Edouard-chin/followers", "following_url": "https://api.github.com/users/Edouard-chin/following{/other_user}", "gists_url": "https://api.github.com/users/Edouard-chin/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edouard-chin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edouard-chin/subscriptions", "organizations_url": "https://api.github.com/users/Edouard-chin/orgs", "repos_url": "https://api.github.com/users/Edouard-chin/repos", "events_url": "https://api.github.com/users/Edouard-chin/events{/privacy}", "received_events_url": "https://api.github.com/users/Edouard-chin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 123812746, "node_id": "MDU6TGFiZWwxMjM4MTI3NDY=", "url": "https://api.github.com/repos/rails/rails/labels/activejob", "name": "activejob", "color": "5319e7", "default": false, "description": null}, {"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-30T02:55:14Z", "updated_at": "2023-08-14T14:32:25Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48615", "html_url": "https://github.com/rails/rails/pull/48615", "diff_url": "https://github.com/rails/rails/pull/48615.diff", "patch_url": "https://github.com/rails/rails/pull/48615.patch", "merged_at": null}, "body": "### Context\r\n\r\nWhile working on https://github.com/rails/rails/pull/44695, I realised that Broadcasting was still a private API, although it\u2019s commonly used. @rafaelfranca mentioned that making it public would require some refactor because of the original implementation which was hard\r\nto understand and maintain.\r\n\r\n\r\n### Broadcasting\r\n\r\n\r\nBroadcasting in a nutshell worked by \u201ctransforming\u201d an existing logger into a broadcasted one.\r\nThe logger would then be responsible to log and format its own messages as well as passing the message along to other logger it broadcasts to.\r\n\r\nThe problem with this approach was the following:\r\n\r\n- Heavy use of metaprogramming.\r\n- Accessing the loggers in the broadcast wasn\u2019t possible. Removing a logger from the broadcast either.\r\n- More importantly, modifying the main logger (the one that broadcasts logs to the others) wasn\u2019t possible and the main source of misunderstanding.\r\n\r\n  ```ruby\r\n    logger = Logger.new(STDOUT)\r\n    stderr_logger = Logger.new(STDER))\r\n    logger.extend(AS::Logger.broadcast(stderr_logger))\r\n\r\n    logger.level = DEBUG # This modifies the level on all other loggers\r\n    logger.formatter = \u2026 # Modified the formatter on all other loggers\r\n  ```\r\n\r\nTo keep the contract unchanged on what `Rails.logger` returns, the new `BroadcastLogger` class implement duck typing with all methods that has the vanilla Ruby Logger class.\r\nIt's a simple and boring PORO that keeps an array of all the loggers that are part of the broadcast and iterate over whenever a log is sent.\r\n\r\nNow, users can access all loggers inside the broadcast and modify them on the fly. They can also remove any logger from the broadcast at any time.\r\n\r\n```ruby\r\n# Before\r\n\r\nstdout_logger = Logger.new(STDOUT)\r\nstderr_logger = Logger.new(STDER)\r\nfile_logger = Logger.new(\u201cdevelopment.log\u201d)\r\nstdout_logger.extend(AS::Logger.broadcast(stderr_logger))\r\nstdout_logger.extend(AS::Logger.broadcast(file_logger))\r\n\r\n# After\r\n\r\nbroadcast = BroadcastLogger.new(stdout_logger, stderr_logger, file_logger)\r\n```\r\n\r\nI also think that now, it should be more clear for users that the broadcast sole job is to pass everything to the whole loggers in the broadcast. So there should be no surprise that all loggers in the broadcast get their level modified when they call `broadcast.level = DEBUG` .\r\n\r\nIt\u2019s also easier to wrap your head around more complex setup such as broadcasting logs to another broadcast: `broadcast.broadcast_to(stdout_logger, other_broadcast)`\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48615/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48615/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48614", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48614/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48614/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48614/events", "html_url": "https://github.com/rails/rails/pull/48614", "id": 1781582685, "node_id": "PR_kwDNIULOVEgs_A", "number": 48614, "title": "Improve performance of ActiveSupport::JSON.encode", "user": {"login": "jhawthorn", "id": 131752, "node_id": "MDQ6VXNlcjEzMTc1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/131752?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhawthorn", "html_url": "https://github.com/jhawthorn", "followers_url": "https://api.github.com/users/jhawthorn/followers", "following_url": "https://api.github.com/users/jhawthorn/following{/other_user}", "gists_url": "https://api.github.com/users/jhawthorn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhawthorn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhawthorn/subscriptions", "organizations_url": "https://api.github.com/users/jhawthorn/orgs", "repos_url": "https://api.github.com/users/jhawthorn/repos", "events_url": "https://api.github.com/users/jhawthorn/events{/privacy}", "received_events_url": "https://api.github.com/users/jhawthorn/received_events", "type": "User", "site_admin": true}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-29T22:15:11Z", "updated_at": "2023-07-05T18:16:28Z", "closed_at": "2023-06-30T19:10:54Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48614", "html_url": "https://github.com/rails/rails/pull/48614", "diff_url": "https://github.com/rails/rails/pull/48614.diff", "patch_url": "https://github.com/rails/rails/pull/48614.patch", "merged_at": "2023-06-30T19:10:54Z"}, "body": "This about doubles the performance of `.to_json`/`ActiveSupport::JSON.encode` (with most impact when data is already JSON-ready, and no options are passed, but should be faster in all cases). The change should be mostly transparent to users. I've split this into three commits for easier digesting.\r\n\r\n## [Avoid extra pass on AS::JSON.dump with no options](https://github.com/rails/rails/commit/047da67ba31ec241e82ff630bdf446d8953fe754)\r\n\r\nJSONGemEncoder.encode previously would always perform two passes. First it would call `.as_json(options)`, but then would perform a second pass \"jsonify\" to recursively call `.as_json` (this time without options) until the data converges into a \"JSON-ready\" representation.\r\n\r\nWhen options are not given, the second pass should be equivalent to the first, so we can detect that, and only perform the \"jsonify\" step.\r\n\r\nThe only user-visible effect of this should be that we will pass no options to `as_json` instead of an empty Hash, but implementations of `as_json` should already be expected to accept that (EDIT: though there was one test case each in ActiveModel and ActiveRecord which this broke).\r\n\r\nThis could be considered a \"light\" version of what was done in https://github.com/rails/rails/pull/34633 from @tenderlove and @eileencodes from a few years back (I think that's still a great idea and may still be a future implementation, but a wider change than this PR).\r\n\r\n## [Escape JSON output instead of string inputs](https://github.com/rails/rails/commit/306490b07c95b1960c0316120d1133c563478456)\r\n\r\nRails performs additional escaping of strings compared to the JSON gem, and will escape U+2028, U+2029, <, >, and &. In JSON, the only places those characters are valid is inside of a JSON string, so it should be equivalent (and faster) to perform the escaping on the output.\r\n\r\nThis has the most performance impact, which is nice as it should improve all `.to_json` calls regardless of input. This escaping is still quite expensive and something I intend to continue looking into (either adjusting our rules for escaping or having a faster implementation of the escaping further upstream).\r\n\r\n## [Consider Symbol \"JSON-ready\", improve jsonify](https://github.com/rails/rails/commit/c9bf6a176d733f90f40ddacfc84fa8a72af6fde8)\r\n\r\nPreviously jsonify would call `.as_json` for Integer, nil, true, and false, even though those types are considered \"JSON-ready\" (looks like this was introduced in https://github.com/rails/rails/pull/26933). Technically a user could have overridden `.as_json` for these types but I can't imagine a use case and I don't think we should support that.\r\n\r\nI left the same behaviour of calling `.as_json` for generic \"Numeric\" as that can have user subclasses where one may have implemented `as_json`. This behaviour is also used for Float (which coerces `NaN`/`Infinity`/`-Infinity` into `nil`).\r\n\r\nThis also adds Symbol to the list of \"JSON-ready\" types, to avoid unnecessarily casting them to strings (possible as we no longer perform escaping on input). The output of `jsonify` should never be user visible before it is passed through `JSON.generate`, so I don't think this can be seen by users.\r\n\r\nThis also corrects our handling of Hash to call `to_s` on all keys, matching the behaviour of `.as_json` and JSON's requirement that keys are `Strings` (`Symbol`s are also permitted as the JSON gem knows to convert them to a string).\r\n\r\n\r\n## Benchmark\r\n\r\nTested using the `twitter.json` from [nativejson-benchmark](https://github.com/miloyip/nativejson-benchmark#json-data), which is somewhat unicode-heavy but otherwise IMO pretty typical.\r\n\r\n(JSON and RapidJSON included just for comparison/scale)\r\n\r\n``` ruby\r\nsource_data = ::JSON.parse(File.read(\"twitter.json\"))\r\nsource_data_sym = source_data.deep_symbolize_keys.deep_dup\r\n```\r\n\r\n**Rails main**\r\n\r\n```\r\n source_data.to_json     26.103  (\u00b1 0.0%) i/s -    132.000  in   5.056999s\r\nsource_data_sym.to_json\r\n                         24.311  (\u00b1 0.0%) i/s -    122.000  in   5.018373s\r\nJSON.generate(source_data)\r\n                        474.026  (\u00b1 0.8%) i/s -      2.392k in   5.046540s\r\nRapidJSON.generate(source_data)\r\n                        716.922  (\u00b1 4.6%) i/s -      3.618k in   5.057603s\r\n```\r\n\r\n**this branch**\r\n\r\n```\r\n source_data.to_json     61.344  (\u00b1 0.0%) i/s -    310.000  in   5.053787s\r\nsource_data_sym.to_json\r\n                         63.068  (\u00b1 1.6%) i/s -    318.000  in   5.042746s\r\nJSON.generate(source_data)\r\n                        470.431  (\u00b1 2.3%) i/s -      2.392k in   5.087858s\r\nRapidJSON.generate(source_data)\r\n                        704.303  (\u00b1 3.4%) i/s -      3.520k in   5.004222s\r\n```\r\n\r\n---\r\n\r\ncc @matthewd @byroot ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48614/reactions", "total_count": 8, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 6, "rocket": 2, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48614/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48613", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48613/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48613/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48613/events", "html_url": "https://github.com/rails/rails/pull/48613", "id": 1780950626, "node_id": "PR_kwDNIULOVD-vaQ", "number": 48613, "title": "Warn on an unnecessary table_name= invocation", "user": {"login": "nvasilevski", "id": 5512772, "node_id": "MDQ6VXNlcjU1MTI3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/5512772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nvasilevski", "html_url": "https://github.com/nvasilevski", "followers_url": "https://api.github.com/users/nvasilevski/followers", "following_url": "https://api.github.com/users/nvasilevski/following{/other_user}", "gists_url": "https://api.github.com/users/nvasilevski/gists{/gist_id}", "starred_url": "https://api.github.com/users/nvasilevski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nvasilevski/subscriptions", "organizations_url": "https://api.github.com/users/nvasilevski/orgs", "repos_url": "https://api.github.com/users/nvasilevski/repos", "events_url": "https://api.github.com/users/nvasilevski/events{/privacy}", "received_events_url": "https://api.github.com/users/nvasilevski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-29T14:27:43Z", "updated_at": "2023-06-29T15:10:06Z", "closed_at": "2023-06-29T15:10:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48613", "html_url": "https://github.com/rails/rails/pull/48613", "diff_url": "https://github.com/rails/rails/pull/48613.diff", "patch_url": "https://github.com/rails/rails/pull/48613.patch", "merged_at": null}, "body": "This commit adds a warning when `self.table_name =` is explicitly configured to the same value as would have been derived by convention and asks to remove the unnecessary config.\r\n\r\nI couldn't find a lot of examples where Rails issues any kind of notifications to help applications follow the \"convention over configuration\" principle but at the same time I'm struggling to find any argument against Rails being helpful in certain cases. \r\nGenerally we may be concerned about adding non-functional checks and degrading performance but in case of `table_name=` it can only impact boot time which will unlikely be noticeable\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48613/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48613/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48612", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48612/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48612/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48612/events", "html_url": "https://github.com/rails/rails/pull/48612", "id": 1780888966, "node_id": "PR_kwDNIULOVD7TqQ", "number": 48612, "title": "Introduce `ActiveSupport::Duration#in_time_duration`", "user": {"login": "stevepolitodesign", "id": 5122678, "node_id": "MDQ6VXNlcjUxMjI2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/5122678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stevepolitodesign", "html_url": "https://github.com/stevepolitodesign", "followers_url": "https://api.github.com/users/stevepolitodesign/followers", "following_url": "https://api.github.com/users/stevepolitodesign/following{/other_user}", "gists_url": "https://api.github.com/users/stevepolitodesign/gists{/gist_id}", "starred_url": "https://api.github.com/users/stevepolitodesign/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stevepolitodesign/subscriptions", "organizations_url": "https://api.github.com/users/stevepolitodesign/orgs", "repos_url": "https://api.github.com/users/stevepolitodesign/repos", "events_url": "https://api.github.com/users/stevepolitodesign/events{/privacy}", "received_events_url": "https://api.github.com/users/stevepolitodesign/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-29T14:01:01Z", "updated_at": "2023-06-29T14:38:11Z", "closed_at": "2023-06-29T14:38:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48612", "html_url": "https://github.com/rails/rails/pull/48612", "diff_url": "https://github.com/rails/rails/pull/48612.diff", "patch_url": "https://github.com/rails/rails/pull/48612.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nIt's common to represent duration in the format \"HH:MM:SS.milliseconds\". For example, media players or time tracking. Prior to this commit, it was not possible to return duration in this format/\r\n\r\n### Detail\r\n\r\nReturns the duration as a string in the format \"HH:MM:SS.milliseconds\". Supports negative values, as well as decimal points with 2 points for precision, while accounting for rounding.\r\n\r\n```ruby\r\n-1.hours.in_time_duration\r\n# => \"-01:00:00.00\"\r\n1.5.hours.in_time_duration \r\n# => \"00:01:30.00\"\r\n0.66.seconds.in_time_duration\r\n# => \"00:00:00.66\"\r\n0.666.seconds.in_time_duration\r\n# => \"00:00:00.67\"\r\n```\r\n\r\n### Additional information\r\n\r\n- In an effort to support negative durations, we call [abs](https://docs.ruby-lang.org/en/master/Numeric.html#method-i-abs) on all values.\r\n- The string will always return 11 characters: \r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48612/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48612/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48611", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48611/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48611/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48611/events", "html_url": "https://github.com/rails/rails/issues/48611", "id": 1780472225, "node_id": "I_kwDNIULOah_ZoQ", "number": 48611, "title": "Error loading cached data after upgrade to 7.1 `dump format error`", "user": {"login": "matthutchinson", "id": 2095, "node_id": "MDQ6VXNlcjIwOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/2095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthutchinson", "html_url": "https://github.com/matthutchinson", "followers_url": "https://api.github.com/users/matthutchinson/followers", "following_url": "https://api.github.com/users/matthutchinson/following{/other_user}", "gists_url": "https://api.github.com/users/matthutchinson/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthutchinson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthutchinson/subscriptions", "organizations_url": "https://api.github.com/users/matthutchinson/orgs", "repos_url": "https://api.github.com/users/matthutchinson/repos", "events_url": "https://api.github.com/users/matthutchinson/events{/privacy}", "received_events_url": "https://api.github.com/users/matthutchinson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rails/rails/milestones/82", "html_url": "https://github.com/rails/rails/milestone/82", "labels_url": "https://api.github.com/repos/rails/rails/milestones/82/labels", "id": 7758309, "node_id": "MI_kwDNIULOAHZh5Q", "number": 82, "title": "7.1.0", "description": "", "creator": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "open_issues": 10, "closed_issues": 37, "state": "open", "created_at": "2022-03-11T16:33:03Z", "updated_at": "2023-08-16T15:43:36Z", "due_on": null, "closed_at": null}, "comments": 13, "created_at": "2023-06-29T09:40:29Z", "updated_at": "2023-07-06T11:25:27Z", "closed_at": "2023-07-06T09:03:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "We have a Rails `7.0.5.1` app set with `config.load_defaults 6.0`\r\n\r\nWhen attempting to upgrade to 7.1.0-alpha, with cached data already present in the app (Redis cache) I'm getting an error when Rails attempts to read the data with `Marshal.load` in `Marshal61WithFallback` ([here](https://github.com/rails/rails/blob/main/activesupport/lib/active_support/cache/serializer_with_fallback.rb#L147)). \r\n\r\n```\r\nArgument Error \r\ndump format error (user class)\r\n```\r\n\r\nThe cached data is correctly identified as 6.1 with `Marshal61WithFallback::MARSHAL_SIGNATURE` but fails to load.  \r\n\r\n\r\nI've created an [example app](https://github.com/matthutchinson/rails-caching-example) where you can easily replicate this, (see reproduction instructions below).\r\n\r\nFrom reading recent commits and the [CHANGELOG](https://github.com/rails/rails/blob/main/activesupport/CHANGELOG.md), I can see that @jonathanhefner did make some --recent changes in here, but from what I can see, this should just work, without any necessary cache migration.  \r\n\r\n### Steps to reproduce\r\n\r\n```\r\ngit clone https://github.com/matthutchinson/rails-caching-example\r\ncd rails-caching-example\r\nbin/setup\r\nrails db:seed\r\nrails dev:cache\r\nrails server\r\nopen https://localhost:3000\r\n\r\n# visit page, causing partials to be cached\r\n# stop server\r\n# edit Gemfile, set to use edge rails from gh master\r\n\r\nbundle update rails\r\nrails server\r\nopen https://localhost:3000\r\n# page errors when loading cached data with dump format error (user class)\r\n\r\n```\r\n\r\nHere's a what the [dumped var](https://github.com/rails/rails/blob/main/activesupport/lib/active_support/cache/serializer_with_fallback.rb#L26) looks like in my [example app](https://github.com/matthutchinson/rails-caching-example) and I'm caching partials in `high_scores#index` with;\r\n\r\n`<%= render partial: \"high_score\", collection: @high_scores, cached: true %>`\r\n\r\n```\r\n\"\\u0004\\bo: ActiveSupport::Cache::Entry\\t:\\v@valueIC:\\u001DActionView::OutputBuffer\\\"\\u0001\\xAB<div id=\\\"high_score_1\\\">\\n  <p>\\n    <strong>Game:</strong>\\n    <a href=\\\"/high_scores/1\\\">Tetris</a>\\n  </p>\\n\\n  <p>\\n    <strong>Score:</strong>\\n    100000\\n  </p>\\n\\n</div>\\n<hr/>\\n\\a:\\u0006ET:\\u000F@html_safeT:\\r@versionI\\\"\\u001920230628145327125454\\u0006;\\bT:\\u0010@created_atf\\u00060:\\u0010@expires_in0\"\r\n```\r\n\r\n### Expected behavior\r\n\r\nCached partial data should be loaded and displayed without error\r\n\r\n### Actual behavior\r\n\r\nError raised when loading cached data from `Marshal.load`\r\n\r\n```\r\nArgument Error \r\ndump format error (user class)\r\n```\r\n\r\n<img width=\"1010\" alt=\"Screenshot 2023-06-28 at 16 35 43\" src=\"https://github.com/rails/rails/assets/2095/a06d95ed-7f35-42a0-97d4-0e2170bd21d3\">\r\n\r\n\r\n### System configuration\r\n\r\n**Rails version**: `7.1.0-alpha` (migrating from `7.0.5.1`)\r\n**Ruby version**: `3.1.2` and `3.2.0` \r\n\r\n\r\n#### Other Notes:\r\n\r\n* I thought [this commit](https://github.com/jonathanhefner/rails/commit/e2524e574b2f8f157190c00e7c2d1377995d2fdd) might have been the cause, but reverting to the commit before that, I get the same issue.\r\n* Clearing the cache will fix the issue, but in production, we'd really prefer not to have to do that.  \r\n* If clearing the cache _is a requirement_, we should update the docs and upgrade guide to explain that.\r\n\r\ncc @jonathanhefner ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48611/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48611/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48610", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48610/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48610/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48610/events", "html_url": "https://github.com/rails/rails/pull/48610", "id": 1780271043, "node_id": "PR_kwDNIULOVDZpiw", "number": 48610, "title": "Introduce config.autoload_lib_once(ignore:)", "user": {"login": "fxn", "id": 3387, "node_id": "MDQ6VXNlcjMzODc=", "avatar_url": "https://avatars.githubusercontent.com/u/3387?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxn", "html_url": "https://github.com/fxn", "followers_url": "https://api.github.com/users/fxn/followers", "following_url": "https://api.github.com/users/fxn/following{/other_user}", "gists_url": "https://api.github.com/users/fxn/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxn/subscriptions", "organizations_url": "https://api.github.com/users/fxn/orgs", "repos_url": "https://api.github.com/users/fxn/repos", "events_url": "https://api.github.com/users/fxn/events{/privacy}", "received_events_url": "https://api.github.com/users/fxn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-29T07:16:12Z", "updated_at": "2023-06-29T07:28:27Z", "closed_at": "2023-06-29T07:28:26Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48610", "html_url": "https://github.com/rails/rails/pull/48610", "diff_url": "https://github.com/rails/rails/pull/48610.diff", "patch_url": "https://github.com/rails/rails/pull/48610.patch", "merged_at": "2023-06-29T07:28:26Z"}, "body": "The method `config.autoload_lib_once` is similar to `config.autoload_lib`, except that it adds `lib` to `config.autoload_once_paths` instead.\r\n\r\nBy calling `config.autoload_lib_once`, classes and modules in `lib` can be autoloaded, even from application initializers, but won't be reloaded.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48610/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48610/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48609", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48609/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48609/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48609/events", "html_url": "https://github.com/rails/rails/issues/48609", "id": 1780242827, "node_id": "I_kwDNIULOahxZiw", "number": 48609, "title": "No way to configure `Strict-Transport-Security` not to be added on `config.force_ssl = true`?", "user": {"login": "r7kamura", "id": 111689, "node_id": "MDQ6VXNlcjExMTY4OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/111689?v=4", "gravatar_id": "", "url": "https://api.github.com/users/r7kamura", "html_url": "https://github.com/r7kamura", "followers_url": "https://api.github.com/users/r7kamura/followers", "following_url": "https://api.github.com/users/r7kamura/following{/other_user}", "gists_url": "https://api.github.com/users/r7kamura/gists{/gist_id}", "starred_url": "https://api.github.com/users/r7kamura/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/r7kamura/subscriptions", "organizations_url": "https://api.github.com/users/r7kamura/orgs", "repos_url": "https://api.github.com/users/r7kamura/repos", "events_url": "https://api.github.com/users/r7kamura/events{/privacy}", "received_events_url": "https://api.github.com/users/r7kamura/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2023-06-29T06:55:34Z", "updated_at": "2023-08-03T20:58:02Z", "closed_at": "2023-08-03T20:58:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\nI would like to use `config.force_ssl = true` for secure cookie and https URL generation. However, my application already has a reverse proxy configured to add `Strict-Transport-Security` header.\r\n\r\n### Expected behavior\r\n\r\nSo I want to use `config.force_ssl = true`, but not add `Strict-Transport-Security` header on the Rails application side, by setting `config.ssl_options`.\r\n\r\n### Actual behavior\r\n\r\nThere appears to be no way to set it up that way. The result is that `Strict-Transport-Security` header is added twice.\r\n\r\nAs a workaround, I have solved this problem by adding some Rack middleware on the outside that removes this header.\r\n\r\n### System configuration\r\n**Rails version**: 7.0.5.1\r\n\r\n**Ruby version**: 3.2.1\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48609/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48609/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48608", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48608/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48608/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48608/events", "html_url": "https://github.com/rails/rails/pull/48608", "id": 1780069788, "node_id": "PR_kwDNIULOVDO03g", "number": 48608, "title": "Support NULLS NOT DISTINCT in Postgres 15+", "user": {"login": "grjones", "id": 67890, "node_id": "MDQ6VXNlcjY3ODkw", "avatar_url": "https://avatars.githubusercontent.com/u/67890?v=4", "gravatar_id": "", "url": "https://api.github.com/users/grjones", "html_url": "https://github.com/grjones", "followers_url": "https://api.github.com/users/grjones/followers", "following_url": "https://api.github.com/users/grjones/following{/other_user}", "gists_url": "https://api.github.com/users/grjones/gists{/gist_id}", "starred_url": "https://api.github.com/users/grjones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/grjones/subscriptions", "organizations_url": "https://api.github.com/users/grjones/orgs", "repos_url": "https://api.github.com/users/grjones/repos", "events_url": "https://api.github.com/users/grjones/events{/privacy}", "received_events_url": "https://api.github.com/users/grjones/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-29T03:38:44Z", "updated_at": "2023-08-03T19:29:58Z", "closed_at": "2023-08-03T19:29:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48608", "html_url": "https://github.com/rails/rails/pull/48608", "diff_url": "https://github.com/rails/rails/pull/48608.diff", "patch_url": "https://github.com/rails/rails/pull/48608.patch", "merged_at": "2023-08-03T19:29:57Z"}, "body": "### Motivation / Background\r\n\r\nPostgreSQL 15 introduced `NULLS NOT DISTINCT` in order to support unique indexes where you want to treat NULLs as equal. Otherwise, and by default, unique indexes allow any rows with null column values.\r\n\r\nThis Pull Request has been created because creating unique indexes where rows can have only one null value is helpful, and it is a good idea to keep up with new PostgreSQL features.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the PostgreSQL connection adapter, schema detection, and schema generation. Prior work was done in https://github.com/rails/rails/pull/46659 but was incomplete--a DB created from schema.rb would not have `NULLS NOT DISTINCT` set. Additionally, https://github.com/rails/rails/pull/44803 added `INCLUDE` to the index schema regex, but this must come **before** `NULLS [NOT] DISTINCT` per the [Postgres](https://www.postgresql.org/docs/15/sql-createindex.html) docs.\r\n\r\n### Additional information\r\n\r\nCheck out the PostreSQL docs [here](https://www.postgresql.org/docs/15/sql-createindex.html), in particular to confirm the correct ordering of SQL parts. My intent was to put it immediately after `INCLUDE` in regex detection and ruby argument order.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48608/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48608/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48607", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48607/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48607/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48607/events", "html_url": "https://github.com/rails/rails/pull/48607", "id": 1780019106, "node_id": "PR_kwDNIULOVDMDYA", "number": 48607, "title": "Add option apply_on_subqueries to associations", "user": {"login": "lazaronixon", "id": 2651240, "node_id": "MDQ6VXNlcjI2NTEyNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/2651240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lazaronixon", "html_url": "https://github.com/lazaronixon", "followers_url": "https://api.github.com/users/lazaronixon/followers", "following_url": "https://api.github.com/users/lazaronixon/following{/other_user}", "gists_url": "https://api.github.com/users/lazaronixon/gists{/gist_id}", "starred_url": "https://api.github.com/users/lazaronixon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lazaronixon/subscriptions", "organizations_url": "https://api.github.com/users/lazaronixon/orgs", "repos_url": "https://api.github.com/users/lazaronixon/repos", "events_url": "https://api.github.com/users/lazaronixon/events{/privacy}", "received_events_url": "https://api.github.com/users/lazaronixon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-29T02:35:40Z", "updated_at": "2023-07-31T14:00:00Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48607", "html_url": "https://github.com/rails/rails/pull/48607", "diff_url": "https://github.com/rails/rails/pull/48607.diff", "patch_url": "https://github.com/rails/rails/pull/48607.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nAdd option to merge association scopes to subqueries.\r\n\r\nIt removes a breaking change introduced by #48487. Conditions that were not applied in\r\nprevious versions would be applied giving people different results.\r\n\r\nSet the option on an association:\r\n\r\n```ruby\r\nclass Author < ApplicationRecord\r\n  has_many :welcome_posts, -> { where(title: \"welcome\") } , class_name: \"Post\"\r\n  has_many :welcome_posts_scoped, -> { where(title: \"Welcome\") }, class_name: \"Post\", apply_on_subqueries: true\r\nend\r\n```\r\n\r\nThen the association scope will be merged into the subquery.\r\n\r\n```ruby\r\nAuthor.where(welcome_posts: Post.all)\r\n#=> SELECT (...) WHERE \"authors\".\"id\" IN (SELECT \"posts\".\"author_id\" FROM \"posts\")\r\n\r\nAuthor.where(welcome_posts_scoped: Post.all)\r\n#=> SELECT (...) WHERE \"authors\".\"id\" IN (SELECT \"posts\".\"author_id\" FROM \"posts\" WHERE \"posts\".\"title\" = 'welcome')    \r\n```\r\n\r\n### Additional information\r\n\r\nhttps://github.com/rails/rails/pull/48487#issuecomment-1612150489\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48607/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48607/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48606", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48606/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48606/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48606/events", "html_url": "https://github.com/rails/rails/pull/48606", "id": 1780009404, "node_id": "PR_kwDNIULOVDLjFA", "number": 48606, "title": "Support stale state detections in CPK through associations", "user": {"login": "gmcgibbon", "id": 5162312, "node_id": "MDQ6VXNlcjUxNjIzMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5162312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gmcgibbon", "html_url": "https://github.com/gmcgibbon", "followers_url": "https://api.github.com/users/gmcgibbon/followers", "following_url": "https://api.github.com/users/gmcgibbon/following{/other_user}", "gists_url": "https://api.github.com/users/gmcgibbon/gists{/gist_id}", "starred_url": "https://api.github.com/users/gmcgibbon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gmcgibbon/subscriptions", "organizations_url": "https://api.github.com/users/gmcgibbon/orgs", "repos_url": "https://api.github.com/users/gmcgibbon/repos", "events_url": "https://api.github.com/users/gmcgibbon/events{/privacy}", "received_events_url": "https://api.github.com/users/gmcgibbon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-29T02:21:02Z", "updated_at": "2023-07-05T17:00:29Z", "closed_at": "2023-07-05T15:07:21Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48606", "html_url": "https://github.com/rails/rails/pull/48606", "diff_url": "https://github.com/rails/rails/pull/48606.diff", "patch_url": "https://github.com/rails/rails/pull/48606.patch", "merged_at": "2023-07-05T15:07:21Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because stale stack checking for `has_many` / `has_one` through relations doesn't currently work for composite primary key relations. \r\n\r\n### Detail\r\n\r\nThis Pull Request changes stale states so that they are tracked as an array of columns to properly check through associations with composite primary keys.\r\n\r\n### Additional information\r\n\r\nMy tests might be too close to the implementation. Let me know if I should improve that.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48606/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48606/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48605", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48605/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48605/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48605/events", "html_url": "https://github.com/rails/rails/issues/48605", "id": 1779963694, "node_id": "I_kwDNIULOahgXLg", "number": 48605, "title": "`ActiveRecord::Encryption` tests fail", "user": {"login": "yahonda", "id": 73684, "node_id": "MDQ6VXNlcjczNjg0", "avatar_url": "https://avatars.githubusercontent.com/u/73684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yahonda", "html_url": "https://github.com/yahonda", "followers_url": "https://api.github.com/users/yahonda/followers", "following_url": "https://api.github.com/users/yahonda/following{/other_user}", "gists_url": "https://api.github.com/users/yahonda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yahonda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yahonda/subscriptions", "organizations_url": "https://api.github.com/users/yahonda/orgs", "repos_url": "https://api.github.com/users/yahonda/repos", "events_url": "https://api.github.com/users/yahonda/events{/privacy}", "received_events_url": "https://api.github.com/users/yahonda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 776781281, "node_id": "MDU6TGFiZWw3NzY3ODEyODE=", "url": "https://api.github.com/repos/rails/rails/labels/ci%20issues", "name": "ci issues", "color": "aaafff", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-29T01:12:32Z", "updated_at": "2023-07-05T09:48:08Z", "closed_at": "2023-07-05T09:48:08Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Managed to reproduce https://buildkite.com/rails/rails/builds/97615#018903f3-48a6-47cc-bd25-df5ae58f3810\r\n\r\n### Steps to reproduce\r\n\r\n```ruby\r\nARCONN=mysql2 bin/test test/cases/encryption/encryption_schemes_test.rb test/cases/encryption/encrypted_fixtures_test.rb test/cases/encryption/encryptable_record_api_test.rb test/cases/encryption/encryptable_record_test.rb --seed 28123 -n \"/^(?:ActiveRecord::Encryption::EncryptionSchemesTest#(?:test_use_global_previous_schemes_to_decrypt_data_encrypted_with_previous_schemes_with_unencrypted_data)|ActiveRecord::Encryption::EncryptableFixtureTest#(?:test_fixtures_get_encrypted_automatically|test_preserved_columns_due_to_ignore_case:_true_gets_encrypted_automatically)|ActiveRecord::Encryption::EncryptableRecordApiTest#(?:test_ciphertext_for_returns_the_ciphertext_for_a_given_attribute|test_ciphertext_for_returns_the_ciphertext_of_a_decrypted_value|test_ciphertext_for_returns_the_ciphertext_of_a_new_value|test_ciphertext_for_returns_the_ciphertext_of_a_value_when_the_record_is_new|test_encrypt_will_preserve_case_when_:ignore_case_option_is_used|test_encrypt_won\\\\'t_force_encoding_for_deterministic_attributes_when_option_is_nil|test_encrypted_attribute\\\\?_returns_true_for_encrypted_attributes_which_content_is_encrypted|test_re-encrypting_will_preserve_case_when_:ignore_case_option_is_used)|ActiveRecord::Encryption::EncryptableRecordTest#(?:test_by_default,_it\\\\'s_case_sensitive|test_can_only_save_unencrypted_attributes_when_frozen_encryption_is_true|test_deterministic_attributes_can_be_created_by_passing_deterministic:_true|test_deterministic_attributes_can_be_searched_with_Active_Record_queries|test_forced_encoding_for_deterministic_attributes_can_be_disabled|test_forced_encoding_for_deterministic_attributes_will_replace_invalid_characters|test_forces_UTF-8_encoding_for_deterministic_attributes_by_default|test_forces_encoding_for_deterministic_attributes_based_on_the_configured_option|test_ignores_empty_values|test_support_encrypted_attributes_defined_on_columns_with_default_values|test_when_ignore_case:_true,_it_ignores_case_in_queries_but_keep_it_when_reading_the_attribute|test_when_ignore_case:_true,_it_keeps_both_the_attribute_and_the__original_counterpart_encrypted|test_when_ignore_case:_true,_it_lets_you_update_attributes_normally))$/\"\r\n```\r\n\r\n### Expected behavior\r\nIt should pass.\r\n\r\n### Actual behavior\r\nIt always fail.\r\n\r\n### System configuration\r\n**Rails version**: main branch\r\n\r\n**Ruby version**: ruby 3.2.2 (2023-03-30 revision e51014f9c0) [x86_64-linux]\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48605/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48605/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48604", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48604/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48604/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48604/events", "html_url": "https://github.com/rails/rails/pull/48604", "id": 1779793274, "node_id": "PR_kwDNIULOVDADuw", "number": 48604, "title": "Emit warning when using 6.1 cache format as well", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-28T21:21:58Z", "updated_at": "2023-06-29T01:58:47Z", "closed_at": "2023-06-29T01:58:23Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48604", "html_url": "https://github.com/rails/rails/pull/48604", "diff_url": "https://github.com/rails/rails/pull/48604.diff", "patch_url": "https://github.com/rails/rails/pull/48604.patch", "merged_at": "2023-06-29T01:58:23Z"}, "body": "### Motivation / Background\r\n\r\nRef #48598 \r\n\r\nA deprecation warning was [added][1] to ensure that applications manually setting `config.active_support.cache_format_version` to `6.1` will be aware that they need to migrate. However, if an app is not using a `config.load_defaults` of `7.0` or greater, this warning will never be triggered.\r\n\r\n### Detail\r\n\r\nThis commit adds an additional warning where the configuration is used to cover this case as well.\r\n\r\n[1]: https://github.com/rails/rails/commit/2ba3ac29c36f4c6d23b1dd302584f15739ff2aff\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48604/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48604/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48603", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48603/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48603/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48603/events", "html_url": "https://github.com/rails/rails/pull/48603", "id": 1779594447, "node_id": "PR_kwDNIULOVC025Q", "number": 48603, "title": "Backport #47940 to 7-0-stable", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-28T19:18:56Z", "updated_at": "2023-06-28T19:51:26Z", "closed_at": "2023-06-28T19:31:32Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48603", "html_url": "https://github.com/rails/rails/pull/48603", "diff_url": "https://github.com/rails/rails/pull/48603.diff", "patch_url": "https://github.com/rails/rails/pull/48603.patch", "merged_at": null}, "body": "A bug introduced in #45015 was fixed on main with #47940.\r\nAs #45015 was backported to 7-0-stable we also need to backport #47940. to 7-0-stable\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48603/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48603/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48602", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48602/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48602/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48602/events", "html_url": "https://github.com/rails/rails/pull/48602", "id": 1779481268, "node_id": "PR_kwDNIULOVCuWzA", "number": 48602, "title": "Add a missing \"require\" activesupport:", "user": {"login": "Edouard-chin", "id": 8122246, "node_id": "MDQ6VXNlcjgxMjIyNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/8122246?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edouard-chin", "html_url": "https://github.com/Edouard-chin", "followers_url": "https://api.github.com/users/Edouard-chin/followers", "following_url": "https://api.github.com/users/Edouard-chin/following{/other_user}", "gists_url": "https://api.github.com/users/Edouard-chin/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edouard-chin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edouard-chin/subscriptions", "organizations_url": "https://api.github.com/users/Edouard-chin/orgs", "repos_url": "https://api.github.com/users/Edouard-chin/repos", "events_url": "https://api.github.com/users/Edouard-chin/events{/privacy}", "received_events_url": "https://api.github.com/users/Edouard-chin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-28T18:26:38Z", "updated_at": "2023-06-28T18:37:31Z", "closed_at": "2023-06-28T18:37:20Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48602", "html_url": "https://github.com/rails/rails/pull/48602", "diff_url": "https://github.com/rails/rails/pull/48602.diff", "patch_url": "https://github.com/rails/rails/pull/48602.patch", "merged_at": null}, "body": "Add a missing \"require\" activesupport:\r\n\r\n- The `::ActiveSupport::IsolatedExecutionState` constant can't be autoloaded otherwise.\r\n\r\n https://github.com/rails/rails/blob/5b2523edaa131eec7b18780b7916760828262df4/activesupport/lib/active_support/core_ext/module/attribute_accessors_per_thread.rb#L51\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48602/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48602/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48601", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48601/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48601/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48601/events", "html_url": "https://github.com/rails/rails/issues/48601", "id": 1779265516, "node_id": "I_kwDNIULOag1v7A", "number": 48601, "title": "Test Fixture Not Decrypting Properly with store_accessor", "user": {"login": "donnfelker", "id": 91827, "node_id": "MDQ6VXNlcjkxODI3", "avatar_url": "https://avatars.githubusercontent.com/u/91827?v=4", "gravatar_id": "", "url": "https://api.github.com/users/donnfelker", "html_url": "https://github.com/donnfelker", "followers_url": "https://api.github.com/users/donnfelker/followers", "following_url": "https://api.github.com/users/donnfelker/following{/other_user}", "gists_url": "https://api.github.com/users/donnfelker/gists{/gist_id}", "starred_url": "https://api.github.com/users/donnfelker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/donnfelker/subscriptions", "organizations_url": "https://api.github.com/users/donnfelker/orgs", "repos_url": "https://api.github.com/users/donnfelker/repos", "events_url": "https://api.github.com/users/donnfelker/events{/privacy}", "received_events_url": "https://api.github.com/users/donnfelker/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 5511275119, "node_id": "LA_kwDNIULPAAAAAUh_Ym8", "url": "https://api.github.com/repos/rails/rails/labels/encryption", "name": "encryption", "color": "8D3EA8", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-28T16:07:31Z", "updated_at": "2023-06-29T14:01:47Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n1. Create new rails app with postgresql as db\r\n2. Add jsonb field to model via migration with name `settings`\r\n3. Add store_accessor to model\r\n4. encrypt store_accessor field with `encrypts` \r\n5. Add encryption keys to envs as per [docs](https://guides.rubyonrails.org/active_record_encryption.html#setup)\r\n6. Add `config.active_record.encryption.encrypt_fixtures = true` to `test.rb`\r\n7. Add data to test fixture (posts.yml) with the field that needs to be encrypted\r\n8. Write test to obtain test fixture and ensure it is being encrypted/decrypted properly\r\n9. Test fails with `Minitest::UnexpectedError: ActiveRecord::Encryption::Errors::Decryption: ActiveRecord::Encryption::Errors::Decryption`\r\n\r\n### Executable Test Case\r\nYou will also need a value in the `posts.yml` file as such: \r\n```yml\r\none:\r\n  name: Hello World\r\n  settings:\r\n    public_key: \"some-fake-public-key\"\r\n```\r\n\r\nTest Case\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activerecord\", \"~> 7.0.0\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"postgresql\", database: \"jsonb-test\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\nActiveRecord::Encryption.configure \\\r\n      primary_key: \"nYlllafgBdhQ7Vn37dlWAoqfDbTPl4Fl\",\r\n      deterministic_key: \"CK7x2oUEeu06bKehhKGiKYAHoytPaOPg\",\r\n      key_derivation_salt: \"Fol1dR03ZXnL8k4hEUYj7IMr0UlgOMHC\"\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n    t.jsonb :settings\r\n  end\r\n\r\n  create_table :comments, force: true do |t|\r\n    t.integer :post_id\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  has_many :comments\r\n\r\n  store_accessor :settings, [:public_key], suffix: :setting\r\n  encrypts :settings\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\n  belongs_to :post\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_association_stuff\r\n    post = posts(:one)\r\n    assert_equal \"some-fake-public-key\", post.public_key_setting\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\nThe test should be able to store the value for the fixture, encrypted and then it should be able to retrieve it and decrypt it.\r\n\r\n### Actual behavior\r\nTest fails with error: `Minitest::UnexpectedError: ActiveRecord::Encryption::Errors::Decryption: ActiveRecord::Encryption::Errors::Decryption`\r\n\r\n### System configuration\r\n**Rails version**: 7.0.5.1\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48601/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48601/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48600", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48600/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48600/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48600/events", "html_url": "https://github.com/rails/rails/pull/48600", "id": 1779038502, "node_id": "PR_kwDNIULOVCV3Ow", "number": 48600, "title": "Active Record commit transaction on `return`, `break` and `throw`", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-06-28T14:09:44Z", "updated_at": "2023-07-14T04:13:09Z", "closed_at": "2023-07-10T08:55:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48600", "html_url": "https://github.com/rails/rails/pull/48600", "diff_url": "https://github.com/rails/rails/pull/48600.diff", "patch_url": "https://github.com/rails/rails/pull/48600.patch", "merged_at": "2023-07-10T08:55:41Z"}, "body": "Fix: https://github.com/rails/rails/issues/45017\r\nRef: https://github.com/rails/rails/pull/29333\r\nRef: https://github.com/ruby/timeout/pull/30\r\n\r\nHistorically only raised errors would trigger a rollback, but in Ruby `2.3`, the `timeout` library started using `throw` to interupt execution which had the adverse effect of committing open transactions.\r\n\r\nTo solve this, in Active Record 6.1 the behavior was changed to instead rollback the transaction as it was safer than to potentially commit an incomplete transaction.\r\n\r\nUsing `return`, `break` or `throw` inside a `transaction` block was essentially deprecated from Rails 6.1 onwards.\r\n\r\nHowever with the release of `timeout 0.4.0`, `Timeout.timeout` now raises an error again, and Active Record is able to return to its original, less surprising, behavior.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48600/reactions", "total_count": 7, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 5, "rocket": 2, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48600/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48599", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48599/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48599/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48599/events", "html_url": "https://github.com/rails/rails/pull/48599", "id": 1778604419, "node_id": "PR_kwDNIULOVB-OfA", "number": 48599, "title": "Make `perform_enqueued_jobs` compatible with all Active Job adapters", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107188, "node_id": "MDU6TGFiZWwxMDcxODg=", "url": "https://api.github.com/repos/rails/rails/labels/actionmailer", "name": "actionmailer", "color": "8B00FC", "default": false, "description": null}, {"id": 123812746, "node_id": "MDU6TGFiZWwxMjM4MTI3NDY=", "url": "https://api.github.com/repos/rails/rails/labels/activejob", "name": "activejob", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-28T09:53:53Z", "updated_at": "2023-06-28T21:52:30Z", "closed_at": "2023-06-28T17:10:24Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48599", "html_url": "https://github.com/rails/rails/pull/48599", "diff_url": "https://github.com/rails/rails/pull/48599.diff", "patch_url": "https://github.com/rails/rails/pull/48599.patch", "merged_at": "2023-06-28T17:10:24Z"}, "body": "### Motivation / Background\r\n\r\nhttps://github.com/rails/rails/issues/37270 describes a common Active Job issue where if you try to set an adapter other than `:test` as your adapter in a test environment, you get some confusing results.\r\n\r\nThe [most popular workaround](https://github.com/rails/rails/issues/37270#issuecomment-567900541) on the issue is to add this to a setup block:\r\n\r\n```ruby\r\n(ActiveJob::Base.descendants << ActiveJob::Base).each(&:disable_test_adapter)\r\n```\r\n\r\nThis solves some issues, but causes others. https://github.com/bensheldon/good_job/issues/846 is an example of an issue it causes. If you call `assert_emails` in an integration test, it will crash [here](https://github.com/rails/rails/blob/48e17e5ce75a02a331e6b48769d9c75243269696/activejob/lib/active_job/test_helper.rb#L603) because only the test adapter defines `perform_enqueued_jobs`.\r\n\r\nI think we should fix the issue of Active Job adapters being inconsistent across tests fully, and https://github.com/rails/rails/pull/48585 is my work in progress for that. But I wanted to extract this fix from that PR since I think it's useful in isolation.\r\n\r\n### Detail\r\n\r\nWith this PR, `perform_enqueued_jobs` will yield if a block is given but the test adapter is not being used. This is the minimum required to make that method compatible with any adapter.\r\n\r\n### Additional information\r\n\r\nref: https://github.com/bensheldon/good_job/issues/846, https://github.com/rails/rails/issues/37270\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48599/reactions", "total_count": 3, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 3, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48599/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48598", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48598/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48598/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48598/events", "html_url": "https://github.com/rails/rails/pull/48598", "id": 1778517980, "node_id": "PR_kwDNIULOVB5gMw", "number": 48598, "title": "Deprecate active_support.cache_format_version = 6.1", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-28T09:03:35Z", "updated_at": "2023-06-28T09:25:08Z", "closed_at": "2023-06-28T09:25:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48598", "html_url": "https://github.com/rails/rails/pull/48598", "diff_url": "https://github.com/rails/rails/pull/48598.diff", "patch_url": "https://github.com/rails/rails/pull/48598.patch", "merged_at": "2023-06-28T09:25:07Z"}, "body": "Closes: https://github.com/rails/rails/pull/48586\r\n\r\nOnce we finally get rid of it, we're no longer constrained on the `Entry` internal representation as other coders don't directly marshal the instance.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48598/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48598/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48597", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48597/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48597/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48597/events", "html_url": "https://github.com/rails/rails/pull/48597", "id": 1777907232, "node_id": "PR_kwDNIULOVBYwgA", "number": 48597, "title": "Fix Railties failing for tests using Webpacker", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-27T23:43:23Z", "updated_at": "2023-06-29T01:58:55Z", "closed_at": "2023-06-28T23:48:06Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48597", "html_url": "https://github.com/rails/rails/pull/48597", "diff_url": "https://github.com/rails/rails/pull/48597.diff", "patch_url": "https://github.com/rails/rails/pull/48597.patch", "merged_at": "2023-06-28T23:48:06Z"}, "body": "### Motivation / Background\r\n\r\nThere were recently some changes to the base ruby Docker images that required us to [update][1] the version of Node.js we use in our images. In addition, the base image change brought OpenSSL 3.0 instead of the previous 1.x version. Since the change in base image, there have been failing railties tests for 6-1-stable:\r\n\r\n```\r\n** Execute webpacker:compile\r\nCompiling...\r\nCompilation failed:\r\nnode:internal/crypto/hash:71\r\n  this[kHandle] = new _Hash(algorithm, xofLen);\r\n                  ^\r\n\r\nError: error:0308010C:digital envelope routines::unsupported\r\n    at new Hash (node:internal/crypto/hash:71:19)\r\n    at Object.createHash (node:crypto:133:10)\r\n    at module.exports (/rails/railties/test/isolation/assets/node_modules/webpack/lib/util/createHash.js:135:53)\r\n    at NormalModule._initBuildHash (/rails/railties/test/isolation/assets/node_modules/webpack/lib/NormalModule.js:417:16)\r\n    at handleParseError (/rails/railties/test/isolation/assets/node_modules/webpack/lib/NormalModule.js:471:10)\r\n\r\n    at /rails/railties/test/isolation/assets/node_modules/webpack/lib/NormalModule.js:503:5\r\n    at /rails/railties/test/isolation/assets/node_modules/webpack/lib/NormalModule.js:358:12\r\n    at /rails/railties/test/isolation/assets/node_modules/loader-runner/lib/LoaderRunner.js:373:3\r\n\r\n    at iterateNormalLoaders (/rails/railties/test/isolation/assets/node_modules/loader-runner/lib/LoaderRunner.js:214:10)\r\n    at iterateNormalLoaders (/rails/railties/test/isolation/assets/node_modules/loader-runner/lib/LoaderRunner.js:221:10)\r\n    at /rails/railties/test/isolation/assets/node_modules/loader-runner/lib/LoaderRunner.js:236:3\r\n    at context.callback (/rails/railties/test/isolation/assets/node_modules/loader-runner/lib/LoaderRunner.js:111:13)\r\n    at /rails/railties/test/isolation/assets/node_modules/babel-loader/lib/index.js:44:71 {\r\n  opensslErrorStack: [ 'error:03000086:digital envelope routines::initialization error' ],\r\n  library: 'digital envelope routines',\r\n  reason: 'unsupported',\r\n  code: 'ERR_OSSL_EVP_UNSUPPORTED'\r\n}\r\n```\r\n\r\n### Detail\r\n\r\nThe issue is that OpenSSL has disabled some older crypto functions by default, and the version of Webpack required by Webpacker tries to use one of those older functions. We can re enable support for these old crypto functions by passing NODE_OPTIONS=--openssl-legacy-provider for Rails 6.1 (and newer versions will never have this problem as they do not use Webpacker)\r\n\r\nisolation/abstract_unit was chosen as the place to add it because it's a common file used by all of the places that create temporary Rails projects and try to compile assets.\r\n\r\n### Additional information\r\n\r\nI initially proposed this as a [change to the Buildkite configuration][2], but Matthew suggested that the Rails repo would be a better place for it since this could help other people who run Rails tests as well.\r\n\r\n[1]: https://github.com/rails/buildkite-config/commit/e7964c6d299951b80cc3a4041ad64d3ee7815e7a\r\n[2]: https://github.com/rails/buildkite-config/pull/56\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48597/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48597/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48596", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48596/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48596/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48596/events", "html_url": "https://github.com/rails/rails/pull/48596", "id": 1777826835, "node_id": "PR_kwDNIULOVBUVvg", "number": 48596, "title": "Document and test lib & config.add_autoload_paths_to_load_path", "user": {"login": "fxn", "id": 3387, "node_id": "MDQ6VXNlcjMzODc=", "avatar_url": "https://avatars.githubusercontent.com/u/3387?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxn", "html_url": "https://github.com/fxn", "followers_url": "https://api.github.com/users/fxn/followers", "following_url": "https://api.github.com/users/fxn/following{/other_user}", "gists_url": "https://api.github.com/users/fxn/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxn/subscriptions", "organizations_url": "https://api.github.com/users/fxn/orgs", "repos_url": "https://api.github.com/users/fxn/repos", "events_url": "https://api.github.com/users/fxn/events{/privacy}", "received_events_url": "https://api.github.com/users/fxn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-27T22:12:52Z", "updated_at": "2023-06-28T08:00:16Z", "closed_at": "2023-06-27T22:13:44Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48596", "html_url": "https://github.com/rails/rails/pull/48596", "diff_url": "https://github.com/rails/rails/pull/48596.diff", "patch_url": "https://github.com/rails/rails/pull/48596.patch", "merged_at": "2023-06-27T22:13:44Z"}, "body": "Rails adds `lib` to `$LOAD_PATH` when `Rails::Application` is subclassed ([source](https://github.com/rails/rails/blob/5c5b78dfa7d4ab0db884d10d3a4f02f5883c9b68/railties/lib/rails/application.rb#L74)), but if `lib` belongs to the autoload paths, this does not square with  `config.add_autoload_paths_to_load_path`.\r\n\r\nI believe adding `lib` to `$LOAD_PATH` unconditionally is the right thing to do:\r\n\r\n1. It is an important convention in Ruby projects.\r\n2. Apps may have generators in `lib/generators`, which Rails loads with `require`.\r\n3. This has been the case always (backwards compatibility).\r\n\r\nSo, this patch documents this exception and adds test coverage for it.\r\n\r\nThanks to @chaadow for bringing this to my attention.\r\n\r\n/cc @byroot ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48596/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48596/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48595", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48595/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48595/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48595/events", "html_url": "https://github.com/rails/rails/issues/48595", "id": 1777441420, "node_id": "I_kwDNIULOafGajA", "number": 48595, "title": "Clarify support status of 6.1", "user": {"login": "slondr", "id": 13040688, "node_id": "MDQ6VXNlcjEzMDQwNjg4", "avatar_url": "https://avatars.githubusercontent.com/u/13040688?v=4", "gravatar_id": "", "url": "https://api.github.com/users/slondr", "html_url": "https://github.com/slondr", "followers_url": "https://api.github.com/users/slondr/followers", "following_url": "https://api.github.com/users/slondr/following{/other_user}", "gists_url": "https://api.github.com/users/slondr/gists{/gist_id}", "starred_url": "https://api.github.com/users/slondr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/slondr/subscriptions", "organizations_url": "https://api.github.com/users/slondr/orgs", "repos_url": "https://api.github.com/users/slondr/repos", "events_url": "https://api.github.com/users/slondr/events{/privacy}", "received_events_url": "https://api.github.com/users/slondr/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-27T17:36:53Z", "updated_at": "2023-06-27T17:41:49Z", "closed_at": "2023-06-27T17:41:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "Rails 6.1.7.x doesn't support Ruby 3.2, but there's no public documentation stating this. \n\nThe 6-1-stable branch contains some fixes related to Ruby 3.2, but has a broken build and seemingly lots of unresolved problems. \n\nCan the current state of support for Rails 6.1 be made more clear?", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48595/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48595/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48594", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48594/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48594/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48594/events", "html_url": "https://github.com/rails/rails/pull/48594", "id": 1777362116, "node_id": "PR_kwDNIULOVA6tAw", "number": 48594, "title": "Accept keyword-like named columns for PostgreSQL partial indexes", "user": {"login": "fatkodima", "id": 5657035, "node_id": "MDQ6VXNlcjU2NTcwMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/5657035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fatkodima", "html_url": "https://github.com/fatkodima", "followers_url": "https://api.github.com/users/fatkodima/followers", "following_url": "https://api.github.com/users/fatkodima/following{/other_user}", "gists_url": "https://api.github.com/users/fatkodima/gists{/gist_id}", "starred_url": "https://api.github.com/users/fatkodima/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fatkodima/subscriptions", "organizations_url": "https://api.github.com/users/fatkodima/orgs", "repos_url": "https://api.github.com/users/fatkodima/repos", "events_url": "https://api.github.com/users/fatkodima/events{/privacy}", "received_events_url": "https://api.github.com/users/fatkodima/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-27T16:42:39Z", "updated_at": "2023-06-29T14:15:28Z", "closed_at": "2023-06-29T14:15:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48594", "html_url": "https://github.com/rails/rails/pull/48594", "diff_url": "https://github.com/rails/rails/pull/48594.diff", "patch_url": "https://github.com/rails/rails/pull/48594.patch", "merged_at": "2023-06-29T14:15:27Z"}, "body": "Fixes #48571 (see there for the description).", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48594/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48594/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48593", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48593/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48593/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48593/events", "html_url": "https://github.com/rails/rails/pull/48593", "id": 1777070316, "node_id": "PR_kwDNIULOVAqz9w", "number": 48593, "title": "Linter fixes", "user": {"login": "zmariscal", "id": 10590756, "node_id": "MDQ6VXNlcjEwNTkwNzU2", "avatar_url": "https://avatars.githubusercontent.com/u/10590756?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zmariscal", "html_url": "https://github.com/zmariscal", "followers_url": "https://api.github.com/users/zmariscal/followers", "following_url": "https://api.github.com/users/zmariscal/following{/other_user}", "gists_url": "https://api.github.com/users/zmariscal/gists{/gist_id}", "starred_url": "https://api.github.com/users/zmariscal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zmariscal/subscriptions", "organizations_url": "https://api.github.com/users/zmariscal/orgs", "repos_url": "https://api.github.com/users/zmariscal/repos", "events_url": "https://api.github.com/users/zmariscal/events{/privacy}", "received_events_url": "https://api.github.com/users/zmariscal/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-06-27T14:07:09Z", "updated_at": "2023-06-27T16:41:16Z", "closed_at": "2023-06-27T16:33:24Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48593", "html_url": "https://github.com/rails/rails/pull/48593", "diff_url": "https://github.com/rails/rails/pull/48593.diff", "patch_url": "https://github.com/rails/rails/pull/48593.patch", "merged_at": null}, "body": "### Motivation / Background\r\nThis Pull Request has been created because I want to fix a small amount of linter violations.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes various rubocop failures/violations\r\n\r\n### Additional information\r\nMost of these changes are auto fixes via `standardbred --fix <path>`\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48593/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48593/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48592", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48592/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48592/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48592/events", "html_url": "https://github.com/rails/rails/issues/48592", "id": 1777007448, "node_id": "I_kwDNIULOaer7WA", "number": 48592, "title": "Broken table alias referencing in Rails 7.0.5.1", "user": {"login": "kaoru", "id": 89070, "node_id": "MDQ6VXNlcjg5MDcw", "avatar_url": "https://avatars.githubusercontent.com/u/89070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kaoru", "html_url": "https://github.com/kaoru", "followers_url": "https://api.github.com/users/kaoru/followers", "following_url": "https://api.github.com/users/kaoru/following{/other_user}", "gists_url": "https://api.github.com/users/kaoru/gists{/gist_id}", "starred_url": "https://api.github.com/users/kaoru/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kaoru/subscriptions", "organizations_url": "https://api.github.com/users/kaoru/orgs", "repos_url": "https://api.github.com/users/kaoru/repos", "events_url": "https://api.github.com/users/kaoru/events{/privacy}", "received_events_url": "https://api.github.com/users/kaoru/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-27T13:42:23Z", "updated_at": "2023-06-27T14:27:43Z", "closed_at": "2023-06-27T14:27:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\nWe're using a combination of \"where missing\" and \"or + scope\" to find events which have not ended, meaning that they don't have a schedule at all _or_ they do have a schedule and it doesn't have a date _or_ they do have a schedule and it has a date and that date is today or in the future.\r\n\r\nThe behaviour has changed in Rails 7.0.5.1 to throw an `ActiveRecord::StatementInvalid` error, because on 7.0.4.3 the left joined table was not given an alias but on 7.0.5.1 it is given an alias and that alias is then not consistently used in the where clauses produced.\r\n\r\n```ruby\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem 'rails', '~> 7.0', '= 7.0.5.1'\r\n  # gem 'rails', '~> 7.0', '= 7.0.4.3'\r\n  # gem 'rails', github: 'rails/rails'\r\n  gem 'sqlite3'\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\n#ActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :events, force: true do |t|\r\n  end\r\n\r\n  create_table :event_schedules, force: true do |t|\r\n    t.integer :event_id\r\n    t.date :date\r\n  end\r\nend\r\n\r\nclass Event < ActiveRecord::Base\r\n  has_one :schedule, class_name: 'EventSchedule', dependent: :destroy\r\n\r\n  scope :not_ended, -> { where.missing(:schedule).or(EventSchedule.not_ended) }\r\nend\r\n\r\nclass EventSchedule < ActiveRecord::Base\r\n  belongs_to :event\r\n\r\n  scope :date_not_set, -> { where(date: nil) }\r\n  scope :not_ended, -> { where('date >= ?', Date.today).or(date_not_set) }\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def setup\r\n    Event.create\r\n    Event.create.then { |e| e.create_schedule(date: Date.yesterday) }\r\n    Event.create.then { |e| e.create_schedule(date: Date.today) }\r\n    Event.create.then { |e| e.create_schedule(date: Date.tomorrow) }\r\n  end\r\n\r\n  # This works on Rails 7.0.4.3 and gives an ActiveRecord::StatementInvalid on\r\n  # Rails 7.0.5.1 because the table alias behaviour has changed.\r\n  def test_events_not_ended\r\n    puts\r\n    puts Event.not_ended.to_sql\r\n    puts\r\n\r\n    assert_equal 3, Event.not_ended.uniq.count\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\n\r\nOn Rails 7.0.4.3 (and on the main branch of `rails/rails`) the SQL produced is:\r\n\r\n```sql\r\nSELECT \"events\".* FROM \"events\" LEFT OUTER JOIN \"event_schedules\" ON \"event_schedules\".\"event_id\" = \"events\".\"id\" WHERE (\"event_schedules\".\"id\" IS NULL OR date >= '2023-06-27' OR \"event_schedules\".\"date\" IS NULL)\r\n```\r\n\r\nWhich works because there is no table alias.\r\n\r\n### Actual behavior\r\n\r\nThe SQL produced is:\r\n\r\n```sql\r\nSELECT \"events\".* FROM \"events\" LEFT OUTER JOIN \"event_schedules\" \"schedule\" ON \"schedule\".\"event_id\" = \"events\".\"id\" WHERE (\"schedule\".\"id\" IS NULL OR date >= '2023-06-27' OR \"event_schedules\".\"date\" IS NULL)\r\n```\r\n\r\nWhich throws an error:\r\n\r\n```\r\nActiveRecord::StatementInvalid: SQLite3::SQLException: no such column: event_schedules.date\r\n```\r\n\r\nBecause the table is alias to \"schedule\" but then referred to as \"events_schedule\" in the merged or scope.\r\n\r\n### System configuration\r\n**Rails version**: 7.0.5.1\r\n\r\n**Ruby version**: 3.2.2", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48592/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48592/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48591", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48591/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48591/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48591/events", "html_url": "https://github.com/rails/rails/pull/48591", "id": 1776767023, "node_id": "PR_kwDNIULOVAZ7nQ", "number": 48591, "title": "Add support for :prefix option in relations.", "user": {"login": "Nerian", "id": 259568, "node_id": "MDQ6VXNlcjI1OTU2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/259568?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nerian", "html_url": "https://github.com/Nerian", "followers_url": "https://api.github.com/users/Nerian/followers", "following_url": "https://api.github.com/users/Nerian/following{/other_user}", "gists_url": "https://api.github.com/users/Nerian/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nerian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nerian/subscriptions", "organizations_url": "https://api.github.com/users/Nerian/orgs", "repos_url": "https://api.github.com/users/Nerian/repos", "events_url": "https://api.github.com/users/Nerian/events{/privacy}", "received_events_url": "https://api.github.com/users/Nerian/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-27T12:00:28Z", "updated_at": "2023-06-27T12:11:09Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48591", "html_url": "https://github.com/rails/rails/pull/48591", "diff_url": "https://github.com/rails/rails/pull/48591.diff", "patch_url": "https://github.com/rails/rails/pull/48591.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nOur application is multi-tenant and storing files in S3 was an organizational issue due to ActiveStorage storing the files at the root level in a flat structure. Instead we would like some semantic structure, for example we would like to have all files related  to active storage to be in the active_storage top folder, and then for each tenant our of application we will further namespace. Example of the intended structure:\r\n\r\nS3/active_storage/tenant_id/some_file_uid\r\nS3/active_storage/tenant_id/some_file_uid\r\n\r\nThis Pull Request has been created in order to support this kind of structure.\r\n\r\nAllows for configuring a custom prefix for Blob keys.\r\n\r\n```\r\n    Rails.application.configure do\r\n      config.active_storage.blob_prefix = 'active_storage'\r\n    end\r\n```\r\n\r\nThis will store Blobs in a path like active_storage/<random_key>. You may also configure an additional level of prefix on each relation.\r\n\r\n```\r\n    class User < ActiveRecord::Base\r\n      has_one_attached :avatar, prefix: 'avatars'\r\n    end\r\n```\r\n\r\nThis will store Blobs in a path like active_storage/avatars/<random_key>. Or even generate it using information on the record:\r\n\r\n```\r\n    class User < ActiveRecord::Base\r\n      belongs_to :tenant\r\n      has_one_attached :avatar, prefix: -> (record, attachment) { record.tenant.name }\r\n    end\r\n```\r\n\r\nThis will store Blobs in a path like active_storage/account_1/<random_key>\r\n\r\n### Detail\r\n\r\nThis Pull Request changes to Active Storage. Particularly it makes the association macros determine the blob id, if given the option `:prefix`.\r\n\r\n### Additional information\r\n\r\nWe are using this in production right now. Working fine so far. We do not use direct upload. Unsure if this may affect it.\r\n\r\nOther people interested in this sort of functionality:\r\n* https://github.com/rails/rails/issues/38161\r\n* https://github.com/rails/rails/issues/32790\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48591/reactions", "total_count": 5, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48591/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48590", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48590/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48590/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48590/events", "html_url": "https://github.com/rails/rails/issues/48590", "id": 1776371255, "node_id": "I_kwDNIULOaeFGNw", "number": 48590, "title": "Type of keys returned by grouped count on joined enum column inconsistent after 7.0.5", "user": {"login": "adamzapasnik", "id": 9281806, "node_id": "MDQ6VXNlcjkyODE4MDY=", "avatar_url": "https://avatars.githubusercontent.com/u/9281806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adamzapasnik", "html_url": "https://github.com/adamzapasnik", "followers_url": "https://api.github.com/users/adamzapasnik/followers", "following_url": "https://api.github.com/users/adamzapasnik/following{/other_user}", "gists_url": "https://api.github.com/users/adamzapasnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/adamzapasnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adamzapasnik/subscriptions", "organizations_url": "https://api.github.com/users/adamzapasnik/orgs", "repos_url": "https://api.github.com/users/adamzapasnik/repos", "events_url": "https://api.github.com/users/adamzapasnik/events{/privacy}", "received_events_url": "https://api.github.com/users/adamzapasnik/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-27T08:26:49Z", "updated_at": "2023-06-27T18:05:46Z", "closed_at": "2023-06-27T18:05:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n```ruby\r\nrequire 'bundler/inline'\r\n\r\ngemfile do\r\n  source \"https://rubygems.org\"\r\n\r\n  gem 'activerecord', \"7.0.4.3\"\r\n  # gem 'activerecord', \"7.0.5.0\"\r\n  gem 'sqlite3'\r\nend\r\n\r\nrequire 'active_record'\r\nrequire 'sqlite3'\r\n\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Base.establish_connection(\r\n  adapter: 'sqlite3',\r\n  database: ':memory:'\r\n)\r\n\r\n\r\nActiveRecord::Base.connection.create_table :ufos do |t|\r\n  t.integer :color\r\nend\r\n\r\nActiveRecord::Base.connection.create_table :cows do |t|\r\n  t.belongs_to :ufo\r\nend\r\n\r\nclass Ufo < ActiveRecord::Base\r\n  has_many :cows\r\n\r\n  enum color: [:green, :blue]\r\nend\r\n\r\nclass Cow < ActiveRecord::Base\r\n  belongs_to :ufo\r\nend\r\n\r\ngreen_ufo = Ufo.create!(color: :green)\r\nblue_ufo = Ufo.create!(color: :blue)\r\n\r\nCow.create!(ufo: green_ufo)\r\nCow.create!(ufo: green_ufo)\r\nCow.create!(ufo: green_ufo)\r\nCow.create!(ufo: blue_ufo)\r\n\r\n\r\nputs Ufo.group(:color).count\r\nputs Ufo.group(\"color\").count\r\nputs Ufo.group(\"ufos.color\").count\r\n\r\n\r\nputs Cow.joins(:ufo).group(:color).count\r\nputs Cow.joins(:ufo).group(\"color\").count\r\nputs Cow.joins(:ufo).group(\"ufos.color\").count\r\n\r\n```\r\n\r\n### Expected behavior\r\nAR 7.0.4.3\r\n```ruby\r\n7.0.4.3\r\nD, [2023-06-27T11:23:15.523050 #37544] DEBUG -- :   Ufo Count (0.4ms)  SELECT COUNT(*) AS \"count_all\", \"ufos\".\"color\" AS \"ufos_color\" FROM \"ufos\" GROUP BY \"ufos\".\"color\"\r\n{\"green\"=>1, \"blue\"=>1}\r\nD, [2023-06-27T11:23:15.523285 #37544] DEBUG -- :   Ufo Count (0.0ms)  SELECT COUNT(*) AS \"count_all\", \"ufos\".\"color\" AS \"ufos_color\" FROM \"ufos\" GROUP BY \"ufos\".\"color\"\r\n{\"green\"=>1, \"blue\"=>1}\r\nD, [2023-06-27T11:23:15.523499 #37544] DEBUG -- :   Ufo Count (0.0ms)  SELECT COUNT(*) AS \"count_all\", \"ufos\".\"color\" AS \"ufos_color\" FROM \"ufos\" GROUP BY \"ufos\".\"color\"\r\n{\"green\"=>1, \"blue\"=>1}\r\nD, [2023-06-27T11:23:15.536016 #37544] DEBUG -- :   Cow Count (0.1ms)  SELECT COUNT(*) AS \"count_all\", \"color\" AS \"color\" FROM \"cows\" INNER JOIN \"ufos\" ON \"ufos\".\"id\" = \"cows\".\"ufo_id\" GROUP BY \"color\"\r\n{0=>3, 1=>1}\r\nD, [2023-06-27T11:23:15.536388 #37544] DEBUG -- :   Cow Count (0.0ms)  SELECT COUNT(*) AS \"count_all\", color AS \"color\" FROM \"cows\" INNER JOIN \"ufos\" ON \"ufos\".\"id\" = \"cows\".\"ufo_id\" GROUP BY color\r\n{0=>3, 1=>1}\r\nD, [2023-06-27T11:23:15.536662 #37544] DEBUG -- :   Cow Count (0.0ms)  SELECT COUNT(*) AS \"count_all\", \"ufos\".\"color\" AS \"ufos_color\" FROM \"cows\" INNER JOIN \"ufos\" ON \"ufos\".\"id\" = \"cows\".\"ufo_id\" GROUP BY \"ufos\".\"color\"\r\n{0=>3, 1=>1}\r\n```\r\n\r\n### Actual behavior\r\nAR 7.0.5\r\n```ruby\r\n7.0.5\r\nD, [2023-06-27T11:23:31.090960 #37564] DEBUG -- :   Ufo Count (0.1ms)  SELECT COUNT(*) AS \"count_all\", \"ufos\".\"color\" AS \"ufos_color\" FROM \"ufos\" GROUP BY \"ufos\".\"color\"\r\n{\"green\"=>1, \"blue\"=>1}\r\nD, [2023-06-27T11:23:31.091140 #37564] DEBUG -- :   Ufo Count (0.0ms)  SELECT COUNT(*) AS \"count_all\", \"ufos\".\"color\" AS \"ufos_color\" FROM \"ufos\" GROUP BY \"ufos\".\"color\"\r\n{\"green\"=>1, \"blue\"=>1}\r\nD, [2023-06-27T11:23:31.091316 #37564] DEBUG -- :   Ufo Count (0.0ms)  SELECT COUNT(*) AS \"count_all\", \"ufos\".\"color\" AS \"ufos_color\" FROM \"ufos\" GROUP BY \"ufos\".\"color\"\r\n{\"green\"=>1, \"blue\"=>1}\r\nD, [2023-06-27T11:23:31.094997 #37564] DEBUG -- :   Cow Count (0.1ms)  SELECT COUNT(*) AS \"count_all\", \"color\" AS \"color\" FROM \"cows\" INNER JOIN \"ufos\" ON \"ufos\".\"id\" = \"cows\".\"ufo_id\" GROUP BY \"color\"\r\n{0=>3, 1=>1}\r\nD, [2023-06-27T11:23:31.095297 #37564] DEBUG -- :   Cow Count (0.0ms)  SELECT COUNT(*) AS \"count_all\", color AS \"color\" FROM \"cows\" INNER JOIN \"ufos\" ON \"ufos\".\"id\" = \"cows\".\"ufo_id\" GROUP BY color\r\n{0=>3, 1=>1}\r\nD, [2023-06-27T11:23:31.095528 #37564] DEBUG -- :   Cow Count (0.0ms)  SELECT COUNT(*) AS \"count_all\", \"ufos\".\"color\" AS \"ufos_color\" FROM \"cows\" INNER JOIN \"ufos\" ON \"ufos\".\"id\" = \"cows\".\"ufo_id\" GROUP BY \"ufos\".\"color\"\r\n{\"green\"=>3, \"blue\"=>1}\r\n```\r\n\r\nI think the inconsistency is easy to spot \u261d\ufe0f Not sure if a bug? but obviously the behavior has changed to an unpredictable one.\r\n\r\n### System configuration\r\n**Rails version**: 7.0.4.3 and 7.0.5.0\r\n\r\n**Ruby version**: 3.1.4\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48590/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48590/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48589", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48589/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48589/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48589/events", "html_url": "https://github.com/rails/rails/pull/48589", "id": 1776350041, "node_id": "PR_kwDNIULOVADK8Q", "number": 48589, "title": "[6-1-stable] Fix rubocop", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-27T08:15:52Z", "updated_at": "2023-06-27T09:03:02Z", "closed_at": "2023-06-27T09:03:01Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48589", "html_url": "https://github.com/rails/rails/pull/48589", "diff_url": "https://github.com/rails/rails/pull/48589.diff", "patch_url": "https://github.com/rails/rails/pull/48589.patch", "merged_at": "2023-06-27T09:03:01Z"}, "body": "Similar to #48588 for `6-1-stable` branch.\r\n\r\nFixes the rubocop build:\r\nhttps://github.com/rails/rails/actions/runs/5383348950/jobs/9769989203\r\n\r\nHowever, f1cdfc0 didn't apply cleanly so did it by hand. :pray:\r\n\r\n---\r\n\r\nReproduced locally:\r\n\r\n```\r\nOffenses:\r\n\r\nactionpack/lib/action_controller/metal/redirecting.rb:66:26: C: Layout/SpaceAroundOperators: Operator = should be surrounded by a single space.\r\n      self.status        = _extract_redirect_to_status(options, response_options)\r\n                         ^\r\nactionpack/test/controller/redirect_test.rb:456:1: C: Layout/EmptyLinesAroundClassBody: Extra empty line detected at class body end.\r\n\r\n2863 files inspected, 2 offenses detected, 2 offenses auto-correctable\r\n```", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48589/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48589/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48588", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48588/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48588/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48588/events", "html_url": "https://github.com/rails/rails/pull/48588", "id": 1776344675, "node_id": "PR_kwDNIULOVAC4qg", "number": 48588, "title": "[7-0-stable] Fix rubocop warning", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-27T08:12:21Z", "updated_at": "2023-06-27T09:02:48Z", "closed_at": "2023-06-27T09:02:47Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48588", "html_url": "https://github.com/rails/rails/pull/48588", "diff_url": "https://github.com/rails/rails/pull/48588.diff", "patch_url": "https://github.com/rails/rails/pull/48588.patch", "merged_at": "2023-06-27T09:02:47Z"}, "body": "Backports f1cdfc0 to fix rubocop on `7-0-stable` branch", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48588/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48588/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48587", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48587/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48587/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48587/events", "html_url": "https://github.com/rails/rails/pull/48587", "id": 1776333918, "node_id": "PR_kwDNIULOVACTeA", "number": 48587, "title": "[6-1-stable] Try to fix yarn build errors", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-27T08:05:59Z", "updated_at": "2023-06-27T08:07:09Z", "closed_at": "2023-06-27T08:07:05Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48587", "html_url": "https://github.com/rails/rails/pull/48587", "diff_url": "https://github.com/rails/rails/pull/48587.diff", "patch_url": "https://github.com/rails/rails/pull/48587.patch", "merged_at": null}, "body": "Deleted the old `yarn.lock` and ran `yarn install --check-files`", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48587/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48587/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48586", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48586/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48586/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48586/events", "html_url": "https://github.com/rails/rails/pull/48586", "id": 1776323095, "node_id": "PR_kwDNIULOVABtpw", "number": 48586, "title": "Remove support for Rails 6.1 cache format", "user": {"login": "casperisfine", "id": 19192189, "node_id": "MDQ6VXNlcjE5MTkyMTg5", "avatar_url": "https://avatars.githubusercontent.com/u/19192189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/casperisfine", "html_url": "https://github.com/casperisfine", "followers_url": "https://api.github.com/users/casperisfine/followers", "following_url": "https://api.github.com/users/casperisfine/following{/other_user}", "gists_url": "https://api.github.com/users/casperisfine/gists{/gist_id}", "starred_url": "https://api.github.com/users/casperisfine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/casperisfine/subscriptions", "organizations_url": "https://api.github.com/users/casperisfine/orgs", "repos_url": "https://api.github.com/users/casperisfine/repos", "events_url": "https://api.github.com/users/casperisfine/events{/privacy}", "received_events_url": "https://api.github.com/users/casperisfine/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-27T07:59:46Z", "updated_at": "2023-06-28T15:20:42Z", "closed_at": "2023-06-28T09:25:09Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48586", "html_url": "https://github.com/rails/rails/pull/48586", "diff_url": "https://github.com/rails/rails/pull/48586.diff", "patch_url": "https://github.com/rails/rails/pull/48586.patch", "merged_at": null}, "body": "The 6.1 format directly Marshal the AS::Cache::Entry class which prevent us from changing its internal representation.\r\n\r\nRemoving support for it would unblock various refactors and cleanup.\r\n\r\ncc @jonathanhefner \r\n\r\n@matthewd: do you think we need to go through a deprecation for this? (I assume so but not 100% sure).\r\n\r\nIf we can't remove it right now, we should deprecate is ASAP so this stop hindering us.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48586/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48586/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48585", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48585/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48585/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48585/events", "html_url": "https://github.com/rails/rails/pull/48585", "id": 1775913042, "node_id": "PR_kwDNIULOU_r34g", "number": 48585, "title": "Active Job: Correctly use the desired test adapter in tests", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}, {"id": 123812746, "node_id": "MDU6TGFiZWwxMjM4MTI3NDY=", "url": "https://api.github.com/repos/rails/rails/labels/activejob", "name": "activejob", "color": "5319e7", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-27T01:01:04Z", "updated_at": "2023-07-15T23:08:29Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48585", "html_url": "https://github.com/rails/rails/pull/48585", "diff_url": "https://github.com/rails/rails/pull/48585.diff", "patch_url": "https://github.com/rails/rails/pull/48585.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nCurrently if you set `config.active_job.queue_adapter = (anything)` in `config/application.rb` or `config/environments/test.rb`, this config will be respected by some test cases but not others.\r\n\r\nSpecifically, in `ActionDispatch::IntegrationTest`, `ActionMailer::TestCase`, and `ActiveJob::TestCase`, the test adapter will still be `TestAdapter`, while in other test cases it will be `InlineAdapter`.\r\n\r\nI think you'd expect that if you set the test adapter for an environment, that test adapter would be available everywhere in that environment. For example, you might want to use the Delayed Job test adapter in your test environment so that you can have your test code more closely match production. The feedback on https://github.com/rails/rails/issues/37270 echoes this, but the workaround suggested there of disabling the test adapter on specific klasses is not reliable.\r\n\r\n### Detail\r\n\r\nThe logic to determine which queue adapter a job uses is quite confusing.\r\n\r\nHere is how it works on `main` currently:\r\n\r\n1. If running in a test, and the test class includes `ActiveJob::TestHelper` and overrides `queue_adapter_for_test`, then the `queue_adapter_for_test` adapter is used.\r\n2. Otherwise, if running in a test, and the test class includes `ActiveJob::TestHelper`, then the `:test` adapter is used.\r\n3. Otherwise, if `self.queue_adapter` is set on the job class, that adapter is used.\r\n4. Otherwise, if `self.queue_adapter` is set on the job's superclass (eg. `ApplicationJob`), that adapter is used. \r\n5. Fall back to `Rails.application.config.active_job.queue_adapter` as configured by the user.\r\n6. If not configured by the user, `Rails.application.config.active_job.queue_adapter` defaults to `:async`.\r\n7. Fall back to `:async` if no Rails config set (eg. using Active Job as a standalone).\r\n\r\nAs noted above, only some of the built in test classes include `ActiveJob::TestHelper`. Also, setting a queue adapter on a specific job class is rare (typically you would not want different jobs to be performed by different backends). So in practice, in development/production, option 5 is used. And in test, options 2 and 5 are used, depending on the type of test.\r\n\r\nThis PR changes the logic to work as follows:\r\n\r\n1. If `self.queue_adapter` is set on the job class, that adapter is used.\r\n2. Otherwise, if `self.queue_adapter` is set on the job's superclass (eg. `ApplicationJob`), that adapter is used. \r\n3. If running in a test, and the test class includes `ActiveJob::TestHelper` and overrides `queue_adapter_for_test`, then the `queue_adapter_for_test` adapter is used.\r\n4. Fall back to `Rails.application.config.active_job.queue_adapter` as configured by the user.\r\n5. If not configured by the user, `Rails.application.config.active_job.queue_adapter` defaults to `:test` if `Rails.env.test?`, otherwise it defaults to `:async`.\r\n6. If running in a test, and the test class includes `ActiveJob::TestHelper`, and no other adapter has been set (eg. using Active Job as a standalone), then use `:test`.\r\n7. Otherwise, fall back to `:async`.\r\n\r\nThe key changes are:\r\n\r\n- Now, if you set a `queue_adapter` on a job class, that will always be respected.\r\n- The `queue_adapter_for_test` override still works, but it no longer takes priority over a queue adapter set on a specific job class. Since I think both of these techniques are rare, and the impact of this change only exists in a test environment, I think it is a relatively safe change.\r\n- The default queue adapter in Rails config is now env-dependent. (It's `:test` in the `test` environment, and `:async` in all others.)\r\n\r\nThe default rails environment templates suggest [setting a specific queue adapter only in production](https://github.com/rails/rails/blob/f46d3452ae30c46d3e213c687decbbca0cee9119/railties/lib/rails/generators/rails/app/templates/config/environments/production.rb.tt#L79C12-L79C12). For users who do that, there will be no changes to behaviour with this PR.\r\n\r\nFor users who are more granular, by setting per-job queue adapters, things should continue to work as expected with this PR.\r\n\r\n**The real change is for users who set a default queue adapter across all environments (as in this issue: https://github.com/rails/rails/issues/37270). For them, this PR solves the issue where some tests use the desired queue adapter, and other tests don't.**\r\n\r\n### Additional information\r\n\r\nFixes: https://github.com/rails/rails/issues/37270\r\n\r\nref: https://github.com/bensheldon/good_job/issues/846\r\nref: https://github.com/rails/rails/issues/26360 - this PR changes the behavior here, which I think was overzealous.\r\n\r\nI extracted out some other PRs to fix internal issues while working on this: https://github.com/rails/rails/pull/48623, https://github.com/rails/rails/pull/48626. I also extracted https://github.com/rails/rails/pull/48599 out as a non-controversial fix prior to this PR.\r\n\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48585/reactions", "total_count": 9, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 3, "rocket": 3, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48585/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48584", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48584/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48584/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48584/events", "html_url": "https://github.com/rails/rails/pull/48584", "id": 1775909780, "node_id": "PR_kwDNIULOU_rslg", "number": 48584, "title": "Fix \"Invalid value type 175:0 in yarn.lock\"", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-27T00:57:50Z", "updated_at": "2023-06-27T13:55:50Z", "closed_at": "2023-06-27T09:01:52Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48584", "html_url": "https://github.com/rails/rails/pull/48584", "diff_url": "https://github.com/rails/rails/pull/48584.diff", "patch_url": "https://github.com/rails/rails/pull/48584.patch", "merged_at": "2023-06-27T09:01:52Z"}, "body": "### Motivation / Background\r\n\r\nSomething about the update to yarn.lock appears to have corrupted it, and 6-1-stable CI is now failing with the above error.\r\n\r\nhttps://buildkite.com/rails/rails/builds/97539#0188f9ac-db37-4c8e-8be7-0da2fc4fc0c9\r\n\r\n### Detail\r\n\r\nThis commit fixes the issue by regenerating the lockfile:\r\n\r\n`rm yarn.lock && yarn install`\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48584/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48584/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48583", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48583/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48583/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48583/events", "html_url": "https://github.com/rails/rails/pull/48583", "id": 1775775216, "node_id": "PR_kwDNIULOU_klww", "number": 48583, "title": "Add a rake task for checking various release related utilities", "user": {"login": "tenderlove", "id": 3124, "node_id": "MDQ6VXNlcjMxMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3124?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tenderlove", "html_url": "https://github.com/tenderlove", "followers_url": "https://api.github.com/users/tenderlove/followers", "following_url": "https://api.github.com/users/tenderlove/following{/other_user}", "gists_url": "https://api.github.com/users/tenderlove/gists{/gist_id}", "starred_url": "https://api.github.com/users/tenderlove/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tenderlove/subscriptions", "organizations_url": "https://api.github.com/users/tenderlove/orgs", "repos_url": "https://api.github.com/users/tenderlove/repos", "events_url": "https://api.github.com/users/tenderlove/events{/privacy}", "received_events_url": "https://api.github.com/users/tenderlove/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-26T22:26:30Z", "updated_at": "2023-06-27T19:00:05Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48583", "html_url": "https://github.com/rails/rails/pull/48583", "diff_url": "https://github.com/rails/rails/pull/48583.diff", "patch_url": "https://github.com/rails/rails/pull/48583.patch", "merged_at": null}, "body": "This commit adds a rake task that checks various utilities are working before releasing Rails.  The problem we're trying to avoid is commands failing halfway through the release (for example maybe you're not logged in to npmjs). The check task is fairly opinionated, it requires that:\r\n\r\n* Use a YubiKey for storing OTPs\r\n  * The `ykman` utility is installed\r\n  * The OTP name for RubyGems has `rubygems.org` in the name\r\n  * The OTP name for NPM has `npmjs.com` in the name\r\n* You are logged in to RubyGems\r\n* You are logged in to npmjs\r\n* You are logged in to the `gh` utility\r\n\r\nIf the task fails, then no gems will be pushed and it gives you an opportunity to fix your environment.  Basically I want to automate [this section](https://github.com/rails/rails/blob/main/RELEASING_RAILS.md#check-credentials-for-rubygems-npm-and-github) in our release documentation.\r\n\r\nSee [this blog post](https://tenderlovemaking.com/2021/10/26/publishing-gems-with-your-yubikey.html) for configuring your YubiKey.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48583/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48583/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48582", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48582/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48582/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48582/events", "html_url": "https://github.com/rails/rails/pull/48582", "id": 1775657560, "node_id": "PR_kwDNIULOU_e__A", "number": 48582, "title": "Introduce ActiveRecord::Base#preload on a record", "user": {"login": "kirs", "id": 522155, "node_id": "MDQ6VXNlcjUyMjE1NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/522155?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirs", "html_url": "https://github.com/kirs", "followers_url": "https://api.github.com/users/kirs/followers", "following_url": "https://api.github.com/users/kirs/following{/other_user}", "gists_url": "https://api.github.com/users/kirs/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirs/subscriptions", "organizations_url": "https://api.github.com/users/kirs/orgs", "repos_url": "https://api.github.com/users/kirs/repos", "events_url": "https://api.github.com/users/kirs/events{/privacy}", "received_events_url": "https://api.github.com/users/kirs/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 257468118, "node_id": "MDU6TGFiZWwyNTc0NjgxMTg=", "url": "https://api.github.com/repos/rails/rails/labels/needs%20work", "name": "needs work", "color": "000000", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-06-26T21:32:12Z", "updated_at": "2023-06-27T22:32:32Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48582", "html_url": "https://github.com/rails/rails/pull/48582", "diff_url": "https://github.com/rails/rails/pull/48582.diff", "patch_url": "https://github.com/rails/rails/pull/48582.patch", "merged_at": null}, "body": "Sometimes you might want to `preload` relations for a record that has already been loaded.\r\nIf you were to do it today, you'd either have to use private API (`ActiveRecord::Associations::Preloader`) or do something like\r\n\r\n```\r\ndef method_that_wants_to_preload_and_receives_record(user)\r\n  user = User.preload(:address, friends: [:address, :followers]).find(user.id)\r\nend\r\n```\r\n\r\nHowever, that seems ugly and may result to unnecessary (but probably cached) query on `users` to find a record by a primary key.\r\n\r\nIt seems like an simple addition to introduce `preload` on a record that has already been loaded. That's what this PR does.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48582/reactions", "total_count": 3, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 3, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48582/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48581", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48581/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48581/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48581/events", "html_url": "https://github.com/rails/rails/issues/48581", "id": 1775349504, "node_id": "I_kwDNIULOadGvAA", "number": 48581, "title": "Precompile fails when building from a Dockerfile", "user": {"login": "JoaoPedroAssis", "id": 38732089, "node_id": "MDQ6VXNlcjM4NzMyMDg5", "avatar_url": "https://avatars.githubusercontent.com/u/38732089?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JoaoPedroAssis", "html_url": "https://github.com/JoaoPedroAssis", "followers_url": "https://api.github.com/users/JoaoPedroAssis/followers", "following_url": "https://api.github.com/users/JoaoPedroAssis/following{/other_user}", "gists_url": "https://api.github.com/users/JoaoPedroAssis/gists{/gist_id}", "starred_url": "https://api.github.com/users/JoaoPedroAssis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JoaoPedroAssis/subscriptions", "organizations_url": "https://api.github.com/users/JoaoPedroAssis/orgs", "repos_url": "https://api.github.com/users/JoaoPedroAssis/repos", "events_url": "https://api.github.com/users/JoaoPedroAssis/events{/privacy}", "received_events_url": "https://api.github.com/users/JoaoPedroAssis/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-26T18:33:29Z", "updated_at": "2023-06-27T02:12:13Z", "closed_at": "2023-06-27T02:12:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi guys! I am currently implementing ephemeral environments for the PRs in my repository, and I've made great progress using ArgoCD and ApplicationSets. However, I build these images in staging mode using a staging database defined in Rails Credentials and all the environments use the same database. In my pipeline I can create and destroy databases in my managed cluster (Digital Ocean psql), to make each environment have their own clean database to perform tests. \r\n\r\nWhen I tried to make the database connections available through env vars, the docker build failed in github actions in the precompile step. How can I docker build my application?\r\n\r\nPipeline flow:\r\n\r\nPR open -> create database -> build image -> create k8s namespace and deployment -> seed\r\nPR close -> delete k8s resources -> delete database\r\n\r\nIs there an Rails way to accomplish this behaviour? thanks in advance!!\r\n\r\n### Steps to reproduce\r\n\r\nI changed the config from:\r\n\r\n```yaml\r\n# database.yml\r\nproduction: &production\r\n  adapter: postgresql\r\n  encoding: unicode\r\n  database: <%= Rails.application.credentials.dig(:db, :name) %>\r\n  username: <%= Rails.application.credentials.dig(:db, :username) %>\r\n  password: <%= Rails.application.credentials.dig(:db, :password) %>\r\n  port: <%= Rails.application.credentials.dig(:db, :port) %>\r\n  host: <%= Rails.application.credentials.dig(:db, :host) %>\r\n```\r\nto: (other values such as user and password could benefit from the solution, but I can use a root user that doesnt need to be changed, since I am the only one with access to the db. But i'm open to other implementations.)\r\n\r\n```yaml\r\n# database.yml\r\nproduction: &production\r\n  adapter: postgresql\r\n  encoding: unicode\r\n  database: <%= ENV.fetch(\"DB_NAME\",  \"default_db_name\") %>\r\n  username: <%= Rails.application.credentials.dig(:db, :username) %>\r\n  password: <%= Rails.application.credentials.dig(:db, :password) %>\r\n  port: <%= Rails.application.credentials.dig(:db, :port) %>\r\n  host: <%= Rails.application.credentials.dig(:db, :host) %>\r\n```\r\nIn my github actions build step I use the `build-and-push` action from Docker: (I already tried to pass the arguments via Docker, but it did not work)\r\n\r\n```yaml\r\n- name: Build and push ${{ matrix.target }}\r\n        uses: docker/build-push-action@v2\r\n        with:\r\n          context: .\r\n          builder: ${{ steps.buildx.outputs.name }}\r\n          target: ${{ matrix.target }}\r\n          push: true\r\n          tags: organization/projects:preview-${{ matrix.target }}-${{ steps.docker-tag.outputs.tag }}\r\n          cache-from: type=gha,scope=build-${{ matrix.target }}\r\n```\r\nIn my deploymeny, I defined the env, but it has never reached this point because the build fails. It is safe to assume that the kubernetes envs would not have any effect, since the final image needs them to be built. Reading online i saw that is possible that the application needs to be started in order to run `rails assets:precompile`, but I already tried the `initialize_on_precompile` option and it also didnt work\r\n\r\n### Expected behavior\r\n\r\nThe build step should complete successfully and the image should accept Env Vars to set the database name\r\n\r\n### Actual behavior\r\n\r\nThe build step logs an error:\r\n\r\n```\r\n#15 [builder 8/8] RUN rails assets:precompile\r\n#15 2.471 To use retry middleware with Faraday v2.0+, install `faraday-retry` gem\r\n#15 3.297 rails aborted!\r\n#15 3.297 KeyError: Cannot load database configuration:\r\n#15 3.297 key not found: \"DB_NAME\"\r\n#15 3.297 /app/config/database.yml:20:in `fetch'\r\n#15 3.297 /app/config/database.yml:20:in `<main>'\r\n#15 3.297 /app/app/models/application_record.rb:3:in `<main>'\r\n#15 3.297 /app/app/models/user.rb:3:in `<main>'\r\n#15 3.297 /app/config/routes.rb:4:in `block in <main>'\r\n#15 3.297 /app/config/routes.rb:3:in `<main>'\r\n#15 3.297 /app/config/environment.rb:7:in `<main>'\r\n#15 3.297 \r\n#15 3.297 Caused by:\r\n#15 3.297 KeyError: key not found: \"DB_NAME\"\r\n#15 3.297 /app/config/database.yml:20:in `fetch'\r\n#15 3.297 /app/config/database.yml:20:in `<main>'\r\n#15 3.297 /app/app/models/application_record.rb:3:in `<main>'\r\n#15 3.297 /app/app/models/user.rb:3:in `<main>'\r\n#15 3.297 /app/config/routes.rb:4:in `block in <main>'\r\n#15 3.297 /app/config/routes.rb:3:in `<main>'\r\n#15 3.297 /app/config/environment.rb:7:in `<main>'\r\n#15 3.297 Tasks: TOP => environment\r\n#15 3.297 (See full trace by running task with --trace)\r\n#15 ERROR: process \"/bin/sh -c rails assets:precompile\" did not complete successfully: exit code: 1\r\n------\r\n > [builder 8/8] RUN rails assets:precompile:\r\n#15 3.297 KeyError: key not found: \"DB_NAME\"\r\n#15 3.297 /app/config/database.yml:20:in `fetch'\r\n#15 3.297 /app/config/database.yml:20:in `<main>'\r\n#15 3.297 /app/app/models/application_record.rb:3:in `<main>'\r\n#15 3.297 /app/app/models/user.rb:3:in `<main>'\r\n#15 3.297 /app/config/routes.rb:4:in `block in <main>'\r\n#15 3.297 /app/config/routes.rb:3:in `<main>'\r\n#15 3.297 /app/config/environment.rb:7:in `<main>'\r\n#15 3.297 Tasks: TOP => environment\r\n#15 3.297 (See full trace by running task with --trace)\r\n------\r\nWARNING: local cache import at /tmp/.buildx-cache not found due to err: could not read /tmp/.buildx-cache/index.json: open /tmp/.buildx-cache/index.json: no such file or directory\r\nDockerfile:28\r\n--------------------\r\n  26 |     COPY . ./\r\n  27 |     \r\n  28 | >>> RUN rails assets:precompile\r\n  29 |     \r\n  30 |     FROM ruby:3.1.0-alpine as production\r\n--------------------\r\nERROR: failed to solve: process \"/bin/sh -c rails assets:precompile\" did not complete successfully: exit code: 1\r\n```\r\n\r\n### System configuration\r\n**Rails version**: 7.0.4\r\n\r\n**Ruby version**: 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48581/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48581/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48580", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48580/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48580/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48580/events", "html_url": "https://github.com/rails/rails/pull/48580", "id": 1775277139, "node_id": "PR_kwDNIULOU_J8qA", "number": 48580, "title": "Fix flaky tests without guaranteed sort", "user": {"login": "abaldwin88", "id": 15172605, "node_id": "MDQ6VXNlcjE1MTcyNjA1", "avatar_url": "https://avatars.githubusercontent.com/u/15172605?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abaldwin88", "html_url": "https://github.com/abaldwin88", "followers_url": "https://api.github.com/users/abaldwin88/followers", "following_url": "https://api.github.com/users/abaldwin88/following{/other_user}", "gists_url": "https://api.github.com/users/abaldwin88/gists{/gist_id}", "starred_url": "https://api.github.com/users/abaldwin88/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abaldwin88/subscriptions", "organizations_url": "https://api.github.com/users/abaldwin88/orgs", "repos_url": "https://api.github.com/users/abaldwin88/repos", "events_url": "https://api.github.com/users/abaldwin88/events{/privacy}", "received_events_url": "https://api.github.com/users/abaldwin88/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-26T17:47:29Z", "updated_at": "2023-06-26T18:07:38Z", "closed_at": "2023-06-26T18:07:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48580", "html_url": "https://github.com/rails/rails/pull/48580", "diff_url": "https://github.com/rails/rails/pull/48580.diff", "patch_url": "https://github.com/rails/rails/pull/48580.patch", "merged_at": "2023-06-26T18:07:38Z"}, "body": "### Motivation / Background\r\n\r\nThese test assertions rely on database queries that lack an ORDER BY statement. On occasion the database will return results from these queries in an unexpected order resulting in a flaky test.\r\n\r\n\r\n### Additional information\r\n\r\nFurther Reading... https://www.simplethread.com/chaos-order-randomizing-queries-uncover-order-dependency/\r\n\r\nHere's the hacked together code (edits done via vim macros) I used to flush these out... https://github.com/rails/rails/compare/main...abaldwin88:rails:chaos_order\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48580/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48580/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48579", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48579/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48579/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48579/events", "html_url": "https://github.com/rails/rails/pull/48579", "id": 1775174781, "node_id": "PR_kwDNIULOU_EViA", "number": 48579, "title": "DATABASE option for railties:install:migrations", "user": {"login": "SixiS", "id": 99471, "node_id": "MDQ6VXNlcjk5NDcx", "avatar_url": "https://avatars.githubusercontent.com/u/99471?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SixiS", "html_url": "https://github.com/SixiS", "followers_url": "https://api.github.com/users/SixiS/followers", "following_url": "https://api.github.com/users/SixiS/following{/other_user}", "gists_url": "https://api.github.com/users/SixiS/gists{/gist_id}", "starred_url": "https://api.github.com/users/SixiS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SixiS/subscriptions", "organizations_url": "https://api.github.com/users/SixiS/orgs", "repos_url": "https://api.github.com/users/SixiS/repos", "events_url": "https://api.github.com/users/SixiS/events{/privacy}", "received_events_url": "https://api.github.com/users/SixiS/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-26T16:40:50Z", "updated_at": "2023-06-26T17:45:49Z", "closed_at": "2023-06-26T17:45:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48579", "html_url": "https://github.com/rails/rails/pull/48579", "diff_url": "https://github.com/rails/rails/pull/48579.diff", "patch_url": "https://github.com/rails/rails/pull/48579.patch", "merged_at": "2023-06-26T17:45:48Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because it is helpful to be able to specify which database you want\r\nto install migrations to when using an engine with a Rails project that has multiple databases.\r\n\r\n### Detail\r\n\r\nThis Pull Request adds a DATABASE option to the railties:install:migrations rake task.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48579/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48579/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48578", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48578/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48578/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48578/events", "html_url": "https://github.com/rails/rails/pull/48578", "id": 1774949598, "node_id": "PR_kwDNIULOU-4AVQ", "number": 48578, "title": "Add :report behavior to ActiveSupport::Deprecation", "user": {"login": "etiennebarrie", "id": 3535, "node_id": "MDQ6VXNlcjM1MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/3535?v=4", "gravatar_id": "", "url": "https://api.github.com/users/etiennebarrie", "html_url": "https://github.com/etiennebarrie", "followers_url": "https://api.github.com/users/etiennebarrie/followers", "following_url": "https://api.github.com/users/etiennebarrie/following{/other_user}", "gists_url": "https://api.github.com/users/etiennebarrie/gists{/gist_id}", "starred_url": "https://api.github.com/users/etiennebarrie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/etiennebarrie/subscriptions", "organizations_url": "https://api.github.com/users/etiennebarrie/orgs", "repos_url": "https://api.github.com/users/etiennebarrie/repos", "events_url": "https://api.github.com/users/etiennebarrie/events{/privacy}", "received_events_url": "https://api.github.com/users/etiennebarrie/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-26T14:37:30Z", "updated_at": "2023-06-26T17:27:59Z", "closed_at": "2023-06-26T17:27:59Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48578", "html_url": "https://github.com/rails/rails/pull/48578", "diff_url": "https://github.com/rails/rails/pull/48578.diff", "patch_url": "https://github.com/rails/rails/pull/48578.patch", "merged_at": "2023-06-26T17:27:59Z"}, "body": "This behavior uses the ErrorReporter to report a deprecation as a handled error with `:warning` severity.\r\n\r\n### Motivation / Background\r\n\r\nThe error reporter is a great way to report on errors happening in production, with a way to declare the \"error\" as handled. In the lifecycle of an application, after upgrading to a new minor, deprecations can be slowly resolved and even marked as disallowed to prevent reintroduction, then deprecations can be configured to raise in development/test to make sure they don't reappear or are not ignored. But typically deprecations are completely silenced in production, with the `config.active_support.report_deprecations` configuration option.\r\n\r\nAt the very last step before upgrading to the subsequent minor, if tests are not fully trusted to cover all code paths, it would be nice to be able to report deprecations happening in production to the bug tracker the application uses.\r\n\r\n### Detail\r\n\r\nI debated whether to de-duplicate reports by somehow keeping track of backtraces or things like that. Ultimately I felt like this wasn't super useful since multiple worker processes will still report the same deprecation multiple times, and it would add complexity to the implementation.\r\n\r\nBy default, reported errors are marked as handled and have a severity of `:warning`. I wondered about using `:info` to denote that it's very low cause for concern, but since the terminology is \"deprecation warning\" I went with what's the default for handled errors.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48578/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48578/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48577", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48577/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48577/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48577/events", "html_url": "https://github.com/rails/rails/pull/48577", "id": 1774477187, "node_id": "PR_kwDNIULOU-d6nA", "number": 48577, "title": "Fix Active Record encryption not picking up encryption settings with eager-loading", "user": {"login": "jorgemanrubia", "id": 129938, "node_id": "MDQ6VXNlcjEyOTkzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/129938?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jorgemanrubia", "html_url": "https://github.com/jorgemanrubia", "followers_url": "https://api.github.com/users/jorgemanrubia/followers", "following_url": "https://api.github.com/users/jorgemanrubia/following{/other_user}", "gists_url": "https://api.github.com/users/jorgemanrubia/gists{/gist_id}", "starred_url": "https://api.github.com/users/jorgemanrubia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jorgemanrubia/subscriptions", "organizations_url": "https://api.github.com/users/jorgemanrubia/orgs", "repos_url": "https://api.github.com/users/jorgemanrubia/repos", "events_url": "https://api.github.com/users/jorgemanrubia/events{/privacy}", "received_events_url": "https://api.github.com/users/jorgemanrubia/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-26T10:45:38Z", "updated_at": "2023-06-26T11:25:39Z", "closed_at": "2023-06-26T11:25:39Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48577", "html_url": "https://github.com/rails/rails/pull/48577", "diff_url": "https://github.com/rails/rails/pull/48577.diff", "patch_url": "https://github.com/rails/rails/pull/48577.patch", "merged_at": "2023-06-26T11:25:39Z"}, "body": "This deals with a problem where, when eager-loading is enabled, Active Record fails to pick up settings affecting encryption schemes.\r\n\r\nThe solution here is to resolve encryption schemes lazily, when the attribute type is used.\r\n\r\nFollow-up to https://github.com/rails/rails/pull/48530\r\n\r\nFixes https://github.com/rails/rails/issues/48204#issuecomment-1607127334\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48577/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48577/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48576", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48576/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48576/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48576/events", "html_url": "https://github.com/rails/rails/pull/48576", "id": 1773919338, "node_id": "PR_kwDNIULOU-Addw", "number": 48576, "title": "Update deleted_at on destroy", "user": {"login": "lazaronixon", "id": 2651240, "node_id": "MDQ6VXNlcjI2NTEyNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/2651240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lazaronixon", "html_url": "https://github.com/lazaronixon", "followers_url": "https://api.github.com/users/lazaronixon/followers", "following_url": "https://api.github.com/users/lazaronixon/following{/other_user}", "gists_url": "https://api.github.com/users/lazaronixon/gists{/gist_id}", "starred_url": "https://api.github.com/users/lazaronixon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lazaronixon/subscriptions", "organizations_url": "https://api.github.com/users/lazaronixon/orgs", "repos_url": "https://api.github.com/users/lazaronixon/repos", "events_url": "https://api.github.com/users/lazaronixon/events{/privacy}", "received_events_url": "https://api.github.com/users/lazaronixon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-06-26T05:30:36Z", "updated_at": "2023-07-07T11:11:30Z", "closed_at": "2023-07-01T20:27:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48576", "html_url": "https://github.com/rails/rails/pull/48576", "diff_url": "https://github.com/rails/rails/pull/48576.diff", "patch_url": "https://github.com/rails/rails/pull/48576.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nTimestamp `deleted_at` on destroy instead of actually deleting the record. \r\n\r\nIf suppliers table has a field named deleted_at:\r\n\r\n```ruby\r\nsupplier.destroy\r\n#=> UPDATE \"suppliers\" SET \"deleted_at\" = ? WHERE \"suppliers\".\"id\" = ?\r\n\r\nsupplier.delete\r\n#=> DELETE FROM \"suppliers\" WHERE \"suppliers\".\"id\" = ?\r\n```\r\nSoft deletion can be turned off by setting:\r\n```ruby\r\nconfig.active_record.soft_delete = false\r\n```\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48576/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48576/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48575", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48575/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48575/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48575/events", "html_url": "https://github.com/rails/rails/pull/48575", "id": 1773758170, "node_id": "PR_kwDNIULOU94p1g", "number": 48575, "title": "Make the log level in DebugExceptions configurable", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-26T03:15:28Z", "updated_at": "2023-06-27T17:18:44Z", "closed_at": "2023-06-27T17:17:46Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48575", "html_url": "https://github.com/rails/rails/pull/48575", "diff_url": "https://github.com/rails/rails/pull/48575.diff", "patch_url": "https://github.com/rails/rails/pull/48575.patch", "merged_at": "2023-06-27T17:17:45Z"}, "body": "### Motivation / Background\r\n\r\nFixes #47643 \r\n\r\nThis middleware has been logging at a FATAL level since the first [commit][1] in Rails (the code originally lived in actionpack/lib/action_controller/rescue.rb). However, FATAL is documented in the Ruby Logger [docs][2] as being for \"An unhandleable error that results in a program crash.\", which does not really apply to this case since DebugExceptions is handling the error. A more appropriate level would be ERROR, which the Ruby Logger docs describe as \"A handleable error condition.\"\r\n\r\n### Detail\r\n\r\nThis commit introduces a new configuration for the DebugExceptions log level so that new apps will have it set to ERROR by default and ERROR can eventually be made the default.\r\n\r\n[1]: https://github.com/rails/rails/commit/db045dbbf60b53dbe013ef25554fd013baf88134\r\n[2]: https://ruby-doc.org/3.2.1/stdlibs/logger/Logger/Severity.html\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48575/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48575/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48574", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48574/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48574/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48574/events", "html_url": "https://github.com/rails/rails/pull/48574", "id": 1773255611, "node_id": "PR_kwDNIULOU9e0sQ", "number": 48574, "title": "Extract Select rendering methods into SelectRenderer module and simplify Action View base helper logic", "user": {"login": "pinzonjulian", "id": 10928518, "node_id": "MDQ6VXNlcjEwOTI4NTE4", "avatar_url": "https://avatars.githubusercontent.com/u/10928518?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pinzonjulian", "html_url": "https://github.com/pinzonjulian", "followers_url": "https://api.github.com/users/pinzonjulian/followers", "following_url": "https://api.github.com/users/pinzonjulian/following{/other_user}", "gists_url": "https://api.github.com/users/pinzonjulian/gists{/gist_id}", "starred_url": "https://api.github.com/users/pinzonjulian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pinzonjulian/subscriptions", "organizations_url": "https://api.github.com/users/pinzonjulian/orgs", "repos_url": "https://api.github.com/users/pinzonjulian/repos", "events_url": "https://api.github.com/users/pinzonjulian/events{/privacy}", "received_events_url": "https://api.github.com/users/pinzonjulian/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-06-25T12:36:13Z", "updated_at": "2023-06-27T17:52:40Z", "closed_at": "2023-06-26T04:17:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48574", "html_url": "https://github.com/rails/rails/pull/48574", "diff_url": "https://github.com/rails/rails/pull/48574.diff", "patch_url": "https://github.com/rails/rails/pull/48574.patch", "merged_at": "2023-06-26T04:17:03Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been made to help make the Action View Helper Tags a little bit better. This is purely a refactoring PR and does not introduce any changes to the behaviour of tags.\r\n\r\nThe reason I'm doing this is because I'm diving deep into these tags ([1](https://dev.julianpinzon.com/unlocking-the-power-of-forms-in-rails), [2](https://dev.julianpinzon.com/diving-deep-action-view-form-helpers)) in order to find some sort of abstraction ([this](https://dev.julianpinzon.com/the-potential-birth-of-attributebuilders) is one possible version) that might help make it easier to style form elements (input, select, label and text-area)\r\n\r\nIn doing so, I've discovered that the `Tags::Base` class is in need of some maintenance to make it easier to understand where the boundaries are drawn between different elements.\r\n\r\n### Detail\r\n\r\nThis Pull Request:\r\n- Simplifies some of the logic in the `Tags::Base` class\r\n- Creates a new `SelectRenderer` module that contains three methods only used by `<select>` tags.\r\n- Includes the FormOptionsHelper module only in `<select>` classes.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48574/reactions", "total_count": 4, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 3, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48574/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48573", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48573/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48573/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48573/events", "html_url": "https://github.com/rails/rails/pull/48573", "id": 1773171423, "node_id": "PR_kwDNIULOU9aY3A", "number": 48573, "title": "Fix a few typos in changelogs [ci skip]", "user": {"login": "vipulnsward", "id": 567626, "node_id": "MDQ6VXNlcjU2NzYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/567626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vipulnsward", "html_url": "https://github.com/vipulnsward", "followers_url": "https://api.github.com/users/vipulnsward/followers", "following_url": "https://api.github.com/users/vipulnsward/following{/other_user}", "gists_url": "https://api.github.com/users/vipulnsward/gists{/gist_id}", "starred_url": "https://api.github.com/users/vipulnsward/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vipulnsward/subscriptions", "organizations_url": "https://api.github.com/users/vipulnsward/orgs", "repos_url": "https://api.github.com/users/vipulnsward/repos", "events_url": "https://api.github.com/users/vipulnsward/events{/privacy}", "received_events_url": "https://api.github.com/users/vipulnsward/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 123812746, "node_id": "MDU6TGFiZWwxMjM4MTI3NDY=", "url": "https://api.github.com/repos/rails/rails/labels/activejob", "name": "activejob", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-25T09:25:38Z", "updated_at": "2023-06-25T09:27:12Z", "closed_at": "2023-06-25T09:26:20Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48573", "html_url": "https://github.com/rails/rails/pull/48573", "diff_url": "https://github.com/rails/rails/pull/48573.diff", "patch_url": "https://github.com/rails/rails/pull/48573.patch", "merged_at": "2023-06-25T09:26:20Z"}, "body": null, "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48573/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48573/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48572", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48572/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48572/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48572/events", "html_url": "https://github.com/rails/rails/pull/48572", "id": 1773129061, "node_id": "PR_kwDNIULOU9YHeA", "number": 48572, "title": "Introduce config.autoload_lib", "user": {"login": "fxn", "id": 3387, "node_id": "MDQ6VXNlcjMzODc=", "avatar_url": "https://avatars.githubusercontent.com/u/3387?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxn", "html_url": "https://github.com/fxn", "followers_url": "https://api.github.com/users/fxn/followers", "following_url": "https://api.github.com/users/fxn/following{/other_user}", "gists_url": "https://api.github.com/users/fxn/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxn/subscriptions", "organizations_url": "https://api.github.com/users/fxn/orgs", "repos_url": "https://api.github.com/users/fxn/repos", "events_url": "https://api.github.com/users/fxn/events{/privacy}", "received_events_url": "https://api.github.com/users/fxn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-25T08:05:31Z", "updated_at": "2023-06-27T22:14:26Z", "closed_at": "2023-06-25T08:43:10Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48572", "html_url": "https://github.com/rails/rails/pull/48572", "diff_url": "https://github.com/rails/rails/pull/48572.diff", "patch_url": "https://github.com/rails/rails/pull/48572.patch", "merged_at": "2023-06-25T08:43:10Z"}, "body": "## Introduction\r\n\r\nThis patch introduces API to easily autoload and eager load from `lib`:\r\n\r\n```ruby\r\n# config/application.rb\r\nconfig.autoload_lib(ignore: %w(assets tasks generators))\r\n```\r\n\r\n## Some history\r\n\r\nThe `lib` directory was in the autoload paths by default in the early versions of Rails. However, `lib` stores different kinds of files, and eager loading in production proved to be an issue. Some files in there are not meant to be autoloaded or eager loaded. Think generators, for example.\r\n\r\nBecause of that, `lib` was removed from the default autoload paths in Rails 3.\r\n\r\n## app/lib\r\n\r\nSince `lib` didn't have a good solution, the idea of using `app/lib` started to emerge.\r\n\r\nNew `app` subdirectories are added to the autoload and eager load paths automatically, and a posteriori you put there only regular code (not assets or tasks, for example), it worked out of the box.\r\n\r\nHowever, I have a few remarks about `app/lib`:\r\n\r\n* While `app/models` and `app/controllers` mean something, `app/lib` means nothing. They are at the same level, but naming is not quite consistent.\r\n* `lib` is meant for things that are kind of tangential to the application core. What's in there feels better located in `lib` than under `app`, for me.\r\n* Regardless, Rails programmers should be able to autoload from `lib`.\r\n* In most projects I have consulted for, `lib` is added to the autoload paths by hand anyway. People want to autoload from `lib`, which is understandable. If we can, this use case should have first-class support from the framework.\r\n\r\n## We have more options now\r\n\r\nZeitwerk is able to ignore files and directories, so now Rails programmers can autoload and eager load from `lib` with more control. For example:\r\n\r\n```ruby\r\n# config/application.rb\r\nmodule MyApp\r\n  class Application < Rails::Application\r\n    lib = root.join(\"lib\")\r\n\r\n    config.autoload_paths << lib\r\n    config.eager_load_paths << lib\r\n\r\n    Rails.autoloaders.main.ignore(\r\n      lib.join(\"assets\"),\r\n      lib.join(\"tasks\"),\r\n      lib.join(\"generators\")\r\n    )\r\n\r\n    ...\r\n  end\r\nend\r\n```\r\n\r\nTechnically, that is possible since Rails 6, but a better API is possible.\r\n\r\n## `config.autoload_lib(ignore:)`\r\n\r\nIn API design, exceptional use cases may justify exceptional support. You design for the common case, and let the edge case be edge.\r\n\r\nIn this case, I believe `lib` deserves ad-hoc API that allows users to do exactly that in one shot:\r\n\r\n```ruby\r\n# config/application.rb\r\nconfig.autoload_lib(ignore: %w(assets tasks generators))\r\n```\r\n\r\nValues passed to `ignore` are relative to `lib` because it does not make sense to ignore anything outside `lib` using this API, so you enforce that implicitly. As a bonus, the call is short and concise.\r\n\r\n## Why no default arguments?\r\n\r\nI wondered if those three should be a default, but look at this:\r\n\r\n```ruby\r\n# config/application.rb\r\nconfig.autoload_lib\r\n```\r\n\r\nIs it obvious that there are directories being ignored? No, you open the file and see \"autoload lib\". That would be a misleading API. I believe a default makes sense when it is a no-brainer for _clients_, but in this case I don't think it is.\r\n\r\nIn this case, I believe it is better to be explicit and require that you think about what to ignore. Documentation already takes you there by example.\r\n\r\n## Why not generated for new applications?\r\n\r\nI believe we could eventually include that line in newly generated applications. However, I don't want to rush this, let's have the API out and see. If it works well, perhaps in a future version of Rails.\r\n\r\n## Why not available for engines?\r\n\r\nThe `lib` directory in engines is generally speaking more similar to the `lib` directory of a gem than to the `lib` directory of an application. Having `lib` reloaded in engines is more tricky. By now, I prefer to let people that know what they do configure the autoloaders by hand.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48572/reactions", "total_count": 15, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 12, "rocket": 3, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48572/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48571", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48571/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48571/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48571/events", "html_url": "https://github.com/rails/rails/issues/48571", "id": 1772920262, "node_id": "I_kwDNIULOaaydxg", "number": 48571, "title": "`where:` clause of partial index requires doubled, escaped quoting of attributes, contradicting API docs", "user": {"login": "clairity", "id": 950439, "node_id": "MDQ6VXNlcjk1MDQzOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/950439?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clairity", "html_url": "https://github.com/clairity", "followers_url": "https://api.github.com/users/clairity/followers", "following_url": "https://api.github.com/users/clairity/following{/other_user}", "gists_url": "https://api.github.com/users/clairity/gists{/gist_id}", "starred_url": "https://api.github.com/users/clairity/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clairity/subscriptions", "organizations_url": "https://api.github.com/users/clairity/orgs", "repos_url": "https://api.github.com/users/clairity/repos", "events_url": "https://api.github.com/users/clairity/events{/privacy}", "received_events_url": "https://api.github.com/users/clairity/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-06-24T21:12:20Z", "updated_at": "2023-06-29T14:15:29Z", "closed_at": "2023-06-29T14:15:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nthe rails API docs on [partial indexes](https://edgeapi.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-add_index-label-Creating+a+partial+index\r\n) provides a concise example of creating a partial index on a boolean value:\r\n\r\n```ruby\r\nadd_index(:accounts, [:branch_id, :party_id], unique: true, where: \"active\")\r\n```\r\n\r\n### Actual behavior\r\nhowever, this syntax fails with the following error:\r\n\r\n```sh\r\nStandardError: An error has occurred, this and all later migrations canceled:\r\n\r\nPG::SyntaxError: ERROR:  syntax error at or near \"active\"\r\nLINE 1: ...ctive\" ON \"accounts\" (\"branch_id\", \"party_id\") WHERE active\r\n```\r\n\r\nthis may possibly be related to the attribute (here, `active`) not being quoted (although stackoverflow answers indicate that this syntax has worked in the past), because the following variation works:\r\n\r\n```ruby\r\nadd_index(:accounts, [:branch_id, :party_id], unique: true, where: \"\\\"active\\\"\")\r\n```\r\n\r\nwhere we have to pass the attribute with double, escaped quotes, and results in the following output on migration:\r\n\r\n```sh\r\nCREATE UNIQUE INDEX \"index_accounts_on_branch_id_and_party_id\" ON \"accounts\" (\"account_id\", \"party_id\") WHERE \"active\"\r\n```\r\n\r\nthe latest postgres (15) doesn't seem to require quoting such attributes either, as noted by their [example on creating a partial index](https://www.postgresql.org/docs/15/indexes-partial.html#INDEXES-PARTIAL-EX3).\r\n\r\n### Expected behavior\r\n\r\nas the docs indicate, we'd expect that a singly-quoted `where:` clause to generate our expected partial index:\r\n\r\n```ruby\r\nadd_index(:accounts, [:branch_id, :party_id], unique: true, where: \"active\"\r\n```\r\nor even (hopefully) a symbolized version: \r\n\r\n```ruby\r\nadd_index(:accounts, [:branch_id, :party_id], unique: true, where: :active\r\n```\r\n\r\nto result in\r\n\r\n```sh\r\nCREATE UNIQUE INDEX \"index_accounts_on_branch_id_and_party_id\" ON \"accounts\" (\"account_id\", \"party_id\") WHERE \"active\"\r\n```\r\n\r\n### System configuration\r\n**Rails version**: 7.1.alpha\r\n\r\n**Ruby version**: 3.2.2\r\n\r\n**PostgreSQL version**: 15.3\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48571/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48571/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48570", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48570/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48570/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48570/events", "html_url": "https://github.com/rails/rails/pull/48570", "id": 1772872309, "node_id": "PR_kwDNIULOU9KwTw", "number": 48570, "title": "Implement default chronologically scopes", "user": {"login": "lazaronixon", "id": 2651240, "node_id": "MDQ6VXNlcjI2NTEyNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/2651240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lazaronixon", "html_url": "https://github.com/lazaronixon", "followers_url": "https://api.github.com/users/lazaronixon/followers", "following_url": "https://api.github.com/users/lazaronixon/following{/other_user}", "gists_url": "https://api.github.com/users/lazaronixon/gists{/gist_id}", "starred_url": "https://api.github.com/users/lazaronixon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lazaronixon/subscriptions", "organizations_url": "https://api.github.com/users/lazaronixon/orgs", "repos_url": "https://api.github.com/users/lazaronixon/repos", "events_url": "https://api.github.com/users/lazaronixon/events{/privacy}", "received_events_url": "https://api.github.com/users/lazaronixon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-24T18:55:05Z", "updated_at": "2023-06-26T17:15:48Z", "closed_at": "2023-06-26T16:42:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48570", "html_url": "https://github.com/rails/rails/pull/48570", "diff_url": "https://github.com/rails/rails/pull/48570.diff", "patch_url": "https://github.com/rails/rails/pull/48570.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nAdd `chronologically` and `reverse_chronologically` scopes to `ActiveRecord::Base`.\r\n\r\n```ruby\r\nAuthor.chronologically\r\n#=> SELECT * FROM authors ORDER BY authors.id ASC\r\n\r\nAuthor.reverse_chronologically\r\n#=> SELECT * FROM authors ORDER BY authors.id DESC\r\n```\r\n\r\nIt uses the same logic as `first` and `last`, the order is defined based on `implicit_order_column || query_constraints_list || primary_key`.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48570/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48570/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48569", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48569/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48569/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48569/events", "html_url": "https://github.com/rails/rails/pull/48569", "id": 1772684021, "node_id": "PR_kwDNIULOU9Am5A", "number": 48569, "title": "Update datetime_local_field.rb", "user": {"login": "chaffeqa", "id": 287640, "node_id": "MDQ6VXNlcjI4NzY0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/287640?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chaffeqa", "html_url": "https://github.com/chaffeqa", "followers_url": "https://api.github.com/users/chaffeqa/followers", "following_url": "https://api.github.com/users/chaffeqa/following{/other_user}", "gists_url": "https://api.github.com/users/chaffeqa/gists{/gist_id}", "starred_url": "https://api.github.com/users/chaffeqa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chaffeqa/subscriptions", "organizations_url": "https://api.github.com/users/chaffeqa/orgs", "repos_url": "https://api.github.com/users/chaffeqa/repos", "events_url": "https://api.github.com/users/chaffeqa/events{/privacy}", "received_events_url": "https://api.github.com/users/chaffeqa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-24T12:56:20Z", "updated_at": "2023-07-06T03:03:24Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48569", "html_url": "https://github.com/rails/rails/pull/48569", "diff_url": "https://github.com/rails/rails/pull/48569.diff", "patch_url": "https://github.com/rails/rails/pull/48569.patch", "merged_at": null}, "body": "Defaulted datetime-local to not use seconds\r\n\r\n\r\n### Motivation / Background\r\n\r\nInput of `datetime-local` specifies that the [value must be excluding seconds](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/datetime-local#value).  Although Chrome supports seconds, safari will validate client-side that the value is `not valid` and the form will not be submittable.\r\n\r\n\r\n\r\nThis Pull Request has been created because the default for rails should not error out in a popular browser.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the default for `datetime-local` value conversion\r\n\r\n### Additional information\r\n\r\n<img width=\"770\" alt=\"Screenshot 2023-06-24 at 6 54 09 AM\" src=\"https://github.com/rails/rails/assets/287640/917cf010-82fb-4f95-a2fc-54b85f6ab193\">\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48569/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48569/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48568", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48568/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48568/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48568/events", "html_url": "https://github.com/rails/rails/pull/48568", "id": 1772444158, "node_id": "PR_kwDNIULOU8ztrw", "number": 48568, "title": "Use `~=` instead of `IS NOT DISTINCT FROM` for the PostgreSQL geometric data types", "user": {"login": "thukim", "id": 1097697, "node_id": "MDQ6VXNlcjEwOTc2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1097697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thukim", "html_url": "https://github.com/thukim", "followers_url": "https://api.github.com/users/thukim/followers", "following_url": "https://api.github.com/users/thukim/following{/other_user}", "gists_url": "https://api.github.com/users/thukim/gists{/gist_id}", "starred_url": "https://api.github.com/users/thukim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thukim/subscriptions", "organizations_url": "https://api.github.com/users/thukim/orgs", "repos_url": "https://api.github.com/users/thukim/repos", "events_url": "https://api.github.com/users/thukim/events{/privacy}", "received_events_url": "https://api.github.com/users/thukim/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-24T04:24:06Z", "updated_at": "2023-06-24T09:10:48Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48568", "html_url": "https://github.com/rails/rails/pull/48568", "diff_url": "https://github.com/rails/rails/pull/48568.diff", "patch_url": "https://github.com/rails/rails/pull/48568.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThe `~=` operator is available for 4 types point, box, polygon, circle, which represents the usual notion of equality. (other geometric data types, which are line, lseg, path, still work with `IS NOT DISTINCT FROM` / = operator)\r\n\r\nA typical example of how `~=` works is: box '((3,4),(5,5))' ~=  box '((3,4),(5,5))' -> t; box '((3,4),(5,5))' ~=  box '((5,5),(3,4))' -> t \r\nRef https://www.postgresql.org/docs/15/functions-geometry.html\r\n\r\n<img width=\"1292\" alt=\"Screenshot 2023-06-24 at 16 09 58\" src=\"https://github.com/rails/rails/assets/1097697/0dd4b8c9-5096-4b5b-bcf8-8d726f09cafb\">\r\n\r\n\r\nFixes #48497\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48568/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48568/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48567", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48567/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48567/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48567/events", "html_url": "https://github.com/rails/rails/pull/48567", "id": 1771738266, "node_id": "PR_kwDNIULOU8NiLQ", "number": 48567, "title": "Add rake tests for trilogy", "user": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-23T16:33:29Z", "updated_at": "2023-06-23T17:15:16Z", "closed_at": "2023-06-23T17:15:12Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48567", "html_url": "https://github.com/rails/rails/pull/48567", "diff_url": "https://github.com/rails/rails/pull/48567.diff", "patch_url": "https://github.com/rails/rails/pull/48567.patch", "merged_at": "2023-06-23T17:15:12Z"}, "body": "These were missed in the migration. I also renamed the mysql2 ones to mysql2 from mysql to match the appropriate namespaces.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48567/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48567/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48566", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48566/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48566/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48566/events", "html_url": "https://github.com/rails/rails/pull/48566", "id": 1771567467, "node_id": "PR_kwDNIULOU8EPXA", "number": 48566, "title": "Fix error ActiveJob passed class with `permitted?`", "user": {"login": "abaldwin88", "id": 15172605, "node_id": "MDQ6VXNlcjE1MTcyNjA1", "avatar_url": "https://avatars.githubusercontent.com/u/15172605?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abaldwin88", "html_url": "https://github.com/abaldwin88", "followers_url": "https://api.github.com/users/abaldwin88/followers", "following_url": "https://api.github.com/users/abaldwin88/following{/other_user}", "gists_url": "https://api.github.com/users/abaldwin88/gists{/gist_id}", "starred_url": "https://api.github.com/users/abaldwin88/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abaldwin88/subscriptions", "organizations_url": "https://api.github.com/users/abaldwin88/orgs", "repos_url": "https://api.github.com/users/abaldwin88/repos", "events_url": "https://api.github.com/users/abaldwin88/events{/privacy}", "received_events_url": "https://api.github.com/users/abaldwin88/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123812746, "node_id": "MDU6TGFiZWwxMjM4MTI3NDY=", "url": "https://api.github.com/repos/rails/rails/labels/activejob", "name": "activejob", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-23T14:31:41Z", "updated_at": "2023-06-27T16:32:33Z", "closed_at": "2023-06-23T19:56:54Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48566", "html_url": "https://github.com/rails/rails/pull/48566", "diff_url": "https://github.com/rails/rails/pull/48566.diff", "patch_url": "https://github.com/rails/rails/pull/48566.patch", "merged_at": "2023-06-23T19:56:54Z"}, "body": "### Motivation / Background\r\n\r\nFixes #48561\r\n\r\n### Detail\r\n\r\nThis Pull Request fixes an error being raised when providing a class argument to ActiveJob for classes that implement `permitted?`. \r\n\r\nThis code path is primarily intended for instances of `ActionController::Parameters`. However an application could define `permitted?` for it's own purposes resulting in an error. Adding the additional `to_h` narrows the criteria and in the event another type besides `Parameters` is passed will ensure it quacks right.\r\n\r\nCo-authored-by: @sampatbadhe \r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48566/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48566/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48565", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48565/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48565/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48565/events", "html_url": "https://github.com/rails/rails/pull/48565", "id": 1771046767, "node_id": "PR_kwDNIULOU7n6iw", "number": 48565, "title": "Rename `Range#overlaps?` to `Range#overlap?`", "user": {"login": "c960657", "id": 111346, "node_id": "MDQ6VXNlcjExMTM0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/111346?v=4", "gravatar_id": "", "url": "https://api.github.com/users/c960657", "html_url": "https://github.com/c960657", "followers_url": "https://api.github.com/users/c960657/followers", "following_url": "https://api.github.com/users/c960657/following{/other_user}", "gists_url": "https://api.github.com/users/c960657/gists{/gist_id}", "starred_url": "https://api.github.com/users/c960657/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/c960657/subscriptions", "organizations_url": "https://api.github.com/users/c960657/orgs", "repos_url": "https://api.github.com/users/c960657/repos", "events_url": "https://api.github.com/users/c960657/events{/privacy}", "received_events_url": "https://api.github.com/users/c960657/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-23T08:28:58Z", "updated_at": "2023-06-25T07:44:34Z", "closed_at": "2023-06-24T21:36:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48565", "html_url": "https://github.com/rails/rails/pull/48565", "diff_url": "https://github.com/rails/rails/pull/48565.diff", "patch_url": "https://github.com/rails/rails/pull/48565.patch", "merged_at": "2023-06-24T21:36:18Z"}, "body": "### Motivation\r\nThe method name `Range#overlaps?` uses a 3rd person verb which is inconsistent with e.g. `Range#include?` and `Range#cover?`.\r\n\r\n### Detail\r\nThis pull request renames `Range#overlaps?` to `Range#overlap?` and adds an alias for backwards compatibility (similar to `String#starts_with?`).\r\n\r\n### Checklist\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48565/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48565/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48564", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48564/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48564/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48564/events", "html_url": "https://github.com/rails/rails/pull/48564", "id": 1770807031, "node_id": "PR_kwDNIULOU7b-nA", "number": 48564, "title": "Use id in composite primary key of cpk book and fix related bugs", "user": {"login": "gmcgibbon", "id": 5162312, "node_id": "MDQ6VXNlcjUxNjIzMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5162312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gmcgibbon", "html_url": "https://github.com/gmcgibbon", "followers_url": "https://api.github.com/users/gmcgibbon/followers", "following_url": "https://api.github.com/users/gmcgibbon/following{/other_user}", "gists_url": "https://api.github.com/users/gmcgibbon/gists{/gist_id}", "starred_url": "https://api.github.com/users/gmcgibbon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gmcgibbon/subscriptions", "organizations_url": "https://api.github.com/users/gmcgibbon/orgs", "repos_url": "https://api.github.com/users/gmcgibbon/repos", "events_url": "https://api.github.com/users/gmcgibbon/events{/privacy}", "received_events_url": "https://api.github.com/users/gmcgibbon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-06-23T05:30:52Z", "updated_at": "2023-06-27T22:08:04Z", "closed_at": "2023-06-27T18:02:20Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48564", "html_url": "https://github.com/rails/rails/pull/48564", "diff_url": "https://github.com/rails/rails/pull/48564.diff", "patch_url": "https://github.com/rails/rails/pull/48564.patch", "merged_at": "2023-06-27T18:02:20Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because I think that our test models could be improved. Right now, we primary test composite primary key code with `Cpk::Book` and related models. This model uses `[:author_id, :number]` as a PK definition. In practice, most models (I think) would use `[:some_id, :id]`, so I've changed `cpk_books` to mirror this assumption. \r\n\r\n### Detail\r\n\r\nThis Pull Request changes `Cpk::Book` to use `id` instead of `number`, and as the second campsite key, and updated related tests. This also uncovered three bugs in our current implementation I've fixed as well.\r\n\r\n### Additional information\r\n\r\nHappy to introduce another model instead of doing this, but it seems much easier to model our test data closer to what we expect in the real world.\r\n\r\nThe last commit (70f3b3de1cbf761e67f527ed1525734882e08649), breaks a few attribute method test expectations. We might need to implement a special query method for ID dirty checking. WDYT?\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48564/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48564/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48563", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48563/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48563/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48563/events", "html_url": "https://github.com/rails/rails/pull/48563", "id": 1770642921, "node_id": "PR_kwDNIULOU7Ttkw", "number": 48563, "title": ":link: Remove RDoc auto-link from Rails module everywhere", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107188, "node_id": "MDU6TGFiZWwxMDcxODg=", "url": "https://api.github.com/repos/rails/rails/labels/actionmailer", "name": "actionmailer", "color": "8B00FC", "default": false, "description": null}, {"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}, {"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}, {"id": 1174770998, "node_id": "MDU6TGFiZWwxMTc0NzcwOTk4", "url": "https://api.github.com/repos/rails/rails/labels/actionmailbox", "name": "actionmailbox", "color": "f4a6cb", "default": false, "description": ""}, {"id": 1180817762, "node_id": "MDU6TGFiZWwxMTgwODE3NzYy", "url": "https://api.github.com/repos/rails/rails/labels/actiontext", "name": "actiontext", "color": "3bc667", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-23T01:54:12Z", "updated_at": "2023-06-23T02:39:21Z", "closed_at": "2023-06-23T02:39:20Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48563", "html_url": "https://github.com/rails/rails/pull/48563", "diff_url": "https://github.com/rails/rails/pull/48563.diff", "patch_url": "https://github.com/rails/rails/pull/48563.patch", "merged_at": "2023-06-23T02:39:20Z"}, "body": "This patch was sitting half-baked on my machine, so I decided to just finish it and remove these links which could be confusing to readers who end up on the `Rails` module not knowing it's purpose.\r\n\r\nThere are other similar namespaces that I'd like to to the same, but I wonder if there is a way to prevent auto-linking for a deny-listed set of modules with SDoc.\r\n\r\n* Hash\r\n* Mail\r\n* Digest\r\n* API\r\n* Time\r\n* Method\r\n\r\nJust to name a few that I spotted when doing this.\r\n\r\nRealizing this is a cosmetic change, but the value of potentially saving an early developer time possibly wasted on reading the `Rails` module is worth it IMO. And also using this as an opportunity to let others know about the remaining namespaces that could use the same treatment. :pray:", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48563/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48563/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48562", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48562/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48562/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48562/events", "html_url": "https://github.com/rails/rails/pull/48562", "id": 1770396868, "node_id": "PR_kwDNIULOU7HLxw", "number": 48562, "title": "[Fix #46653] `becomes` losing target class default value", "user": {"login": "abaldwin88", "id": 15172605, "node_id": "MDQ6VXNlcjE1MTcyNjA1", "avatar_url": "https://avatars.githubusercontent.com/u/15172605?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abaldwin88", "html_url": "https://github.com/abaldwin88", "followers_url": "https://api.github.com/users/abaldwin88/followers", "following_url": "https://api.github.com/users/abaldwin88/following{/other_user}", "gists_url": "https://api.github.com/users/abaldwin88/gists{/gist_id}", "starred_url": "https://api.github.com/users/abaldwin88/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abaldwin88/subscriptions", "organizations_url": "https://api.github.com/users/abaldwin88/orgs", "repos_url": "https://api.github.com/users/abaldwin88/repos", "events_url": "https://api.github.com/users/abaldwin88/events{/privacy}", "received_events_url": "https://api.github.com/users/abaldwin88/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-22T21:07:04Z", "updated_at": "2023-06-22T21:38:22Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48562", "html_url": "https://github.com/rails/rails/pull/48562", "diff_url": "https://github.com/rails/rails/pull/48562.diff", "patch_url": "https://github.com/rails/rails/pull/48562.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nFixes #46653\r\n\r\n### Detail\r\n\r\n`becomes` is coping the `@attributes` from the original instance but the defaults are not being applied from the target class during initialization. Following the comments from the linked issue this PR will apply the default value if an attribute is nil and hasn't been changed.\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48562/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48562/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48561", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48561/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48561/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48561/events", "html_url": "https://github.com/rails/rails/issues/48561", "id": 1770117799, "node_id": "I_kwDNIULOaYHapw", "number": 48561, "title": "Error when providing a class argument to ActiveJob for classes that implement `permitted?`", "user": {"login": "adnanrh", "id": 9893413, "node_id": "MDQ6VXNlcjk4OTM0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/9893413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adnanrh", "html_url": "https://github.com/adnanrh", "followers_url": "https://api.github.com/users/adnanrh/followers", "following_url": "https://api.github.com/users/adnanrh/following{/other_user}", "gists_url": "https://api.github.com/users/adnanrh/gists{/gist_id}", "starred_url": "https://api.github.com/users/adnanrh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adnanrh/subscriptions", "organizations_url": "https://api.github.com/users/adnanrh/orgs", "repos_url": "https://api.github.com/users/adnanrh/repos", "events_url": "https://api.github.com/users/adnanrh/events{/privacy}", "received_events_url": "https://api.github.com/users/adnanrh/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-22T17:29:51Z", "updated_at": "2023-06-23T19:56:56Z", "closed_at": "2023-06-23T19:56:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n1. Write a class MyClass that implements a class method named `permitted?`\r\n2. Write a job BuggyJob with a `perform` method that accepts a class as a parameter\r\n3. Enqueue a BuggyJob job with MyClass as an argument: `BuggyJob.perform_later(MyClass)`\r\n\r\nThe issue seems to be here: https://github.com/rails/rails/blob/main/activejob/lib/active_job/arguments.rb#L93\r\nIt seems in the switch statement to choose the correct serializer for the argument, we attempt to call `serialize_indifferent_hash` on `argument.to_h` if it responds to `permitted?`. I suppose the assumption here is that if the argument responds to `permitted?`, it should be an instance of `ActionController::Parameters`? In our app, we have a module that defines a class method named `permitted?` for some other business logic and it's used in a few classes.\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activejob\", \"~> 7.0.0\"\r\nend\r\n\r\nrequire \"minitest/autorun\"\r\nrequire \"active_job\"\r\n\r\nclass MyClass\r\n  def self.permitted?\r\n    # noop\r\n  end\r\nend\r\n\r\nclass BuggyJob < ActiveJob::Base\r\n  def perform(klass)\r\n    puts \"performed\"\r\n  end\r\nend\r\n\r\nclass BuggyJobTest < ActiveJob::TestCase\r\n  def test_stuff\r\n    error = assert_raises(NoMethodError) { BuggyJob.perform_later(MyClass) }\r\n    assert_match /undefined method `to_h' for MyClass:Class/, error.message\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\n<!-- Tell us what should happen -->\r\nA BuggyJob job should successfully be queued, with the MyClass argument serialized using ActiveJob::Serializers::ModuleSerializer.\r\n\r\n\r\n### Actual behavior\r\n<!-- Tell us what happens instead -->\r\nA NoMethodError is raised:\r\n```\r\nFailed enqueuing BuggyJob to DelayedJob(default): NoMethodError (undefined method `to_h' for MyClass:Class\r\nDid you mean?  to_s)\r\n.../ruby/3.0.0/gems/activejob-6.1.7.3/lib/active_job/arguments.rb:120:in `serialize_argument': undefined method `to_h' for MyClass:Class (NoMethodError)\r\nDid you mean?  to_s\r\n```\r\n\r\n### System configuration\r\n**Rails version**: Tested on 6.1.x, 7.0.x\r\n\r\n**Ruby version**: Tested on 3.0.4\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48561/reactions", "total_count": 3, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48561/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48560", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48560/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48560/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48560/events", "html_url": "https://github.com/rails/rails/pull/48560", "id": 1769861404, "node_id": "PR_kwDNIULOU6p_qQ", "number": 48560, "title": "Fix parallel testing (issue #48547)", "user": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-22T14:54:18Z", "updated_at": "2023-07-05T15:06:56Z", "closed_at": "2023-07-05T15:06:52Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48560", "html_url": "https://github.com/rails/rails/pull/48560", "diff_url": "https://github.com/rails/rails/pull/48560.diff", "patch_url": "https://github.com/rails/rails/pull/48560.patch", "merged_at": "2023-07-05T15:06:52Z"}, "body": "Fixes 2 bugs in parallel testing.\r\n\r\nThe first bug was related to changes made in #45450 which meant that we were no longer replacing the connection in parallel testing because the config object is equal (we simply merge a new db name but the object id of the config stays the same). This bug only manifested in mysql and sqlite3 interestingly. It would fail on the internal metadata tables because they were missing in the schema version check.\r\n\r\nTo fix this I introduced a `clobber: true` kwarg onto the connection handler that allowsus to bypass the functionality that won't make a new connection if the config is the same. This is an easy way to fall back to the old behavior from before this change.\r\n\r\nAfter implementing this fix I was still seeing failures in the mysql demo app I made due to the fact that `purge` was not re-establishing the connection to a config that had a database defined. Neither sqlite3 or postgresql were missing this.\r\n\r\nI added a test for mysql2 so we don't have regressions in the future. I think this was missed because sqlite3 only demonstrates the bug if it was never successful on that worker and postgresql was fine.\r\n\r\nFixes #48547\r\n\r\ncc/ @matthutchinson", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48560/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48560/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48559", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48559/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48559/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48559/events", "html_url": "https://github.com/rails/rails/pull/48559", "id": 1769404472, "node_id": "PR_kwDNIULOU6RPsQ", "number": 48559, "title": "fix AbstractController#action_methods ", "user": {"login": "kamil-gwozdz", "id": 15572959, "node_id": "MDQ6VXNlcjE1NTcyOTU5", "avatar_url": "https://avatars.githubusercontent.com/u/15572959?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kamil-gwozdz", "html_url": "https://github.com/kamil-gwozdz", "followers_url": "https://api.github.com/users/kamil-gwozdz/followers", "following_url": "https://api.github.com/users/kamil-gwozdz/following{/other_user}", "gists_url": "https://api.github.com/users/kamil-gwozdz/gists{/gist_id}", "starred_url": "https://api.github.com/users/kamil-gwozdz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kamil-gwozdz/subscriptions", "organizations_url": "https://api.github.com/users/kamil-gwozdz/orgs", "repos_url": "https://api.github.com/users/kamil-gwozdz/repos", "events_url": "https://api.github.com/users/kamil-gwozdz/events{/privacy}", "received_events_url": "https://api.github.com/users/kamil-gwozdz/received_events", "type": "User", "site_admin": true}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-06-22T10:32:58Z", "updated_at": "2023-07-09T19:04:03Z", "closed_at": "2023-07-09T19:03:43Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48559", "html_url": "https://github.com/rails/rails/pull/48559", "diff_url": "https://github.com/rails/rails/pull/48559.diff", "patch_url": "https://github.com/rails/rails/pull/48559.patch", "merged_at": null}, "body": "This PR fixes `AbstractController#action_methods` to include inherited shadowed internal methods.\r\n\r\n### Motivation / Background\r\n\r\nI tried enabling [`raise_on_missing_callback_actions`](https://github.com/rails/rails/pull/43487) and I found out that `MyController#action_methods` is missing a method that `MyController` actually defines. It only happens when a method is also defined by an ancestor abstract controller.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [ ] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48559/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48559/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48558", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48558/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48558/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48558/events", "html_url": "https://github.com/rails/rails/pull/48558", "id": 1769336011, "node_id": "PR_kwDNIULOU6NdtA", "number": 48558, "title": "Merge pull request #45837 from hahmed/ha/active-storage-fix-rotation-\u2026", "user": {"login": "yahonda", "id": 73684, "node_id": "MDQ6VXNlcjczNjg0", "avatar_url": "https://avatars.githubusercontent.com/u/73684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yahonda", "html_url": "https://github.com/yahonda", "followers_url": "https://api.github.com/users/yahonda/followers", "following_url": "https://api.github.com/users/yahonda/following{/other_user}", "gists_url": "https://api.github.com/users/yahonda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yahonda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yahonda/subscriptions", "organizations_url": "https://api.github.com/users/yahonda/orgs", "repos_url": "https://api.github.com/users/yahonda/repos", "events_url": "https://api.github.com/users/yahonda/events{/privacy}", "received_events_url": "https://api.github.com/users/yahonda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 664533972, "node_id": "MDU6TGFiZWw2NjQ1MzM5NzI=", "url": "https://api.github.com/repos/rails/rails/labels/activestorage", "name": "activestorage", "color": "bfd4f2", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-22T09:50:45Z", "updated_at": "2023-06-23T02:41:19Z", "closed_at": "2023-06-23T02:41:18Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48558", "html_url": "https://github.com/rails/rails/pull/48558", "diff_url": "https://github.com/rails/rails/pull/48558.diff", "patch_url": "https://github.com/rails/rails/pull/48558.patch", "merged_at": "2023-06-23T02:41:18Z"}, "body": "### Motivation / Background\r\nThis pull request backports #45837 to the 7-0-stable branch.\r\n \r\n### Detail\r\nI have opened this back port pull request because 7-0-stable CI has been red.\r\nThis commit addresses the following failure.\r\n\r\nhttps://buildkite.com/rails/rails/builds/97419#0188e1f5-368b-4d81-8161-e58086d544fa/1187-1244\r\n\r\n```ruby\r\nFailure:\r\nActiveStorage::Analyzer::VideoAnalyzerTest#test_analyzing_a_rotated_video [/rails/activestorage/test/analyzer/video_analyzer_test.rb:26]:\r\nExpected: 480\r\n  Actual: 640.0\r\n```\r\n\r\n### Additional information\r\nNone\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [ ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48558/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48558/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48557", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48557/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48557/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48557/events", "html_url": "https://github.com/rails/rails/pull/48557", "id": 1768873212, "node_id": "PR_kwDNIULOU50Upg", "number": 48557, "title": "Fix EncryptedConfiguration not behaving like Hash [7-0-stable]", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-22T03:40:23Z", "updated_at": "2023-06-22T15:54:16Z", "closed_at": "2023-06-22T07:13:35Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48557", "html_url": "https://github.com/rails/rails/pull/48557", "diff_url": "https://github.com/rails/rails/pull/48557.diff", "patch_url": "https://github.com/rails/rails/pull/48557.patch", "merged_at": "2023-06-22T07:13:35Z"}, "body": "### Motivation / Background\r\n\r\nPreviously, `EncryptedConfiguration` was [updated][1] to use `InheritableOptions` so that keys could be called like methods. It was later [updated again][2] to ensure that it behaved both like a `Hash` and `OrderedOptions`. In this second change, the `InheritableOptions` instance was accidentally nested with another `InheritableOptions` instance.\r\n\r\nThis continued to mostly work as expected because `InheritableOptions` will fall back to the inner `InheritableOptions` when the outer one doesn't have a key. However, any methods that try to treat the outer `InheritableOptions` like it should know about all of its keys will fail (for example, `#keys`, `#to_h`, `#to_json`, etc.)\r\n\r\n### Detail\r\n\r\nThis commit fixes the issue by removing the extraneous outer `InheritableOptions` instance.\r\n\r\n[1]: https://github.com/rails/rails/commit/a6a9fed1719a3cfe47eb1566ae4d6034374fd809\r\n[2]: https://github.com/rails/rails/commit/80585daf2def5bf94854be69f81e24a16ce14c55\r\n\r\n### Additional information\r\n\r\nRef #48556 didn't cherry-pick cleanly so I went ahead and opened this with the conflict resolved\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48557/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48557/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48556", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48556/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48556/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48556/events", "html_url": "https://github.com/rails/rails/pull/48556", "id": 1768869366, "node_id": "PR_kwDNIULOU50How", "number": 48556, "title": "Fix EncryptedConfiguration not behaving like Hash", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-06-22T03:34:44Z", "updated_at": "2023-06-22T15:54:03Z", "closed_at": "2023-06-22T08:16:02Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48556", "html_url": "https://github.com/rails/rails/pull/48556", "diff_url": "https://github.com/rails/rails/pull/48556.diff", "patch_url": "https://github.com/rails/rails/pull/48556.patch", "merged_at": "2023-06-22T08:16:02Z"}, "body": "### Motivation / Background\r\n\r\nFixes #48554\r\n\r\nPreviously, `EncryptedConfiguration` was [updated][1] to use `InheritableOptions` so that keys could be called like methods. It was later [updated again][2] to ensure that it behaved both like a `Hash` and `OrderedOptions`. In this second change, the `InheritableOptions` instance was accidentally nested with another `InheritableOptions` instance.\r\n\r\nThis continued to mostly work as expected because `InheritableOptions` will fall back to the inner `InheritableOptions` when the outer one doesn't have a key. However, any methods that try to treat the outer `InheritableOptions` like it should know about all of its keys will fail (for example, `#keys`, `#to_h`, `#to_json`, etc.)\r\n\r\n### Detail\r\n\r\nThis commit fixes the issue by removing the extraneous outer `InheritableOptions` instance.\r\n\r\n[1]: https://github.com/rails/rails/commit/a6a9fed1719a3cfe47eb1566ae4d6034374fd809\r\n[2]: https://github.com/rails/rails/commit/80585daf2def5bf94854be69f81e24a16ce14c55\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48556/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48556/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48555", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48555/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48555/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48555/events", "html_url": "https://github.com/rails/rails/pull/48555", "id": 1768841275, "node_id": "PR_kwDNIULOU5yqbQ", "number": 48555, "title": "Fix to_s not using :default format with no args", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-06-22T02:54:48Z", "updated_at": "2023-08-16T15:47:24Z", "closed_at": "2023-08-03T19:59:11Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48555", "html_url": "https://github.com/rails/rails/pull/48555", "diff_url": "https://github.com/rails/rails/pull/48555.diff", "patch_url": "https://github.com/rails/rails/pull/48555.patch", "merged_at": "2023-08-03T19:59:11Z"}, "body": "### Motivation / Background\r\n\r\nFixes #48545 \r\n\r\nWhen `to_s` was [deprecated][1] for `to_fs`, warnings were added when explicit formats were passed to `to_s`. To determine whether a format argument was passed, the method signature was changed from `to_s(format = :default)` to `to_s(format = EMPTY_OBJECT)`. While this enabled being able to warn on formats passed, it changed the behavior of not passing any format for applications that customized the `:default` format for one of these classes.\r\n\r\n### Detail\r\n\r\nThis commit restores the previous behavior for `:default` formats while keeping the existing warnings. Additionally, it will continue to not warn for applications using `to_s` without arguments that haven't set a custom `:default` format. However, for applications that have set a custom `:default` format, it will now warn that those classes should be migrated to `to_fs`.\r\n\r\n[1]: https://github.com/rails/rails/commit/f9fbfe0ab3cfc31f72663b9f06286ab32224b886\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48555/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48555/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48554", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48554/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48554/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48554/events", "html_url": "https://github.com/rails/rails/issues/48554", "id": 1768820027, "node_id": "I_kwDNIULOaW4NOw", "number": 48554, "title": "Why is credentails.to_h/to_json empty when there are credentials?", "user": {"login": "dorianmariefr", "id": 58794487, "node_id": "MDQ6VXNlcjU4Nzk0NDg3", "avatar_url": "https://avatars.githubusercontent.com/u/58794487?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dorianmariefr", "html_url": "https://github.com/dorianmariefr", "followers_url": "https://api.github.com/users/dorianmariefr/followers", "following_url": "https://api.github.com/users/dorianmariefr/following{/other_user}", "gists_url": "https://api.github.com/users/dorianmariefr/gists{/gist_id}", "starred_url": "https://api.github.com/users/dorianmariefr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dorianmariefr/subscriptions", "organizations_url": "https://api.github.com/users/dorianmariefr/orgs", "repos_url": "https://api.github.com/users/dorianmariefr/repos", "events_url": "https://api.github.com/users/dorianmariefr/events{/privacy}", "received_events_url": "https://api.github.com/users/dorianmariefr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-22T02:25:54Z", "updated_at": "2023-06-22T08:16:04Z", "closed_at": "2023-06-22T08:16:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```ruby\r\n>> Rails.application.credentials.to_h\r\n=> {}\r\n>> Rails.application.credentials.to_json\r\n=> \"{}\"\r\n```\r\n\r\nruby 3.2.2 (2023-03-30 revision e51014f9c0) +YJIT [arm64-darwin22]\r\n\r\nRails 7.1.0.alpha", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48554/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48554/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48553", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48553/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48553/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48553/events", "html_url": "https://github.com/rails/rails/pull/48553", "id": 1768812581, "node_id": "PR_kwDNIULOU5xKWg", "number": 48553, "title": "Allow opting in/out of `Link preload` headers when calling `stylesheet_link_tag` or `javascript_include_tag`", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-22T02:14:29Z", "updated_at": "2023-06-30T21:46:36Z", "closed_at": "2023-06-30T20:40:03Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48553", "html_url": "https://github.com/rails/rails/pull/48553", "diff_url": "https://github.com/rails/rails/pull/48553.diff", "patch_url": "https://github.com/rails/rails/pull/48553.patch", "merged_at": "2023-06-30T20:40:03Z"}, "body": "Fixes https://github.com/rails/rails/issues/48517\r\n\r\n```ruby\r\n# will exclude header, even if config is enabled:\r\njavascript_include_tag(\"http://example.com/all.js\", preload_links_header: false)\r\n\r\n# will include header, even if config is disabled:\r\nstylesheet_link_tag(\"http://example.com/all.css\", preload_links_header: true)\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48553/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48553/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48552", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48552/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48552/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48552/events", "html_url": "https://github.com/rails/rails/pull/48552", "id": 1768591652, "node_id": "PR_kwDNIULOU5k9gQ", "number": 48552, "title": "Add support for unpersisted CPK has_one/has_many through associations", "user": {"login": "gmcgibbon", "id": 5162312, "node_id": "MDQ6VXNlcjUxNjIzMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5162312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gmcgibbon", "html_url": "https://github.com/gmcgibbon", "followers_url": "https://api.github.com/users/gmcgibbon/followers", "following_url": "https://api.github.com/users/gmcgibbon/following{/other_user}", "gists_url": "https://api.github.com/users/gmcgibbon/gists{/gist_id}", "starred_url": "https://api.github.com/users/gmcgibbon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gmcgibbon/subscriptions", "organizations_url": "https://api.github.com/users/gmcgibbon/orgs", "repos_url": "https://api.github.com/users/gmcgibbon/repos", "events_url": "https://api.github.com/users/gmcgibbon/events{/privacy}", "received_events_url": "https://api.github.com/users/gmcgibbon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-21T22:19:49Z", "updated_at": "2023-06-23T19:42:24Z", "closed_at": "2023-06-23T19:42:20Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48552", "html_url": "https://github.com/rails/rails/pull/48552", "diff_url": "https://github.com/rails/rails/pull/48552.diff", "patch_url": "https://github.com/rails/rails/pull/48552.patch", "merged_at": "2023-06-23T19:42:20Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because `has_many` and `has_one` with composite primary key `through:` associations with unpersisted owner records don't currently work.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes `ActiveRecord::Associations::HasManyThroughAssociation` and `ActiveRecord::Associations:: ThroughAssociation` to support through reflections with array foreign keys.\r\n\r\n### Additional information\r\n\r\nBecause of the unpersisted record, `owner[through_reflection.foreign_key]` doesn't raise when the foreign key is an array. I wonder if that's a bug, because I don't think it should ever work. In persisted records, this raises later when we ask the database for an attribute with an array name.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48552/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48552/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48551", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48551/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48551/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48551/events", "html_url": "https://github.com/rails/rails/pull/48551", "id": 1768408935, "node_id": "PR_kwDNIULOU5axSA", "number": 48551, "title": "Document Dev Container CLI setup in guides", "user": {"login": "abaldwin88", "id": 15172605, "node_id": "MDQ6VXNlcjE1MTcyNjA1", "avatar_url": "https://avatars.githubusercontent.com/u/15172605?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abaldwin88", "html_url": "https://github.com/abaldwin88", "followers_url": "https://api.github.com/users/abaldwin88/followers", "following_url": "https://api.github.com/users/abaldwin88/following{/other_user}", "gists_url": "https://api.github.com/users/abaldwin88/gists{/gist_id}", "starred_url": "https://api.github.com/users/abaldwin88/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abaldwin88/subscriptions", "organizations_url": "https://api.github.com/users/abaldwin88/orgs", "repos_url": "https://api.github.com/users/abaldwin88/repos", "events_url": "https://api.github.com/users/abaldwin88/events{/privacy}", "received_events_url": "https://api.github.com/users/abaldwin88/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-21T20:19:13Z", "updated_at": "2023-06-21T21:13:10Z", "closed_at": "2023-06-21T21:13:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48551", "html_url": "https://github.com/rails/rails/pull/48551", "diff_url": "https://github.com/rails/rails/pull/48551.diff", "patch_url": "https://github.com/rails/rails/pull/48551.patch", "merged_at": "2023-06-21T21:13:10Z"}, "body": "### Motivation / Background\r\n\r\nI don't use VS Code, but I still like the idea of developing against a local Docker container. I found [Dev Container CLI](https://github.com/devcontainers/cli) to be a quick, easy, editor-agnostic way of diving in. Documenting this will help remove a friction point for a portion of new Rails developers.\r\n\r\nFYI - This package is mentioned by the Visual Studio [docs](https://code.visualstudio.com/docs/devcontainers/devcontainer-cli#_npm-install)", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48551/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48551/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48550", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48550/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48550/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48550/events", "html_url": "https://github.com/rails/rails/issues/48550", "id": 1768348009, "node_id": "I_kwDNIULOaWbZaQ", "number": 48550, "title": "Render from before_action does not respect request format", "user": {"login": "mikerobe", "id": 1505137, "node_id": "MDQ6VXNlcjE1MDUxMzc=", "avatar_url": "https://avatars.githubusercontent.com/u/1505137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikerobe", "html_url": "https://github.com/mikerobe", "followers_url": "https://api.github.com/users/mikerobe/followers", "following_url": "https://api.github.com/users/mikerobe/following{/other_user}", "gists_url": "https://api.github.com/users/mikerobe/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikerobe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikerobe/subscriptions", "organizations_url": "https://api.github.com/users/mikerobe/orgs", "repos_url": "https://api.github.com/users/mikerobe/repos", "events_url": "https://api.github.com/users/mikerobe/events{/privacy}", "received_events_url": "https://api.github.com/users/mikerobe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-21T19:36:57Z", "updated_at": "2023-06-26T06:34:42Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nSee https://github.com/rails/rails/issues/32179\r\n\r\nWhen a call to `render` is made from within a `before_action` in a controller, it does not respect the request format. This issue recently led to an unexpected behavior where incorrect HTML templates were being rendered for JSON requests.\r\n\r\nHere are the steps from the ticket above (created in 2018 then auto closed as stale). \r\n\r\n1. Create before_action function and run render within it:\r\n\r\n```\r\nclass BeforeController < ApplicationController\r\n  before_action :before_index\r\n\r\n  def index\r\n  end\r\n\r\n  private\r\n  def before_index\r\n    render partial: 'test'\r\n  end\r\nend\r\n```\r\n\r\n2. Create templates for html and js format: `_test.html.erb` and `_test.json.erb`\r\n3. Open index action url.\r\n\r\n### Expected behavior\r\nRender uses the format specified in the request, so if open `http://localhost:3000/before/index.html` you see _test.html.erb rendered, and if open `http://localhost:3000/before/index.json` you see _test.json.erb rendered.\r\n\r\n### Actual behavior\r\nDefault format (_test.html.erb) is being rendered. If make same render execution within index action, format specified in the request is being used.\r\n\r\n### System configuration\r\n**Rails version**: 7.0.3\r\n\r\n**Ruby version**: 3.2.2\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48550/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48550/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48549", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48549/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48549/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48549/events", "html_url": "https://github.com/rails/rails/pull/48549", "id": 1767971997, "node_id": "PR_kwDNIULOU5FRBA", "number": 48549, "title": "Qualify association unscope values with table names", "user": {"login": "philip-maina", "id": 76848245, "node_id": "MDQ6VXNlcjc2ODQ4MjQ1", "avatar_url": "https://avatars.githubusercontent.com/u/76848245?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philip-maina", "html_url": "https://github.com/philip-maina", "followers_url": "https://api.github.com/users/philip-maina/followers", "following_url": "https://api.github.com/users/philip-maina/following{/other_user}", "gists_url": "https://api.github.com/users/philip-maina/gists{/gist_id}", "starred_url": "https://api.github.com/users/philip-maina/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philip-maina/subscriptions", "organizations_url": "https://api.github.com/users/philip-maina/orgs", "repos_url": "https://api.github.com/users/philip-maina/repos", "events_url": "https://api.github.com/users/philip-maina/events{/privacy}", "received_events_url": "https://api.github.com/users/philip-maina/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-21T16:24:58Z", "updated_at": "2023-08-13T22:48:38Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48549", "html_url": "https://github.com/rails/rails/pull/48549", "diff_url": "https://github.com/rails/rails/pull/48549.diff", "patch_url": "https://github.com/rails/rails/pull/48549.patch", "merged_at": null}, "body": "### Motivation\r\n\r\nFixes #48548 \r\n\r\n### Checklist\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n- [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n- [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: [Fix #issue-number]\r\n- [x] Tests are added or updated if you fix a bug or add a feature.\r\n- [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48549/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48549/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48548", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48548/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48548/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48548/events", "html_url": "https://github.com/rails/rails/issues/48548", "id": 1767971401, "node_id": "I_kwDNIULOaWEaSQ", "number": 48548, "title": "`unscope` on `through` associations fails to respect default scope of join models", "user": {"login": "philip-maina", "id": 76848245, "node_id": "MDQ6VXNlcjc2ODQ4MjQ1", "avatar_url": "https://avatars.githubusercontent.com/u/76848245?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philip-maina", "html_url": "https://github.com/philip-maina", "followers_url": "https://api.github.com/users/philip-maina/followers", "following_url": "https://api.github.com/users/philip-maina/following{/other_user}", "gists_url": "https://api.github.com/users/philip-maina/gists{/gist_id}", "starred_url": "https://api.github.com/users/philip-maina/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philip-maina/subscriptions", "organizations_url": "https://api.github.com/users/philip-maina/orgs", "repos_url": "https://api.github.com/users/philip-maina/repos", "events_url": "https://api.github.com/users/philip-maina/events{/privacy}", "received_events_url": "https://api.github.com/users/philip-maina/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-21T16:24:31Z", "updated_at": "2023-06-30T07:56:23Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\nReproduction script:\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :users, force: true do |t|\r\n  end\r\n\r\n  create_table :posts, force: true do |t|\r\n    t.integer :user_id\r\n    t.datetime :deleted_at\r\n  end\r\n\r\n  create_table :comments, force: true do |t|\r\n    t.integer :post_id\r\n    t.datetime :deleted_at\r\n  end\r\nend\r\n\r\nclass User < ActiveRecord::Base\r\n  has_many :posts\r\n  has_many :comments, through: :posts\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  default_scope -> { where deleted_at: nil }\r\n\r\n  belongs_to :user\r\n  has_many :comments, -> { with_deleted }\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\n  default_scope -> { where deleted_at: nil }\r\n  scope :with_deleted, -> { unscope where: :deleted_at }\r\n\r\n  belongs_to :post\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_unscope_applied_on_correct_association\r\n    user = User.create!\r\n\r\n    active_post  = Post.create!(user: user)\r\n    deleted_post = Post.create!(user: user, deleted_at: Time.now)\r\n\r\n\r\n    active_post_active_comment   = Comment.create!(post: active_post)\r\n    active_post_deleted_comment  = Comment.create!(post: active_post, deleted_at: Time.now)\r\n    deleted_post_deleted_comment = Comment.create!(post: deleted_post, deleted_at: Time.now)\r\n\r\n    # Should find only 2 comments (active_post_active_comment & active_post_deleted_comment) but finds all three\r\n    assert_equal 2, user.comments.count\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\nThe test should pass and return a count of 2\r\n\r\n### Actual behavior\r\nThe test fails with a count of 3\r\n\r\n### System configuration\r\n**Rails version**: 7.0.4.3 / main\r\n\r\n**Ruby version**: 3.1.3 / 3.2.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48548/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48548/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48547", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48547/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48547/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48547/events", "html_url": "https://github.com/rails/rails/issues/48547", "id": 1767794424, "node_id": "I_kwDNIULOaV5m-A", "number": 48547, "title": "parallelize test runner broken in 7.1.0.alpha", "user": {"login": "matthutchinson", "id": 2095, "node_id": "MDQ6VXNlcjIwOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/2095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthutchinson", "html_url": "https://github.com/matthutchinson", "followers_url": "https://api.github.com/users/matthutchinson/followers", "following_url": "https://api.github.com/users/matthutchinson/following{/other_user}", "gists_url": "https://api.github.com/users/matthutchinson/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthutchinson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthutchinson/subscriptions", "organizations_url": "https://api.github.com/users/matthutchinson/orgs", "repos_url": "https://api.github.com/users/matthutchinson/repos", "events_url": "https://api.github.com/users/matthutchinson/events{/privacy}", "received_events_url": "https://api.github.com/users/matthutchinson/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/rails/rails/milestones/82", "html_url": "https://github.com/rails/rails/milestone/82", "labels_url": "https://api.github.com/repos/rails/rails/milestones/82/labels", "id": 7758309, "node_id": "MI_kwDNIULOAHZh5Q", "number": 82, "title": "7.1.0", "description": "", "creator": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "open_issues": 10, "closed_issues": 37, "state": "open", "created_at": "2022-03-11T16:33:03Z", "updated_at": "2023-08-16T15:43:36Z", "due_on": null, "closed_at": null}, "comments": 3, "created_at": "2023-06-21T14:53:28Z", "updated_at": "2023-07-06T10:45:06Z", "closed_at": "2023-07-05T15:06:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\n- Create a new app with Rails 7.1.0.alpha (edge)\r\n- Add any test (controller or model)\r\n- Run any tests in parallel with [parallelize](https://api.rubyonrails.org/classes/ActiveSupport/TestCase.html#method-c-parallelize).  I.e. to force this use the `PARALLEL_WORKERS` env var\r\n\r\n```\r\n# In a new Rails  7.1.0.alpha (edge) app\r\nbundle install\r\nrails generate scaffold HighScore game:string score:integer\r\nrails db:migrate\r\n# run any test with 2 (or more) parallel workers\r\nPARALLEL_WORKERS=2 rails test test/controllers/high_scores_controller_test.rb \r\n```\r\n\r\n**Example App**: a [simple bare bones app](https://github.com/matthutchinson/rails-edge-basic-app) with a few generated models/controllers\r\n\r\n### Expected behavior\r\n\r\nTests should run in parallel and pass\r\n\r\n### Actual behavior\r\n\r\nTests all fail with missing db table errors; E.g.\r\n\r\n    DRb::DRbRemoteError: SQLite3::SQLException: no such table: ar_internal_metadata (ActiveRecord::StatementInvalid)\r\n\r\nOr\r\n\r\n    DRb::DRbRemoteError: Could not find table 'high_scores' (ActiveRecord::StatementInvalid)\r\n\r\n### System configuration\r\n**Rails version**: 7.1.0.alpha \r\n**Ruby version**: 3.1.2\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48547/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48547/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48546", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48546/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48546/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48546/events", "html_url": "https://github.com/rails/rails/issues/48546", "id": 1767727767, "node_id": "I_kwDNIULOaV1ilw", "number": 48546, "title": "ActionRecord callback not being called when another callback makes an update", "user": {"login": "jcarloslopez", "id": 7100108, "node_id": "MDQ6VXNlcjcxMDAxMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/7100108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcarloslopez", "html_url": "https://github.com/jcarloslopez", "followers_url": "https://api.github.com/users/jcarloslopez/followers", "following_url": "https://api.github.com/users/jcarloslopez/following{/other_user}", "gists_url": "https://api.github.com/users/jcarloslopez/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcarloslopez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcarloslopez/subscriptions", "organizations_url": "https://api.github.com/users/jcarloslopez/orgs", "repos_url": "https://api.github.com/users/jcarloslopez/repos", "events_url": "https://api.github.com/users/jcarloslopez/events{/privacy}", "received_events_url": "https://api.github.com/users/jcarloslopez/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-21T14:22:57Z", "updated_at": "2023-06-27T02:20:11Z", "closed_at": "2023-06-27T02:20:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "Looks like it has to do with the update being called because if you change the update for another print both will be called\r\n\r\n### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"sqlite3\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n    t.integer :value\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  after_create_commit :this_will_never_be_called\r\n  after_create_commit :this_will_be_called\r\n\r\n  private\r\n\r\n  def this_will_never_be_called\r\n    p \"This will never be called\"\r\n  end\r\n\r\n  def this_will_be_called\r\n    update(value: 3)\r\n  end\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_output_produces_output\r\n    assert_output(/This will never be called/) { Post.create }\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\nThe first callback should be called and print the output prior to the update in the second callback.\r\n\r\n### Actual behavior\r\nThe first callback is not being called but the second one is.\r\n\r\n### System configuration\r\n**Rails version**: 7.0.3.1\r\n\r\n**Ruby version**: 3.0.2p107\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48546/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48546/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48545", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48545/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48545/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48545/events", "html_url": "https://github.com/rails/rails/issues/48545", "id": 1767455640, "node_id": "I_kwDNIULOaVk7mA", "number": 48545, "title": "Deprecated conversion introduced in Rails 7.0 is incompatible with implicit default format", "user": {"login": "wata727", "id": 9624059, "node_id": "MDQ6VXNlcjk2MjQwNTk=", "avatar_url": "https://avatars.githubusercontent.com/u/9624059?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wata727", "html_url": "https://github.com/wata727", "followers_url": "https://api.github.com/users/wata727/followers", "following_url": "https://api.github.com/users/wata727/following{/other_user}", "gists_url": "https://api.github.com/users/wata727/gists{/gist_id}", "starred_url": "https://api.github.com/users/wata727/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wata727/subscriptions", "organizations_url": "https://api.github.com/users/wata727/orgs", "repos_url": "https://api.github.com/users/wata727/repos", "events_url": "https://api.github.com/users/wata727/events{/privacy}", "received_events_url": "https://api.github.com/users/wata727/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107186, "node_id": "MDU6TGFiZWwxMDcxODY=", "url": "https://api.github.com/repos/rails/rails/labels/regression", "name": "regression", "color": "e10c02", "default": false, "description": null}, {"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-21T12:08:17Z", "updated_at": "2023-08-03T19:59:22Z", "closed_at": "2023-08-03T19:59:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\nWe are planning to upgrade an application running on Rails 6.1 to Rails 7.0. Among them, we are looking at the deprecated conversions introduced in #43772.\r\n\r\nI'm guessing this was probably designed to be backwards compatible as of Rails 7.0, but if we've added `Date::DATE_FORMATS[:default]`, the result changed in Rails 7.0.\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activesupport\", \"7.0.5\"\r\nend\r\n\r\nrequire \"active_support\"\r\nrequire \"active_support/core_ext/date\"\r\nrequire \"minitest/autorun\"\r\n\r\n# Add default format\r\nDate::DATE_FORMATS[:default] = '%Y/%m/%d'\r\n\r\nclass DateDeprecatedConversionsTest < Minitest::Test\r\n  def test_implicit_default_conversions\r\n    assert_equal Date.new(2023, 6, 21).to_s, '2023/06/21'\r\n  end\r\n\r\n  def test_explicit_default_conversions\r\n    assert_equal Date.new(2023, 6, 21).to_s(:default), '2023/06/21'\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\n\r\nThese tests are passed in Rails 6.1. So it should work on Rails 7.0 as well.\r\n\r\n```diff\r\ndiff --git a/test.rb b/test.rb\r\nindex 187c8500dd6..9cb2e93c834 100644\r\n--- a/test.rb\r\n+++ b/test.rb\r\n@@ -8,7 +8,7 @@ gemfile(true) do\r\n   git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n \r\n   # Activate the gem you are reporting the issue against.\r\n-  gem \"activesupport\", \"7.0.5\"\r\n+  gem \"activesupport\", \"6.1.7.3\"\r\n end\r\n \r\n require \"active_support\"\r\n```\r\n\r\n```\r\n# Running:\r\n\r\n..\r\n\r\nFinished in 0.001116s, 1792.1149 runs/s, 1792.1149 assertions/s.\r\n\r\n2 runs, 2 assertions, 0 failures, 0 errors, 0 skips\r\n```\r\n\r\n### Actual behavior\r\n\r\nImplicit default format does not work in Rails 7.0.\r\n\r\n```\r\n# Running:\r\n\r\nDEPRECATION WARNING: Date#to_s(:default) is deprecated. Please use Date#to_fs(:default) instead. (called from test_explicit_default_conversions at test.rb:27)\r\n.F\r\n\r\nFinished in 0.101925s, 19.6223 runs/s, 19.6223 assertions/s.\r\n\r\n  1) Failure:\r\nDateDeprecatedConversionsTest#test_implicit_default_conversions [test.rb:23]:\r\n--- expected\r\n+++ actual\r\n@@ -1,3 +1 @@\r\n-# encoding: US-ASCII\r\n-#    valid: true\r\n-\"2023-06-21\"\r\n+\"2023/06/21\"\r\n\r\n\r\n2 runs, 2 assertions, 1 failures, 0 errors, 0 skips\r\n```\r\n\r\nPerhaps calling `to_formatted_s(:default)` instead of `to_default_s` here would keep compatibility.\r\n\r\nhttps://github.com/rails/rails/blob/e88857bbb9d4e1dd64555c34541301870de4a45b/activesupport/lib/active_support/core_ext/date/deprecated_conversions.rb#L18\r\n\r\nHowever, [this conversion has been removed](https://github.com/rails/rails/commit/e420c3380eb2b698a4fe84ed196f914d18f7844a) in the main branch, and adding the `Date::DATE_FORMATS[:default]` may be undesirable behaviour (In general, I understand that this is a bad practice). I just wanted to share this behavior and discuss whether it's worth fixing it in the Rails 7.0 branch.\r\n\r\n### System configuration\r\n**Rails version**:\r\n6.1.7.3/7.0.5\r\n\r\n**Ruby version**:\r\n3.1.4\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48545/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48545/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48544", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48544/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48544/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48544/events", "html_url": "https://github.com/rails/rails/pull/48544", "id": 1767369055, "node_id": "PR_kwDNIULOU4kK-Q", "number": 48544, "title": "Get rid of unnecessary `gem \"minitest\"` calls", "user": {"login": "amatsuda", "id": 11493, "node_id": "MDQ6VXNlcjExNDkz", "avatar_url": "https://avatars.githubusercontent.com/u/11493?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amatsuda", "html_url": "https://github.com/amatsuda", "followers_url": "https://api.github.com/users/amatsuda/followers", "following_url": "https://api.github.com/users/amatsuda/following{/other_user}", "gists_url": "https://api.github.com/users/amatsuda/gists{/gist_id}", "starred_url": "https://api.github.com/users/amatsuda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amatsuda/subscriptions", "organizations_url": "https://api.github.com/users/amatsuda/orgs", "repos_url": "https://api.github.com/users/amatsuda/repos", "events_url": "https://api.github.com/users/amatsuda/events{/privacy}", "received_events_url": "https://api.github.com/users/amatsuda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-21T11:24:09Z", "updated_at": "2023-06-21T21:08:33Z", "closed_at": "2023-06-21T21:08:32Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48544", "html_url": "https://github.com/rails/rails/pull/48544", "diff_url": "https://github.com/rails/rails/pull/48544.diff", "patch_url": "https://github.com/rails/rails/pull/48544.patch", "merged_at": "2023-06-21T21:08:32Z"}, "body": "This patch simply removes unnecessary `gem` activations of minitest.\r\n\r\n### Motivation / Background\r\n\r\nminitest used to be a CRuby's stdlib from Rubies `>= 1.9.1` to `< 2.2.0`.\r\nAnd the `gem 'minitest'` call in the Rails codebase was added at 6f74d36c4263a6cbbc6dc32a03edeed04faefbd9 because at that time `require 'minitest'` could load either a gem version or the stdlib one, and we wanted to make sure not to load the stdlib minitest.\r\n\r\n2.years.since then, CRuby's bundled minitest had been removed in 2.2.0 at https://github.com/ruby/ruby/commit/7cda8222ca6fa109e531705579164f56f29f8068\r\nand now that Ruby < 2.2 is no longer supported in Rails 7, we can just safely drop this `gem \"minitest\"` call in favor of simple `require` that is already written there.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48544/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48544/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48543", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48543/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48543/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48543/events", "html_url": "https://github.com/rails/rails/issues/48543", "id": 1767071963, "node_id": "I_kwDNIULOaVNg2w", "number": 48543, "title": "ActionCable subscriptions are never created because welcome event is not received", "user": {"login": "Georgegriff", "id": 9056958, "node_id": "MDQ6VXNlcjkwNTY5NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/9056958?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Georgegriff", "html_url": "https://github.com/Georgegriff", "followers_url": "https://api.github.com/users/Georgegriff/followers", "following_url": "https://api.github.com/users/Georgegriff/following{/other_user}", "gists_url": "https://api.github.com/users/Georgegriff/gists{/gist_id}", "starred_url": "https://api.github.com/users/Georgegriff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Georgegriff/subscriptions", "organizations_url": "https://api.github.com/users/Georgegriff/orgs", "repos_url": "https://api.github.com/users/Georgegriff/repos", "events_url": "https://api.github.com/users/Georgegriff/events{/privacy}", "received_events_url": "https://api.github.com/users/Georgegriff/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 300028327, "node_id": "MDU6TGFiZWwzMDAwMjgzMjc=", "url": "https://api.github.com/repos/rails/rails/labels/actioncable", "name": "actioncable", "color": "bfdadc", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-21T08:33:29Z", "updated_at": "2023-07-05T19:50:06Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nI apologise upfront that i've not been able to produce a reproduction case, it involves some network conditions which breaks actioncable's default usage\r\n\r\nWe've been working with some of our customers who have reported our application not working as expected. The area relies on Action Cable subscriptions. We have observed the following behaviour.\r\n\r\n1. We Create ActionCable in js\r\n2. We immediately add a subscriber\r\n```js\r\nconst consumer = ActionCable.createConsumer(\"wss://...\");\r\nconsumer.subscriptions.create(\r\n            ....\r\n);\r\n```\r\n3. Server opens the connection and sends the welcome message (this is the rails code i've been looking at)\r\n4. Websocket opens, but [welcome even](https://github.com/rails/rails/blob/e446ef82c8174a4bd6c98f670912bb395b3091d6/actioncable/lib/action_cable/connection/base.rb#L188)t is never received.\r\n\r\nThe result is that subscriptions are never  reloaded - (internal actioncable code)(https://github.com/rails/rails/blob/e446ef82c8174a4bd6c98f670912bb395b3091d6/actioncable/app/assets/javascripts/actioncable.esm.js#L253) when welcome is received, which should have created the subscription.\r\n\r\nIt's possible the reason this doesn't come up more is due to some specific network conditions, but we have enough diagnostics gathered in our system to show that this is the issue, we have open websockets but no subscriptions are established.\r\n\r\nIt is possible to workaround this by creating the subscriptions in the onOpen handler of the websocket instead, but this is circumventing the design of action cable.\r\n\r\nIn our logging we have collected we have no observed any connection instability.\r\n\r\n> The logs are a combination of the action cable logs and some custom event handlers we have added to on message/open, to detect the issue.\r\n\r\n```\r\n  [\r\n    \"[ActionCable]\",\r\n    \"Opening WebSocket, current state is null, subprotocols: actioncable-v1-json,actioncable-unsupported\",\r\n    1687331929209,\r\n    \"Wed, 21 Jun 2023 07:18:49 GMT\"\r\n  ],\r\n  [\r\n    \"[ActionCable]\",\r\n    \"ConnectionMonitor started. stale threshold = 6 s\",\r\n    1687331929210,\r\n    \"Wed, 21 Jun 2023 07:18:49 GMT\"\r\n  ],\r\n  [\r\n    \"[SUCCESS]\",\r\n    \"WebSocket onopen event\",\r\n    \"Wed, 21 Jun 2023 07:18:49 GMT\"\r\n  ],\r\n  [\r\n    \"[ActionCable]\",\r\n    \"WebSocket onopen event, using 'actioncable-v1-json' subprotocol\",\r\n    1687331929446,\r\n    \"Wed, 21 Jun 2023 07:18:49 GMT\"\r\n  ],\r\n   [\r\n    \"[WARN]\",\r\n    \"Welcome not received within 20s\",\r\n    \"Wed, 21 Jun 2023 07:19:09 GMT\"\r\n  ]\r\n```\r\n(These are extracted from logs where we have put a work around in place, but we have alerting to detect if the welcome event was never received)\r\n\r\n[It's a different library but its possible that something like this might describe the issue? I'd just be guessing though\r\n](https://github.com/pocoproject/poco/issues/1212)\r\n\r\n### Expected behavior\r\nActionCable subscriptions should be initialised once the websocket has opened. The welcome should not be \"lost\"\r\n<!-- Tell us what should happen -->\r\n\r\n### Actual behavior\r\nSubscriptions never establish, websocket just is left open doing nothing.\r\n\r\n### System configuration\r\n**Rails version**:\r\n6.1.7.2\r\n\r\n[Looks like the logic that linked is broadly the same for actioncable in the version im using.\r\n](https://github.com/rails/rails/blob/8798a6f2aa95e12f37993ba3c5a80fd0ac813dbb/actioncable/lib/action_cable/connection/base.rb#L175)**Ruby version**:\r\n3.1.3\r\n**Action cable NPM version**:\r\n    \"@rails/actioncable\": \"^7.0.4-3\",\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48543/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48543/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48542", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48542/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48542/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48542/events", "html_url": "https://github.com/rails/rails/pull/48542", "id": 1767040484, "node_id": "PR_kwDNIULOU4STww", "number": 48542, "title": "Introduce `ActionMailer::FormBuilder`", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107188, "node_id": "MDU6TGFiZWwxMDcxODg=", "url": "https://api.github.com/repos/rails/rails/labels/actionmailer", "name": "actionmailer", "color": "8B00FC", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-21T08:18:50Z", "updated_at": "2023-06-21T08:20:47Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48542", "html_url": "https://github.com/rails/rails/pull/48542", "diff_url": "https://github.com/rails/rails/pull/48542.diff", "patch_url": "https://github.com/rails/rails/pull/48542.patch", "merged_at": null}, "body": "ref: https://github.com/rails/rails/issues/48477\r\n\r\nUsing forms inside emails is not common, but it's possible, and it's also possible to share views between controllers and mailers. Currently if a controller sets a `default_form_builder` that's different from the global config, mailers that use the same views will not default to the same `FormBuilder`. To fix this, this PR adds a `default_form_builder` method for mailers that does the same thing as its controller sibling.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48542/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48542/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48541", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48541/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48541/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48541/events", "html_url": "https://github.com/rails/rails/pull/48541", "id": 1766847053, "node_id": "PR_kwDNIULOU4HvDQ", "number": 48541, "title": "Add GlobalID to the API docs", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-21T06:29:25Z", "updated_at": "2023-06-21T06:36:55Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48541", "html_url": "https://github.com/rails/rails/pull/48541", "diff_url": "https://github.com/rails/rails/pull/48541.diff", "patch_url": "https://github.com/rails/rails/pull/48541.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nGlobalID is a dependency of Active Job and Action Text. It adds `to_gid` and `to_sgid` methods to Active Model and Active Record classes.\r\n\r\nTrying to find the documentation of these methods can be confusing as they are not present in the API docs.\r\n\r\n### Detail\r\n\r\nBy symlinking the globalid gem from the Gemfile we can include it in the API documentation. After the `rdoc` task has run we can remove the symlink. I'd prefer to remove to symlink in an `ensure` block but that doesn't seem to be supported by Rake.\r\n\r\n### Additional information\r\n\r\nThis could also be used to add all the `turbo-rails` methods to the API docs, like ` broadcast_append_to`  and `turbo_stream_from` (that is used in video demo on https://rubyonrails.org/.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48541/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48541/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48540", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48540/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48540/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48540/events", "html_url": "https://github.com/rails/rails/pull/48540", "id": 1766832528, "node_id": "PR_kwDNIULOU4G83Q", "number": 48540, "title": "Added Dockerfile instructions to remove artifacts and node_modules", "user": {"login": "igor-alexandrov", "id": 100725, "node_id": "MDQ6VXNlcjEwMDcyNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/100725?v=4", "gravatar_id": "", "url": "https://api.github.com/users/igor-alexandrov", "html_url": "https://github.com/igor-alexandrov", "followers_url": "https://api.github.com/users/igor-alexandrov/followers", "following_url": "https://api.github.com/users/igor-alexandrov/following{/other_user}", "gists_url": "https://api.github.com/users/igor-alexandrov/gists{/gist_id}", "starred_url": "https://api.github.com/users/igor-alexandrov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/igor-alexandrov/subscriptions", "organizations_url": "https://api.github.com/users/igor-alexandrov/orgs", "repos_url": "https://api.github.com/users/igor-alexandrov/repos", "events_url": "https://api.github.com/users/igor-alexandrov/events{/privacy}", "received_events_url": "https://api.github.com/users/igor-alexandrov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-21T06:16:44Z", "updated_at": "2023-06-21T07:32:04Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48540", "html_url": "https://github.com/rails/rails/pull/48540", "diff_url": "https://github.com/rails/rails/pull/48540.diff", "patch_url": "https://github.com/rails/rails/pull/48540.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nI've tested Rails 7.1 Dockerfile template in Rails 7.0 app with MRSK on GitHub Actions and found that a bit more optimization can be applied.\r\n\r\n### Detail\r\n\r\nThis Pull Request adds minor optimization to dockerignore template.\r\n\r\nDuring the build process, the setup-ruby@v1 GitHub Action leaves artifacts in the ~/vendor/bundle folder, resulting in two full bundles in the final build: one in the default /usr/local/bundle directory specified in the Dockerfile template, and another in the /rails/vendor/bundle directory. By ignoring the /rails/vendor/bundle directory, we can significantly reduce the size of the final image. \r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48540/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48540/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48539", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48539/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48539/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48539/events", "html_url": "https://github.com/rails/rails/pull/48539", "id": 1766635820, "node_id": "PR_kwDNIULOU3-UnA", "number": 48539, "title": "Add support for nullifying composite primary key has_one associations", "user": {"login": "gmcgibbon", "id": 5162312, "node_id": "MDQ6VXNlcjUxNjIzMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5162312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gmcgibbon", "html_url": "https://github.com/gmcgibbon", "followers_url": "https://api.github.com/users/gmcgibbon/followers", "following_url": "https://api.github.com/users/gmcgibbon/following{/other_user}", "gists_url": "https://api.github.com/users/gmcgibbon/gists{/gist_id}", "starred_url": "https://api.github.com/users/gmcgibbon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gmcgibbon/subscriptions", "organizations_url": "https://api.github.com/users/gmcgibbon/orgs", "repos_url": "https://api.github.com/users/gmcgibbon/repos", "events_url": "https://api.github.com/users/gmcgibbon/events{/privacy}", "received_events_url": "https://api.github.com/users/gmcgibbon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-21T03:59:45Z", "updated_at": "2023-06-21T20:05:36Z", "closed_at": "2023-06-21T18:33:41Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48539", "html_url": "https://github.com/rails/rails/pull/48539", "diff_url": "https://github.com/rails/rails/pull/48539.diff", "patch_url": "https://github.com/rails/rails/pull/48539.patch", "merged_at": "2023-06-21T18:33:41Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because `has_one` CPK associations with `dependent: :nullify` don't currently work.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes the nullification code in `ActiveRecord::Associations::HasOneAssociation` to iterate through foreign key columns and nullify them if they don't belong to the model's primary keys.\r\n\r\n### Additional information\r\n\r\nI had to add an extra test model to make a scenario where part of a composite primary key shouldn't be nullified. Does it make sense?\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48539/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48539/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48538", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48538/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48538/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48538/events", "html_url": "https://github.com/rails/rails/pull/48538", "id": 1766634165, "node_id": "PR_kwDNIULOU3-OyA", "number": 48538, "title": "Support queries with regular expressions", "user": {"login": "lazaronixon", "id": 2651240, "node_id": "MDQ6VXNlcjI2NTEyNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/2651240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lazaronixon", "html_url": "https://github.com/lazaronixon", "followers_url": "https://api.github.com/users/lazaronixon/followers", "following_url": "https://api.github.com/users/lazaronixon/following{/other_user}", "gists_url": "https://api.github.com/users/lazaronixon/gists{/gist_id}", "starred_url": "https://api.github.com/users/lazaronixon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lazaronixon/subscriptions", "organizations_url": "https://api.github.com/users/lazaronixon/orgs", "repos_url": "https://api.github.com/users/lazaronixon/repos", "events_url": "https://api.github.com/users/lazaronixon/events{/privacy}", "received_events_url": "https://api.github.com/users/lazaronixon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-21T03:57:38Z", "updated_at": "2023-06-22T06:37:41Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48538", "html_url": "https://github.com/rails/rails/pull/48538", "diff_url": "https://github.com/rails/rails/pull/48538.diff", "patch_url": "https://github.com/rails/rails/pull/48538.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nSupport queries with regular expressions on supported databases. (PostgreSQL/MySQL/SQLite)\r\n\r\n```ruby\r\nPost.where(title: /ThInKiNg/)\r\n#=> SELECT * FROM posts WHERE title REGEXP 'ThInKiNg'; --MySQL/SQLite\r\n#=> SELECT * FROM posts WHERE title ~* 'ThInKiNg'; --PostgreSQL\r\n\r\nPost.where.not(title: /ThInKiNg/)\r\n#=> SELECT * FROM posts WHERE title NOT REGEXP 'ThInKiNg'; --MySQL/SQLite\r\n#=> SELECT * FROM posts WHERE title !~* 'ThInKiNg'; --PostgreSQL    \r\n```\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48538/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48538/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48537", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48537/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48537/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48537/events", "html_url": "https://github.com/rails/rails/pull/48537", "id": 1766517039, "node_id": "PR_kwDNIULOU338Mg", "number": 48537, "title": "Update CHANGELOG.md", "user": {"login": "brandondrew", "id": 9854, "node_id": "MDQ6VXNlcjk4NTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/9854?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brandondrew", "html_url": "https://github.com/brandondrew", "followers_url": "https://api.github.com/users/brandondrew/followers", "following_url": "https://api.github.com/users/brandondrew/following{/other_user}", "gists_url": "https://api.github.com/users/brandondrew/gists{/gist_id}", "starred_url": "https://api.github.com/users/brandondrew/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brandondrew/subscriptions", "organizations_url": "https://api.github.com/users/brandondrew/orgs", "repos_url": "https://api.github.com/users/brandondrew/repos", "events_url": "https://api.github.com/users/brandondrew/events{/privacy}", "received_events_url": "https://api.github.com/users/brandondrew/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-21T01:32:14Z", "updated_at": "2023-06-23T05:08:37Z", "closed_at": "2023-06-21T05:27:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48537", "html_url": "https://github.com/rails/rails/pull/48537", "diff_url": "https://github.com/rails/rails/pull/48537.diff", "patch_url": "https://github.com/rails/rails/pull/48537.patch", "merged_at": null}, "body": "This corrects `intersect` with `intersects` (the actual name of the method) as per this comment here: https://github.com/rails/rails/pull/47670/files#r1236168967\r\n\r\n### Motivation / Background\r\n\r\nThe method is incorrectly listed in the change log without an 's'.  This is likely to cause bugs as people look at documentation more frequently than source code for method names.\r\n\r\nhttps://github.com/john-h-k/rails/blob/c837ae624bc96f46b49f4656c76cd935591a8a3f/activerecord/lib/active_record/relation/delegation.rb\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48537/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48537/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48536", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48536/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48536/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48536/events", "html_url": "https://github.com/rails/rails/pull/48536", "id": 1766315312, "node_id": "PR_kwDNIULOU3vy9g", "number": 48536, "title": "Disallow `id` as an enum value in Active Record (v2)", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-20T22:57:53Z", "updated_at": "2023-06-20T23:26:31Z", "closed_at": "2023-06-20T23:17:18Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48536", "html_url": "https://github.com/rails/rails/pull/48536", "diff_url": "https://github.com/rails/rails/pull/48536.diff", "patch_url": "https://github.com/rails/rails/pull/48536.patch", "merged_at": "2023-06-20T23:17:18Z"}, "body": "Second attempt at https://github.com/rails/rails/pull/48527\r\n\r\nThis was reverted in https://github.com/rails/rails/pull/48534 because the call to `primary_key` broke railties tests.\r\n\r\nThe original issue was caused by a call to `#id` [here](https://github.com/rails/rails/blob/51f2e2f80b86e0c3769cf5272b7d97035730f19d/activerecord/lib/active_record/relation/predicate_builder.rb#L58). So I think it is fine for this check to only run where the value is `\"id\"`, as opposed to for any primary key.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48536/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48536/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48535", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48535/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48535/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48535/events", "html_url": "https://github.com/rails/rails/issues/48535", "id": 1766266191, "node_id": "I_kwDNIULOaUcVTw", "number": 48535, "title": "Change in ActiveRecord JSON/JSONB Query Behavior from Rails 6.0 to 6.1", "user": {"login": "JohnAnon9771", "id": 42195321, "node_id": "MDQ6VXNlcjQyMTk1MzIx", "avatar_url": "https://avatars.githubusercontent.com/u/42195321?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnAnon9771", "html_url": "https://github.com/JohnAnon9771", "followers_url": "https://api.github.com/users/JohnAnon9771/followers", "following_url": "https://api.github.com/users/JohnAnon9771/following{/other_user}", "gists_url": "https://api.github.com/users/JohnAnon9771/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnAnon9771/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnAnon9771/subscriptions", "organizations_url": "https://api.github.com/users/JohnAnon9771/orgs", "repos_url": "https://api.github.com/users/JohnAnon9771/repos", "events_url": "https://api.github.com/users/JohnAnon9771/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnAnon9771/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 126910270, "node_id": "MDU6TGFiZWwxMjY5MTAyNzA=", "url": "https://api.github.com/repos/rails/rails/labels/With%20reproduction%20steps", "name": "With reproduction steps", "color": "009800", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-06-20T22:03:23Z", "updated_at": "2023-06-26T16:19:42Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Steps to reproduce\r\nIn Rails 6.0, create a query on a JSON/JSONB column in PostgreSQL using an array of hashes:\r\n\r\n```ruby\r\nstore_ids = [{ \"store_id\" => 7 }, { \"store_id\" => 8 }]\r\nwhere(dimensions: store_ids) # This works as expected in Rails 6.0\r\n```\r\n\r\nThen, run the same query in Rails 6.1:\r\n\r\n```ruby\r\nstore_ids = [{ \"store_id\" => 7 }, { \"store_id\" => 8 }]\r\nwhere(dimensions: store_ids) # This returns [] in Rails 6.1\r\n```\r\n\r\n### Expected behavior\r\nThe query should return the same results in Rails 6.1 as it did in Rails 6.0. The ActiveRecord should convert the array of hashes into a JSON representation that PostgreSQL can understand.\r\n\r\n### Actual behavior\r\nIn Rails 6.1, the query returns an empty array. It appears that ActiveRecord is no longer converting the array of hashes into a JSON representation that PostgreSQL can understand.\r\n\r\nAs a workaround, I've had to convert the store IDs into strings and use PostgreSQL's `->>` operator syntax:\r\n\r\n```ruby\r\nstore_ids = [7, 8].map(&:to_s)\r\nwhere(\"dimensions->>'store_id' in (?)\", store_ids) # This works as expected in Rails 6.1\r\n```\r\n\r\n### System configuration\r\n**Rails version**: 6.1\r\n\r\n**Ruby version**: 2.7.7", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48535/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48535/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48534", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48534/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48534/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48534/events", "html_url": "https://github.com/rails/rails/pull/48534", "id": 1766254117, "node_id": "PR_kwDNIULOU3s1eA", "number": 48534, "title": "Revert \"Merge pull request #48527 from ghiculescu/active-record-enum-id\"", "user": {"login": "skipkayhil", "id": 6014046, "node_id": "MDQ6VXNlcjYwMTQwNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/6014046?v=4", "gravatar_id": "", "url": "https://api.github.com/users/skipkayhil", "html_url": "https://github.com/skipkayhil", "followers_url": "https://api.github.com/users/skipkayhil/followers", "following_url": "https://api.github.com/users/skipkayhil/following{/other_user}", "gists_url": "https://api.github.com/users/skipkayhil/gists{/gist_id}", "starred_url": "https://api.github.com/users/skipkayhil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/skipkayhil/subscriptions", "organizations_url": "https://api.github.com/users/skipkayhil/orgs", "repos_url": "https://api.github.com/users/skipkayhil/repos", "events_url": "https://api.github.com/users/skipkayhil/events{/privacy}", "received_events_url": "https://api.github.com/users/skipkayhil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-06-20T21:56:51Z", "updated_at": "2023-06-21T00:25:53Z", "closed_at": "2023-06-20T22:41:12Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48534", "html_url": "https://github.com/rails/rails/pull/48534", "diff_url": "https://github.com/rails/rails/pull/48534.diff", "patch_url": "https://github.com/rails/rails/pull/48534.patch", "merged_at": "2023-06-20T22:41:12Z"}, "body": "### Motivation / Background\r\n\r\nRailties tests have been failing since this change. The issue is that calling `primary_key` as the model is loaded requires either a connection to the database or a populated schema cache. This becomes an issue when an app loads models that do not have underlying tables, as shown in the failing Railties tests.\r\n\r\nWhen eager loading an app using `rails/all`, `ActionMailbox::InboundEmail` will be loaded whether or not `rails g action_mailbox:install` has been run. This means the `primary_key` for `InboundEmail` will not be in the schema cache and a database connection will be required to boot the app.\r\n\r\n### Detail\r\n\r\nThis reverts commit 8b36095881435e996db16604c52737e144b6bff3, reversing changes made to e05245db878077097d666f7667c0f9057f767583.\r\n\r\n### Additional information\r\n\r\nExample failures:\r\n- https://buildkite.com/rails/rails/builds/97331\r\n- https://buildkite.com/rails/rails/builds/97331#0188d9b0-1307-4136-b53c-2df31ee7d6ac/1224-1234\r\n\r\nRef #48524\r\nRef #48527\r\n\r\ncc @ghiculescu @guilleiguaran\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48534/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48534/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48533", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48533/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48533/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48533/events", "html_url": "https://github.com/rails/rails/pull/48533", "id": 1765797832, "node_id": "PR_kwDNIULOU3WCWg", "number": 48533, "title": "Call proxy methods from `alias_attribute` generated methods", "user": {"login": "nvasilevski", "id": 5512772, "node_id": "MDQ6VXNlcjU1MTI3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/5512772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nvasilevski", "html_url": "https://github.com/nvasilevski", "followers_url": "https://api.github.com/users/nvasilevski/followers", "following_url": "https://api.github.com/users/nvasilevski/following{/other_user}", "gists_url": "https://api.github.com/users/nvasilevski/gists{/gist_id}", "starred_url": "https://api.github.com/users/nvasilevski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nvasilevski/subscriptions", "organizations_url": "https://api.github.com/users/nvasilevski/orgs", "repos_url": "https://api.github.com/users/nvasilevski/repos", "events_url": "https://api.github.com/users/nvasilevski/events{/privacy}", "received_events_url": "https://api.github.com/users/nvasilevski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107190, "node_id": "MDU6TGFiZWwxMDcxOTA=", "url": "https://api.github.com/repos/rails/rails/labels/activemodel", "name": "activemodel", "color": "00E5FF", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "matthewd", "id": 1034, "node_id": "MDQ6VXNlcjEwMzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1034?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewd", "html_url": "https://github.com/matthewd", "followers_url": "https://api.github.com/users/matthewd/followers", "following_url": "https://api.github.com/users/matthewd/following{/other_user}", "gists_url": "https://api.github.com/users/matthewd/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewd/subscriptions", "organizations_url": "https://api.github.com/users/matthewd/orgs", "repos_url": "https://api.github.com/users/matthewd/repos", "events_url": "https://api.github.com/users/matthewd/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewd/received_events", "type": "User", "site_admin": true}, "assignees": [{"login": "matthewd", "id": 1034, "node_id": "MDQ6VXNlcjEwMzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1034?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewd", "html_url": "https://github.com/matthewd", "followers_url": "https://api.github.com/users/matthewd/followers", "following_url": "https://api.github.com/users/matthewd/following{/other_user}", "gists_url": "https://api.github.com/users/matthewd/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewd/subscriptions", "organizations_url": "https://api.github.com/users/matthewd/orgs", "repos_url": "https://api.github.com/users/matthewd/repos", "events_url": "https://api.github.com/users/matthewd/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewd/received_events", "type": "User", "site_admin": true}, {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/rails/rails/milestones/82", "html_url": "https://github.com/rails/rails/milestone/82", "labels_url": "https://api.github.com/repos/rails/rails/milestones/82/labels", "id": 7758309, "node_id": "MI_kwDNIULOAHZh5Q", "number": 82, "title": "7.1.0", "description": "", "creator": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "open_issues": 10, "closed_issues": 37, "state": "open", "created_at": "2022-03-11T16:33:03Z", "updated_at": "2023-08-16T15:43:36Z", "due_on": null, "closed_at": null}, "comments": 8, "created_at": "2023-06-20T17:00:43Z", "updated_at": "2023-07-25T15:37:13Z", "closed_at": "2023-07-21T12:08:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48533", "html_url": "https://github.com/rails/rails/pull/48533", "diff_url": "https://github.com/rails/rails/pull/48533.diff", "patch_url": "https://github.com/rails/rails/pull/48533.patch", "merged_at": "2023-07-21T12:08:30Z"}, "body": "This commit changes bodies of methods generated by `alias_attribute` on Active Record objects.\r\n\r\nPreviously the body of the `alias_attribute :new_title, :title` was `def new_title; title; end`. This commit changes it to `def new_title; attribute(\"title\"); end`.\r\n\r\nThis allows for `alias_attribute` to be used to alias attributes named with a reserved names like `id`:\r\n```ruby\r\n  class Topic < ActiveRecord::Base\r\n    self.primary_key = :title\r\n    alias_attribute :id_value, :id\r\n  end\r\n\r\n  Topic.new.id_value # => 1\r\n```\r\n\r\n## Implementation details\r\n\r\n### Body generation\r\n\r\nMost of the methods for the alias attribute will now be generated by `define_proxy_call` unless the model redefines the `target_name` attribute method, for example:\r\n```ruby\r\nclass Post < ApplicationRecord\r\n alias_attribute :subject, :title\r\n\r\n def title_was\r\n  ...\r\n end\r\n```\r\n\r\nwill issue a deprecation warning that asks for the `subject_was` to be overridden as well since next version of Rails will not make `subject_was` method to call into the `title_was`. This is a very unlikely situation and I genuinely expect no applications to ever see the deprecation warning but still something that does require a deprecation cycle. \r\n\r\n\r\n### Active Model changes\r\n\r\nEven though we don't change the behavior of the Active Model alias attribute definition there are some code changes in this PR that were made to share some common code between Active Model and Active Record. If you find this unnecessary complicated feel free to speak up and we can consider an alternative which means no changes to Active Model but more duplication in Active Record. Some of the duplication will go away though when deprecation is removed\r\n\r\n ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48533/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48533/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48532", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48532/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48532/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48532/events", "html_url": "https://github.com/rails/rails/pull/48532", "id": 1765710402, "node_id": "PR_kwDNIULOU3Rgeg", "number": 48532, "title": "Fix devcontainer trilogy connection for tests", "user": {"login": "abaldwin88", "id": 15172605, "node_id": "MDQ6VXNlcjE1MTcyNjA1", "avatar_url": "https://avatars.githubusercontent.com/u/15172605?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abaldwin88", "html_url": "https://github.com/abaldwin88", "followers_url": "https://api.github.com/users/abaldwin88/followers", "following_url": "https://api.github.com/users/abaldwin88/following{/other_user}", "gists_url": "https://api.github.com/users/abaldwin88/gists{/gist_id}", "starred_url": "https://api.github.com/users/abaldwin88/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abaldwin88/subscriptions", "organizations_url": "https://api.github.com/users/abaldwin88/orgs", "repos_url": "https://api.github.com/users/abaldwin88/repos", "events_url": "https://api.github.com/users/abaldwin88/events{/privacy}", "received_events_url": "https://api.github.com/users/abaldwin88/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-20T16:02:15Z", "updated_at": "2023-06-20T16:40:42Z", "closed_at": "2023-06-20T16:40:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48532", "html_url": "https://github.com/rails/rails/pull/48532", "diff_url": "https://github.com/rails/rails/pull/48532.diff", "patch_url": "https://github.com/rails/rails/pull/48532.patch", "merged_at": "2023-06-20T16:40:41Z"}, "body": "Previously, executing Active Record tests against the trilogy adapter within a devcontainer would fail with the error message:\r\n\r\n```\r\nTrilogy::SyscallError::ENOENT: No such file or directory - trilogy_connect\r\n- unable to connect to /tmp/mysql.sock (ActiveRecord::StatementInvalid)\r\n```", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48532/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48532/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48531", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48531/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48531/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48531/events", "html_url": "https://github.com/rails/rails/pull/48531", "id": 1765654298, "node_id": "PR_kwDNIULOU3Osuw", "number": 48531, "title": "Fix unscope with multiple not conditions", "user": {"login": "lazaronixon", "id": 2651240, "node_id": "MDQ6VXNlcjI2NTEyNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/2651240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lazaronixon", "html_url": "https://github.com/lazaronixon", "followers_url": "https://api.github.com/users/lazaronixon/followers", "following_url": "https://api.github.com/users/lazaronixon/following{/other_user}", "gists_url": "https://api.github.com/users/lazaronixon/gists{/gist_id}", "starred_url": "https://api.github.com/users/lazaronixon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lazaronixon/subscriptions", "organizations_url": "https://api.github.com/users/lazaronixon/orgs", "repos_url": "https://api.github.com/users/lazaronixon/repos", "events_url": "https://api.github.com/users/lazaronixon/events{/privacy}", "received_events_url": "https://api.github.com/users/lazaronixon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-20T15:29:58Z", "updated_at": "2023-06-21T14:59:52Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48531", "html_url": "https://github.com/rails/rails/pull/48531", "diff_url": "https://github.com/rails/rails/pull/48531.diff", "patch_url": "https://github.com/rails/rails/pull/48531.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nFix unscope with multiple not conditions\r\n\r\nBefore:\r\n```ruby\r\nPost.where.not(body: \"hello\", title: \"sti me\").unscope(where: :title)\r\n#=> SELECT * FROM posts WHERE NOT (body = 'hello' AND title = 'sti me')\r\n```\r\n\r\nLater:\r\n```ruby\r\nPost.where.not(body: \"hello\", title: \"sti me\").unscope(where: :title)\r\n#=> SELECT * FROM posts WHERE NOT (body = 'hello')\r\n```\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48531/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48531/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48530", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48530/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48530/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48530/events", "html_url": "https://github.com/rails/rails/pull/48530", "id": 1765439665, "node_id": "PR_kwDNIULOU3DSBw", "number": 48530, "title": "Add a encryption option to support previous data encrypted non-deterministically with a SHA1 hash digest", "user": {"login": "jorgemanrubia", "id": 129938, "node_id": "MDQ6VXNlcjEyOTkzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/129938?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jorgemanrubia", "html_url": "https://github.com/jorgemanrubia", "followers_url": "https://api.github.com/users/jorgemanrubia/followers", "following_url": "https://api.github.com/users/jorgemanrubia/following{/other_user}", "gists_url": "https://api.github.com/users/jorgemanrubia/gists{/gist_id}", "starred_url": "https://api.github.com/users/jorgemanrubia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jorgemanrubia/subscriptions", "organizations_url": "https://api.github.com/users/jorgemanrubia/orgs", "repos_url": "https://api.github.com/users/jorgemanrubia/repos", "events_url": "https://api.github.com/users/jorgemanrubia/events{/privacy}", "received_events_url": "https://api.github.com/users/jorgemanrubia/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}, {"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 19, "created_at": "2023-06-20T13:42:22Z", "updated_at": "2023-06-26T15:41:49Z", "closed_at": "2023-06-25T08:16:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48530", "html_url": "https://github.com/rails/rails/pull/48530", "diff_url": "https://github.com/rails/rails/pull/48530.diff", "patch_url": "https://github.com/rails/rails/pull/48530.patch", "merged_at": "2023-06-25T08:16:22Z"}, "body": "This adds a new Active Record encryption option to support previous data encrypted non-deterministically with a SHA1 hash digest.\r\n\r\nThere is currently a problem with Active Record encryption for users updating from 7.0 to 7.1 Before #44873, data encrypted with non-deterministic encryption was always using SHA-1. The reason is that `ActiveSupport::KeyGenerator.hash_digest_class` was set in an `after_initialize` block in the railtie config, but encryption config was running before that, so it was effectively using the previous default SHA1. That means that existing users are using SHA256 for non deterministic encryption, and SHA1 for deterministic encryption.\r\n\r\nThis adds a new option `support_sha1_for_non_deterministic_encryption` that users can enable to support for SHA1 and SHA256 when decrypting existing data.\r\n\r\nThe new option will kick-in by default for versions prior to 7.1. The idea is that:\r\n\r\n- Existing users updating from 7.0, won't have to set it, as it will get enabled by default.\r\n- Users starting with 7.1 will have the option disabled.\r\n\r\nThis also improves the initialization system for AR encryption to make it more robust. It will now happen after all the initializers have run, and the system to declare filtered attributes will work with different load orders.\r\n\r\nBig thanks to @duduribeiro for the thorough investigation and debugging here, as he was the one identifying the issue and who explored alternatives to fix the problem (see #48520). I added him as the co-author of the commit I ported from that PR.\r\n\r\nPending: \r\n\r\n- [x] Validate patch in real scenarios\r\n- [x] Update new framework default initializer\r\n- [x] Update CHANGELOG\r\n- [x] Update documentation\r\n- [x] Suite passing\r\n\r\nFixes https://github.com/rails/rails/issues/48204. \r\nCloses https://github.com/rails/rails/pull/48520.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48530/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48530/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48528", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48528/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48528/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48528/events", "html_url": "https://github.com/rails/rails/issues/48528", "id": 1764558038, "node_id": "I_kwDNIULOaS0E1g", "number": 48528, "title": "Should ActionDispatch::Executor be moved higher up the middleware stack?", "user": {"login": "KJTsanaktsidis", "id": 1418177, "node_id": "MDQ6VXNlcjE0MTgxNzc=", "avatar_url": "https://avatars.githubusercontent.com/u/1418177?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KJTsanaktsidis", "html_url": "https://github.com/KJTsanaktsidis", "followers_url": "https://api.github.com/users/KJTsanaktsidis/followers", "following_url": "https://api.github.com/users/KJTsanaktsidis/following{/other_user}", "gists_url": "https://api.github.com/users/KJTsanaktsidis/gists{/gist_id}", "starred_url": "https://api.github.com/users/KJTsanaktsidis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KJTsanaktsidis/subscriptions", "organizations_url": "https://api.github.com/users/KJTsanaktsidis/orgs", "repos_url": "https://api.github.com/users/KJTsanaktsidis/repos", "events_url": "https://api.github.com/users/KJTsanaktsidis/events{/privacy}", "received_events_url": "https://api.github.com/users/KJTsanaktsidis/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-06-20T03:38:25Z", "updated_at": "2023-06-20T10:40:55Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n\r\nCurrently, the `ActionDispatch::HostAuthorization` and `ActionDispatch::Static` middlewares, amongst others, are ordered before `ActionDispatch::Executor`. Let's say we want to include a custom middleware to instrument requests. This middleware should go before `HostAuthorization` and `Static`, because we want to instrument requests which fail host authorization or hit static files; on the other hand, they should go after `Executor` because the [threading and code execution](https://guides.rubyonrails.org/threading_and_code_execution.html) rails guide says that user code should be wrapped in an Executor.\r\n\r\nI suspect this might cause problems with the autoloader not working on such middleware, but actually there is another practical problem with including the instrumentation before `Executor`. If the instrumentation middleware wants to use a `ActiveSupport::CurrentAttributes` class, the values stored in there are cleared when the executor middleware calls the `run` callbacks.\r\n\r\n### Expected behavior\r\nI believe the Executor middleware should come first, perhaps? The only reason I can think of not to do this is an efficiency concern of booting up the executor unnecessarily for serving static files without user code intervention. \r\n\r\n* Is there any reason I shouldn't re-order this middleware in my own app?\r\n* Would this be something that should be changed in Rails by default?\r\n\r\n\r\n### Actual behavior\r\nAny values stored in `ActiveSupport::CurrentAttributes` in middlewares before `Executor` are cleared when Executor is run.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48528/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48528/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48527", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48527/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48527/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48527/events", "html_url": "https://github.com/rails/rails/pull/48527", "id": 1764454090, "node_id": "PR_kwDNIULOU2OcFQ", "number": 48527, "title": "Disallow `id` as an enum value in Active Record", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-20T01:17:48Z", "updated_at": "2023-06-20T02:50:53Z", "closed_at": "2023-06-20T02:36:43Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48527", "html_url": "https://github.com/rails/rails/pull/48527", "diff_url": "https://github.com/rails/rails/pull/48527.diff", "patch_url": "https://github.com/rails/rails/pull/48527.patch", "merged_at": "2023-06-20T02:36:43Z"}, "body": "Fixes https://github.com/rails/rails/issues/48524\r\n\r\nThe test case in the issue breaks because `value.respond_to?(:id)` returns true [here](https://github.com/rails/rails/blob/51f2e2f80b86e0c3769cf5272b7d97035730f19d/activerecord/lib/active_record/relation/predicate_builder.rb#L58). This effectively adds a default scope to queries where it shouldn't.\r\n\r\nThere might be a way to fix this in Active Record but I'd be surprised if nothing else breaks from defining `id` instance and class methods. I think it is simpler to not allow it as a value since it really should be treated as a reserved method.\r\n\r\nYou can use `_prefix: true` to work around this if you want to use `id` as a value.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48527/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48527/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48526", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48526/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48526/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48526/events", "html_url": "https://github.com/rails/rails/pull/48526", "id": 1764381036, "node_id": "PR_kwDNIULOU2LCzg", "number": 48526, "title": "Update Active Job testing guide", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}, {"id": 123812746, "node_id": "MDU6TGFiZWwxMjM4MTI3NDY=", "url": "https://api.github.com/repos/rails/rails/labels/activejob", "name": "activejob", "color": "5319e7", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-06-19T23:59:49Z", "updated_at": "2023-06-21T06:13:49Z", "closed_at": "2023-06-21T05:38:31Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48526", "html_url": "https://github.com/rails/rails/pull/48526", "diff_url": "https://github.com/rails/rails/pull/48526.diff", "patch_url": "https://github.com/rails/rails/pull/48526.patch", "merged_at": "2023-06-21T05:38:31Z"}, "body": "The testing guide for Active Job currently implies that when you queue a job it will be performed:\r\n\r\n![image](https://github.com/rails/rails/assets/509837/c864a0c2-ec53-45bb-9991-e8f55fb74ce6)\r\n\r\n\r\nThis isn't true; by default jobs are enqueued, not performed.\r\n\r\nThis PR fleshes out the docs a bit to show both examples, and adds a test to confirm the default behaviour.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48526/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48526/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48525", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48525/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48525/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48525/events", "html_url": "https://github.com/rails/rails/issues/48525", "id": 1764376736, "node_id": "I_kwDNIULOaSpAoA", "number": 48525, "title": "Action View `actionview: rake test:ujs` gets `ERROR: 127`", "user": {"login": "yahonda", "id": 73684, "node_id": "MDQ6VXNlcjczNjg0", "avatar_url": "https://avatars.githubusercontent.com/u/73684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yahonda", "html_url": "https://github.com/yahonda", "followers_url": "https://api.github.com/users/yahonda/followers", "following_url": "https://api.github.com/users/yahonda/following{/other_user}", "gists_url": "https://api.github.com/users/yahonda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yahonda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yahonda/subscriptions", "organizations_url": "https://api.github.com/users/yahonda/orgs", "repos_url": "https://api.github.com/users/yahonda/repos", "events_url": "https://api.github.com/users/yahonda/events{/privacy}", "received_events_url": "https://api.github.com/users/yahonda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}, {"id": 776781281, "node_id": "MDU6TGFiZWw3NzY3ODEyODE=", "url": "https://api.github.com/repos/rails/rails/labels/ci%20issues", "name": "ci issues", "color": "aaafff", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-06-19T23:56:21Z", "updated_at": "2023-06-21T02:13:20Z", "closed_at": "2023-06-21T02:13:20Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Managed to reproduce CI error since https://buildkite.com/rails/rails/builds/97157#0188bbe5-70da-4702-8617-4de08ad34ece/1090-1091\r\n\r\n### Steps to reproduce\r\n\r\n```ruby\r\n$ git clone https://github.com/rails/rails.git\r\n$ cd rails\r\n$ git clone https://github.com/rails/buildkite-config .buildkite/\r\n$ RUBY_IMAGE=ruby:3.2 docker-compose -f .buildkite/docker-compose.yml build base \\\r\n&& CI=1 docker-compose -f .buildkite/docker-compose.yml run -e PRE_STEPS -e RACK --rm actionview runner actionview 'rake test:ujs'\r\n```\r\n\r\n### Expected behavior\r\nIt should finish successfully\r\n\r\n### Actual behavior\r\nIt gets `ERROR: 127` . Here is the entire output.\r\nhttps://gist.github.com/yahonda/8384471b51c204ffab363fa471eea25f\r\n\r\n### System configuration\r\n**Rails version**: main branch\r\n\r\n**Ruby version**: 3.2.2p53 (2023-03-30 revision e51014f9c05aa65cbf203442d37fef7c12390015) [x86_64-linux]\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48525/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48525/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48524", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48524/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48524/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48524/events", "html_url": "https://github.com/rails/rails/issues/48524", "id": 1764314766, "node_id": "I_kwDNIULOaSlOjg", "number": 48524, "title": "Usage of `id` enum key results in unexpected filter with joins and subqueries", "user": {"login": "nmichels", "id": 10784799, "node_id": "MDQ6VXNlcjEwNzg0Nzk5", "avatar_url": "https://avatars.githubusercontent.com/u/10784799?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nmichels", "html_url": "https://github.com/nmichels", "followers_url": "https://api.github.com/users/nmichels/followers", "following_url": "https://api.github.com/users/nmichels/following{/other_user}", "gists_url": "https://api.github.com/users/nmichels/gists{/gist_id}", "starred_url": "https://api.github.com/users/nmichels/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nmichels/subscriptions", "organizations_url": "https://api.github.com/users/nmichels/orgs", "repos_url": "https://api.github.com/users/nmichels/repos", "events_url": "https://api.github.com/users/nmichels/events{/privacy}", "received_events_url": "https://api.github.com/users/nmichels/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-19T22:42:25Z", "updated_at": "2023-06-20T02:36:44Z", "closed_at": "2023-06-20T02:36:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n<!-- (Guidelines for creating a bug report are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report)) -->\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"sqlite3\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :offers, force: true do |t|\r\n    t.string :status\r\n    t.integer :account_id\r\n  end\r\n  create_table :accounts, force: true do |t|\r\n    t.string :name\r\n    t.integer :group_id\r\n  end\r\n  create_table :groups, force: true do |t|\r\n    t.string :name\r\n    t.string :external_code\r\n    t.integer :external_integration_attr\r\n    t.integer :account_id\r\n  end\r\n  create_table :transactions, force: true do |t|\r\n    t.integer :group_id\r\n    t.decimal :amount\r\n  end\r\nend\r\n\r\nclass Offer < ActiveRecord::Base\r\n  belongs_to :account\r\nend\r\n\r\nclass Account < ActiveRecord::Base\r\n  belongs_to :group\r\nend\r\n\r\n\r\nclass Group < ActiveRecord::Base\r\n  has_one :account\r\n  enum external_integration_attr: [\"id\", \"externalCode\"]\r\nend\r\n\r\nclass Transaction < ActiveRecord::Base\r\n  belongs_to :group\r\nend\r\n\r\nclass AddOfferAccountGroupAndTransactions < ActiveRecord::Migration[7.0]\r\n  def change\r\n    reversible do |dir|\r\n      dir.up do\r\n        Group.new(name: \"Foo\", external_integration_attr: \"externalCode\").save!\r\n        Account.new(name: \"Bar\", group: Group.first).save!\r\n        Offer.new(status: \"approved\", account: Account.first).save!\r\n        Transaction.new(amount: 10, group: Group.first).save!\r\n      end\r\n\r\n      dir.down do\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_migration_up\r\n    \r\n    AddOfferAccountGroupAndTransactions.migrate(:up)\r\n\r\n    transactions = \r\n      Transaction\r\n        .where(group_id: Group.joins(:account)\r\n          .where(account: { id:  Offer.where(status: \"approved\").select(:account_id) })\r\n          .select(:id))\r\n\r\n    assert_equal 1, transactions.count\r\n  end\r\nend\r\n```\r\n\r\n### Expected behavior\r\nQuery `does not have` the following filter: `AND \"groups\".\"external_integration_attr\" = ?` (`[\"external_integration_attr\", 0]`)\r\n\r\n### Actual behavior\r\nQuery has the following filter `AND \"groups\".\"external_integration_attr\" = ?` (`[\"external_integration_attr\", 0]`)\r\n\r\n### System configuration\r\n**Rails version**:\r\nCurrent main branch and 6.1.7.3\r\n\r\n**Ruby version**:\r\nRuby 3.1.0 (alongside main branch) and Ruby 2.7.7 + Rails 6.1.7.3", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48524/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48524/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48523", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48523/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48523/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48523/events", "html_url": "https://github.com/rails/rails/pull/48523", "id": 1764190810, "node_id": "PR_kwDNIULOU2A1RQ", "number": 48523, "title": "Update Action View and Action Dispatch to use HTML5 when available", "user": {"login": "flavorjones", "id": 8207, "node_id": "MDQ6VXNlcjgyMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/8207?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flavorjones", "html_url": "https://github.com/flavorjones", "followers_url": "https://api.github.com/users/flavorjones/followers", "following_url": "https://api.github.com/users/flavorjones/following{/other_user}", "gists_url": "https://api.github.com/users/flavorjones/gists{/gist_id}", "starred_url": "https://api.github.com/users/flavorjones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flavorjones/subscriptions", "organizations_url": "https://api.github.com/users/flavorjones/orgs", "repos_url": "https://api.github.com/users/flavorjones/repos", "events_url": "https://api.github.com/users/flavorjones/events{/privacy}", "received_events_url": "https://api.github.com/users/flavorjones/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-19T20:36:14Z", "updated_at": "2023-06-21T20:17:57Z", "closed_at": "2023-06-20T02:40:22Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48523", "html_url": "https://github.com/rails/rails/pull/48523", "diff_url": "https://github.com/rails/rails/pull/48523.diff", "patch_url": "https://github.com/rails/rails/pull/48523.patch", "merged_at": "2023-06-20T02:40:22Z"}, "body": "### Motivation / Background\r\n\r\nUpdate Action Dispatch Assertions' `html_document` to use the HTML5 parser if it's available, to better represent what an end user will see in their browser DOM.\r\n\r\nUpdate Action View TestCase's private `document_root_element` and the form tag helper test to use HTML5 as well.\r\n\r\n### Additional information\r\n\r\nThis is part of ongoing work to update Rails to use HTML5.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48523/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48523/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48522", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48522/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48522/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48522/events", "html_url": "https://github.com/rails/rails/pull/48522", "id": 1764167589, "node_id": "PR_kwDNIULOU1_lJw", "number": 48522, "title": "Update Action Text to use HTML5 when available", "user": {"login": "flavorjones", "id": 8207, "node_id": "MDQ6VXNlcjgyMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/8207?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flavorjones", "html_url": "https://github.com/flavorjones", "followers_url": "https://api.github.com/users/flavorjones/followers", "following_url": "https://api.github.com/users/flavorjones/following{/other_user}", "gists_url": "https://api.github.com/users/flavorjones/gists{/gist_id}", "starred_url": "https://api.github.com/users/flavorjones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flavorjones/subscriptions", "organizations_url": "https://api.github.com/users/flavorjones/orgs", "repos_url": "https://api.github.com/users/flavorjones/repos", "events_url": "https://api.github.com/users/flavorjones/events{/privacy}", "received_events_url": "https://api.github.com/users/flavorjones/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1180817762, "node_id": "MDU6TGFiZWwxMTgwODE3NzYy", "url": "https://api.github.com/repos/rails/rails/labels/actiontext", "name": "actiontext", "color": "3bc667", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-19T20:13:23Z", "updated_at": "2023-06-20T21:53:25Z", "closed_at": "2023-06-20T01:32:39Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48522", "html_url": "https://github.com/rails/rails/pull/48522", "diff_url": "https://github.com/rails/rails/pull/48522.diff", "patch_url": "https://github.com/rails/rails/pull/48522.patch", "merged_at": "2023-06-20T01:32:39Z"}, "body": "### Motivation / Background\r\n\r\nUpdate Action Text to use the HTML5 sanitizer when available, and to parse markup using Nokogiri::HTML5 when available. Previously, Action Text used Nokogiri's HTML4 parsers for these operations.\r\n\r\n### Detail\r\n\r\nThis pull request updates the default value for `ActionText::ContentHelper.sanitizer` from `Rails::Html::Sanitizer.safe_list_sanitizer.new` to `Rails::Html::Sanitizer.best_supported_vendor.safe_list_sanitizer.new`. The method `.best_supported_vendor` is available in rails-html-sanitizer v1.6.0 and later, which 500ccaae made the minimum for Action View.\r\n\r\nThis pull request also adds two new methods that return the \"best supported\" HTML document and document fragment classes: `ActionText.html_document_class` and `ActionText.html_document_fragment_class`. These methods are used internally where code previously referenced `Nokogiri::HTML` directly.\r\n\r\nThe change from `#clone` to `#dup` is necessary to work around an issue in Nokogiri where `#clone` is not defined properly for HTML5 fragment and the fragment does not have a parent Document. `#dup` behaves the way we expect, so this should be fine.\r\n\r\n\r\n### Additional information\r\n\r\nThis is part of ongoing work to update Rails to use HTML5.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48522/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48522/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48521", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48521/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48521/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48521/events", "html_url": "https://github.com/rails/rails/pull/48521", "id": 1764144370, "node_id": "PR_kwDNIULOU1-RuA", "number": 48521, "title": "Update guides generation to use Nokogiri's HTML5 parser", "user": {"login": "flavorjones", "id": 8207, "node_id": "MDQ6VXNlcjgyMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/8207?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flavorjones", "html_url": "https://github.com/flavorjones", "followers_url": "https://api.github.com/users/flavorjones/followers", "following_url": "https://api.github.com/users/flavorjones/following{/other_user}", "gists_url": "https://api.github.com/users/flavorjones/gists{/gist_id}", "starred_url": "https://api.github.com/users/flavorjones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flavorjones/subscriptions", "organizations_url": "https://api.github.com/users/flavorjones/orgs", "repos_url": "https://api.github.com/users/flavorjones/repos", "events_url": "https://api.github.com/users/flavorjones/events{/privacy}", "received_events_url": "https://api.github.com/users/flavorjones/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-19T19:59:12Z", "updated_at": "2023-06-20T01:42:03Z", "closed_at": "2023-06-20T01:36:16Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48521", "html_url": "https://github.com/rails/rails/pull/48521", "diff_url": "https://github.com/rails/rails/pull/48521.diff", "patch_url": "https://github.com/rails/rails/pull/48521.patch", "merged_at": "2023-06-20T01:36:16Z"}, "body": "### Motivation / Background\r\n\r\nUse Nokogiri::HTML5 to generate the guides. This doesn't meaningfully change the output, but will help ensure we're emitting valid HTML5 markup. A followup commit could reasonably rip out the W3C validator, I think.\r\n\r\nNote that the most frequent changes to the output are:\r\n\r\n- attribute values, most often data-clipboard-text. TheHTML5 spec prescribes entity-escaping fewer characters in attribute values than libxml2 did, and wraps attribute values in double-quotes. In particular `>` and `<` are not escaped per the HTML5 spec which may be surprising to look at if you're used to libxml2's output.\r\n- linebreaks are different for some HTML elements, particularly lists and tables have fewer linebreaks between elements.\r\n\r\n\r\n### Detail\r\n\r\nThis Pull Request replaces calls to `Nokogiri::HTML.fragment` with a call to a new private method, `html_fragment` which uses either `Nokogiri::HTML5.fragment` if HTML5 available, else `Nokogiri::HTML4.fragment`.\r\n\r\n\r\n### Additional information\r\n\r\nPart of an ongoing effort to update Rails to use HTML5.\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48521/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48521/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48520", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48520/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48520/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48520/events", "html_url": "https://github.com/rails/rails/pull/48520", "id": 1763776125, "node_id": "PR_kwDNIULOU1qZPg", "number": 48520, "title": "Wrap active_record_encryption.configuration on an after initialize", "user": {"login": "duduribeiro", "id": 771411, "node_id": "MDQ6VXNlcjc3MTQxMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/771411?v=4", "gravatar_id": "", "url": "https://api.github.com/users/duduribeiro", "html_url": "https://github.com/duduribeiro", "followers_url": "https://api.github.com/users/duduribeiro/followers", "following_url": "https://api.github.com/users/duduribeiro/following{/other_user}", "gists_url": "https://api.github.com/users/duduribeiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/duduribeiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/duduribeiro/subscriptions", "organizations_url": "https://api.github.com/users/duduribeiro/orgs", "repos_url": "https://api.github.com/users/duduribeiro/repos", "events_url": "https://api.github.com/users/duduribeiro/events{/privacy}", "received_events_url": "https://api.github.com/users/duduribeiro/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-19T15:32:17Z", "updated_at": "2023-06-26T15:43:04Z", "closed_at": "2023-06-25T08:16:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48520", "html_url": "https://github.com/rails/rails/pull/48520", "diff_url": "https://github.com/rails/rails/pull/48520.diff", "patch_url": "https://github.com/rails/rails/pull/48520.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\nThis commit changes the active_record_encryption.configuration to be set on an after initialize block. After PR #44873, we can configure now hash_digest_class that will be used on ActiveRecord::Encryption. But the docs said that we could change it via an initializer by setting\r\nRails.application.config.active_record.encryption.hash_digest_class. This wasn't working because the railtie\r\n\"active_record_encryption.configuration\" was being set before the initializer was loaded. This changes this behave to configure the active_record encryption after the initialize was loaded.\r\n\r\n### Additional information\r\n\r\nI found this while debugging https://github.com/rails/rails/issues/48204 and I noticed that the PR https://github.com/rails/rails/pull/44873 added an option to configure the hash_class used to encrypt the attribute by setting the `ActiveRecord::Encryption.config.hash_digest_class` on the initializer. But while debugging my issue, I found that the code to use this hash_digest_class wasn't using the different hash_digest_class that I set and I noticed that the ActiveRecord::Encryption was only configured only at the `active_record` railtie before the custom initializers I have.\r\n\r\n```ruby\r\n    initializer \"active_record_encryption.configuration\" do |app|\r\n      ActiveRecord::Encryption.configure \\\r\n         primary_key: app.credentials.dig(:active_record_encryption, :primary_key),\r\n         deterministic_key: app.credentials.dig(:active_record_encryption, :deterministic_key),\r\n         key_derivation_salt: app.credentials.dig(:active_record_encryption, :key_derivation_salt),\r\n         **config.active_record.encryption\r\n```\r\n\r\nand my `new_framework_defaults_7_1` was loaded after that. \r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48520/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48520/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48519", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48519/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48519/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48519/events", "html_url": "https://github.com/rails/rails/pull/48519", "id": 1763647313, "node_id": "PR_kwDNIULOU1jeCg", "number": 48519, "title": "Fix deprecation warning messages for `ActiveSupport::TestFixtures`", "user": {"login": "adrianna-chang-shopify", "id": 22918438, "node_id": "MDQ6VXNlcjIyOTE4NDM4", "avatar_url": "https://avatars.githubusercontent.com/u/22918438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adrianna-chang-shopify", "html_url": "https://github.com/adrianna-chang-shopify", "followers_url": "https://api.github.com/users/adrianna-chang-shopify/followers", "following_url": "https://api.github.com/users/adrianna-chang-shopify/following{/other_user}", "gists_url": "https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}", "starred_url": "https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adrianna-chang-shopify/subscriptions", "organizations_url": "https://api.github.com/users/adrianna-chang-shopify/orgs", "repos_url": "https://api.github.com/users/adrianna-chang-shopify/repos", "events_url": "https://api.github.com/users/adrianna-chang-shopify/events{/privacy}", "received_events_url": "https://api.github.com/users/adrianna-chang-shopify/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-19T14:15:30Z", "updated_at": "2023-06-20T12:56:43Z", "closed_at": "2023-06-19T22:32:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48519", "html_url": "https://github.com/rails/rails/pull/48519", "diff_url": "https://github.com/rails/rails/pull/48519.diff", "patch_url": "https://github.com/rails/rails/pull/48519.patch", "merged_at": "2023-06-19T22:32:13Z"}, "body": "### Motivation / Background\r\n\r\nWhile reviewing @zzak 's [documentation improvements around fixture paths](https://github.com/rails/rails/pull/48512), I noticed a few minor inconsistencies with the deprecation messages.\r\n\r\n### Detail\r\n\r\nMinor fixes to the deprecation messages around `TestFixtures.fixture_path`, `TestFixtures.fixture_path=`, and `TestFixtures#fixture_path` to clarify which method is deprecated and which should be used instead. \r\n\r\nEnsure we refer to the class method vs instance method appropriately, and refer to the setter method in the deprecation method for `TestFixtures.fixture_path=`.\r\n\r\ncc @andrewn617 \r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48519/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48519/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48518", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48518/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48518/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48518/events", "html_url": "https://github.com/rails/rails/pull/48518", "id": 1762956431, "node_id": "PR_kwDNIULOU09mbg", "number": 48518, "title": "update doc to use to_fs over deprecated to_s [ci-skip]", "user": {"login": "sampatbadhe", "id": 5279284, "node_id": "MDQ6VXNlcjUyNzkyODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5279284?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sampatbadhe", "html_url": "https://github.com/sampatbadhe", "followers_url": "https://api.github.com/users/sampatbadhe/followers", "following_url": "https://api.github.com/users/sampatbadhe/following{/other_user}", "gists_url": "https://api.github.com/users/sampatbadhe/gists{/gist_id}", "starred_url": "https://api.github.com/users/sampatbadhe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sampatbadhe/subscriptions", "organizations_url": "https://api.github.com/users/sampatbadhe/orgs", "repos_url": "https://api.github.com/users/sampatbadhe/repos", "events_url": "https://api.github.com/users/sampatbadhe/events{/privacy}", "received_events_url": "https://api.github.com/users/sampatbadhe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-19T07:50:10Z", "updated_at": "2023-06-19T11:46:30Z", "closed_at": "2023-06-19T11:46:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48518", "html_url": "https://github.com/rails/rails/pull/48518", "diff_url": "https://github.com/rails/rails/pull/48518.diff", "patch_url": "https://github.com/rails/rails/pull/48518.patch", "merged_at": "2023-06-19T11:46:29Z"}, "body": "Update doc to use `to_fs` over deprecated `to_s`", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48518/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48518/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48517", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48517/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48517/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48517/events", "html_url": "https://github.com/rails/rails/issues/48517", "id": 1762559591, "node_id": "I_kwDNIULOaQ6GZw", "number": 48517, "title": "javascript_include_tag's implicit modulepreload Link header insertion breaks importmaps", "user": {"login": "aaronjensen", "id": 8588, "node_id": "MDQ6VXNlcjg1ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/8588?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aaronjensen", "html_url": "https://github.com/aaronjensen", "followers_url": "https://api.github.com/users/aaronjensen/followers", "following_url": "https://api.github.com/users/aaronjensen/following{/other_user}", "gists_url": "https://api.github.com/users/aaronjensen/gists{/gist_id}", "starred_url": "https://api.github.com/users/aaronjensen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aaronjensen/subscriptions", "organizations_url": "https://api.github.com/users/aaronjensen/orgs", "repos_url": "https://api.github.com/users/aaronjensen/repos", "events_url": "https://api.github.com/users/aaronjensen/events{/privacy}", "received_events_url": "https://api.github.com/users/aaronjensen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 3666649, "node_id": "MDU6TGFiZWwzNjY2NjQ5", "url": "https://api.github.com/repos/rails/rails/labels/actionview", "name": "actionview", "color": "d7e102", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2023-06-19T01:23:52Z", "updated_at": "2023-07-01T00:32:45Z", "closed_at": "2023-06-30T20:40:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "If you use importmaps along with something like `javascript_include(\"some-module\", type: \"module\")` you end up with an error in the Chrome Devtools:\r\n\r\n`An import map is added after module script load was triggered.`\r\n\r\nThis happens even if the import map is before the script tag. You may need to be running Puma or another server that supports early hints.\r\n\r\nThis behavior is opaque and overly presumptuous. I cannot find an obvious way to disable it other than to write script tags without the helper. Please provide a means for disabling the behavior or make it opt-in. ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48517/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48517/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48516", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48516/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48516/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48516/events", "html_url": "https://github.com/rails/rails/pull/48516", "id": 1762535358, "node_id": "PR_kwDNIULOU0m5VQ", "number": 48516, "title": ":nail_care: Move `:enddoc: to the top of the file", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-19T00:39:06Z", "updated_at": "2023-06-19T00:42:09Z", "closed_at": "2023-06-19T00:42:08Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48516", "html_url": "https://github.com/rails/rails/pull/48516", "diff_url": "https://github.com/rails/rails/pull/48516.diff", "patch_url": "https://github.com/rails/rails/pull/48516.patch", "merged_at": "2023-06-19T00:42:08Z"}, "body": "This way we don't need the other `:nodoc:` statements\r\n\r\nPulled from #48512 to save time", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48516/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48516/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48515", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48515/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48515/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48515/events", "html_url": "https://github.com/rails/rails/pull/48515", "id": 1762533968, "node_id": "PR_kwDNIULOU0m08w", "number": 48515, "title": ":nail_care: Wrap the AC::Meta::Streaming doc links", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-19T00:35:18Z", "updated_at": "2023-06-19T00:37:59Z", "closed_at": "2023-06-19T00:37:58Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48515", "html_url": "https://github.com/rails/rails/pull/48515", "diff_url": "https://github.com/rails/rails/pull/48515.diff", "patch_url": "https://github.com/rails/rails/pull/48515.patch", "merged_at": "2023-06-19T00:37:58Z"}, "body": "This way they look good on page, and in your editor.\r\n\r\nA tiny improvement left over from #48496, pulled from #48512 to save time", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48515/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48515/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48514", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48514/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48514/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48514/events", "html_url": "https://github.com/rails/rails/pull/48514", "id": 1762378384, "node_id": "PR_kwDNIULOU0e4zg", "number": 48514, "title": "Set `secret_key_base` on `config` in bug_report_templates", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-18T17:00:55Z", "updated_at": "2023-06-19T06:06:16Z", "closed_at": "2023-06-18T20:56:12Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48514", "html_url": "https://github.com/rails/rails/pull/48514", "diff_url": "https://github.com/rails/rails/pull/48514.diff", "patch_url": "https://github.com/rails/rails/pull/48514.patch", "merged_at": "2023-06-18T20:56:12Z"}, "body": "`application.secrets` are deprecated. For the bug templates we can set the `secret_key_base` on `application.config` instead.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48514/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48514/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48513", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48513/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48513/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48513/events", "html_url": "https://github.com/rails/rails/pull/48513", "id": 1762301242, "node_id": "PR_kwDNIULOU0bBnw", "number": 48513, "title": "Allow insert_all/upsert_all to use an array of models", "user": {"login": "TakuyaKurimoto", "id": 75765648, "node_id": "MDQ6VXNlcjc1NzY1NjQ4", "avatar_url": "https://avatars.githubusercontent.com/u/75765648?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TakuyaKurimoto", "html_url": "https://github.com/TakuyaKurimoto", "followers_url": "https://api.github.com/users/TakuyaKurimoto/followers", "following_url": "https://api.github.com/users/TakuyaKurimoto/following{/other_user}", "gists_url": "https://api.github.com/users/TakuyaKurimoto/gists{/gist_id}", "starred_url": "https://api.github.com/users/TakuyaKurimoto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TakuyaKurimoto/subscriptions", "organizations_url": "https://api.github.com/users/TakuyaKurimoto/orgs", "repos_url": "https://api.github.com/users/TakuyaKurimoto/repos", "events_url": "https://api.github.com/users/TakuyaKurimoto/events{/privacy}", "received_events_url": "https://api.github.com/users/TakuyaKurimoto/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-18T13:30:51Z", "updated_at": "2023-06-22T11:23:06Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48513", "html_url": "https://github.com/rails/rails/pull/48513", "diff_url": "https://github.com/rails/rails/pull/48513.diff", "patch_url": "https://github.com/rails/rails/pull/48513.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\nCurrently, insert_all/upsert_all only accept array of hashes, so I want to make it accept array of models as well.\r\nExample:\r\n```\r\nBook.insert_all([\r\n  Book.new(title: \"Rework\", author: \"David\"),\r\n  Book.new(title: \"Eloquent Ruby\", author: \"Russ\")\r\n])\r\n```\r\n\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\n### Detail\r\n\r\n### Additional information\r\n\r\nIf you do not want timestamp values to be updated automatically, you must set record_timestamps to false.\r\nExample:\r\n```\r\nBook.insert_all([Book.new(title: \"Rework\", author: \"David\")])\r\nBook.last.updated_at = '2023-05-23 20:37:10.97 UTC'\r\n\r\nBook.insert_all([Book.new(title: \"Rework\", author: \"David\")], record_timestamps: false)\r\nBook.last.updated_at = nil\r\n```\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48513/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48513/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48512", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48512/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48512/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48512/events", "html_url": "https://github.com/rails/rails/pull/48512", "id": 1762189071, "node_id": "PR_kwDNIULOU0VOJQ", "number": 48512, "title": "Update documentation around fixture paths", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107188, "node_id": "MDU6TGFiZWwxMDcxODg=", "url": "https://api.github.com/repos/rails/rails/labels/actionmailer", "name": "actionmailer", "color": "8B00FC", "default": false, "description": null}, {"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-18T08:57:31Z", "updated_at": "2023-06-20T07:08:06Z", "closed_at": "2023-06-20T07:08:05Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48512", "html_url": "https://github.com/rails/rails/pull/48512", "diff_url": "https://github.com/rails/rails/pull/48512.diff", "patch_url": "https://github.com/rails/rails/pull/48512.patch", "merged_at": "2023-06-20T07:08:04Z"}, "body": "This PR makes a couple of changes, so I've broken them down atomically.\r\n\r\nBased on what I've found from #47675, there were a couple of improvements to be made.\r\n\r\nPlease feel free to review them on a per-commit basis, starting:\r\n\r\n* [Make ActionMailer::TestCase#read_fixture public](https://github.com/rails/rails/commit/7552929471c77cafacd988aff031dd6394e653cc)\r\n  * Perhaps a bit controversial, but since it's been documented in the [guides](https://guides.rubyonrails.org/testing.html#revenge-of-the-fixtures) for ages, why not?\r\n* [Fix AR::TestFixtures.fixture_paths= docs](https://github.com/rails/rails/commit/6dfdb5e1bcfd42a29348490ef5512bd5f8703d7c)\r\n  * Remove deprecated method and add docs for the new plural forms\r\n* [Document ActiveSupport::TestCase.fixture_paths= and getter](https://github.com/rails/rails/commit/387970fdec4d2147c2e71e0c510cffbf1c17091e)\r\n  * Also document them where they are intended to be used, when requiring \"rails/test_help\"\r\n* [Fixup AR::FixtureSet docs](https://github.com/rails/rails/commit/c1db265021e02279f8bcf087f49bd569db93623d)\r\n  * Linkify the `fixture_paths=` setter now that it's documented, and other small cleanups\r\n\r\nPlanning to not merge this one without feedback, since it's changing the public visibility of a method and adding other possibly controversial docs.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48512/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48512/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48511", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48511/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48511/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48511/events", "html_url": "https://github.com/rails/rails/pull/48511", "id": 1762172698, "node_id": "PR_kwDNIULOU0UcvQ", "number": 48511, "title": "Support queries using the `LIKE` operator", "user": {"login": "lazaronixon", "id": 2651240, "node_id": "MDQ6VXNlcjI2NTEyNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/2651240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lazaronixon", "html_url": "https://github.com/lazaronixon", "followers_url": "https://api.github.com/users/lazaronixon/followers", "following_url": "https://api.github.com/users/lazaronixon/following{/other_user}", "gists_url": "https://api.github.com/users/lazaronixon/gists{/gist_id}", "starred_url": "https://api.github.com/users/lazaronixon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lazaronixon/subscriptions", "organizations_url": "https://api.github.com/users/lazaronixon/orgs", "repos_url": "https://api.github.com/users/lazaronixon/repos", "events_url": "https://api.github.com/users/lazaronixon/events{/privacy}", "received_events_url": "https://api.github.com/users/lazaronixon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-18T08:05:17Z", "updated_at": "2023-06-18T10:01:25Z", "closed_at": "2023-06-18T09:55:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48511", "html_url": "https://github.com/rails/rails/pull/48511", "diff_url": "https://github.com/rails/rails/pull/48511.diff", "patch_url": "https://github.com/rails/rails/pull/48511.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nSupport queries using the `LIKE` operator through `where.like(...)`. \r\n\r\n```ruby\r\nUser.where.like(name: \"nixon\")\r\n#=> SELECT * FROM users WHERE name LIKE 'nixon'\r\n\r\nUser.where.like(name: %w(nixon DHH))\r\n#=> SELECT * FROM users WHERE (name LIKE 'nixon' OR name LIKE 'DHH')\r\n\r\nUser.where.like.not(name: \"nixon\")\r\n#=> SELECT * FROM users WHERE name NOT LIKE 'nixon'\r\n```\r\n\r\n### More details\r\n\r\nIt is case-insensitive, on PostgreSQL, it will be `ILIKE`.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48511/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48511/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48510", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48510/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48510/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48510/events", "html_url": "https://github.com/rails/rails/pull/48510", "id": 1762165544, "node_id": "PR_kwDNIULOU0UE5Q", "number": 48510, "title": "Allow default CSP setup to work with empty sessions", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}, {"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2023-06-18T07:50:25Z", "updated_at": "2023-07-03T23:52:20Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48510", "html_url": "https://github.com/rails/rails/pull/48510", "diff_url": "https://github.com/rails/rails/pull/48510.diff", "patch_url": "https://github.com/rails/rails/pull/48510.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nFixes https://github.com/rails/rails/issues/48463\r\n\r\nSince https://github.com/rails/rails/pull/43227, the default CSP suggested in the initializer does not work with empty sessions. See [this comment](https://github.com/rails/rails/pull/43227#issuecomment-1191692615) for an example issue and workaround.\r\n\r\n### Detail\r\n\r\nThis PR just adds a fallback in case the session has not been loaded. I also updated the railties test to match the config in the default initializer.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48510/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48510/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48509", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48509/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48509/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48509/events", "html_url": "https://github.com/rails/rails/pull/48509", "id": 1761877912, "node_id": "PR_kwDNIULOU0Fqcg", "number": 48509, "title": "[Fix #47357] Inconsistent update, delete, reload behaviour with `#scoping` and default scopes", "user": {"login": "joshuay03", "id": 54629302, "node_id": "MDQ6VXNlcjU0NjI5MzAy", "avatar_url": "https://avatars.githubusercontent.com/u/54629302?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshuay03", "html_url": "https://github.com/joshuay03", "followers_url": "https://api.github.com/users/joshuay03/followers", "following_url": "https://api.github.com/users/joshuay03/following{/other_user}", "gists_url": "https://api.github.com/users/joshuay03/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshuay03/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshuay03/subscriptions", "organizations_url": "https://api.github.com/users/joshuay03/orgs", "repos_url": "https://api.github.com/users/joshuay03/repos", "events_url": "https://api.github.com/users/joshuay03/events{/privacy}", "received_events_url": "https://api.github.com/users/joshuay03/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-17T14:33:33Z", "updated_at": "2023-08-04T14:32:15Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48509", "html_url": "https://github.com/rails/rails/pull/48509", "diff_url": "https://github.com/rails/rails/pull/48509.diff", "patch_url": "https://github.com/rails/rails/pull/48509.patch", "merged_at": null}, "body": "<!--\r\nThanks for contributing to Rails!\r\n\r\nPlease do not make *Draft* pull requests, as they still send\r\nnotifications to everyone watching the Rails repo.\r\n\r\nCreate a pull request when it is ready for review and feedback\r\nfrom the Rails team :).\r\n\r\nIf your pull request affects documentation or any non-code\r\nchanges, guidelines for those changes are [available\r\nhere](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation)\r\n\r\nAbout this template\r\n\r\nThe following template aims to help contributors write a good description for their pull requests.\r\nWe'd like you to provide a description of the changes in your pull request (i.e. bugs fixed or features added), motivation behind the changes, and complete the checklist below before opening a pull request.\r\n\r\nFeel free to discard it if you need to (e.g. when you just fix a typo). -->\r\n\r\n### Motivation / Background\r\n\r\n<!--\r\nDescribe why this Pull Request needs to be merged. What bug have you fixed? What feature have you added? Why is it important?\r\nIf you are fixing a specific issue, include \"Fixes #ISSUE\" (replace with the issue number, remove the quotes) and the issue will be linked to this PR.\r\n-->\r\n\r\nThis Pull Request has been created to fix https://github.com/rails/rails/issues/47357.\r\n\r\n### Detail\r\n\r\nThis Pull Request ensures that when using `scoping` on update, delete and reload, scopes are only applied if `all_queries: true` and only default scopes with `all_queries: true` are applied. Because all default scopes are applied initially with the `where` clause when scoping, my approach was to remove the unneeded scopes after the fact in these three scenarios.\r\n\r\nExcept for the update and delete cases **without** `scoping(all_queries: true)`, all other tests failed initially.\r\n\r\n### Additional information\r\n\r\nAdded @pjambet as a co-author since they thoroughly documented all the expected and actual behaviour and tests.\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48509/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48509/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48508", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48508/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48508/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48508/events", "html_url": "https://github.com/rails/rails/pull/48508", "id": 1761242245, "node_id": "PR_kwDNIULOUzlAyQ", "number": 48508, "title": "Change new_framework_defaults_7_1.rb to use the right config for hash_digest_class", "user": {"login": "duduribeiro", "id": 771411, "node_id": "MDQ6VXNlcjc3MTQxMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/771411?v=4", "gravatar_id": "", "url": "https://api.github.com/users/duduribeiro", "html_url": "https://github.com/duduribeiro", "followers_url": "https://api.github.com/users/duduribeiro/followers", "following_url": "https://api.github.com/users/duduribeiro/following{/other_user}", "gists_url": "https://api.github.com/users/duduribeiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/duduribeiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/duduribeiro/subscriptions", "organizations_url": "https://api.github.com/users/duduribeiro/orgs", "repos_url": "https://api.github.com/users/duduribeiro/repos", "events_url": "https://api.github.com/users/duduribeiro/events{/privacy}", "received_events_url": "https://api.github.com/users/duduribeiro/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2023-06-16T19:56:58Z", "updated_at": "2023-06-19T18:49:25Z", "closed_at": "2023-06-19T15:33:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48508", "html_url": "https://github.com/rails/rails/pull/48508", "diff_url": "https://github.com/rails/rails/pull/48508.diff", "patch_url": "https://github.com/rails/rails/pull/48508.patch", "merged_at": null}, "body": "### Detail\r\n\r\nPreviously the template was using\r\nRails.application.config.active_record.encryption.hash_digest_class to set the hash digest class but the correct way to set it is using ActiveRecord::Encryption.config.hash_digest_class.\r\n\r\n### Additional information\r\n\r\nI found this while debugging https://github.com/rails/rails/issues/48204 and I noticed that the PR https://github.com/rails/rails/pull/44873 added an option to configure the hash_class used to encrypt the attribute by setting the `ActiveRecord::Encryption.config.hash_digest_class` on the initializer. But while debugging my issue, I found that the code to use this hash_digest_class wasn't using the different hash_digest_class that I set and I noticed that the ActiveRecord::Encryption was only configured only at the `active_record` railtie at\r\n\r\n```ruby\r\n    initializer \"active_record_encryption.configuration\" do |app|\r\n      ActiveRecord::Encryption.configure \\\r\n         primary_key: app.credentials.dig(:active_record_encryption, :primary_key),\r\n         deterministic_key: app.credentials.dig(:active_record_encryption, :deterministic_key),\r\n         key_derivation_salt: app.credentials.dig(:active_record_encryption, :key_derivation_salt),\r\n         **config.active_record.encryption\r\n```\r\n\r\nand my `new_framework_defaults_7_1` was loaded after that. \r\n\r\nSo I workaround this by changing the `new_framework_defaults_7_1` to set the digest via \r\n```ruby\r\nActiveRecord::Encryption.config.hash_digest_class = OpenSSL::Digest::SHA256\r\n```\r\ninstead. \r\n\r\nIDK if this is a valid approach or if I was doing something wrong \ud83d\ude04 . probably @jorgemanrubia can give his thoughts \r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48508/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48508/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48507", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48507/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48507/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48507/events", "html_url": "https://github.com/rails/rails/pull/48507", "id": 1761172451, "node_id": "PR_kwDNIULOUzhJtQ", "number": 48507, "title": "Fix empty string saving for ranges", "user": {"login": "szymonlipka", "id": 11679928, "node_id": "MDQ6VXNlcjExNjc5OTI4", "avatar_url": "https://avatars.githubusercontent.com/u/11679928?v=4", "gravatar_id": "", "url": "https://api.github.com/users/szymonlipka", "html_url": "https://github.com/szymonlipka", "followers_url": "https://api.github.com/users/szymonlipka/followers", "following_url": "https://api.github.com/users/szymonlipka/following{/other_user}", "gists_url": "https://api.github.com/users/szymonlipka/gists{/gist_id}", "starred_url": "https://api.github.com/users/szymonlipka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/szymonlipka/subscriptions", "organizations_url": "https://api.github.com/users/szymonlipka/orgs", "repos_url": "https://api.github.com/users/szymonlipka/repos", "events_url": "https://api.github.com/users/szymonlipka/events{/privacy}", "received_events_url": "https://api.github.com/users/szymonlipka/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 1072773639, "node_id": "MDU6TGFiZWwxMDcyNzczNjM5", "url": "https://api.github.com/repos/rails/rails/labels/ready", "name": "ready", "color": "fef2c0", "default": false, "description": "PRs ready to merge"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-06-16T19:10:35Z", "updated_at": "2023-06-26T16:05:07Z", "closed_at": "2023-06-26T16:05:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48507", "html_url": "https://github.com/rails/rails/pull/48507", "diff_url": "https://github.com/rails/rails/pull/48507.diff", "patch_url": "https://github.com/rails/rails/pull/48507.patch", "merged_at": "2023-06-26T16:05:07Z"}, "body": "### Motivation / Background\r\nFixes https://github.com/rails/rails/issues/48486\r\n\r\nSaving ranges with an empty range\r\n\r\n### Detail\r\n\r\nSimply return if the string is empty, the same as it's being done for an \"empty\" string.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48507/reactions", "total_count": 2, "+1": 1, "-1": 1, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48507/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48506", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48506/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48506/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48506/events", "html_url": "https://github.com/rails/rails/pull/48506", "id": 1761140263, "node_id": "PR_kwDNIULOUzfXgA", "number": 48506, "title": "Autoload ActiveRecord::FixtureSet", "user": {"login": "rwstauner", "id": 142719, "node_id": "MDQ6VXNlcjE0MjcxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/142719?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rwstauner", "html_url": "https://github.com/rwstauner", "followers_url": "https://api.github.com/users/rwstauner/followers", "following_url": "https://api.github.com/users/rwstauner/following{/other_user}", "gists_url": "https://api.github.com/users/rwstauner/gists{/gist_id}", "starred_url": "https://api.github.com/users/rwstauner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rwstauner/subscriptions", "organizations_url": "https://api.github.com/users/rwstauner/orgs", "repos_url": "https://api.github.com/users/rwstauner/repos", "events_url": "https://api.github.com/users/rwstauner/events{/privacy}", "received_events_url": "https://api.github.com/users/rwstauner/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-16T18:45:25Z", "updated_at": "2023-06-30T17:32:45Z", "closed_at": "2023-06-30T17:32:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48506", "html_url": "https://github.com/rails/rails/pull/48506", "diff_url": "https://github.com/rails/rails/pull/48506.diff", "patch_url": "https://github.com/rails/rails/pull/48506.patch", "merged_at": "2023-06-30T17:32:43Z"}, "body": "### Motivation / Background\r\n\r\nWhen eager_load is enabled and something (like the frozen_record gem) tries to load yaml files that use `ActiveRecord::FixtureSet.identify(...)` we'll get an uninitialized constant error.\r\n\r\n### Detail\r\n\r\nWith a new rails app, add the `frozen_record` gem and two files:\r\n```\r\n$ cat app/models/ice.rb\r\nclass Ice < FrozenRecord::Base\r\n  self.base_path = Rails.root.join(\"db/data\").to_s\r\nend\r\n$ cat db/data/ices.yml.erb\r\n- y: <%= ActiveRecord::FixtureSet.identify(:fake) %>\r\n```\r\n\r\nRunning `CI=true bin/rails test` will abort with an uninitialized constant error:\r\n\r\n```\r\n$ CI=1 bin/rails test\r\n(erb):1:in `<main>': uninitialized constant ActiveRecord::FixtureSet (NameError)\r\n\r\n_erbout = +''; _erbout.<< \"- y: \".freeze; _erbout.<<(( ActiveRecord::FixtureSet.identify(:fake) ).to_s); _erbout.<< \"\\n\".freeze\r\n```\r\n\r\n### Notes\r\n\r\nIt may be worth noting that this file is already autoloaded in this module for a different constant:\r\nhttps://github.com/rails/rails/blob/df24e61cfb9a0e61f35989e35da487299d805e03/activerecord/lib/active_record.rb#L84\r\n\r\nSimply adding the autoload line introduced a circular require\r\n(fixtures.rb defines FixtureSet but before that it tries to load files beneath that namespace)\r\nso I moved those requires down to after the class definition\r\nas is done in\r\nhttps://github.com/rails/rails/blob/7dd67dc285fcdbb788cbdcdcaf53f6ce588bf7e5/activesupport/lib/active_support/deprecation.rb#L35-L54\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [ ] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48506/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48506/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48505", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48505/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48505/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48505/events", "html_url": "https://github.com/rails/rails/pull/48505", "id": 1761044953, "node_id": "PR_kwDNIULOUzaZqA", "number": 48505, "title": "Fix fixture_path deprecation", "user": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-16T17:35:54Z", "updated_at": "2023-06-16T17:57:33Z", "closed_at": "2023-06-16T17:57:30Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48505", "html_url": "https://github.com/rails/rails/pull/48505", "diff_url": "https://github.com/rails/rails/pull/48505.diff", "patch_url": "https://github.com/rails/rails/pull/48505.patch", "merged_at": "2023-06-16T17:57:30Z"}, "body": "Replace `fixture_path` with `fixture_paths` to fix the deprecation warning for fixture paths.\r\n\r\nEx warning:\r\n\r\n```\r\nDEPRECATION WARNING: TestFixtures#fixture_path is deprecated and\r\nwill be removed in Rails 7.2. Use #fixture_paths instead.\r\nIf multiple fixture paths have been configured with #fixture_paths,\r\nthen #fixture_path will just return the first path.\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48505/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48505/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48504", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48504/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48504/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48504/events", "html_url": "https://github.com/rails/rails/pull/48504", "id": 1761040905, "node_id": "PR_kwDNIULOUzaMhA", "number": 48504, "title": "Remove unnecessary setters of `use_transactional_tests`", "user": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-16T17:32:38Z", "updated_at": "2023-06-16T18:18:14Z", "closed_at": "2023-06-16T18:18:13Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48504", "html_url": "https://github.com/rails/rails/pull/48504", "diff_url": "https://github.com/rails/rails/pull/48504.diff", "patch_url": "https://github.com/rails/rails/pull/48504.patch", "merged_at": "2023-06-16T18:18:13Z"}, "body": "I've removed `self.use_transactional_tests = false` from the tests here as they don't appear to be necessary. They were likely added when other tests were copied or just an assumption they were needed.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48504/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48504/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48503", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48503/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48503/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48503/events", "html_url": "https://github.com/rails/rails/issues/48503", "id": 1760768005, "node_id": "I_kwDNIULOaPMwBQ", "number": 48503, "title": "complex where cluases including dots are split improperly", "user": {"login": "k-kostadinov", "id": 58818647, "node_id": "MDQ6VXNlcjU4ODE4NjQ3", "avatar_url": "https://avatars.githubusercontent.com/u/58818647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/k-kostadinov", "html_url": "https://github.com/k-kostadinov", "followers_url": "https://api.github.com/users/k-kostadinov/followers", "following_url": "https://api.github.com/users/k-kostadinov/following{/other_user}", "gists_url": "https://api.github.com/users/k-kostadinov/gists{/gist_id}", "starred_url": "https://api.github.com/users/k-kostadinov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/k-kostadinov/subscriptions", "organizations_url": "https://api.github.com/users/k-kostadinov/orgs", "repos_url": "https://api.github.com/users/k-kostadinov/repos", "events_url": "https://api.github.com/users/k-kostadinov/events{/privacy}", "received_events_url": "https://api.github.com/users/k-kostadinov/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-16T14:35:22Z", "updated_at": "2023-06-16T16:23:14Z", "closed_at": "2023-06-16T16:23:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\nuse postgress database\r\ncreate a table( posts),\r\ncreate a query with complex where statement like `where('CASE WHEN posts.use_created_at_flag THEN posts.created_at ELSE posts.updated_at'=> 2.days.ago..1.day.ago)`\r\n\r\n\r\n\r\n### what happens \r\nafter some investigation i found the method `convert_dot_notation_to_hash`\r\nwhich takes the \r\n`CASE WHEN posts.use_created_at_flag THEN posts.created_at ELSE posts.updated_at` splits it byt dot`.split(\".\")`\r\nand the result is bad.\r\ni would expect it to take the string as is and apply just the > , >=, between, < , <= to the dates.\r\n\r\n```ruby\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activerecord\", \"~> 7.0.0\"\r\n  gem \"pg\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"postgresql\", database: \":memory:\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n    t.boolean \"use_created_at_flag\", default: false\r\n    t.datetime \"created_at\", precision: nil, null: false\r\n    t.datetime \"updated_at\", precision: nil, null: false\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\nend\r\n\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_complex_where\r\n    Post.create!(use_created_at_flag: true, created_at: 3.day.ago)\r\n    Post.create!(use_created_at_flag: false, created_at: 3.day.ago)\r\n    Post.create!(use_created_at_flag: true, created_at: 2.day.ago)\r\n    Post.create!(use_created_at_flag: false, created_at: 2.day.ago)\r\n    Post.create!(use_created_at_flag: true, created_at: 1.day.ago)\r\n    Post.create!(use_created_at_flag: false, created_at: 1.day.ago)\r\n\r\n    Post.where('created_at' => 2.days.ago..1.day.ago).size # will work perfectly \r\n    Post.where('CASE WHEN posts.use_created_at_flag THEN posts.created_at ELSE posts.updated_at'=> 2.days.ago..1.day.ago).size # will will throw an error\r\n\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\nI would expect to get the results \r\n\r\n### Actual behavior\r\n\r\n.../activerecord-7.0.4.3/lib/active_record/connection_adapters/postgresql_adapter.rb:768:in `exec_params': PG::UndefinedTable: ERROR:  missing FROM-clause entry for table \"CASE WHEN posts\" (ActiveRecord::StatementInvalid)\r\nLINE 1: SELECT COUNT(*) FROM \"posts\" WHERE \"CASE WHEN pos...\r\n\r\n### System configuration\r\n**Rails version**:\r\nRails 7.0.4.3\r\n\r\n**Ruby version**:\r\nruby 3.1.2p20 (2022-04-12 revision 4491bb740a) [x86_64-linux]\r\n\r\nI am not sure that this is a bug or a bit like feature expansion or inteded behaviour.\r\nI couldn't make the test run with postgress so it is a bit useless\r\ni am grateful for any attention to this issue of mine", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48503/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48503/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}, {"url": "https://api.github.com/repos/rails/rails/issues/48502", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48502/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48502/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48502/events", "html_url": "https://github.com/rails/rails/issues/48502", "id": 1760763621, "node_id": "I_kwDNIULOaPMe5Q", "number": 48502, "title": "Why does ActiveRecord query on association with singular table name instead of plural create an alias instead of error?", "user": {"login": "justinpchang", "id": 4704389, "node_id": "MDQ6VXNlcjQ3MDQzODk=", "avatar_url": "https://avatars.githubusercontent.com/u/4704389?v=4", "gravatar_id": "", "url": "https://api.github.com/users/justinpchang", "html_url": "https://github.com/justinpchang", "followers_url": "https://api.github.com/users/justinpchang/followers", "following_url": "https://api.github.com/users/justinpchang/following{/other_user}", "gists_url": "https://api.github.com/users/justinpchang/gists{/gist_id}", "starred_url": "https://api.github.com/users/justinpchang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/justinpchang/subscriptions", "organizations_url": "https://api.github.com/users/justinpchang/orgs", "repos_url": "https://api.github.com/users/justinpchang/repos", "events_url": "https://api.github.com/users/justinpchang/events{/privacy}", "received_events_url": "https://api.github.com/users/justinpchang/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-16T14:32:50Z", "updated_at": "2023-06-29T20:04:46Z", "closed_at": "2023-06-29T20:04:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce\r\n- Database schema must have any model `Foo` which has a has_one relationship to model `Bar`.\r\n- `Foo.joins(:bar).where(bar: { col: val })`\r\n- Notice that the generated SQL will look like `...INNER JOIN \"bars\" \"bar\" ON \"bar\".\"foo_id\" = \"foos\".\"id\"...`\r\n- This command will execute as expected, but from the SQL, we see that it has automatically aliased the `bars` association to the singular `bar`.\r\n- If somewhere in the Query Chain, you use raw SQL because it is more complex, such as `.order(\"foos.col ASC, bars.col DESC\")` and use the Rails standard pluralized table name, this will error out since the table has been aliased behind the scenes.\r\n\r\n<!-- Paste your executable test case created from one of the scripts found [here](https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#create-an-executable-test-case) below: -->\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire 'bundler/inline'\r\n\r\ngemfile(true) do\r\n  source 'https://rubygems.org'\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem 'rails', github: 'rails/rails', branch: 'main'\r\n  gem 'sqlite3'\r\nend\r\n\r\nrequire 'active_record'\r\nrequire 'minitest/autorun'\r\nrequire 'logger'\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: 'sqlite3', database: ':memory:')\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n  end\r\n\r\n  create_table :comments, force: true do |t|\r\n    t.integer :post_id\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  has_many :comments\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\n  belongs_to :post\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_association_stuff\r\n    Comment.create!(post: Post.create!)\r\n\r\n    # 1. Signular in join (correct), plural in query (correct)\r\n    assert_equal Comment.joins(:post).where(posts: { id: 1 }).pluck(:id), [1]\r\n    # Generates the following SQL (notice no \"posts\" alias):\r\n    # SELECT \"comments\".\"id\" FROM \"comments\" INNER JOIN \"posts\" ON \"posts\".\"id\" = \"comments\".\"post_id\" WHERE \"posts\".\"id\" = ?  [[\"id\", 1]]\r\n\r\n    # 2. Signular in join (correct), singular in query (INCORRECT -  but works?)\r\n    assert_equal Comment.joins(:post).where(post: { id: 1 }).pluck(:id), [1]\r\n    # Works, but creates the following SQL (notice automatic \"post\" alias):\r\n    # SELECT \"comments\".\"id\" FROM \"comments\" INNER JOIN \"posts\" \"post\" ON \"post\".\"id\" = \"comments\".\"post_id\" WHERE \"post\".\"id\" = ?  [[\"id\", 1]]\r\n\r\n    # 3. Signular in join (correct), singular in query (INCORRECT), using raw SQL (fails!)\r\n    assert_raises(ActiveRecord::StatementInvalid) do\r\n      Comment.joins(:post).where(post: { id: 1 }).order('comments.id ASC, posts.id DESC').pluck(:id)\r\n    end\r\n\r\n    # 4. Plural in join (INCORRECT) - throws error\r\n    assert_raises(ActiveRecord::ConfigurationError) { Comment.joins(:posts).pluck(:id) }\r\n  end\r\nend\r\n\r\n```\r\n\r\n### Expected behavior\r\n- I would expect the singular table name in the query to raise a `ActiveRecord::ConfigurationError`, just as using an incorrectly pluralized table name in a JOIN raises.\r\n\r\n### Actual behavior\r\n- Instead, ActiveRecord tries to correct the incorrect syntax behind the scenes by aliasing the table name, which is not obvious and unintuitive.\r\n\r\n### System configuration\r\n**Rails version**:\r\n7.0.5\r\n**Ruby version**:\r\n3.2.0", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48502/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48502/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48501", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48501/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48501/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48501/events", "html_url": "https://github.com/rails/rails/pull/48501", "id": 1760671286, "node_id": "PR_kwDNIULOUzF-nQ", "number": 48501, "title": "NullTransaction can have `nil` state", "user": {"login": "florentferry", "id": 9674162, "node_id": "MDQ6VXNlcjk2NzQxNjI=", "avatar_url": "https://avatars.githubusercontent.com/u/9674162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/florentferry", "html_url": "https://github.com/florentferry", "followers_url": "https://api.github.com/users/florentferry/followers", "following_url": "https://api.github.com/users/florentferry/following{/other_user}", "gists_url": "https://api.github.com/users/florentferry/gists{/gist_id}", "starred_url": "https://api.github.com/users/florentferry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/florentferry/subscriptions", "organizations_url": "https://api.github.com/users/florentferry/orgs", "repos_url": "https://api.github.com/users/florentferry/repos", "events_url": "https://api.github.com/users/florentferry/events{/privacy}", "received_events_url": "https://api.github.com/users/florentferry/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-16T13:44:44Z", "updated_at": "2023-06-16T14:13:01Z", "closed_at": "2023-06-16T14:13:01Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48501", "html_url": "https://github.com/rails/rails/pull/48501", "diff_url": "https://github.com/rails/rails/pull/48501.diff", "patch_url": "https://github.com/rails/rails/pull/48501.patch", "merged_at": null}, "body": "Add safe navigation operator to ensure NullTransaction have same behavior than Transaction, causing issue with Database Cleaner gem (https://github.com/DatabaseCleaner/database_cleaner/issues/692).\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48501/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48501/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48500", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48500/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48500/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48500/events", "html_url": "https://github.com/rails/rails/pull/48500", "id": 1760511656, "node_id": "PR_kwDNIULOUy9GKg", "number": 48500, "title": "Don't show secret_key_base for `Rails.application.config#inspect`", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107195, "node_id": "MDU6TGFiZWwxMDcxOTU=", "url": "https://api.github.com/repos/rails/rails/labels/railties", "name": "railties", "color": "8BE06E", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-16T12:10:02Z", "updated_at": "2023-06-16T19:58:10Z", "closed_at": "2023-06-16T18:19:40Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48500", "html_url": "https://github.com/rails/rails/pull/48500", "diff_url": "https://github.com/rails/rails/pull/48500.diff", "patch_url": "https://github.com/rails/rails/pull/48500.patch", "merged_at": "2023-06-16T18:19:40Z"}, "body": "When calling `Rails.application.config#inspect` it will show all attributes, including @secret_key_base after 21c34550549ed90f79565b333e06c7cee79c546e\r\n\r\nBy overriding the `inspect` method to only show the class name we can avoid accidentally outputting sensitive information.\r\n\r\nBefore:\r\n\r\n```ruby\r\nRails.application.config.inspect\r\n\"#<Rails::Application::Configuration:0x00000001132b02a0 @root=... @secret_key_base=\\\"b3c631c314c0bbca50c1b2843150fe33\\\" ... >\"\r\n```\r\n\r\nAfter:\r\n\r\n```ruby\r\nRails.application.config.inspect\r\n\"#<Rails::Application::Configuration:0x00000001132b02a0>\"\r\n```\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48500/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48500/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48499", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48499/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48499/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48499/events", "html_url": "https://github.com/rails/rails/pull/48499", "id": 1760308707, "node_id": "PR_kwDNIULOUyxxtQ", "number": 48499, "title": "Don't show secrets for MessageEncryptor#inspect", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-16T09:59:40Z", "updated_at": "2023-06-16T19:57:31Z", "closed_at": "2023-06-16T19:48:22Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48499", "html_url": "https://github.com/rails/rails/pull/48499", "diff_url": "https://github.com/rails/rails/pull/48499.diff", "patch_url": "https://github.com/rails/rails/pull/48499.patch", "merged_at": "2023-06-16T19:48:22Z"}, "body": "If anyone calls a message encryptor in the console it will show the secret of the encryptor.\r\n\r\nBy overriding the `inspect` method to only show the class name we can avoid accidentally outputting sensitive information.\r\n\r\n### Before:\r\n\r\n```ruby\r\nActiveSupport::MessageEncryptor.new(secret, cipher: \"aes-256-gcm\").inspect\r\n\"#<ActiveSupport::MessageEncryptor:0x0000000104888038 ... @secret=\\\"\\\\xAF\\\\bFh]LV}q\\\\nl\\\\xB2U\\\\xB3 ... >\"\r\n```\r\n\r\n### After:\r\n\r\n```ruby\r\nActiveSupport::MessageEncryptor.new(secret, cipher: \"aes-256-gcm\").inspect\r\n\"#<ActiveSupport::MessageEncryptor:0x0000000104888038>\"\r\n```\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48499/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48499/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48498", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48498/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48498/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48498/events", "html_url": "https://github.com/rails/rails/pull/48498", "id": 1760277017, "node_id": "PR_kwDNIULOUywDMg", "number": 48498, "title": "Don't show contents for EncryptedConfiguration#inspect", "user": {"login": "p8", "id": 28561, "node_id": "MDQ6VXNlcjI4NTYx", "avatar_url": "https://avatars.githubusercontent.com/u/28561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p8", "html_url": "https://github.com/p8", "followers_url": "https://api.github.com/users/p8/followers", "following_url": "https://api.github.com/users/p8/following{/other_user}", "gists_url": "https://api.github.com/users/p8/gists{/gist_id}", "starred_url": "https://api.github.com/users/p8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p8/subscriptions", "organizations_url": "https://api.github.com/users/p8/orgs", "repos_url": "https://api.github.com/users/p8/repos", "events_url": "https://api.github.com/users/p8/events{/privacy}", "received_events_url": "https://api.github.com/users/p8/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-16T09:38:06Z", "updated_at": "2023-06-16T19:58:14Z", "closed_at": "2023-06-16T18:25:53Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48498", "html_url": "https://github.com/rails/rails/pull/48498", "diff_url": "https://github.com/rails/rails/pull/48498.diff", "patch_url": "https://github.com/rails/rails/pull/48498.patch", "merged_at": "2023-06-16T18:25:53Z"}, "body": "If anyone calls `Rails.application.credentials` in the console it will show the unencrypted contents of the credentials.\r\n\r\nBy overriding the `inspect` method to only show the class name we can avoid accidentally outputting sensitive information.\r\n\r\n### Before:\r\n```ruby\r\nRails.application.credentials.inspect\r\n\"#<ActiveSupport::EncryptedConfiguration:0x000000010d2b38e8 ... \r\n    @config={:secret=>\\\"something secret\\\"} ... \r\n    @key_file_contents=\\\"915e4ea054e011022398dc242\\\" ...>\"\r\n```\r\n\r\n### After:\r\n```ruby\r\nRails.application.credentials.inspect\r\n\"#<ActiveSupport::EncryptedConfiguration:0x000000010d2b38e8>\"\r\n```\r\n\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48498/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48498/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48497", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48497/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48497/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48497/events", "html_url": "https://github.com/rails/rails/issues/48497", "id": 1760229595, "node_id": "I_kwDNIULOaOr42w", "number": 48497, "title": "Not possible to use upsert_all with point type column", "user": {"login": "morgoth", "id": 10766, "node_id": "MDQ6VXNlcjEwNzY2", "avatar_url": "https://avatars.githubusercontent.com/u/10766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/morgoth", "html_url": "https://github.com/morgoth", "followers_url": "https://api.github.com/users/morgoth/followers", "following_url": "https://api.github.com/users/morgoth/following{/other_user}", "gists_url": "https://api.github.com/users/morgoth/gists{/gist_id}", "starred_url": "https://api.github.com/users/morgoth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/morgoth/subscriptions", "organizations_url": "https://api.github.com/users/morgoth/orgs", "repos_url": "https://api.github.com/users/morgoth/repos", "events_url": "https://api.github.com/users/morgoth/events{/privacy}", "received_events_url": "https://api.github.com/users/morgoth/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-16T09:05:13Z", "updated_at": "2023-06-16T11:01:08Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "When using `upsert_all` with a table having column with a type `point` and the `updated_at` timestamp, the error is raised:\r\n```\r\nD, [2023-06-16T10:58:12.115714 #3553784] DEBUG -- :   Location Upsert (0.4ms)  INSERT INTO \"locations\" (\"identifier\",\"coordinates\",\"created_at\",\"updated_at\") VALUES ('test', '(1.1,1.2)', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ON CONFLICT (\"identifier\") DO UPDATE SET updated_at=(CASE WHEN (\"locations\".\"coordinates\" IS NOT DISTINCT FROM excluded.\"coordinates\") THEN \"locations\".updated_at ELSE CURRENT_TIMESTAMP END),\"coordinates\"=excluded.\"coordinates\" RETURNING \"id\"\r\nE\r\n\r\nError:\r\nBugTest#test_association_stuff:\r\nActiveRecord::StatementInvalid: PG::UndefinedFunction: ERROR:  operator does not exist: point = point\r\nLINE 1: ... updated_at=(CASE WHEN (\"locations\".\"coordinates\" IS NOT DIS...\r\n                                                             ^\r\nHINT:  No operator matches the given name and argument types. You might need to add explicit type casts.\r\n```\r\n\r\nIt's possible to workaround the issue by including the \"updated_at\" timestamp manually.\r\n\r\nThe reproducible script is as follows:\r\n```ruby\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  gem \"rails\", github: \"rails/rails\", branch: \"main\"\r\n  gem \"pg\"\r\nend\r\n\r\nrequire \"active_record\"\r\nrequire \"minitest/autorun\"\r\nrequire \"logger\"\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \"postgresql\", database: \"upsert-bug\")\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :locations, force: true do |t|\r\n    t.string :identifier\r\n    t.point :coordinates\r\n    t.timestamps\r\n    t.index :identifier, unique: true\r\n  end\r\nend\r\n\r\nclass Location < ActiveRecord::Base\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_association_stuff\r\n    assert Location.upsert_all([identifier: \"test\", coordinates: [1.1, 1.2], updated_at: Time.current], unique_by: [:identifier]) # Works fine\r\n\r\n    assert Location.upsert_all([identifier: \"test\", coordinates: [1.1, 1.2]], unique_by: [:identifier]) # raises\r\n  end\r\nend\r\n```", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48497/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48497/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48496", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48496/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48496/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48496/events", "html_url": "https://github.com/rails/rails/pull/48496", "id": 1760106800, "node_id": "PR_kwDNIULOUym6DA", "number": 48496, "title": "Fixes to AC::Streaming docs", "user": {"login": "zzak", "id": 277819, "node_id": "MDQ6VXNlcjI3NzgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/277819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zzak", "html_url": "https://github.com/zzak", "followers_url": "https://api.github.com/users/zzak/followers", "following_url": "https://api.github.com/users/zzak/following{/other_user}", "gists_url": "https://api.github.com/users/zzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/zzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zzak/subscriptions", "organizations_url": "https://api.github.com/users/zzak/orgs", "repos_url": "https://api.github.com/users/zzak/repos", "events_url": "https://api.github.com/users/zzak/events{/privacy}", "received_events_url": "https://api.github.com/users/zzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107189, "node_id": "MDU6TGFiZWwxMDcxODk=", "url": "https://api.github.com/repos/rails/rails/labels/actionpack", "name": "actionpack", "color": "FFF700", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-16T07:38:25Z", "updated_at": "2023-06-16T07:42:55Z", "closed_at": "2023-06-16T07:42:54Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48496", "html_url": "https://github.com/rails/rails/pull/48496", "diff_url": "https://github.com/rails/rails/pull/48496.diff", "patch_url": "https://github.com/rails/rails/pull/48496.patch", "merged_at": "2023-06-16T07:42:54Z"}, "body": "* Unlink the Rails module automatically\r\n* Inline the documentation links for unicorn and passenger\r\n* Use RDoc fixed-width for passenger_buffer_response instead of markdown\r\n* TIL: about linking to headings, so fixed that for \"Middlewares\" section\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48496/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48496/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48495", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48495/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48495/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48495/events", "html_url": "https://github.com/rails/rails/pull/48495", "id": 1760067059, "node_id": "PR_kwDNIULOUyksWQ", "number": 48495, "title": "Added `foregin_key` to the allowed validation options for managing columns and tables in migration", "user": {"login": "soartec-lab", "id": 18366969, "node_id": "MDQ6VXNlcjE4MzY2OTY5", "avatar_url": "https://avatars.githubusercontent.com/u/18366969?v=4", "gravatar_id": "", "url": "https://api.github.com/users/soartec-lab", "html_url": "https://github.com/soartec-lab", "followers_url": "https://api.github.com/users/soartec-lab/followers", "following_url": "https://api.github.com/users/soartec-lab/following{/other_user}", "gists_url": "https://api.github.com/users/soartec-lab/gists{/gist_id}", "starred_url": "https://api.github.com/users/soartec-lab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/soartec-lab/subscriptions", "organizations_url": "https://api.github.com/users/soartec-lab/orgs", "repos_url": "https://api.github.com/users/soartec-lab/repos", "events_url": "https://api.github.com/users/soartec-lab/events{/privacy}", "received_events_url": "https://api.github.com/users/soartec-lab/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-16T07:16:19Z", "updated_at": "2023-06-19T01:07:08Z", "closed_at": "2023-06-19T01:07:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48495", "html_url": "https://github.com/rails/rails/pull/48495", "diff_url": "https://github.com/rails/rails/pull/48495.diff", "patch_url": "https://github.com/rails/rails/pull/48495.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because raise an error when adding columns in a new migration if `foregin_key` is included. \r\n\r\n### Detail\r\n\r\nThis Pull Request changes fix an error when adding columns in a new migration if `foregin_key` is included.\r\nThe error occurs in cases where `foregin_key` is specified such as `add_reference` in an old migration definition. For example, the bellow:\r\n\r\n```ruby\r\nclass ChangeTableUsers < ActiveRecord::Migration[6.0]\r\n  def change\r\n    add_reference :users, :posts, foregin_key: true\r\n  end\r\nend\r\n\r\n#=> eval error: Unknown key: :foregin_key. Valid keys are: :limit, :precision, :scale, :default, :null, :collation, :comment, :primary_key, :if_exists, :if_not_exists, :auto_increment, :charset, :as, :size, :unsigned, :first, :after, :type, :stored\r\n```\r\n\r\nAn error is generated if an option other than the allowed option is entered. The `foregin_key` is not included in the allowed options, but it is necessary, so it was added.\r\n\r\nAlso, `add_reference` is now compatible with lower versions.\r\n\r\n### Additional information\r\n\r\n- Modified PR: https://github.com/rails/rails/pull/46178\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48495/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48495/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48494", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48494/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48494/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48494/events", "html_url": "https://github.com/rails/rails/pull/48494", "id": 1760012054, "node_id": "PR_kwDNIULOUyhtKQ", "number": 48494, "title": "Support beginless and endless ranges in `to_fs`", "user": {"login": "ghiculescu", "id": 509837, "node_id": "MDQ6VXNlcjUwOTgzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/509837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghiculescu", "html_url": "https://github.com/ghiculescu", "followers_url": "https://api.github.com/users/ghiculescu/followers", "following_url": "https://api.github.com/users/ghiculescu/following{/other_user}", "gists_url": "https://api.github.com/users/ghiculescu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghiculescu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghiculescu/subscriptions", "organizations_url": "https://api.github.com/users/ghiculescu/orgs", "repos_url": "https://api.github.com/users/ghiculescu/repos", "events_url": "https://api.github.com/users/ghiculescu/events{/privacy}", "received_events_url": "https://api.github.com/users/ghiculescu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-16T06:35:34Z", "updated_at": "2023-06-17T09:45:11Z", "closed_at": "2023-06-17T09:36:14Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48494", "html_url": "https://github.com/rails/rails/pull/48494", "diff_url": "https://github.com/rails/rails/pull/48494.diff", "patch_url": "https://github.com/rails/rails/pull/48494.patch", "merged_at": "2023-06-17T09:36:14Z"}, "body": "Fixes https://github.com/rails/rails/issues/48485\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48494/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48494/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48493", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48493/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48493/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48493/events", "html_url": "https://github.com/rails/rails/pull/48493", "id": 1759911105, "node_id": "PR_kwDNIULOUycbRg", "number": 48493, "title": "Use `SHA256` digest instead of `MD4` that is legacy in OpenSSL 3", "user": {"login": "yahonda", "id": 73684, "node_id": "MDQ6VXNlcjczNjg0", "avatar_url": "https://avatars.githubusercontent.com/u/73684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yahonda", "html_url": "https://github.com/yahonda", "followers_url": "https://api.github.com/users/yahonda/followers", "following_url": "https://api.github.com/users/yahonda/following{/other_user}", "gists_url": "https://api.github.com/users/yahonda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yahonda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yahonda/subscriptions", "organizations_url": "https://api.github.com/users/yahonda/orgs", "repos_url": "https://api.github.com/users/yahonda/repos", "events_url": "https://api.github.com/users/yahonda/events{/privacy}", "received_events_url": "https://api.github.com/users/yahonda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-16T04:43:52Z", "updated_at": "2023-06-16T14:40:28Z", "closed_at": "2023-06-16T04:57:52Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48493", "html_url": "https://github.com/rails/rails/pull/48493", "diff_url": "https://github.com/rails/rails/pull/48493.diff", "patch_url": "https://github.com/rails/rails/pull/48493.patch", "merged_at": "2023-06-16T04:57:52Z"}, "body": "### Motivation / Background\r\n\r\nFix #48483\r\n\r\n### Detail\r\n\r\nThis pull request updates the MD4 digest used in `MessageEncryptorsTest` because OpenSSL 3 moves `MD4` digests as legacy provider.\r\n\r\n[Major changes between OpenSSL 3.0.0 and OpenSSL 3.0.1 [14 Dec 2021]\r\n](https://www.openssl.org/news/openssl-3.0-notes.html\r\n)\r\n> Moved the EVP digests MD2, MD4, MDC2, WHIRLPOOL and RIPEMD-160 to the legacy provider.\r\n\r\nSince Rails CI migrates from Debian 11 \"bullseye\" based Ruby 3.1 and 3.2 images to Debian 12 \"bookworm\" based ones, that supports OpenSSL 3, `MessageEncryptorsTest` raises `EVP_DigestSignInit: unsupported (OpenSSL::HMACError)` and `Digest initialization failed: initialization error (OpenSSL::Digest::DigestError)`\r\n\r\nhttps://packages.debian.org/bookworm/openssl\r\n> Package: openssl (3.0.9-1)\r\n\r\n### Additional information\r\n\r\n`SHA256` is listed as `Provided:` via `openssl list -digest-algorithms` output, so it is safe to use `SHA256` digest in the `MessageEncryptorsTest`.\r\n\r\n```\r\n  { 2.16.840.1.101.3.4.2.1, SHA-256, SHA2-256, SHA256 } @ default\r\n```\r\n\r\n```\r\n$ openssl version\r\nOpenSSL 3.0.8 7 Feb 2023 (Library: OpenSSL 3.0.8 7 Feb 2023)\r\n$ openssl list -digest-algorithms\r\nLegacy:\r\n  RSA-MD4 => MD4\r\n  RSA-MD5 => MD5\r\n  RSA-RIPEMD160 => RIPEMD160\r\n  RSA-SHA1 => SHA1\r\n  RSA-SHA1-2 => RSA-SHA1\r\n  RSA-SHA224 => SHA224\r\n  RSA-SHA256 => SHA256\r\n  RSA-SHA3-224 => SHA3-224\r\n  RSA-SHA3-256 => SHA3-256\r\n  RSA-SHA3-384 => SHA3-384\r\n  RSA-SHA3-512 => SHA3-512\r\n  RSA-SHA384 => SHA384\r\n  RSA-SHA512 => SHA512\r\n  RSA-SHA512/224 => SHA512-224\r\n  RSA-SHA512/256 => SHA512-256\r\n  RSA-SM3 => SM3\r\n  BLAKE2b512\r\n  BLAKE2s256\r\n  id-rsassa-pkcs1-v1_5-with-sha3-224 => SHA3-224\r\n  id-rsassa-pkcs1-v1_5-with-sha3-256 => SHA3-256\r\n  id-rsassa-pkcs1-v1_5-with-sha3-384 => SHA3-384\r\n  id-rsassa-pkcs1-v1_5-with-sha3-512 => SHA3-512\r\n  MD4\r\n  md4WithRSAEncryption => MD4\r\n  MD5\r\n  MD5-SHA1\r\n  md5WithRSAEncryption => MD5\r\n  ripemd => RIPEMD160\r\n  RIPEMD160\r\n  ripemd160WithRSA => RIPEMD160\r\n  rmd160 => RIPEMD160\r\n  SHA1\r\n  sha1WithRSAEncryption => SHA1\r\n  SHA224\r\n  sha224WithRSAEncryption => SHA224\r\n  SHA256\r\n  sha256WithRSAEncryption => SHA256\r\n  SHA3-224\r\n  SHA3-256\r\n  SHA3-384\r\n  SHA3-512\r\n  SHA384\r\n  sha384WithRSAEncryption => SHA384\r\n  SHA512\r\n  SHA512-224\r\n  sha512-224WithRSAEncryption => SHA512-224\r\n  SHA512-256\r\n  sha512-256WithRSAEncryption => SHA512-256\r\n  sha512WithRSAEncryption => SHA512\r\n  SHAKE128\r\n  SHAKE256\r\n  SM3\r\n  sm3WithRSAEncryption => SM3\r\n  ssl3-md5 => MD5\r\n  ssl3-sha1 => SHA1\r\n  whirlpool\r\nProvided:\r\n  { 2.16.840.1.101.3.4.2.10, SHA3-512 } @ default\r\n  { 1.3.6.1.4.1.1722.12.2.2.8, BLAKE2S-256, BLAKE2s256 } @ default\r\n  { 1.2.156.10197.1.401, SM3 } @ default\r\n  { 2.16.840.1.101.3.4.2.8, SHA3-256 } @ default\r\n  { 2.16.840.1.101.3.4.2.7, SHA3-224 } @ default\r\n  { 2.16.840.1.101.3.4.2.2, SHA-384, SHA2-384, SHA384 } @ default\r\n  { 2.16.840.1.101.3.4.2.3, SHA-512, SHA2-512, SHA512 } @ default\r\n  { 2.16.840.1.101.3.4.2.5, SHA-512/224, SHA2-512/224, SHA512-224 } @ default\r\n  { 2.16.840.1.101.3.4.2.12, SHAKE-256, SHAKE256 } @ default\r\n  { 2.16.840.1.101.3.4.2.1, SHA-256, SHA2-256, SHA256 } @ default\r\n  { 1.3.14.3.2.26, SHA-1, SHA1, SSL3-SHA1 } @ default\r\n  { 2.16.840.1.101.3.4.2.9, SHA3-384 } @ default\r\n  { 2.16.840.1.101.3.4.2.11, SHAKE-128, SHAKE128 } @ default\r\n  MD5-SHA1 @ default\r\n  { 1.3.36.3.2.1, RIPEMD, RIPEMD-160, RIPEMD160, RMD160 } @ default\r\n  { 1.2.840.113549.2.5, MD5, SSL3-MD5 } @ default\r\n  { 2.16.840.1.101.3.4.2.4, SHA-224, SHA2-224, SHA224 } @ default\r\n  { 1.3.6.1.4.1.1722.12.2.1.16, BLAKE2B-512, BLAKE2b512 } @ default\r\n  { 2.16.840.1.101.3.4.2.6, SHA-512/256, SHA2-512/256, SHA512-256 } @ default\r\n  { KECCAK-KMAC-128, KECCAK-KMAC128 } @ default\r\n  { KECCAK-KMAC-256, KECCAK-KMAC256 } @ default\r\n  NULL @ default\r\n$\r\n```\r\n\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48493/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48493/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48492", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48492/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48492/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48492/events", "html_url": "https://github.com/rails/rails/pull/48492", "id": 1759698630, "node_id": "PR_kwDNIULOUyRtHA", "number": 48492, "title": "Update NOTE for add_enum_value [ci skip] ", "user": {"login": "sampatbadhe", "id": 5279284, "node_id": "MDQ6VXNlcjUyNzkyODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5279284?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sampatbadhe", "html_url": "https://github.com/sampatbadhe", "followers_url": "https://api.github.com/users/sampatbadhe/followers", "following_url": "https://api.github.com/users/sampatbadhe/following{/other_user}", "gists_url": "https://api.github.com/users/sampatbadhe/gists{/gist_id}", "starred_url": "https://api.github.com/users/sampatbadhe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sampatbadhe/subscriptions", "organizations_url": "https://api.github.com/users/sampatbadhe/orgs", "repos_url": "https://api.github.com/users/sampatbadhe/repos", "events_url": "https://api.github.com/users/sampatbadhe/events{/privacy}", "received_events_url": "https://api.github.com/users/sampatbadhe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150377, "node_id": "MDU6TGFiZWwxNTAzNzc=", "url": "https://api.github.com/repos/rails/rails/labels/docs", "name": "docs", "color": "02d7e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-16T00:09:07Z", "updated_at": "2023-06-16T23:54:48Z", "closed_at": "2023-06-16T23:54:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48492", "html_url": "https://github.com/rails/rails/pull/48492", "diff_url": "https://github.com/rails/rails/pull/48492.diff", "patch_url": "https://github.com/rails/rails/pull/48492.patch", "merged_at": "2023-06-16T23:54:47Z"}, "body": "Update NOTE for add_enum_value - Enum values can be renamed.\r\nhttps://github.com/rails/rails/pull/44898\r\n\r\ncc: @rayfaddis ", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48492/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48492/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48491", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48491/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48491/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48491/events", "html_url": "https://github.com/rails/rails/pull/48491", "id": 1759627479, "node_id": "PR_kwDNIULOUyN_MA", "number": 48491, "title": "Bugfix: Ensure has_one associations saved when part of CPK has changed", "user": {"login": "adrianna-chang-shopify", "id": 22918438, "node_id": "MDQ6VXNlcjIyOTE4NDM4", "avatar_url": "https://avatars.githubusercontent.com/u/22918438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adrianna-chang-shopify", "html_url": "https://github.com/adrianna-chang-shopify", "followers_url": "https://api.github.com/users/adrianna-chang-shopify/followers", "following_url": "https://api.github.com/users/adrianna-chang-shopify/following{/other_user}", "gists_url": "https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}", "starred_url": "https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adrianna-chang-shopify/subscriptions", "organizations_url": "https://api.github.com/users/adrianna-chang-shopify/orgs", "repos_url": "https://api.github.com/users/adrianna-chang-shopify/repos", "events_url": "https://api.github.com/users/adrianna-chang-shopify/events{/privacy}", "received_events_url": "https://api.github.com/users/adrianna-chang-shopify/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-15T22:25:16Z", "updated_at": "2023-06-16T12:48:41Z", "closed_at": "2023-06-16T12:48:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48491", "html_url": "https://github.com/rails/rails/pull/48491", "diff_url": "https://github.com/rails/rails/pull/48491.diff", "patch_url": "https://github.com/rails/rails/pull/48491.patch", "merged_at": "2023-06-16T12:48:38Z"}, "body": "### Motivation / Background\r\n\r\nIf a has_one association uses a composite primary key, and part of the composite primary key changes on the owner, these changes need to be reflected on the belonging object's foreign key.\r\n\r\nThis was not working previously, because `#_record_changed?` was not equipped to handle composite primary key associations, so we were not recognizing that the belonging object's foreign key needed to be updated when the owner's primary key changed.\r\n\r\n### Detail\r\n\r\nMaintain the same check as was previously used in `#_record_changed?`, but adjust it to accommodate composite primary | foreign keys. This means checking that the record has _all_ attributes that form the primary key on the owner, and then checking that the composite FK values don't match the owner's PK. This indicates that the record has changed, and that we should update its foreign key values accordingly.\r\n\r\n### Additional information\r\n\r\n<!-- Provide additional information such as benchmarks, reference to other repositories or alternative solutions. -->\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included. (N/A)\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48491/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48491/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48490", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48490/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48490/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48490/events", "html_url": "https://github.com/rails/rails/pull/48490", "id": 1759527409, "node_id": "PR_kwDNIULOUyIi6A", "number": 48490, "title": "Eager load composite primary keys models", "user": {"login": "gmcgibbon", "id": 5162312, "node_id": "MDQ6VXNlcjUxNjIzMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5162312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gmcgibbon", "html_url": "https://github.com/gmcgibbon", "followers_url": "https://api.github.com/users/gmcgibbon/followers", "following_url": "https://api.github.com/users/gmcgibbon/following{/other_user}", "gists_url": "https://api.github.com/users/gmcgibbon/gists{/gist_id}", "starred_url": "https://api.github.com/users/gmcgibbon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gmcgibbon/subscriptions", "organizations_url": "https://api.github.com/users/gmcgibbon/orgs", "repos_url": "https://api.github.com/users/gmcgibbon/repos", "events_url": "https://api.github.com/users/gmcgibbon/events{/privacy}", "received_events_url": "https://api.github.com/users/gmcgibbon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-06-15T20:48:20Z", "updated_at": "2023-06-19T18:34:14Z", "closed_at": "2023-06-16T18:09:39Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48490", "html_url": "https://github.com/rails/rails/pull/48490", "diff_url": "https://github.com/rails/rails/pull/48490.diff", "patch_url": "https://github.com/rails/rails/pull/48490.patch", "merged_at": "2023-06-16T18:09:39Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because eager loading models and associations with composite primary keys is currently broken.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes join dependency assignment to properly handle nodes with composite primary keys.\r\n\r\n### Additional information\r\n\r\nI also had to change `distinct_relation_for_primary_key` to handle composite keys for has_many/has_one relations. I chose to use `Array#transpose` because we basically have to turn `[[id], [other_id]]` into `[[id, other_id]]`, or `[[cpk_id_1, cpk_id_2], [other_cpk_id_1, other_cpk_id_2]]` into `[[cpk_id_1, other_cpk_id_1], [cpk_id_2, other_cpk_id_2]]` in the composite primary key case.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n\r\nI chose to include the patch for belongs_to and has_many/has_one in one PR. Happy to split it into two if needed.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48490/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48490/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48489", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48489/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48489/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48489/events", "html_url": "https://github.com/rails/rails/pull/48489", "id": 1759403228, "node_id": "PR_kwDNIULOUyCAEA", "number": 48489, "title": "Use _read_attribute when autosaving has_one associations", "user": {"login": "gmcgibbon", "id": 5162312, "node_id": "MDQ6VXNlcjUxNjIzMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5162312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gmcgibbon", "html_url": "https://github.com/gmcgibbon", "followers_url": "https://api.github.com/users/gmcgibbon/followers", "following_url": "https://api.github.com/users/gmcgibbon/following{/other_user}", "gists_url": "https://api.github.com/users/gmcgibbon/gists{/gist_id}", "starred_url": "https://api.github.com/users/gmcgibbon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gmcgibbon/subscriptions", "organizations_url": "https://api.github.com/users/gmcgibbon/orgs", "repos_url": "https://api.github.com/users/gmcgibbon/repos", "events_url": "https://api.github.com/users/gmcgibbon/events{/privacy}", "received_events_url": "https://api.github.com/users/gmcgibbon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-15T19:11:10Z", "updated_at": "2023-06-19T18:34:20Z", "closed_at": "2023-06-16T18:09:04Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48489", "html_url": "https://github.com/rails/rails/pull/48489", "diff_url": "https://github.com/rails/rails/pull/48489.diff", "patch_url": "https://github.com/rails/rails/pull/48489.patch", "merged_at": "2023-06-16T18:09:04Z"}, "body": "### Motivation / Background\r\n\r\nThis Pull Request has been created because composite primary key models do not autosave properly when their association primary key is set to `:id`. In models with composite primary keys, the `#id` accessor will return an array, where we actually want the id column value.\r\n\r\n### Detail\r\n\r\nThis Pull Request changes has_one autosaving to use `_read_attribute` instead of `public_send` so that it won't use the `#id` accessor.\r\n\r\n### Additional information\r\n\r\nAre we concerned with this breaking behaviour of existing apps?\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48489/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48489/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48488", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48488/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48488/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48488/events", "html_url": "https://github.com/rails/rails/pull/48488", "id": 1759386886, "node_id": "PR_kwDNIULOUyBFyQ", "number": 48488, "title": "Remove no connection primary key test", "user": {"login": "eileencodes", "id": 1080678, "node_id": "MDQ6VXNlcjEwODA2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1080678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eileencodes", "html_url": "https://github.com/eileencodes", "followers_url": "https://api.github.com/users/eileencodes/followers", "following_url": "https://api.github.com/users/eileencodes/following{/other_user}", "gists_url": "https://api.github.com/users/eileencodes/gists{/gist_id}", "starred_url": "https://api.github.com/users/eileencodes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eileencodes/subscriptions", "organizations_url": "https://api.github.com/users/eileencodes/orgs", "repos_url": "https://api.github.com/users/eileencodes/repos", "events_url": "https://api.github.com/users/eileencodes/events{/privacy}", "received_events_url": "https://api.github.com/users/eileencodes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-15T19:01:14Z", "updated_at": "2023-07-09T09:55:48Z", "closed_at": "2023-06-15T19:09:27Z", "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48488", "html_url": "https://github.com/rails/rails/pull/48488", "diff_url": "https://github.com/rails/rails/pull/48488.diff", "patch_url": "https://github.com/rails/rails/pull/48488.patch", "merged_at": "2023-06-15T19:09:27Z"}, "body": "This test was added in https://github.com/rails/rails/commit/b3407c86cfccd2cc6258b8879e91600fe25c6e48 at a time when Rails was reading the `primary_keys` off a hash stored on `connection`. We no longer do that in Active Record so this test isn't really necessary. I'm removing it because it was flaky. I attempted to fix it in #48473 but realized today it's not testing the same thing it was before. After discussing it with Matthew, I've decided to remove it.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48488/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48488/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48487", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48487/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48487/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48487/events", "html_url": "https://github.com/rails/rails/pull/48487", "id": 1759321614, "node_id": "PR_kwDNIULOUx9kEA", "number": 48487, "title": "Apply scope to association subqueries", "user": {"login": "lazaronixon", "id": 2651240, "node_id": "MDQ6VXNlcjI2NTEyNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/2651240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lazaronixon", "html_url": "https://github.com/lazaronixon", "followers_url": "https://api.github.com/users/lazaronixon/followers", "following_url": "https://api.github.com/users/lazaronixon/following{/other_user}", "gists_url": "https://api.github.com/users/lazaronixon/gists{/gist_id}", "starred_url": "https://api.github.com/users/lazaronixon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lazaronixon/subscriptions", "organizations_url": "https://api.github.com/users/lazaronixon/orgs", "repos_url": "https://api.github.com/users/lazaronixon/repos", "events_url": "https://api.github.com/users/lazaronixon/events{/privacy}", "received_events_url": "https://api.github.com/users/lazaronixon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-15T18:13:11Z", "updated_at": "2023-06-29T06:28:05Z", "closed_at": "2023-06-20T22:07:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48487", "html_url": "https://github.com/rails/rails/pull/48487", "diff_url": "https://github.com/rails/rails/pull/48487.diff", "patch_url": "https://github.com/rails/rails/pull/48487.patch", "merged_at": "2023-06-20T22:07:29Z"}, "body": "### Motivation / Background\r\n\r\nApply scope to association subqueries. (belongs_to/has_one/has_many).\r\n\r\nGiven: \r\n\r\n```ruby\r\nclass Author < ApplicationRecord\r\n  has_many :welcome_posts, -> { where(title: \"welcome\") } , class_name: \"Post\"\r\nend\r\n```\r\n\r\nBefore:\r\n\r\n```ruby\r\nAuthor.where(welcome_posts: Post.all)\r\n#=> SELECT (...) WHERE \"authors\".\"id\" IN (SELECT \"posts\".\"author_id\" FROM \"posts\")\r\n```\r\n\r\nLater:\r\n\r\n```ruby\r\nAuthor.where(welcome_posts: Post.all)\r\n#=> SELECT (...) WHERE \"authors\".\"id\" IN (SELECT \"posts\".\"author_id\" FROM \"posts\" WHERE \"posts\".\"title\" = 'welcome')\r\n```\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48487/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48487/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48486", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48486/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48486/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48486/events", "html_url": "https://github.com/rails/rails/issues/48486", "id": 1759285533, "node_id": "I_kwDNIULOaNyRHQ", "number": 48486, "title": "PostgreSQL Range adapter throws `NoMethodError` for an empty string value", "user": {"login": "clairity", "id": 950439, "node_id": "MDQ6VXNlcjk1MDQzOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/950439?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clairity", "html_url": "https://github.com/clairity", "followers_url": "https://api.github.com/users/clairity/followers", "following_url": "https://api.github.com/users/clairity/following{/other_user}", "gists_url": "https://api.github.com/users/clairity/gists{/gist_id}", "starred_url": "https://api.github.com/users/clairity/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clairity/subscriptions", "organizations_url": "https://api.github.com/users/clairity/orgs", "repos_url": "https://api.github.com/users/clairity/repos", "events_url": "https://api.github.com/users/clairity/events{/privacy}", "received_events_url": "https://api.github.com/users/clairity/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-06-15T17:44:31Z", "updated_at": "2023-06-26T16:05:09Z", "closed_at": "2023-06-26T16:05:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "when trying to save a postgres `int4range` value that is an empty string (as would be submitted by a form post with a blank value), the postgresql adapter throws a `NoMethodError`. but when `nil` is passed, it handles that gracefully and inserts a `null` value into the field in postgres, as expected.\r\n\r\n```sh\r\n> User.new(my_int_range: \"\").save\r\nNoMethodError: undefined method `split' for nil:NilClass\r\nfrom .../activerecord/lib/active_record/connection_adapters/postgresql/oid/range.rb:70:in `extract_bounds'\r\n> User.new(my_int_range: nil).save\r\n=> true\r\n```\r\n\r\nit looks like there are safeguards in place to handle exceptional values like `nil`:\r\n\r\nhttps://github.com/rails/rails/blob/dfc365949b1b18f8a25eb4eec696982442ed28f7/activerecord/lib/active_record/connection_adapters/postgresql/oid/range.rb#L20-L24\r\n\r\nbut an empty string is not handled gracefully. at the very least, the error returned is misleading, as it should really tell you that an empty string is an invalid value for range types. however, for range types, it seems empty strings should be handled the same way as `nil` values, given that they're always invalid (rather than indicating an empty value), and be converted to `null` for persistence rather than erroring out.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48486/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48486/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48485", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48485/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48485/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48485/events", "html_url": "https://github.com/rails/rails/issues/48485", "id": 1759188604, "node_id": "I_kwDNIULOaNsWfA", "number": 48485, "title": "`ActiveSupport::RangeWithFormat` fails for beginless and endless ranges", "user": {"login": "clairity", "id": 950439, "node_id": "MDQ6VXNlcjk1MDQzOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/950439?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clairity", "html_url": "https://github.com/clairity", "followers_url": "https://api.github.com/users/clairity/followers", "following_url": "https://api.github.com/users/clairity/following{/other_user}", "gists_url": "https://api.github.com/users/clairity/gists{/gist_id}", "starred_url": "https://api.github.com/users/clairity/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clairity/subscriptions", "organizations_url": "https://api.github.com/users/clairity/orgs", "repos_url": "https://api.github.com/users/clairity/repos", "events_url": "https://api.github.com/users/clairity/events{/privacy}", "received_events_url": "https://api.github.com/users/clairity/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 41328116, "node_id": "MDU6TGFiZWw0MTMyODExNg==", "url": "https://api.github.com/repos/rails/rails/labels/attached%20PR", "name": "attached PR", "color": "006b75", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-15T16:31:49Z", "updated_at": "2023-06-17T14:22:27Z", "closed_at": "2023-06-17T09:36:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Steps to reproduce / Actual behavior\r\ni stumbled across this issue while experimenting with Range support on the rails console:\r\n\r\n```sh\r\n> (0..1).to_fs(:db)\r\n=> \"BETWEEN '0' AND '1'\"\r\n> (..1).to_fs(:db)\r\nRangeError: cannot get the first element of beginless range\r\nfrom .../activesupport/lib/active_support/core_ext/range/conversions.rb:33:in `first'\r\n> (0..).to_fs(:db)\r\nRangeError: cannot get the last element of endless range\r\nfrom .../activesupport/lib/active_support/core_ext/range/conversions.rb:33:in `last'\r\n```\r\n\r\n### Expected behavior\r\n```sh\r\n> (0..1).to_fs(:db)\r\n=> \"BETWEEN '0' AND '1'\"\r\n> (..1).to_fs(:db)\r\n=> \"LESS THAN '1'\"\r\n> (0..).to_fs(:db)\r\n=> \"GREATER THAN '0'\"\r\n```\r\n\r\n### System configuration\r\n**Rails version**: 7.1.alpha\r\n**Ruby version**: 3.2.2\r\n\r\ni realize that the expected messages here are arbitrary (and not part of the default formatter message), and a custom formatter can be added to `Range::RANGE_FORMATS`, but that still won't handle a beginless or endless range as input.\r\n\r\nit seems the problem here is passing `first` and `last` rather than `begin` and `end` (which would instead return `nil` for endless/beginless endpoints) on this line of the `to_fs` method referenced in the error:\r\n\r\nhttps://github.com/rails/rails/blob/dfc365949b1b18f8a25eb4eec696982442ed28f7/activesupport/lib/active_support/core_ext/range/conversions.rb#L33\r\n\r\nit would be great to be able to format beginless/endless ranges using the built-in `ActiveSupport::RangeWithFormat` feature.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48485/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48485/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48484", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48484/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48484/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48484/events", "html_url": "https://github.com/rails/rails/pull/48484", "id": 1759143427, "node_id": "PR_kwDNIULOUxz7RQ", "number": 48484, "title": "Fix setting inverses for composite primary key associations", "user": {"login": "adrianna-chang-shopify", "id": 22918438, "node_id": "MDQ6VXNlcjIyOTE4NDM4", "avatar_url": "https://avatars.githubusercontent.com/u/22918438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adrianna-chang-shopify", "html_url": "https://github.com/adrianna-chang-shopify", "followers_url": "https://api.github.com/users/adrianna-chang-shopify/followers", "following_url": "https://api.github.com/users/adrianna-chang-shopify/following{/other_user}", "gists_url": "https://api.github.com/users/adrianna-chang-shopify/gists{/gist_id}", "starred_url": "https://api.github.com/users/adrianna-chang-shopify/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adrianna-chang-shopify/subscriptions", "organizations_url": "https://api.github.com/users/adrianna-chang-shopify/orgs", "repos_url": "https://api.github.com/users/adrianna-chang-shopify/repos", "events_url": "https://api.github.com/users/adrianna-chang-shopify/events{/privacy}", "received_events_url": "https://api.github.com/users/adrianna-chang-shopify/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-15T16:01:30Z", "updated_at": "2023-06-15T18:03:22Z", "closed_at": "2023-06-15T18:03:19Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48484", "html_url": "https://github.com/rails/rails/pull/48484", "diff_url": "https://github.com/rails/rails/pull/48484.diff", "patch_url": "https://github.com/rails/rails/pull/48484.patch", "merged_at": "2023-06-15T18:03:19Z"}, "body": "### Motivation / Background\r\n\r\nChecking whether a record has a foreign key for a composite primary key association requires us to check whether all parts of the foreign key are present. Otherwise, the inverse association will not be set.\r\n\r\n### Detail\r\n\r\nCheck all parts of the foreign key to determine `#foreign_key_for?`.\r\n\r\n### Additional information\r\n\r\nI added a more granular test to `inverse_associations_test.rb` that verifies that the CPK association on the child is loaded appropriately. I also added a more generic test in `belongs_to_associations_test.rb` that ensures that the `belongs_to` associations are saved properly as a result of the inverse association being set.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [X] Tests are added or updated if you fix a bug or add a feature.\r\n* [X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included. (N/A)\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48484/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48484/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48483", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48483/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48483/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48483/events", "html_url": "https://github.com/rails/rails/issues/48483", "id": 1758640577, "node_id": "I_kwDNIULOaNK5wQ", "number": 48483, "title": "Active Support unit tests fails against Ruby 3.1 and 3.2", "user": {"login": "yahonda", "id": 73684, "node_id": "MDQ6VXNlcjczNjg0", "avatar_url": "https://avatars.githubusercontent.com/u/73684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yahonda", "html_url": "https://github.com/yahonda", "followers_url": "https://api.github.com/users/yahonda/followers", "following_url": "https://api.github.com/users/yahonda/following{/other_user}", "gists_url": "https://api.github.com/users/yahonda/gists{/gist_id}", "starred_url": "https://api.github.com/users/yahonda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yahonda/subscriptions", "organizations_url": "https://api.github.com/users/yahonda/orgs", "repos_url": "https://api.github.com/users/yahonda/repos", "events_url": "https://api.github.com/users/yahonda/events{/privacy}", "received_events_url": "https://api.github.com/users/yahonda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}, {"id": 776781281, "node_id": "MDU6TGFiZWw3NzY3ODEyODE=", "url": "https://api.github.com/repos/rails/rails/labels/ci%20issues", "name": "ci issues", "color": "aaafff", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-06-15T11:38:46Z", "updated_at": "2023-06-16T04:57:53Z", "closed_at": "2023-06-16T04:57:53Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Steps to reproduce\r\nhttps://buildkite.com/rails/rails/builds/97157#0188bbe5-7031-470f-a9ef-8c72d49e5116/1052-1061\r\n\r\nhttps://buildkite.com/rails/rails/builds/97157#0188bbe5-70b9-47d2-b3b4-f8fbdd4cf611/1167-1176\r\n\r\n### Expected behavior\r\nActive Support unit tests should run against all Ruby versions 3.0, 3.1, 3.2 and 3.3.0dev\r\n\r\n### Actual behavior\r\nActive Support unit tests fail against Ruby 3.1 and 3.2, Ruby 3.0 and 3.3.0dev are fine.\r\n\r\n### System configuration\r\n**Rails version**: main branch\r\n\r\n**Ruby version**:\r\nRuby          3.1.4p223 (2023-03-30 revision 957bb7cb81995f26c671afce0ee50a5c660e540e) [x86_64-linux]\r\n\r\nRuby          3.2.2p53 (2023-03-30 revision e51014f9c05aa65cbf203442d37fef7c12390015) [x86_64-linux]", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48483/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48483/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48482", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48482/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48482/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48482/events", "html_url": "https://github.com/rails/rails/pull/48482", "id": 1758404452, "node_id": "PR_kwDNIULOUxL4Fg", "number": 48482, "title": "Improve error messages of `assert_changes` and `assert_no_changes`", "user": {"login": "pcreux", "id": 45299, "node_id": "MDQ6VXNlcjQ1Mjk5", "avatar_url": "https://avatars.githubusercontent.com/u/45299?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcreux", "html_url": "https://github.com/pcreux", "followers_url": "https://api.github.com/users/pcreux/followers", "following_url": "https://api.github.com/users/pcreux/following{/other_user}", "gists_url": "https://api.github.com/users/pcreux/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcreux/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcreux/subscriptions", "organizations_url": "https://api.github.com/users/pcreux/orgs", "repos_url": "https://api.github.com/users/pcreux/repos", "events_url": "https://api.github.com/users/pcreux/events{/privacy}", "received_events_url": "https://api.github.com/users/pcreux/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107194, "node_id": "MDU6TGFiZWwxMDcxOTQ=", "url": "https://api.github.com/repos/rails/rails/labels/activesupport", "name": "activesupport", "color": "FC9300", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-15T09:18:25Z", "updated_at": "2023-06-15T09:18:29Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48482", "html_url": "https://github.com/rails/rails/pull/48482", "diff_url": "https://github.com/rails/rails/pull/48482.diff", "patch_url": "https://github.com/rails/rails/pull/48482.patch", "merged_at": null}, "body": "### Motivation / Background\r\n\r\nMake `assert_changes` error messages show objects with `.inspect` so that `nil` is displayed as \"nil\" instead of an empty string, we can differentiate strings and symbols, etc.\r\n\r\nMake `assert_no_changes` error messages surface the actual value.\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n\r\nLet me know if I should update the CHANGELOG as this is a minor change.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48482/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48482/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/rails/rails/issues/48481", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48481/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48481/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48481/events", "html_url": "https://github.com/rails/rails/issues/48481", "id": 1758336207, "node_id": "I_kwDNIULOaM4Uzw", "number": 48481, "title": "Rails 7.0.3 & 7.0.4 pool_config error only in test environment", "user": {"login": "aksharj", "id": 8026629, "node_id": "MDQ6VXNlcjgwMjY2Mjk=", "avatar_url": "https://avatars.githubusercontent.com/u/8026629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aksharj", "html_url": "https://github.com/aksharj", "followers_url": "https://api.github.com/users/aksharj/followers", "following_url": "https://api.github.com/users/aksharj/following{/other_user}", "gists_url": "https://api.github.com/users/aksharj/gists{/gist_id}", "starred_url": "https://api.github.com/users/aksharj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aksharj/subscriptions", "organizations_url": "https://api.github.com/users/aksharj/orgs", "repos_url": "https://api.github.com/users/aksharj/repos", "events_url": "https://api.github.com/users/aksharj/events{/privacy}", "received_events_url": "https://api.github.com/users/aksharj/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-06-15T08:41:32Z", "updated_at": "2023-06-16T13:58:47Z", "closed_at": "2023-06-15T12:49:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nI am on `Rails 7.0.3 & ruby 2.7.4p191` and have the following model definition\r\n\r\n```\r\nclass ExternalRecord < ApplicationRecord\r\n  self.abstract_class = true\r\n  #establish_connection :main_red\r\n  connects_to database: {\r\n    main_red: :main_red,\r\n    main_green: :main_green,\r\n    main_blue: :main_blue\r\n  }\r\nend\r\n```\r\nI want to switch to reading from different databases based on few conditions, `this seems to be working very well on development environment`\r\n\r\ni am using below code to switch to different databases\r\n```\r\nActiveRecord::Base.connected_to(role: @main_db_name.to_sym) do\r\n        result = Api::V2::Gom::T1::Platform.ransack(params[:q]).result.page(params[:page]).per(get_rows_limit)\r\n      end\r\n```\r\nbut when when i try to run rspec tests, i get an error\r\n\r\n\r\nhers is the relevant code in the test\r\n\r\n```\r\n\r\nRSpec.shared_examples \"NON EMPTY(US Horizontals)\" do |end_point, token|\r\n  it \"/#{end_point}\" do\r\n    get(\"/api/v2/#{end_point}\", params: {\r\n      authentication_token: @token,\r\n    })\r\n    data = JSON.parse(response.body)\r\n    expect(response.status).to eql(200)\r\n    expect(data).to be_an_instance_of(Array)\r\n    expect(data.count).to be > 0\r\n  end\r\nend\r\n```\r\n\r\nin the processing of the request is where i switch to different database based on the certain conditions,but this is generating the following error.\r\n\r\n```\r\nArgumentError (The `pool_config` for the :reading_main_red role and :default shard was `nil`. Please check your configuration. If you want your writing role to be something other than `:writing` set `config.active_record.writing_role` in your application configuration. The same setting should be applied for the `reading_role` if applicable.):\r\n```\r\ndatabase.yml as pool setting. it would be great if someone can point me in the right directions, could it be something related my rails configuration or may be something in rspec that i a missing?\r\n\r\nplease help.\r\n\r\nThanks.", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48481/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48481/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/rails/rails/issues/48480", "repository_url": "https://api.github.com/repos/rails/rails", "labels_url": "https://api.github.com/repos/rails/rails/issues/48480/labels{/name}", "comments_url": "https://api.github.com/repos/rails/rails/issues/48480/comments", "events_url": "https://api.github.com/repos/rails/rails/issues/48480/events", "html_url": "https://github.com/rails/rails/pull/48480", "id": 1758171062, "node_id": "PR_kwDNIULOUw_RUQ", "number": 48480, "title": "Add unique option to belongs_to association", "user": {"login": "lazaronixon", "id": 2651240, "node_id": "MDQ6VXNlcjI2NTEyNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/2651240?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lazaronixon", "html_url": "https://github.com/lazaronixon", "followers_url": "https://api.github.com/users/lazaronixon/followers", "following_url": "https://api.github.com/users/lazaronixon/following{/other_user}", "gists_url": "https://api.github.com/users/lazaronixon/gists{/gist_id}", "starred_url": "https://api.github.com/users/lazaronixon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lazaronixon/subscriptions", "organizations_url": "https://api.github.com/users/lazaronixon/orgs", "repos_url": "https://api.github.com/users/lazaronixon/repos", "events_url": "https://api.github.com/users/lazaronixon/events{/privacy}", "received_events_url": "https://api.github.com/users/lazaronixon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 107191, "node_id": "MDU6TGFiZWwxMDcxOTE=", "url": "https://api.github.com/repos/rails/rails/labels/activerecord", "name": "activerecord", "color": "0b02e1", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-06-15T07:00:03Z", "updated_at": "2023-06-17T19:55:43Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rails/rails/pulls/48480", "html_url": "https://github.com/rails/rails/pull/48480", "diff_url": "https://github.com/rails/rails/pull/48480.diff", "patch_url": "https://github.com/rails/rails/pull/48480.patch", "merged_at": null}, "body": "Since version 7.0.5 https://github.com/rails/rails/commit/bdbe58b50461dc44c42df4d5427fa78aeb1debcb  we are able to properly keep integrity in `has_one` relationships, so when we create a new record `account.create_client(...)` it will prevent duplication, but we can still bypass it on the other side of the relationship using `Client.create!(..., account: existing_account)`. \r\n\r\nThat said I'm proposing to add a new option `unique` to the `belongs_to` method. Here are some advantages of this approach...\r\n\r\n- Unique indexes are not required.\r\n- Different from unique indexes we can use it with an optional association.\r\n- Take advantage of the new `belongs_to_required_validates_foreign_key`.\r\n- Validation API, messages, etc...\r\n\r\nBefore:\r\n\r\n```ruby    \r\nclass Client\r\n  belongs_to :account; validates_uniqueness_of(:account, allow_nil: true, message: :unique)\r\nend\r\n```\r\n\r\nLater:\r\n\r\n  ```ruby\r\nclass Client\r\n    belongs_to :account, unique: true\r\nend\r\n ```\r\n\r\n### Additional information\r\n\r\nhttps://thoughtbot.com/blog/rails-has-one-limitations\r\n\r\n### Checklist\r\n\r\nBefore submitting the PR make sure the following are checked:\r\n\r\n* [x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.\r\n* [x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: `[Fix #issue-number]`\r\n* [x] Tests are added or updated if you fix a bug or add a feature.\r\n* [x] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.\r\n", "reactions": {"url": "https://api.github.com/repos/rails/rails/issues/48480/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rails/rails/issues/48480/timeline", "performed_via_github_app": null, "state_reason": null}]